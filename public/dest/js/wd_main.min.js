function a(s){
    var DEFAULT_DATE=null;String.prototype.capitalize=function(e){e=e||"_";var t=this.toLowerCase(),a=t.split(e);return $.each(a,(e,t)=>{a[e]=t.substr(0,1).toUpperCase()+t.substr(1)}),t=a.join(" ")},String.prototype.merge=function(){return this.replace(/ /g,"_").toLowerCase()},String.prototype.isEmpty=function(){return""==this.trim()},String.prototype._trim=function(e){var t=this.toString();return e&&(t=t.replace(/[^\x00-\x7F]/g,"")),t.replace(/ +(?= )/g,"").trim()},Array.prototype.insert=function(e,t){this.splice(e,0,t)},Array.prototype.isEmpty=function(e,t){return 0==this.length};var OBJECT={sortByKey:e=>Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{}),getKeyByValue:(e,t)=>Object.keys(e).find(a=>e[a]===t)},DATETIME={FORMAT:function(e,t="MMM D, YYYY, h:mm A",a="-"){return e?moment(new Date(e)).format(t):a},DH:function(e,t,a="-"){if(e&&e>=0&&(a=e/3600/1e3),null!=t){t=t.toString().replace(/ /g,"");var i=moment.duration(t).asHours();a=Math.round(100*i)/100}return a},HH_MM:function(e,t,a="-"){var i="",n="";return(e&&e>=0||null!=t)&&(e&&e>=0&&(t=e/3600/1e3),null!=t&&(t=Number(t)),i=(t=t.toFixed(2)).toString().split(".")[0],n=JSON.stringify(Math.round(t%1*60)).split(".")[0],i=isNaN(Number(i))?"00":Number(i),n=isNaN(Number(n))?"00":Number(n),i.toString().length<2&&(i="0"+i),n.toString().length<2&&(n="0"+n),a=`${i}:${n}`),{hour:i,minute:n,hour_minute:a}}},GET={AJAX:function(e,t,a){$.ajax(e).done(function(e){"function"==typeof t&&t(e)}).fail(function(e){"function"==typeof a&&a(e)})},BROWSER:function(){var e="Unknown";(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(e="Opera 8.0+"),"undefined"!=typeof InstallTrigger&&(e="Firefox 1.0+"),(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString())&&(e="Safari 3.0+");var t=!!document.documentMode;return t&&(e="Internet Explorer 6-11"),!t&&window.StyleMedia&&(e="Edge 20+"),window.chrome&&(window.chrome.webstore||window.chrome.runtime)&&(e="Chrome 1-71"),e},LENGTH:function(e){return{text:--e>0?`<small class="text-primary"> and ${e} ${1==e?"other":"others"}</small>`:"",actual:e}},ROUND_OFF:function(e,t=2){return Number(Math.round(e+`e${t}`)+`e-${t}`)},TEXT_BETWEEN:function(e,t,a){return(e.match(`${t}(.*)${a}`)||[])[1]},PERCENTAGE:function(e=0,t=1){return GET.ROUND_OFF(100*e,t)},INTLTELINPUT:function(e){$(e).intlTelInput({preferredCountries:["ph"],separateDialCode:!0,utilsScript:"./public/vendor/intlTelInput/utils.js"}),$(e).on("countrychange",function(t,a){GENERATE.MASK(e)}),setTimeout(function(){GENERATE.MASK(e),$(e).css("padding-left","80px")},1e3),$(e).css("padding-left","80px")},INTLTELINPUT_VALUE:function(e){return $($(".iti__selected-flag")[0]).text()+$(e).val().replace(/ /g,"")}},SORT={ARRAY_OBJECT:function(e,t,a={}){return e.sort(function(e,i){if(e[t]=e[t]||"",i[t]=i[t]||"","number"==typeof e[t]){var n=e[t],s=i[t];return"asc"==a.sortType?n-s:s-n}return"asc"==a.sortType?e[t].toLowerCase().localeCompare(i[t].toLowerCase()):i[t].toLowerCase().localeCompare(e[t].toLowerCase())}),e},OBJECT:function(e,t){var a=[];return Object.keys(e).sort(function(a,i){return e[i][t]-e[a][t]}).forEach(function(t){a.push(e[t])}),a}},CRYPTO={ENCRYPT:function(e){return window.btoa(JSON.stringify(e||{}))},DECRYPT:function(e){var t={};try{var a=window.atob(e);t=e?JSON.parse(a):{}}catch(e){}return t}},GENERATE={RANDOM:function(e=6){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var a="",i=e;i>0;--i)a+=t[Math.round(Math.random()*(t.length-1))];return a},MASK:function(e){var t=$(e).attr("placeholder");if(t){var a=t.replace(/\d/g,"9");$(e).mask(a),$(e).blur()}},HIDESHOWPASSWORD:function(e){$(e).hideShowPassword({innerToggle:!0,toggle:{className:"hideShowPassword-toggle toggle-eye"},states:{shown:{toggle:{content:'<i class="la la-eye-slash">'}},hidden:{toggle:{content:'<i class="la la-eye">'}}}})},TABLE_TO_EXCEL:function(){var e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement:same-cell;}</style></head><body><table cellspacing="0" rules="rows" border="1" style="color:Black;background-color:White;border-color:#CCCCCC;border-width:1px;border-style:None;width:100%;border-collapse:collapse;font-size:9pt;text-align:center;">{table}</table></body></html>',t=function(e,t){return e.replace(/{(\w+)}/g,function(e,a){return t[a]})};return function(a,i){a.nodeType||(a=document.getElementById(a));var n,s={worksheet:"Worksheet",table:a.innerHTML};if(navigator.msSaveBlob){var l=new Blob([t(e,s)],{type:"application/vnd.ms-excel",endings:"native"});navigator.msSaveBlob(l,`${i}.xls`)}else $("body").append(`<a id="temp-link" href="${"data:application/vnd.ms-excel;base64,"+(n=t(e,s),window.btoa(unescape(encodeURIComponent(n))))}" download="${i}.xls"></a>`),$("#temp-link")[0].click()}}(),CSV:{toArray:function(e,t){t=t||",";for(var a=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),i=[[]],n=null;n=a.exec(e);){var s=n[1];if(s.length&&s!=t&&i.push([]),n[2])var l=n[2].replace(new RegExp('""',"g"),'"');else l=n[3];i[i.length-1].push(l)}return i},toJSON:function(e){for(var t=GENERATE.CSV.toArray(e),a=[],i=1;i<t.length;i++){a[i-1]={};for(var n=0;n<t[0].length&&n<t[i].length;n++){var s=t[0][n];a[i-1][s]=t[i][n]}}return JSON.stringify(a).replace(/},/g,"},\r\n")}}},ALERT={HTML:{INFO:function(e,t,a){return`<div role="alert" class="alert alert-info alert-dismissible ${t=t||"ml-4 mr-4 mt-2 mb-3"}">\n                        ${a?"":'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'}\n                        <i class="la la-info-circle mr-2"></i>${e}\n                    </div>`},SUCCESS:function(e){var t=t||"ml-4 mr-4 mt-2 mb-3";return`<div role="alert" class="alert alert-success alert-dismissible ${t}">\n                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                            <span aria-hidden="true">&times;</span>\n                        </button>\n                        <i class="la la-check-circle mr-2"></i>${e}\n                    </div>`},WARNING:function(e,t="ml-4 mr-4 mt-2 mb-3"){return`<div role="alert" class="alert alert-warning alert-dismissible ${t}">\n                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                            <span aria-hidden="true">&times;</span>\n                        </button>\n                        <i class="la la-warning mr-2"></i>${e}\n                    </div>`},ERROR:function(e,t="ml-4 mr-4 mt-2 mb-3",a){return`<div class="alert alert-danger alert-dismissible text-left ${t}" role="alert">\n                        ${a?"":'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'}\n                        <i class="la la-times-circle mr-2"></i>${e}\n                    </div>`}},REQUIREGRANTEDDC:function(){return ALERT.HTML.WARNING("Creating and importing of dispatch entries are disabled until you are assigned to a location. Please contact your administrator to assign you a location")},DISABLEDLIVEUPDATE:function(){return ALERT.HTML.WARNING("Real-time update is disabled. Please click the ' <i class=\"la la-refresh\"></i> ' button to refresh data.")},REQUIREDFIELDS:function(e,t){var a={"background-color":"white"},i={"background-color":"#ffe4e4"},n=!1;return $(t).find("input,select,textarea").each((e,t)=>{var s=$(t).val();$(t).attr("required")&&(s?($(t).css(a),$(t).next(".select2-container").find(".select2-selection").css(a)):($(t).css(i),$(t).next(".select2-container").find(".select2-selection").css(i),n=!0))}),n&&$(e).html(ALERT.HTML.ERROR("Please fill in required fields.","ml-3 mr-3 mt-2 mb-2")).show(),n}},TOASTR={REQUIREDFIELDS:function(){toastr.error("Please fill in required fields.")},CREATEDSUCCESSFULLY:function(e,t){var a="Record created successfully."+(e=e||""),i={timeOut:1500};t&&(a+="<br><br>Tap to close.",i={timeOut:0,extendedTimeOut:0}),toastr.success(a,null,i)},UPDATEDSUCCESSFULLY:function(){toastr.success("Record updated successfully.",null,{timeOut:1500})},DELETEDSUCCESSFULLY:function(){toastr.success("Record deleted successfully.",null,{timeOut:1500})},ERROR:function(e={},t="",a){var i=e.error||{},n=e.status||i.status,s=(e.statusText||i.message)+t;a=a||{};400==n?toastr.error("Bad Request.",null,a):401==n?(window.stop(),toastr.error("Unauthorized.</br></br>Please refresh this page. If the problem persists, contact our administrators.",null,{timeOut:0,extendedTimeOut:0}),setTimeout(function(){PAGE.LOGOUT()},1e4)):403==n?toastr.error("Forbidden.",null,a):404==n?toastr.error("Not Found.",null,a):409==n?toastr.error("Conflict.",null,a):500==n?toastr.error("Internal Server Error.",null,a):503==n?toastr.error("Service Unavailable.",null,a):toastr.error(s,null,a)}},ARRAY={REMOVE_DUPS:function(e,t){return e.reduce((e,a)=>(e.some(e=>e[t]===a[t])||e.push(a),e),[])},MERGE:function(e=[],t){return e.map(function(e){return e}).filter(function(e,a,i){return i.findIndex(a=>a[t]==e[t])===a})}},PING={GET:function(){function e(){var e=(new Date).getTime();$("#junkOne").attr("src","http://fate.holmes-cj.com:8886/").error(function(){var t=(new Date).getTime();$("#timer").html(t-e+"ms")})}setInterval(function(){e()},5e3),e()}},_SESSION_={window_tab_close:function(e,t,a){if(e&&a){var i=!1;localStorage.openpages=Date.now();window.addEventListener("storage",function(e){"openpages"==e.key&&(localStorage.page_available=Date.now()),"page_available"!=e.key||i||(i=!0,localStorage.countPages=Number(localStorage.countPages)||1,localStorage.countPages++)},!1),window.onbeforeunload=function(i){localStorage.countPages>0&&localStorage.countPages--,(!localStorage.countPages||localStorage.countPages<=0)&&(sessionStorage.setItem("prev_session_token",a),Cookies.remove("session_token"),$.ajax({url:`/api/sessions/${e}/${t}/temporary/${a}`,method:"DELETE",headers:{Authorization:a},async:!1}))}}},lastActive:function(e,t,a){var i=(new Date).getTime();setInterval(function(){t&&$.ajax({url:`/api/sessions_active/${e}/${t}/${a}/${i}`,method:"PUT",timeout:9e4,headers:{Authorization:a},async:!0})},3e4),$("body").mousemove(function(){i=(new Date).getTime()})}},ATTACHMENTS={initialize:function(e){$("#new-attachment").click(function(){$("#new-file").trigger("click")}),$("#new-file").on("change",function(){var t=this.files[0];if(t.size/1024/1024>1)toastr.warning("Upto 1mb per attachment only.");else{!function(t){var a=new FileReader;a.readAsDataURL(t),a.onload=function(){t.base64=a.result,ATTACHMENTS.add_attachment(t,e)},a.onerror=function(e){toastr.error("Unable to upload file"),console.log("Error: ",e)}}(t)}})},add_attachment:function(e,t){var a=ATTACHMENTS.add_table_row(e,t);$(`[_row="${a}"] [delete-attachment]`).click(function(){$(this).parent().parent().remove(),$("#tbl-attachment > tbody > tr").length>0&&$("#tbl-attachment > tbody > tr").each(function(e,t){$(t).children().eq(0).html(e+1)})})},add_table_row:function(e,t){var a={image:{ext:["png","jpg","jpeg","gif"],icon:"la la-file-image-o"},pdf:{ext:["pdf"],icon:"la la-file-pdf-o"},excel:{ext:["xls","xlsx"],icon:"la la-file-excel-o"},word:{ext:["doc","docx"],icon:"la la-file-word-o"},ppt:{ext:["ppt"],icon:"la la-file-powerpoint-o"},archive:{ext:["zip","rar"],icon:"la la-file-archive-o"}},i=e.filename||e.name,n=i.split(".").pop().toLowerCase(),s="la la-file-o";for(var l in a)$.inArray(n,a[l].ext)>-1&&(s=a[l].icon);var o=GENERATE.RANDOM(36),r=`<tr _row="${o}">\n                            <td class="text-muted">${$("#tbl-attachment > tbody > tr").length+1}</td>\n                            <td><a target="_blank" href="${e.base64||e.url}"><i class="${s} mr-2"></i>${i}</a></td>\n                            <td class="text-center">${!0===t?"":'<a delete-attachment title="Delete" class="action-icon"><i class="la la-trash"></i></a></td>'}</td>\n                        </tr>`;return $("#tbl-attachment tbody").append(r),o},get:function(e){var t=[],a=[];return $("#tbl-attachment").find("tr").length>1&&$("#tbl-attachment").find("tr").each(function(i,n){if(i>0){var s=$(this).find("td").eq(1).find("a"),l=s.text(),o=l.split("."),r=(o[o.length-1],s.attr("href")),d=r.split(",")[1]?`attachments/<INSERT_ID_HERE>/${l}`:r.substring(r.indexOf("attachments"));a.includes(d)||(a.push(d),t.push({base64:r,filename:l,storageFilename:d,url:`https://storage.googleapis.com/${e}/`}))}}),t},set:function(e,t){$.each(e,function(e,a){ATTACHMENTS.add_attachment(a,t)})}};const HISTORY={fromTo:function(e,t,a,i){return`• ${e} changed from '${t=(t||"").toString().replace(/undefined/g,"")}' to '${a=(a||"").toString().replace(/undefined/g,"")}'.`},check:function(e,t,a,i={}){var n=[];return Object.keys(e||{}).length>0&&Object.keys(t||{}).forEach(a=>{if(!(i.excludeKeys||[]).includes(a)){var s=(i.fields||[]).find(e=>e.key==a)||{},l=s.dataExtended,o=s.type,r=s.custom,d=s.customFunction,c=s.customExternalFunction,u=s.customTitle||a.capitalize(),p=!0;if(null==o&&(p=t[a]!=e[a]),"number"==o&&(p=Number(t[a])!=Number(e[a])),"array"==o&&(p=(t[a]||[]).toString()!=(e[a]||[]).toString()),"date"==o&&(p=DATETIME.FORMAT(t[a]||null,T)!=DATETIME.FORMAT(e[a]||null,T)),"bool"==o&&(p=t[a]!=e[a]),p){var m=e[a],h=t[a];if("function"==typeof c&&c(),!0===l){var b=s.data||[],f=s.dataCompareKey,v=s.dataValueKey,E=b.find(e=>(e[f]||"").toString()==(m||"").toString())||{},g=b.find(e=>(e[f]||"").toString()==(h||"").toString())||{};m=E[v]||"-",h=g[v]||"-"}if("date"==o){var T=s.format;m=DATETIME.FORMAT(m,T),h=DATETIME.FORMAT(h,T),n.push(HISTORY.fromTo(u,m,h))}else if("array"==o){var _=s.customCondition||function(e,t){return e==t},y=s.customValue||function(e){return e};!$.isArray(m)&&(m=m.split(",")),!$.isArray(h)&&(h=h.split(","));var S=[],A=[],I=[];function D(e,t,a){(e||[]).forEach(e=>{var i=!1;(t||[]).forEach(t=>{_(e,t)&&(i=!0)}),!1===i&&("removed"==a&&A.push(`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• ${y(e)}`),"added"==a&&S.push(`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• ${y(e)}`))})}D(h,m,"added"),D(m,h,"removed"),S.length>0&&I.push(`&nbsp;&nbsp;&nbsp;Added to list:<br>${S.join("<br>")}`),A.length>0&&I.push(`&nbsp;&nbsp;&nbsp;Removed from list:<br>${A.join("<br>")}`),I.length>0&&n.push(`• ${u}:<br>${I.join("<br>")}`)}else if(!0===r){var O=d(m,h);O&&n.push(O)}else if("bool"===o)(m=m||!1)!=(h=h||!1)&&n.push(`• ${u} changed from '${m}' to '${h}'.`);else if("status"===o){var C=GET.STATUS(m).html,w=GET.STATUS(h).html;C!=w&&n.push(`• ${u} changed from '${C}' to '${w}'.`)}else{if("attachments"===o){var N=[],L=[],x=[];return(m||[]).forEach(e=>{var t=!1;(h||[]).forEach(a=>{e.filename==a.filename&&(t=!0)}),!1===t&&N.push(`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;<i class="la la-paperclip text-muted"></i> ${e.filename}`)}),(h||[]).forEach(e=>{var t=!1;(m||[]).forEach(a=>{e.filename==a.filename&&(t=!0)}),!1===t&&L.push(`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;<i class="la la-paperclip text-muted"></i> ${e.filename}`)}),L.length>0&&x.push(`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;Added attachment/s:<br>${L.join("<br>")}`),N.length>0&&x.push(`&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;Removed attachment/s:<br>${N.join("<br>")}`),x.length>0?n.push(`• Attachments:<br>${x.join("<br>")}`):null}n.push(HISTORY.fromTo(u,m,h))}}}}),(i.customChanges||[]).forEach(e=>{e()&&n.push(`• ${e()}`)}),n.length>0&&(t[`history.${(new Date).getTime()}`]=`<span style="font-weight: normal;">Record updated by <username>${a}</username>:</span><br>${n.join("<br>")}`),t},view:function(e,t){t=t||[];var a="";const i=OBJECT.sortByKey(e||{}),n={};return Object.keys(i).reverse().forEach(function(e){n[e]=i[e]}),Object.keys(n).forEach((e,i)=>{var s=DATETIME.FORMAT(new Date(Number(e)),"MMM D, YYYY, h:mm A"),l=n[e]||"-",o=0==i?"":"pt-3",r=GET.TEXT_BETWEEN(l,"<status>","</status>"),d=GET.TEXT_BETWEEN(l,"<username>","</username>"),c=t.find(e=>e._id==d)||{};r&&(l=l.replace(`<status>${r}</status>`,GET.STATUS(r).html)),c.name&&(l=l.replace(`<username>${d}</username>`,c.name||d)),a+=` <div class="${o}">\n                        <small class="text-muted">${s}</small>\n                        <div>${l}</div>\n                    </div>`}),a},defaults:{data_maintenance:function(e,t,a,i,n="",s=[]){$("body").append(n),s.forEach(n=>{!function(n,s,l){function o(e){var t=e.delete?"text-danger":"",i=[];return"developer"==a&&i.push(`<span class="float-right ml-2 text-danger font-14" style="margin-top: -2px;cursor: pointer;" title="Delete Permanently"><i class="las la-times-circle" _id="${e._id.toString()}" remove-permanently></i></span>`),e.delete?i.push(`<span class="float-right ml-2 font-14" style="margin-top: -2px;cursor: pointer;" title="Undo Delete"><i class="la la-undo" _id="${e._id.toString()}" undo></i></span>`):i.push(`<span class="float-right ml-2 font-14" style="margin-top: -2px;cursor: pointer;" title="Delete"><i class="las la-times-circle" _id="${e._id.toString()}" remove></i></span>`),`<div style="border-bottom: 1px solid #eee;" class="p-2 mb-2">\n                                <span class="${t}" text>${e[s]}</span>\n                                ${i.join("")}\n                            </div>`}$.ajax({url:`/api/${n}/${e}/${t}/all/${JSON.stringify({})}/0/0`,method:"GET",timeout:9e4,headers:{Authorization:i},async:!0}).done(function(e){console.log(n,e);var t="";e.forEach(e=>{t+=o(e)}),$(`#${s}-list`).html(t)}),$(`#${s}-btn`).click(function(){var a=$(`#${s}`).val();if(a._trim()){$(`#${s},#${s}-btn`).attr("disabled",!0),$(`#${s}-btn`).html('<i class="la la-spin la-spinner"></i> Submit');var l={};l[s]=a,$.ajax({url:`/api/${n}/${e}/${t}`,method:"POST",timeout:9e4,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:i},async:!0,data:JSON.stringify(l)}).done(function(e){$(`#${s},#${s}-btn`).attr("disabled",!1),$(`#${s}`).val(""),$(`#${s}-btn`).html("Submit");var t={_id:e._id};t[s]=a,$(`#${s}-list`).prepend(o(t))})}}),$(`#${s}-list`).on("click","[undo]",function(a){a.stopImmediatePropagation();var s=$(this),r=$(this).attr("_id");$(s).parent().parent().css({"pointer-events":"none",color:"#cecece"}),$(s).removeClass().addClass("la la-spin la-spinner");var d=HISTORY.check(l(r),{delete:!1},t,{excludeKeys:["history"],fields:[{key:"delete",type:"bool"}]});$.ajax({url:`/api/${n}/${e}/${t}/${r}`,method:"PUT",timeout:9e4,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:i},data:JSON.stringify(d),async:!0}).done(function(e){$(s).parent().parent().replaceWith(o(e.value))})}),$(`#${s}-list`).on("click","[remove]",function(a){a.stopImmediatePropagation();var s=$(this),r=$(this).attr("_id");$(s).parent().parent().css({"pointer-events":"none",color:"#cecece"}),$(s).removeClass().addClass("la la-spin la-spinner");var d=HISTORY.check(l(r),{delete:!0},t,{excludeKeys:["history"],fields:[{key:"delete",type:"bool"}]});$.ajax({url:`/api/${n}/${e}/${t}/${r}`,method:"PUT",timeout:9e4,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:i},data:JSON.stringify(d),async:!0}).done(function(e){$(s).parent().parent().replaceWith(o(e.value))})}),$(`#${s}-list`).on("click","[remove-permanently]",function(a){a.stopImmediatePropagation();var s=$(this),l=$(this).attr("_id");MODAL.CONFIRMATION({content:"Are you sure to delete this record permanently?",confirmCallback:function(){$(s).parent().parent().css({"pointer-events":"none",color:"#cecece"}),$(s).removeClass().addClass("la la-spin la-spinner"),$.ajax({url:`/api/${n}/${e}/${t}/${l}`,method:"DELETE",timeout:9e4,headers:{Authorization:i},async:!0}).done(function(e){$(s).parent().parent().remove()})}})})}(n.urlPath,n.key,n.objectData)})}}};var PAGE_SETUP=function(){function e(e){return e?"addClass":"removeClass"}$("body").on("click","#overlay #close",function(e){$(".daterangepicker").hide(),$(this).parents("#overlay").remove()}),$("body").on("click","#slider-close",function(e){$(".slider-container").each((e,t)=>{$(t).hide("slide",{direction:"right"},100)})}),$(document).on("input",".clearable",function(){$(this)[e(this.value)]("x")}).on("mousemove",".x",function(t){$(this)[e(this.offsetWidth-18<t.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",".onX",function(e){e.preventDefault();var t=$(this).attr("noval")?"":DEFAULT_DATE,a="";$("input[noval]").each(e=>{$($("input[noval]")[e]).val()&&(a+=$($("input[noval]")[e]).val())}),$(this).attr("default")&&!a.isEmpty()?t="":$(this).attr("default")&&a.isEmpty()?t=DEFAULT_DATE:$(this).attr("noval")&&($("input[default]").val()||"").isEmpty()&&($("input[default]").data("daterangepicker").setStartDate(DEFAULT_DATE),$("input[default]").data("daterangepicker").setEndDate(DEFAULT_DATE),$("input[default]").data("daterangepicker").hide(),$("input[default]").removeClass("x onX").val(DEFAULT_DATE).change().blur()),$(this).data("daterangepicker").setStartDate(DEFAULT_DATE),$(this).data("daterangepicker").setEndDate(DEFAULT_DATE),$(this).data("daterangepicker").hide(),$(this).removeClass("x onX").val(t).change().blur(),"function"==typeof FILTER.CALLBACK&&FILTER.CALLBACK()})};const LOGGER=function(){var e=null,t={enableLogger:function(){null!=e&&(window.console.log=e)},disableLogger:function(){e=console.log,window.console.log=function(){}}};return t}();class User{constructor(e){this._username=e._id,this._fullName=e.name||"-",this._email=e.email||"-",this._phoneNumber=e.phoneNumber||"-",this._role=e.role||"user",this._active=!0,this._filters=e.filter||{},this._settings=e.settings||{}}get apiKey(){return Cookies.get("GKEY")}get username(){return this._username}get fullName(){return this._fullName}set fullName(e){return this._fullName=e||"-"}get email(){return this._email}set email(e){return this._email=e||"-"}get phoneNumber(){return this._phoneNumber}set phoneNumber(e){return this._phoneNumber=e||"-"}get role(){return this._role}set role(e){return this._role=e||"user"}get dc(){return this._dc}set dc(e){return this._dc=e}get filters(){return this._filters}set filters(e){return this._filters=e||{}}get settings(){return this._settings}set settings(e){return this._settings=e||{}}get active(){return this._active}set active(e){return this._active=e}}class ProgressBar{constructor(e){this._minWidth=1,this._maxWidth=1,this._origPerc=0,this._totalPerc=0,this.count=e,$("div.tbl-progress-bar").html(this.html()).css({position:"absolute",left:"0px",bottom:"-6px",width:"160px",height:"20px"}),$("#progress-striped .progress-bar, #progress-striped-active .progress-bar").progressbar({display_text:"fill"})}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth=e}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth=e}get origPerc(){return this._origPerc}set origPerc(e){this._origPerc=e}get totalPerc(){return this._totalPerc}set totalPerc(e){this._totalPerc=e}calculate(){var e=this.count/LIMIT,t=Math.floor(e);return e%1>0&&t++,!this.origPerc&&(this.origPerc=100/t),this.totalPerc=this.totalPerc+this.origPerc,console.log(this.origPerc,this.totalPerc,this.minWidth,this.maxWidth),this.minWidth=this.maxWidth,this.maxWidth=Math.floor(this.totalPerc),this.move(),this.maxWidth}move(){const e=this;var t=0;if(0==t){t=1;var a=$("#progress-striped-active .progress-bar"),i=setInterval(function(){e.minWidth>=e.maxWidth?(clearInterval(i),t=0,TABLE.FINISH_LOADING.START_CHECK()):(e.minWidth++,$(a).css("width",`${e.minWidth}%`).html(`${e.minWidth}%`))},10)}}reset(){this._minWidth=1,this._maxWidth=1,this._origPerc=0,this._totalPerc=0}html(){return'<div id="progress-striped-active" class="progress progress-striped active" style="width: 100%;">\n                    <div class="progress-bar progress-bar-success" data-transitiongoal="0"></div>\n                </div>'}}var tablesToExcel=function(e){var t=function(e,t){return e.replace(/{(\w+)}/g,function(e,a){return t[a]})};return function(a,i){console.log("OH YEAHHH");var n={ExcelWorksheets:"",HTMLWorksheets:"",ListWorksheets:""};a=jQuery(a);e.each(a,function(a){var i=e(this),s=i.attr("data-SheetName");""===e.trim(s)&&(s="Sheet"+a),n.ExcelWorksheets+=t('<x:ExcelWorksheet><x:Name>{SheetName}</x:Name><x:WorksheetSource HRef="sheet{SheetIndex}.htm"/></x:ExcelWorksheet>',{SheetIndex:a,SheetName:s}),n.HTMLWorksheets+=t('\n------=_NextPart_dummy\nContent-Location: sheet{SheetIndex}.htm\nContent-Type: text/html; charset=windows-1252\n\n<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><link id="Main-File" rel="Main-File" href="../WorkBook.htm"><link rel="File-List" href="filelist.xml"></head><body><table>{SheetContent}</table></body></html>',{SheetIndex:a,SheetContent:i.html()}),n.ListWorksheets+=t('<o:File HRef="sheet{SheetIndex}.htm"/>',{SheetIndex:a})});var s,l=document.createElement("A");l.href="data:application/vnd.ms-excel;base64,"+(s=t('MIME-Version: 1.0\nX-Document-Type: Workbook\nContent-Type: multipart/related; boundary="----=_NextPart_dummy"\n\n------=_NextPart_dummy\nContent-Location: WorkBook.htm\nContent-Type: text/html; charset=windows-1252\n\n<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name="Excel Workbook Frameset"><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><link rel="File-List" href="filelist.xml">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets>{ExcelWorksheets}</x:ExcelWorksheets><x:ActiveSheet>0</x:ActiveSheet></x:ExcelWorkbook></xml><![endif]--\x3e</head><frameset><frame src="sheet0.htm" name="frSheet"><noframes><body><p>This page uses frames, but your browser does not support them.</p></body></noframes></frameset></html>{HTMLWorksheets}\nContent-Location: filelist.xml\nContent-Type: text/xml; charset="utf-8"\n<xml xmlns:o="urn:schemas-microsoft-com:office:office">\n<o:MainFile HRef="../WorkBook.htm"/>\n{ListWorksheets}\n<o:File HRef="filelist.xml"/>\n</xml>\n------=_NextPart_dummy--\n',n),window.btoa(unescape(encodeURIComponent(s)))),l.download=i||"Workbook.xls",l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}(jQuery);const ENVIRONMENT=$("#ENVIRONMENT").text()||"development",CUSTOM={COLUMN:{settings:[{data:"Device Info",title:"Device Info",visible:!0},{data:"Last Accessed",title:"Last Accessed",visible:!0},{data:"Expiry",title:"Expiry",visible:!0},{data:"Location",title:"Location",visible:!0},{data:"Action",title:"Action",className:"notExport",width:"40px",orderable:!1,searchable:!1,visible:!0}],dashboard:function(){var e={"In Transit":"All units on the road bound to Plant/DC in the first column of the same row.","Total Shipment":clientCustom.roundtrip?"The total count of shipments, In Transit, Incomplete, Scheduled, Assigned, On-Site, Returning & Complete of Plant/DC.":"The total count of shipments, In Transit, Incomplete, Assigned, Queueing, Processing & Complete of Plant/DC.",Incomplete:"The premature shipments. Premature for the reason of having incomplete details at the DE. (e.g. can’t find the tractor-trailer match)",Scheduled:"The total number of scheduled shipments.",Assigned:"The total number of assigned shipments.",Queueing:"The total number of units inside the queueing area.",Processing:"The total number of units that is on-going loading inside the processing area.","On-Site":"The total number of units that arrived at shipment's destination.",Returning:"The total number of units that is returning to the origin.",Complete:"The total number of shipments already checked out and will eventually tagged as “In Transit”."};function t(t){return`<i class="la la-info" data-toggle="tooltip" title="${e[t]}" style="color:#5b5b5b;position: absolute;top: 0px;right: 0px;padding:1px 8px 5px 5px;"></i>`}var a=[{data:"Region",visible:!1},{data:"Plant",title:"Plant/DC"}];return(clientCustom.visibleStatus||[]).forEach(e=>{switch(e){case"in_transit":a.push({data:"In Transit",title:`In Transit ${t("In Transit")}`,className:"clickable"});break;case"total_shipment":a.push({data:"Total Shipment",title:`Total Shipment ${t("Total Shipment")}`,className:"clickable"});break;case"incomplete":a.push({data:"Incomplete",title:`Incomplete ${t("Incomplete")}`,className:"clickable"});break;case"scheduled":a.push({data:"Scheduled",title:`Scheduled ${t("Scheduled")}`,className:"clickable"});break;case"assigned":a.push({data:"Assigned",title:`Assigned ${t("Assigned")}`,className:"clickable"});break;case"queueingAtOrigin":a.push({data:"Queueing",title:`Queueing ${t("Queueing")}`,className:"clickable"});break;case"processingAtOrigin":a.push({data:"Processing",title:`Processing ${t("Processing")}`,className:"clickable"});break;case"onSite":a.push({data:"On-Site",title:`On-Site ${t("On-Site")}`,className:"clickable"});break;case"returning":a.push({data:"Returning",title:`Returning ${t("Returning")}`,className:"clickable"});break;case"complete":a.push({data:"Complete",title:`Complete ${t("Complete")}`,className:"clickable"})}}),a},de_dashboard:[{data:"Region ID",title:"Region ID",visible:!1},{data:"Delay Type",title:"Delay Type",visible:!1},{data:"SN",title:"SN",visible:!1},{data:"Plate No",title:"Plate No.",visible:!0},{data:"Destination",title:"Destination",visible:!0},{data:"Duration",title:"Duration",visible:!0},{data:"Escalation",title:"Escalation",visible:!0},{data:"Base Plant",title:"Base Plant",visible:!0}],dispatch:function(){var e=[],t=clientCustom.columns.dispatch;if(t){function a(e,a){return a.visible=(t.visible||[]).includes(e),a.hiddenInCustomVisibilityOptions=(t.hiddenInCustomVisibilityOptions||[]).includes(e),(t.notExport||[]).includes(e)&&(a.className="notExport"),a}t.list.forEach(t=>{switch(t){case"_id":e.push(a(t,{data:"_id",title:"Shipment Number",visible:!0}));break;case"ticketNumber":e.push(a(t,{data:"Ticket Number",title:"Ticket Number",visible:!0}));break;case"departureDate":e.push(a(t,{data:"Departure Date",title:"Departure Date",type:"date",visible:!0}));break;case"_departureDate_":e.push(a(t,{data:"Departure__Date",title:"Departure Date",visible:!0}));break;case"_departureTime_":e.push(a(t,{data:"Departure__Time",title:"Departure Time",visible:!0}));break;case"region":e.push(a(t,{data:"Region",title:"Region",visible:!0}));break;case"cluster":e.push(a(t,{data:"Cluster",title:"Cluster",visible:!0}));break;case"origin":e.push(a(t,{data:"Origin",title:"Origin",visible:!0}));break;case"route":e.push(a(t,{data:"Route",title:"Route",visible:!0}));break;case"destination":e.push(a(t,{data:"Destination",title:"Destination",visible:!0}));break;case"etd":e.push(a(t,{data:"ETD",title:"ETD",type:"date",visible:!0}));break;case"eta":e.push(a(t,{data:"ETA",title:"ETA",type:"date",visible:!0}));break;case"targetTransitTime":e.push(a(t,{data:"Target Transit Time",title:"Target Transit Time",visible:!0}));break;case"targetCicoTime":e.push(a(t,{data:"Target CICO Time",title:"Target CICO Time",visible:!0}));break;case"vehicle":e.push(a(t,{data:"Vehicle",title:"Vehicle",visible:!0}));break;case"trailer":e.push(a(t,{data:"Trailer",title:"Trailer",visible:!0}));break;case"conductionNumber":e.push(a(t,{data:"Conduction Number",title:"Conduction #",visible:!0}));break;case"palCap":e.push(a(t,{data:"Pal Cap",title:"Pal Cap",visible:!0}));break;case"plateNumber":e.push(a(t,{data:"Plate Number",title:"Plate Number",visible:!0}));break;case"truckNumber":e.push(a(t,{data:"Truck Number",title:"Truck Number",visible:!0}));break;case"driver":e.push(a(t,{data:"Driver",title:"Driver",visible:!0}));break;case"checker":e.push(a(t,{data:"Checker",title:"Checker",visible:!0}));break;case"helper":e.push(a(t,{data:"Helper",title:"Helper",visible:!0}));break;case"comments":e.push(a(t,{data:"Comments",title:"Comments",visible:!0}));break;case"queueingDuration":e.push(a(t,{data:"Queueing Duration",title:"Queueing Duration",visible:!0}));break;case"processingDuration":e.push(a(t,{data:"Processing Duration",title:"Processing Duration",visible:!0}));break;case"idlingDuration":e.push(a(t,{data:"Idling Duration",title:"Idling Duration",visible:!0}));break;case"cicoTime":e.push(a(t,{data:"CICO Time",title:"CICO Time",visible:!0}));break;case"cicoTimeCapped":e.push(a(t,{data:"CICO Time (Capped)",title:"CICO Time (Capped)",visible:!0}));break;case"transitDuration":e.push(a(t,{data:"Transit Duration",title:"Transit Duration",visible:!0}));break;case"status":e.push(a(t,{data:"Status",title:"Status",visible:!0}));break;case"scheduledDate":e.push(a(t,{data:"Scheduled Date",title:"Scheduled Date",type:"date",visible:!0}));break;case"shiftSchedule":e.push(a(t,{data:"Shift Schedule",title:"Shift Schedule",visible:!0}));break;case"postedBy":e.push(a(t,{data:"Posted By",title:"Posted By",visible:!0}));break;case"postingDate":e.push(a(t,{data:"Posting Date",title:"Posting Date",type:"date",visible:!0}));break;case"lateEntry":e.push(a(t,{data:"Late Entry",title:"Late Entry",visible:!0}));break;case"action":e.push(a(t,{data:"Action",title:"Action",orderable:!1,searchable:!1,visible:!0}))}})}return e},dispatch_deleted:[{data:"_id",title:"Shipment Number",visible:!0},{data:"Departure Date",title:"Departure Date",type:"date",visible:!1},{data:"Region",title:"Region",visible:!1},{data:"Cluster",title:"Cluster",visible:!1},{data:"Origin",title:"Origin",visible:!0},{data:"Route",title:"Route",visible:!1},{data:"Destination",title:"Destination",visible:!0},{data:"ETD",title:"ETD",visible:!1,type:"date",visible:!0},{data:"ETA",title:"ETA",visible:!1,type:"date",visible:!0},{data:"Target Transit Time",title:"Target Transit Time",visible:!1},{data:"Target CICO Time",title:"Target CICO Time",visible:!1},{data:"Vehicle",title:"Vehicle",visible:!0},{data:"Trailer",title:"Trailer",visible:!1},{data:"Conduction Number",title:"Conduction #",visible:!1},{data:"Pal Cap",title:"Pal Cap",visible:!1},{data:"Comments",title:"Comments",visible:!1},{data:"Queueing Duration",title:"Queueing Duration",visible:!1},{data:"Processing Duration",title:"Processing Duration",visible:!1},{data:"Idling Duration",title:"Idling Duration",visible:!1},{data:"CICO Time",title:"CICO Time",visible:!1},{data:"CICO Time (Capped)",title:"CICO Time (Capped)",visible:!1},{data:"Transit Duration",title:"Transit Duration",visible:!1},{data:"Status",title:"Status Before Deleted",visible:!0},{data:"Posted By",title:"Posted By",visible:!0},{data:"Posting Date",title:"Posting Date",type:"date",visible:!0},{data:"Late Entry",title:"Late Entry",visible:!1},{data:"Deleted By",title:"Deleted By",visible:!0},{data:"Deleted Date",title:"Deleted Date",type:"date",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],dispatch_mod2_deleted:[{data:"_id",title:"Shipment Number",visible:!0},{data:"Ticket Number",title:"Ticket Number",type:"date",visible:!0},{data:"Departure Date",title:"Departure Date",className:"notExport",type:"date",visible:!0},{data:"Departure__Date",title:"Departure Date",visible:!1,hiddenInCustomVisibilityOptions:!0},{data:"Departure__Time",title:"Departure Time",visible:!1,hiddenInCustomVisibilityOptions:!0},{data:"Region",title:"Region",visible:!1},{data:"Cluster",title:"Cluster",visible:!1},{data:"Origin",title:"Origin",visible:!0},{data:"Route",title:"Route",visible:!1},{data:"Destination",title:"Destination",visible:!0},{data:"ETD",title:"ETD",visible:!1,type:"date",visible:!0},{data:"ETA",title:"ETA",visible:!1,type:"date",visible:!0},{data:"Target Transit Time",title:"Target Transit Time",visible:!1},{data:"Target CICO Time",title:"Target CICO Time",visible:!1},{data:"Vehicle",title:"Vehicle",className:"notExport",visible:!0},{data:"Plate Number",title:"Plate Number",visible:!1,hiddenInCustomVisibilityOptions:!0},{data:"Truck Number",title:"Truck Number",visible:!1,hiddenInCustomVisibilityOptions:!0},{data:"Driver",title:"Driver",visible:!1},{data:"Checker",title:"Checker",visible:!1},{data:"Helper",title:"Helper",visible:!1},{data:"Comments",title:"Comments",visible:!1},{data:"Queueing Duration",title:"Queueing Duration",visible:!1},{data:"Processing Duration",title:"Processing Duration",visible:!1},{data:"CICO Time",title:"CICO Time",visible:!1},{data:"CICO Time (Capped)",title:"CICO Time (Capped)",visible:!1},{data:"Transit Duration",title:"Transit Duration",visible:!1},{data:"Status",title:"Status Before Deleted",visible:!0},{data:"Scheduled Date",title:"Scheduled Date",type:"date",visible:!1},{data:"Shift Schedule",title:"Shift Schedule",visible:!1},{data:"Posted By",title:"Posted By",visible:!0},{data:"Posting Date",title:"Posting Date",type:"date",visible:!0},{data:"Late Entry",title:"Late Entry",visible:!1},{data:"Deleted By",title:"Deleted By",visible:!0},{data:"Deleted Date",title:"Deleted Date",type:"date",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],shift_schedule:[{data:"_id",title:"Schedule",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],regions:[{data:"Region",title:"Region",visible:!0},{data:"Sequence",title:"Sequence",width:"50px",visible:!0},{data:"esq1_lq",title:"Person In-Charge (E-1 Long Queueing)",visible:!1},{data:"esq1_oc",title:"Person In-Charge (E-1 Over CICO)",visible:!1},{data:"esq1_ot",title:"Person In-Charge (E-1 Over Transit)",visible:!1},{data:"esq2_lq",title:"Person In-Charge (E-2 Long Queueing)",visible:!1},{data:"esq2_oc",title:"Person In-Charge (E-2 Over CICO)",visible:!1},{data:"esq2_ot",title:"Person In-Charge (E-2 Over Transit)",visible:!1},{data:"esq3_lq",title:"Person In-Charge (E-3 Long Queueing)",visible:!1},{data:"esq3_oc",title:"Person In-Charge (E-3 Over CICO)",visible:!1},{data:"esq3_ot",title:"Person In-Charge (E-3 Over Transit)",visible:!1},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],clusters:function(){var e=[];return clientCustom.columns.clusters.forEach(t=>{switch(t){case"cluster":e.push({data:"Cluster",title:"Cluster",visible:!0});break;case"region":e.push({data:"Region",title:"Region",visible:!0});break;case"geofences":e.push({data:"Geofences",title:"Sites",visible:!0});break;case"sequence":e.push({data:"Sequence",title:"Sequence",width:"50px",visible:!0});break;case"esq1_lq":e.push({data:"esq1_lq",title:"Person In-Charge (E-1 Long Queueing)",visible:!1});break;case"esq1_oc":e.push({data:"esq1_oc",title:"Person In-Charge (E-1 Over CICO)",visible:!1});break;case"esq1_ot":e.push({data:"esq1_ot",title:"Person In-Charge (E-1 Over Transit)",visible:!1});break;case"esq2_lq":e.push({data:"esq2_lq",title:"Person In-Charge (E-2 Long Queueing)",visible:!1});break;case"esq2_oc":e.push({data:"esq2_oc",title:"Person In-Charge (E-2 Over CICO)",visible:!1});break;case"esq2_ot":e.push({data:"esq2_ot",title:"Person In-Charge (E-2 Over Transit)",visible:!1});break;case"esq3_lq":e.push({data:"esq3_lq",title:"Person In-Charge (E-3 Long Queueing)",visible:!1});break;case"esq3_oc":e.push({data:"esq3_oc",title:"Person In-Charge (E-3 Over CICO)",visible:!1});break;case"esq3_ot":e.push({data:"esq3_ot",title:"Person In-Charge (E-3 Over Transit)",visible:!1});break;case"action":e.push({data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0})}}),e},geofences:[{data:"Site Code",title:"Site Code",visible:!0},{data:"Site Name",title:"Site Name",visible:!0},{data:"Short Name",title:"Short Name",visible:!0},{data:"CICO",title:"CICO (HH:MM)",visible:!0},{data:"Cluster",title:"Cluster",visible:!0},{data:"Region",title:"Region",visible:!0},{data:"Dispatcher",title:"Dispatcher",visible:!0},{data:"esq1_lq",title:"Person In-Charge (E-1 Long Queueing)",visible:!1},{data:"esq1_oc",title:"Person In-Charge (E-1 Over CICO)",visible:!1},{data:"esq1_ot",title:"Person In-Charge (E-1 Over Transit)",visible:!1},{data:"esq2_lq",title:"Person In-Charge (E-2 Long Queueing)",visible:!1},{data:"esq2_oc",title:"Person In-Charge (E-2 Over CICO)",visible:!1},{data:"esq2_ot",title:"Person In-Charge (E-2 Over Transit)",visible:!1},{data:"esq3_lq",title:"Person In-Charge (E-3 Long Queueing)",visible:!1},{data:"esq3_oc",title:"Person In-Charge (E-3 Over CICO)",visible:!1},{data:"esq3_ot",title:"Person In-Charge (E-3 Over Transit)",visible:!1},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],routes:[{data:"_id",title:"Route",visible:!0},{data:"Origin",title:"Origin",visible:!0},{data:"Destination",title:"Destination",visible:!0},{data:"Transit Time",title:"Transit Time",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],notifications:function(){var e=[];return clientCustom.columns.notifications.forEach(t=>{switch(t){case"shipmentNumber":e.push({data:"Shipment No",title:"Shipment Number",visible:!0});break;case"departureDate":e.push({data:"Departure Date",title:"Departure Date",visible:!0});break;case"delayType":e.push({data:"Delay Type",title:"Delay Type",visible:!0});break;case"escalation":e.push({data:"Escalation",title:"Escalation",visible:!0});break;case"timelapse":e.push({data:"Timelapse",title:"Timelapse",visible:!0});break;case"site":e.push({data:"Site",title:"Site",visible:!0});break;case"status":e.push({data:"Status",title:"Status",visible:!0});break;case"dateTime":e.push({data:"DateTime",title:"Date & Time",type:"date",visible:!0});break;case"sentTo":e.push({data:"Sent to",title:"Sent to",visible:!0});break;case"action":e.push({data:"Action",title:"Action",orderable:!1,searchable:!1,visible:!0})}}),e},event_viewer:function(){return[{data:"Date",title:"Date",type:"date",visible:!0},{data:"Shipment Numbers",title:"Shipment Numbers",visible:!CLIENT.allowDownloadFromOtherDB},{data:"Rule Name",title:"Rule Name",visible:!0},{data:"Vehicle Name",title:"Vehicle Name",visible:!0},{data:"Geofence Name",title:"Geofence Name",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}]},all_events:[{data:"Date",title:"Date",type:"date",visible:!0},{data:"Rule Name",title:"Rule Name",visible:!0},{data:"Vehicle Name",title:"Vehicle Name",visible:!0},{data:"Geofence Name",title:"Geofence Name",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],users:function(){return[{data:"Name",title:"Name",visible:!0},{data:"_id",title:"Username",visible:!0},{data:"Title",title:"Title",visible:!0},{data:"Email",title:"Email",visible:!0},{data:"Phone Number",title:"Phone Number",visible:!0},{data:"Role",title:"Role",visible:!0},{data:"Exempted",title:"Exempted From Auto-Logout",width:"70px",visible:CLIENT.tabCloseAutoLogout||!1},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}]},vehicles:function(){var e=[];return clientCustom.columns.vehicles.forEach(t=>{switch(t){case"name":e.push({data:"Name",title:"Name",visible:!0});break;case"trailer":e.push({data:"Trailer",title:"Trailer",visible:!0});break;case"equipmentNumber":e.push({data:"Equipment Number",title:"Equipment Number",visible:!0});break;case"conductionNumber":e.push({data:"Conduction Number",title:"Conduction Number",visible:!0});break;case"plateNumber":e.push({data:"Plate Number",title:"Plate Number",visible:!0});break;case"truckNumber":e.push({data:"Truck Number",title:"Truck Number",visible:!0});break;case"site":e.push({data:"Site",title:"Site",visible:!0});break;case"section_id":e.push({data:"Section",title:"Section",visible:!0});break;case"company_id":e.push({data:"Company",title:"Company",visible:!0});break;case"availability":e.push({data:"Availability",title:"Availability",visible:!0});break;case"last2Locations":e.push({data:"Last 2 Locations",title:"Last 2 Locations",className:"notExport",visible:!0});break;case"action":e.push({data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0})}}),e},vehicle_personnel:[{data:"Name",title:"Name",visible:!0},{data:"Occupation",title:"Occupation",visible:!0},{data:"Vehicle",title:"Vehicle",visible:!0},{data:"Section",title:"Section",visible:!0},{data:"Company",title:"Company",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}],trailers:[{data:"_id",title:"Trailer",visible:!0},{data:"Pal Cap",title:"Pal Cap",visible:!0},{data:"Region",title:"Region",visible:!0},{data:"Cluster",title:"Cluster",visible:!0},{data:"Site",title:"Site",visible:!0},{data:"Action",title:"Action",className:"notExport",orderable:!1,searchable:!1,visible:!0}]},FORM:{dispatch:function(){return[{id:"#shipment_number",key:"_id",inputType:"val",readonly:!0,regex:/^\d{8}$/},{id:"#ticket_number",key:"ticket_number",inputType:"val",remove:!0,parent:".col-sm-4"},{id:"#scheduled_date",key:"scheduled_date",inputType:"val",remove:!0,parent:".col-sm-4"},{id:"#shift_schedule",key:"shift_schedule",inputType:"val",remove:!0,parent:".col-sm-4"},{id:"#origin",key:"origin_id",inputType:"val",required:!0},{id:"#route",key:"route",inputType:"val",readonly:!0,required:!0,trigger:"change",dataType:"select"},{id:"#trailer",key:"trailer",inputType:"val",trigger:"change",required:!0,dataType:"select"},{id:"#vehicle",key:"vehicle_id",inputType:"val",trigger:"change",required:!0,dataType:"select",typeOf:"number"},{id:"#driver_id",key:"driver_id",inputType:"val",remove:!0,parent:".col-sm-12"},{id:"#checker_id",key:"checker_id",inputType:"val",remove:!0,parent:".col-sm-12"},{id:"#helper_id",key:"helper_id",inputType:"val",remove:!0,parent:".col-sm-12"},{id:"#comments",key:"comments",inputType:"val"}]},dispatch_mod2:function(){return[{id:"#shipment_number",key:"_id",inputType:"val",readonly:!0,regex:/^\d{8}$/},{id:"#ticket_number",key:"ticket_number",inputType:"val",required:!0},{id:"#scheduled_date",key:"scheduled_date",inputType:"val",required:!0,dataType:"date"},{id:"#shift_schedule",key:"shift_schedule",inputType:"val",trigger:"change",dataType:"select"},{id:"#origin",key:"origin_id",inputType:"val",required:!0},{id:"#route",key:"route",inputType:"val",readonly:!0,required:!0,trigger:"change",dataType:"select"},{id:"#trailer",key:"trailer",inputType:"val",trigger:"change",required:!0,dataType:"select"},{id:"#vehicle",key:"vehicle_id",inputType:"val",trigger:"change",required:!0,dataType:"select",typeOf:"number"},{id:"#driver_id",key:"driver_id",inputType:"val",trigger:"change",required:!0,dataType:"select"},{id:"#checker_id",key:"checker_id",inputType:"val",trigger:"change",required:!0,dataType:"select"},{id:"#helper_id",key:"helper_id",inputType:"val",trigger:"change",required:!0,dataType:"select"},{id:"#comments",key:"comments",inputType:"val"}]}},IMPORT_TEMPLATE:{coket1:function(){return'<table id="report-hidden" style="opacity:0;">\n                        <tr>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Shipment Number</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Origin</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Destination</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Truck Name</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Comments</th>\n                        </tr>\n                        <tr>\n                            <td style="font-size:14px;border-color:#D9D9D9;">10000001</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">BBC EXT</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">CEW PL</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">DAE8439</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">Comment is optional.</td>\n                        </tr>\n                    </table>'},wilcon:function(){var e="",t=[];(LIST.shift_schedule||[]).forEach((e,a)=>{t[a]=t[a]||{},t[a].shift_schedule=e._id});var a=[];(LIST.vehicles||[]).forEach((e,t)=>{var i=(LIST.vehicle_personnel||[]).find(t=>Number(t.vehicle_id)==Number(e._id)&&"Driver"==t.occupation)||{},n=(LIST.vehicle_personnel||[]).find(t=>Number(t.vehicle_id)==Number(e._id)&&"Checker"==t.occupation)||{},s=(LIST.vehicle_personnel||[]).find(t=>Number(t.vehicle_id)==Number(e._id)&&"Helper"==t.occupation)||{},l=i.name,o=n.name,r=s.name;l&&o&&r||(l?(o||(o=""),r||(r="")):o?(l||(l=""),r||(r="")):r?(l||(l=""),o||(o="")):(l="ZZZZZZZZ",o="ZZZZZZZZ",r="ZZZZZZZZ")),a.push({vehicle:e.name,vehicle_driver:l,vehicle_checker:o,vehicle_helper:r})}),SORT.ARRAY_OBJECT(a,"vehicle_driver",{sortType:"asc"}).forEach((e,a)=>{t[a]=t[a]||{},t[a].vehicle=e.vehicle,t[a].vehicle_driver="ZZZZZZZZ"==e.vehicle_driver?"":e.vehicle_driver,t[a].vehicle_checker="ZZZZZZZZ"==e.vehicle_checker?"":e.vehicle_checker,t[a].vehicle_helper="ZZZZZZZZ"==e.vehicle_helper?"":e.vehicle_helper});var i=(LIST.vehicle_personnel||[]).filter(e=>"Driver"==e.occupation);SORT.ARRAY_OBJECT(i,"name",{sortType:"asc"}).forEach((e,a)=>{t[a]=t[a]||{},t[a].driver=e.name});var n=(LIST.vehicle_personnel||[]).filter(e=>"Checker"==e.occupation);SORT.ARRAY_OBJECT(n,"name",{sortType:"asc"}).forEach((e,a)=>{t[a]=t[a]||{},t[a].checker=e.name});var s=(LIST.vehicle_personnel||[]).filter(e=>"Helper"==e.occupation);return SORT.ARRAY_OBJECT(s,"name",{sortType:"asc"}).forEach((e,a)=>{t[a]=t[a]||{},t[a].helper=e.name}),SORT.ARRAY_OBJECT(LIST.routes||[],"_id",{sortType:"asc"}).forEach((e,a)=>{t[a]=t[a]||{},t[a].route=e._id}),t.forEach((t,a)=>{e+=`<tr>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"ABC 123":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"MDC01-D03":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"WD NDI3452":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"Jane Doe":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"John Smith":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"James Clark":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"04/02/2021":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"4:00 AM - 5:00 AM":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${0==a?"Comment is optional.":""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;"></td>\n                            <td style="font-size:14px;border-color:#D9D9D9;"></td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.shift_schedule||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.vehicle||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.vehicle_driver||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.vehicle_checker||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.vehicle_helper||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.driver||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.checker||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.helper||""}</td>\n                            <td style="font-size:14px;border-color:#D9D9D9;">${t.route||""}</td>\n                        </tr>`}),`<table id="report-hidden" style="opacity:0;">\n                        <tr>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Ticket Number</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Route</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Truck Name</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Driver</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Checker</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Helper</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Scheduled Date</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Shift Schedule</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Comments</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;"></th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;"></th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Shift List</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Truck List</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Truck Driver</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Truck Checker</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Truck Helper</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Driver List</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Checker List</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Helper List</th>\n                            <th style="font-size:14px;border-color:#D9D9D9;text-align:left;">Route List</th>\n                        </tr>\n                        ${e}\n                    </table>`}}};var USER=null,SESSION_TOKEN=null,HASNOTIFICATION=!1,SOCKET=null,CHANGESTREAMS={},VERSION=null,ISMOBILE=!1,LIMIT=200,PAGE_FUNCTIONALITIES=null,PERMISSION={},LIST={},GRANTED_PAGES=[],MAX_TRIES=5,PERMISSION_BY_ROLE={},DE_NOTIF_COUNT=[],G_SELECT={},G_SELECT2={},GGS={STATUS:{}},DE_CHECKDUPS=null,BASE_PLANTS=null,CLIENT=(DEFAULT_DATE=null,null),exlStyle="font-family:Arial;font-size:20px;",clientCustom={};const WEBSOCKET={sendUserInfo:function(){return new Promise((e,t)=>{USER&&USER.username&&(WEBSOCKET.resolve=e,SOCKET.emit("userInfo",{username:USER.username,role:USER.role,session_token:USER.sessionToken,ISMOBILE:ISMOBILE,dbName:CLIENT.id}))})},connect:function(){return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(ISMOBILE=!0),new Promise((e,t)=>{(SOCKET=io()).on("*",function(t,a){if("credentials"==(t=JSON.parse(t)).type)if(null==CLIENT){a=t.data;sessionStorage.setItem("version",t.version),CLIENT=a.CLIENT,function(){function e(e,t){var a=null;try{var i=e.split("."),n=CLIENT;i.forEach(e=>{n=n[e]}),a=n}catch(e){}return a||t}clientCustom.filterType={},clientCustom.columns={},clientCustom.gSelect2={},clientCustom.allowExportTable={},clientCustom.modalFields={},clientCustom.columnOrder={},clientCustom.tableButtons={},clientCustom.rowButtons={},clientCustom.defaultOrigin=e("custom.routes.defaultOrigin",{}),clientCustom.visibleStatus=e("custom.dashboard.visibleStatus",[]),clientCustom.reports=e("custom.reports",{}),clientCustom.ignoreRolesWithString=e("custom.users.ignoreRolesWithString",[]),clientCustom.filterType.dashboard=e("custom.dashboard.filterType",""),clientCustom.filterType.dispatch=e("custom.dispatch.filterType",""),clientCustom.columns.vehicles=e("custom.vehicles.columns",[]),clientCustom.columns.dispatch=e("custom.dispatch.columns",{}),clientCustom.columns.notifications=e("custom.notifications.columns",[]),clientCustom.columns.clusters=e("custom.clusters.columns",[]),clientCustom.gSelect2.vehicles=e("custom.vehicles.gSelect2",{}),clientCustom.allowExportTable.notifications=e("custom.notifications.allowExportTable",!1),clientCustom.editableTrailer=e("custom.dispatch.editableTrailer",!1),clientCustom.previousCheckIns=e("custom.dispatch.previousCheckIns",{status:[],roles:[]}),clientCustom.autoGeneratedId=e("custom.dispatch.autoGeneratedId",!1),clientCustom.roundtrip=e("custom.dispatch.autoGeneratedId",!1),clientCustom.scheduled=e("custom.dispatch.scheduled",!1),clientCustom.statusWhenTruckEnteredOrigin=e("custom.dispatch.statusWhenTruckEnteredOrigin","assigned"),clientCustom.originDestinationSeparator=e("custom.dispatch.originDestinationSeparator",""),clientCustom.modalFields.vehicles=e("custom.vehicles.modalFields",[]),clientCustom.modalFields.clusters=e("custom.clusters.modalFields",[]),clientCustom.columnOrder.vehicles=e("custom.vehicles.columnOrder",[[0,"asc"]]),clientCustom.tableButtons.vehicles=e("custom.vehicles.tableButtons",{buttons:[]}),clientCustom.tableButtons.vehicle_personnel=e("custom.vehicle_personnel.tableButtons",{buttons:[]}),clientCustom.rowButtons.dispatch=e("custom.dispatch.rowButtons",{buttons:[]})}(),PERMISSION_BY_ROLE=CLIENT.xPERMISSION_BY_ROLE,CLIENT?e():location.reload()}else sessionStorage.getItem("version")!=t.version&&(sessionStorage.setItem("version",t.version),t.forceUpdate.includes(CLIENT.id)&&$("body").append(views.new_version())),SESSION_FROM_DB(function(){},function(){LOGOUT()}),console.log("credentials",t);else if("error"==t.type)t.message=t.message||"An error has occured.",toastr.error(t.message,null,{timeOut:0,extendedTimeOut:0});else if("server_status"==t.type)WEBSOCKET.resolve();else if(CHANGESTREAMS[t.type]){a=t.data;CHANGESTREAMS[t.type](a)}}),SOCKET.once("credentials",function(t){console.log("credentials",t),CLIENT=t.CLIENT,PERMISSION_BY_ROLE=CLIENT.xPERMISSION_BY_ROLE,CLIENT?e():location.reload()}),SOCKET.once("server_status",function(e){WEBSOCKET.resolve()}),SOCKET.on("error",function(e){console.log(e),e.message=e.message||"An error has occured.",toastr.error(e.message,null,{timeOut:0,extendedTimeOut:0})}),SOCKET.on("connect",function(e){console.log("OPENED : ",SOCKET.connected)})})}};function SESSION_FROM_DB(e,t){sessionStorage.getItem("prev_session_token")&&(Cookies.set("session_token",sessionStorage.getItem("prev_session_token"),{expires:30}),sessionStorage.removeItem("prev_session_token")),SESSION_TOKEN=Cookies.get("session_token");try{GET.AJAX({url:`/api/verifyToken/${CLIENT.id}`,method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({token:SESSION_TOKEN})},function(a){console.log("Session:",a);var i=a[0];if(a.error||!i)"function"==typeof t&&t();else{var n=a[0].userDetails;n.name&&n.email||($("body").append(modalViews.notice.emptyProfile()),$("#empty_profile").click(function(){window.history.pushState({},null,`/${CLIENT.name}#profile`),PAGE.GO_TO(),$(this).parents("#overlay").remove()})),CLIENT.tabCloseAutoLogout&&!n.exemptAutoLogout&&_SESSION_.window_tab_close(CLIENT.id,"THISISME",SESSION_TOKEN),USER=new User(n);try{"desktop"==USER.settings.push_notification&&"default"==Notification.permission&&($("body").append('<div class="cd-popup" id="confirm-modal">\n                                            <div class="cd-popup-container">\n                                                <p class="mb-0">Your settings are set to allow Desktop Notifications from this website. Please click \'<b>Allow</b>\' to receive push notifications when asked by the browser.</p>\n                                                <ul class="cd-buttons">\n                                                    <li style="width: 100%;">\n                                                        <a style="background-color: #00a548;color: white;" confirm>OKAY</a>\n                                                    </li>\n                                                </ul>\n                                            </div>\n                                        </div>'),$("#confirm-modal [confirm]").click(function(){$("#confirm-modal").remove(),Notification.requestPermission().then(function(e){console.log(e),"granted"==e||alert("Push notification request was denied. Please enable them in your browser if you've changed your mind.")})}))}catch(e){}i.dispatcherDetails&&autorizationLevel.dispatcher()&&(USER.dc=i.dispatcherDetails._id),PERMISSION=PERMISSION_BY_ROLE[USER.role]||{},i.notificationExists.forEach(e=>{!1===e._id&&(HASNOTIFICATION=!0)}),WEBSOCKET.sendUserInfo().then(()=>{"function"==typeof e&&e()})}})}catch(e){$("#body-main").html(modalViews.notice.browserNotSupported()),console.log("NOT SUUPORTTED")}}function LOGOUT(){$("body").append('<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;background-color: #ffffffc2;z-index: 999999;">\n                        <h3 style="text-align: center;margin-top: 40vh;font-weight: 100;">Logging out...</h3>\n                      </div>'),SESSION_TOKEN&&USER?$.ajax({url:`/api/sessions/${CLIENT.id}/${USER.username}/${SESSION_TOKEN}`,method:"DELETE",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(e){Cookies.remove("GKEY"),Cookies.remove("session_token"),location.href=`../${CLIENT.name}/login`}).fail(function(e){console.log("Error:",e)}):location.href=`../${CLIENT.name}/login`}const changelogList={"2.53.110":{date:"June 28, 2021",improved:["[Adjustment][Wilcon] Checker as not required","[Adjustment][Wilcon] Manpower/Truck Utilization report","[Update][Wilcon] Clusters - added sequence for Wilcon"]},"2.53.109":{date:"June 23, 2021",improved:["[Adjustment][Wilcon] Added values to Time-In and Time-Out columns (Scheduled Entries Report)."]},"2.53.108":{date:"June 21, 2021",fix:["[Adjustment][Wilcon] Helper field not required."]},"2.53.107":{date:"June 21, 2021",feature:["[Adjustment][Wilcon] Create DE: Add Helper field"]},"2.52.107":{date:"June 16, 2021",improved:["[Adjustment][Wilcon] Importing: Entries with previous dates should be not accepted at all","[Adjustment][Wilcon] Update status only available to admins"],fix:["[Bug][Wilcon] Update status still viewable by dispatchers","[Bug][Wilcon] Default driver on rest day can still be submitted"]},"2.51.107":{date:"June 09, 2021",fix:["[Adjustment][Wilcon] Importing DE's should still block duplicate entries based on truck/driver/shift schedule","(Fix)[Bug][Wilcon] Scheduled Entries Report missing","(Fix)[Bug?][Wilcon] Importing entries with previous dates was accepted"],improved:["[Adjustment][Wilcon] Days off: different kinds of days off should not be allowed to overlap","[Adjustment][Wilcon] Update status should not show in DE's"]},"2.51.106":{date:"June 07, 2021",feature:["[Feature][Coke] Admin power to adjust shipment vehicle (and Check-in time) and have WD generate info based on new info"]},"2.50.106":{date:"June 04, 2021",feature:["[Feature][Wilcon] Manpower and Vehicle utilization report"],improved:["[Adjustment][Wilcon] Personnel with scheduled rest days should not be able to be selected in Create Entry","[Adjustment][Wilcon] Confirmation message for setting and removing rest day"]},"2.49.106":{date:"June 02, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Minor bug fix.","aPAGE[Reports]zPAGE Bug fix - unable to click buttons."]},"2.49.105":{date:"May 27, 2021",fix:["Minor bug fix."]},"2.49.104":{date:"May 26, 2021",feature:["[Feature][Wilcon] Rest days"],improved:["[Adjustment][Wilcon] Add Departure date/time time Delay Notification Page","[Adjustment][Wilcon] 'Scheduling Report' adjustments"]},"2.48.104":{date:"May 25, 2021",improved:["[Adjustment][Wilcon] Previous dates be selectable in Scheduled Entries Report.","[Adjustment][Wilcon] Drop down menu for selecting Section and Company of trucks (Vehicle and Vehicle Personnel Page)"],fix:["[Bug][Wilcon] Imported DE's not showing up in Scheduled Entries Report"]},"2.48.103":{date:"May 19, 2021",improved:["[Adjustment][WM] Next Day Scheduled DE Report - Remove 'Next day' in the name; Also make it a date range selection.","WD accept .ods file for import."],feature:["[Adjustment][Wilcon] Add 'Section' and 'Company' tagging of trucks"]},"2.47.103":{date:"May 19, 2021",other:["[Adjustment][Wilcon] Scheduled entries to have their own box in dashboard."]},"2.47.102":{date:"May 12, 2021",fix:["Fixed dispatch entry bug."]},"2.47.101":{date:"May 11, 2021",fix:["Fixed logout issue. Users are not logged out if their session is expired while WD tab is inactive or if there's no internet connection while session was expired. The fix was to check the session everytime the website got connected to server."]},"2.47.100":{date:"May 10, 2021",improved:["[Adjustment][Wilcon] Remove trailer, pal cap, hauler name from CICO Report and Over Transit Report","[Adjustment][Wilcon] Change Next day scheduling to be able to select any future date instead"],fix:["[Adjustment] Make WD accept other file formats for importing (.odt)"]},"2.47.99":{date:"May 08, 2021",improved:["aPAGE[Reports]zPAGE Improved  User Login Activity Report format.","aPAGE[Dispatch Entries]zPAGE Enable dispatchers to edit fields if entry's status is either Queueing, Processing, or Idling."]},"2.47.98":{date:"May 03, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Import file format."],improved:["Version control - able to force update specific client only."]},"2.47.97":{date:"May 03, 2021",feature:["aPAGE[Dispatch Entries]zPAGE New Import file format and process."]},"2.46.97":{date:"April 30, 2021",feature:["Version control."]},"2.45.97":{date:"April 30, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Disabled Edit, Status Update, and Delete button for Dispatchers with conditions."]},"2.45.96":{date:"April 29, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Bug fix."]},"2.45.95":{date:"April 29, 2021",other:["[Wilcon] Added Next Day Scheduled Entries Report."]},"2.45.94":{date:"April 27, 2021",fix:["[Wilcon] WRU Main separated display name, truck number, and plate number. WD is showing truck number twice because of the said change in Main."]},"2.45.93":{date:"April 23, 2021",feature:["[Adjustment][Wilcon] Must not save or create if the truck, driver, checker is already assigned on the same schedule date and time."],other:["[Adjustment][Wilcon] Recombine Truck and Plate # (Except in Export DE excel).","[Adjustment][Wilcon] Additional status for the deployment dashboard 'Scheduled'."]},"2.44.93":{date:"April 21, 2021",fix:["aPAGE[Reports]zPAGE Fixed Dispatch Entries Summary Report bug."],other:["aPAGE[Dispatch Entries]zPAGE Allowed dispatchers to all routes."]},"2.44.92":{date:"April 20, 2021",feature:["[Adjustment][Wilcon] Custom shift schedule"],improved:["[Adjustment][Wilcon] Default scheduled date is the next day (editable)",'[Adjustment][Wilcon] Additional dashboard info "Onsite" "Returning"']},"2.43.92":{date:"April 19, 2021",fix:["aPAGE[Notifications]zPAGE Added escalation to filter."]},"2.43.91":{date:"April 17, 2021",feature:["[Coke] Auto logout after 2 hour idle and Window/tab closure"]},"2.42.91":{date:"April 13, 2021",feature:["[Coke & Wilcon] Modification of Delay Escalations to 'Site based'."],improved:["aPAGE[Reports]zPAGE [Coke] Add status, late entry, comments, and remarks as a last columns of the DE Summary report."]},"2.41.91":{date:"April 12, 2021",feature:["aPAGE[Dispatch Entries]zPAGE Wilcon - Trigger Complete on return to Origin."],improved:["aPAGE[Reports]zPAGE [Coke & Wilcon] Loading percentage for downloading reports.","aPAGE[Reports]zPAGE [Coke] Add status, late entry, and remarks as a last columns of the DE Summary report."]},"2.40.91":{date:"April 08, 2021",improved:["aPAGE[Reports]zPAGE [Adjustment][Coke] Change date format of DE Summary Report to mm/dd/yyyy; Add status and late entry as a last column of the DE Summary report","aPAGE[Reports]zPAGE Added Date From and Date To in excel sheet report","aPAGE[Dispatch Entries]zPAGE [Adjustment][Wilcon] Make shift schedule the basis for DE activation.","aPAGE[Deployment Dashboard]zPAGE Wilcon - Should base on Scheduled date."]},"2.40.90":{date:"April 08, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Status bug fix."]},"2.40.89":{date:"April 07, 2021",feature:["aPAGE[Reports]zPAGE Coke - Shipment summary report"],fix:["aPAGE[Deployment Dashboard]zPAGE Wilcon - Dashboard displaying last year's entries","aPAGE[Dispatch Entries]zPAGE Wilcon - Auto-generated SN. Only 9 digits. Should be 10 digits."]},"2.39.89":{date:"April 05, 2021",feature:["aPAGE[Dispatch Entries]zPAGE Wilcon - Auto-generated, sequential 10-digit shipment numbers."],improved:["aPAGE[Dispatch Entries]zPAGE Wilcon & Coke - Load vehicle data when user clicks the submit button."],fix:["aPAGE[Deployment Dashboard]zPAGE Wilcon & Coke - Dashboard info is persistent through future dates."]},"2.38.89":{date:"March 30, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Fixed trailer bug and added hourDiff (24 hrs)."]},"2.38.88":{date:"March 29, 2021",other:["aPAGE[Dispatch Entries]zPAGE Allow administrators to edit Incomplete shipments. Status will not be affected.","aPAGE[Dispatch Entries]zPAGE Allow administrators to update status with reason."]},"2.38.87":{date:"March 29, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Fixed trailer for cases like ACP8836."]},"2.38.86":{date:"March 27, 2021",fix:["Disabled delay notifications for normal users and dispatchers."]},"2.38.85":{date:"March 26, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Fixed history order."]},"2.38.84":{date:"March 26, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Assigned trailer not appearing when selected in Create Entry; Can create an entry without tractor/trailer by adding a comment (Trailer should be required)."],improved:["aPAGE[Reports]zPAGE Add duration to User Login Activity Report.","aPAGE[Dispatch Entries]zPAGE Will only show the message if required fields are filled."]},"2.38.83":{date:"March 25, 2021",fix:["Big fix"]},"2.38.82":{date:"March 24, 2021",fix:["Big fix"]},"2.38.81":{date:"March 24, 2021",fix:["Big fix"]},"2.38.80":{date:"March 24, 2021",fix:["Big fix"]},"2.38.79":{date:"March 23, 2021",fix:["Big fix"]},"2.38.78":{date:"March 22, 2021",improved:["aPAGE[Vehicle Personnel]zPAGE Wilcon only - Changed Occupation field to select."]},"2.38.77":{date:"March 22, 2021",other:["Changed event time logic. Saved as an object list - key is the timestamp instead of status."]},"2.37.77":{date:"March 22, 2021",improved:["aPAGE[Deployment Dashboard]zPAGE Wilcon only - Show active entries regardless of their posting date. Removed said feature from Coke."],feature:["aPAGE[Dispatch Entries]zPAGE Wilcon & Coke - Allow Administrator to delete completed entries.","aPAGE[Dispatch Entries (Deleted)]zPAGE Wilcon & Coke - New page for Developers ONLY. Display deleted entries as well as who deleted it and what time it was deleted."]},"2.36.77":{date:"March 20, 2021",improved:["aPAGE[Deployment Dashboard]zPAGE Show In Transit entries regardless of their posting date and show Scheduled date in selected date range."]},"2.36.77":{date:"March 20, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Added Hide/Show button to hide or show In Transit entries regardless of their posting date."]},"2.35.77":{date:"March 18, 2021",other:["aPAGE[Delay Escalation Dashboard]zPAGE Added Posted By and Posted On in modal."],fix:["aPAGE[Dispatch Entries]zPAGE Fixed searching feature in routes."]},"2.35.76":{date:"March 15, 2021",improved:["aPAGE[Deployment Dashboard]zPAGE Added View Button in Dispatch Modal.","Improved live updates for Users and Sessions."]},"2.35.75":{date:"March 12, 2021",improved:["Used Socket.IO instead of Websockets for Server-Client communication. Reason: Some clients' browsers may not support Websocket. Socket.IO has a fallback in case these things happen."]},"2.35.74":{date:"March 11, 2021",feature:["aPAGE[Reports]zPAGE Added User Login Activity Report."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Added Base Plant Column."],fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed filter by site & base plant."]},"2.34.74":{date:"March 10, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Fixed Target CICO Time and Search by SN."]},"2.34.73":{date:"March 10, 2021",feature:["Added Vehicle Personnel Page (Wilcon)."],improved:["aPAGE[Dispatch Entries]zPAGE Dropdown list for driver & checker. Driver & Checker will autofill upon vehicle change."],other:["aPAGE[Dispatch Entries]zPAGE Removed 'Create' button (Coke only)."]},"2.33.73":{date:"March 08, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Updated Import Batch File format for Wilcon. Added Scheduled Date filter for Wilcon."]},"2.33.72":{date:"March 05, 2021",fix:["User bug fixes."]},"2.33.71":{date:"March 05, 2021",other:["Back-end update - changestreams."]},"2.33.70":{date:"March 04, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Bug fix."]},"2.33.69":{date:"March 03, 2021",other:["aPAGE[Dispatch Entries]zPAGE Disabled searching of Trailer in Create/Edit Admin."]},"2.33.68":{date:"March 02, 2021",fix:["aPAGE[Vehicles/Trailers]zPAGE Fixed filter issue."]},"2.33.67":{date:"March 02, 2021",feature:["aPAGE[Vehicles/Trailers]zPAGE Added Site filter."]},"2.32.67":{date:"March 01, 2021",improved:["aPAGE[Vehicles/Dispatch Entries]zPAGE Added Conduction #.",'aPAGE[Dispatch Entries]zPAGE Change trailer to "Straight Truck" if the truck is their own trailer.',"aPAGE[Vehicles]zPAGE Sort by Base Plant/Site."],fix:["aPAGE[Reports]zPAGE Fixed - unable to generate report."]},"2.32.66":{date:"February 26, 2021",fix:["aPAGE[Trailers]zPAGE Disable Trailer field in edit."]},"2.32.65":{date:"February 26, 2021",feature:["aPAGE[Trailers]zPAGE Created Trailers page (data downloaded once from Main but will not be updated when trailers in Main is updated. Independent from Main.)"],improved:["aPAGE[Dispatch Entries]zPAGE Trailer can be independent from vehicles. Trailer info will update when trailer is changed."]},"2.31.65":{date:"February 24, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Default value in Origin field for Dispatchers and Wilcon. "],fix:["aPAGE[Dispatch Entries]zPAGE Disabled Create (Admin) and Edit (Admin) buttons for Wilcon"]},"2.31.64":{date:"February 24, 2021",fix:["aPAGE[Delay Notifications]zPAGE Export button for Wilcon only."]},"2.31.63":{date:"February 24, 2021",feature:["aPAGE[Delay Notifications]zPAGE Added Export button (Copy Table, Export as CSV, and Export as Excel).","aPAGE[Dispatch Entries]zPAGE Added separate buttons for Create-Admin and Edit-Admin."]},"2.30.63":{date:"February 24, 2021",other:['aPAGE[Dispatch Entries]zPAGE Removed "Trailer" field.']},"2.30.62":{date:"February 23, 2021",feature:['aPAGE[Dispatch Entries]zPAGE Added "Trailer" field.']},"2.29.62":{date:"February 23, 2021",improved:["aPAGE[Dispatch Entries]zPAGE For dispatchers only - autofilled origin in routes search box."],fix:["aPAGE[Dispatch Entries]zPAGE Fixed - dispatchers able to see all routes."]},"2.29.61":{date:"February 22, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Choose origin and destination by routes."],feature:["aPAGE[Dispatch Entries]zPAGE Wilcon - added ticket number, scheduled date, driver, and checker fields."]},"2.28.61":{date:"February 18, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Improved View function - more detailed and added logs."],other:["Removed 'queueingAtDestination' and 'processingAtDestination' status"]},"2.28.60":{date:"February 17, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Pal Cap - set visibility to default; added access for administrators and developers to edit dispatch entries after assigned status.","aPAGE[Delay Escalation Dashboard]zPAGE Added CICO Time; removed processing,idling,check-out date & time, and CICO time from queueing pop-up.","aPAGE[Reports]zPAGE Added End Date and End Time columns in Vehicle CICO Report."]},"2.28.59":{date:"February 16, 2021",feature:["Added options for push notifications in Settings page.","aPAGE[Delay Escalation Dashboard]zPAGE Live duration."],fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed destination status showing up."]},"2.27.59":{date:"February 15, 2021",improved:["aPAGE[Reports]zPAGE Updated Vehicle CICO Report cells to stick to original format."]},"2.27.58":{date:"February 11, 2021",fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed target CICO time - changed to origin's."]},"2.27.57":{date:"February 10, 2021",fix:["aPAGE[Delay Escalation Dashboard]zPAGE Ignore unnecessary rows."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Arranged the delay types."]},"2.27.56":{date:"February 10, 2021",fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed incorrect duration showing (changed to max)."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Placed 'Idling Duration' after 'Processing Duration'.","Changed 'idle_origin' to 'idlingAtOrigin'. 'idle_origin' is the timestamp where the vehicle is inside Idle geofence while the status of the entry is Dispatch; while 'idleAtOrigin' is the timestamp where the vehicle is also inside the Idle geofence but the status of the entry is Processing."]},"2.27.55":{date:"February 09, 2021",feature:["aPAGE[Dispatch Entries]zPAGE Added progress bar at the bottom of the table.","Pop-up on lower right of the screen for delayed escalation of entries."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Increased notification volume.","aPAGE[Dispatch Entries]zPAGE Added 'Pal Cap'."]},"2.26.55":{date:"February 05, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Added 'idle_origin' time.","aPAGE[Delay Escalation Dashboard]zPAGE Followed Coke's updated pop-up format."]},"2.26.54":{date:"February 05, 2021",improved:["aPAGE[Dispatch Entries]zPAGE Added 'entered_origin' time; removed CICO - Destination."]},"2.26.53":{date:"February 04, 2021",other:["Changed maximum idle time to 30 minutes from 20 minutes."]},"2.26.52":{date:"February 04, 2021",improved:["aPAGE[Delay Escalation Dashboard]zPAGE Followed Coke's format for the pop-out."],fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed duplicate row issues."]},"2.26.51":{date:"February 03, 2021",fix:["aPAGE[Reports]zPAGE Start counting duration when vehicle entered the main geofence (ignore when in Idle, Queueing, or Processing areas)."]},"2.26.50":{date:"February 03, 2021",fix:["aPAGE[Reports]zPAGE Fixed 'Pending' and 'Finished' status error in Vehicle CICO Report."]},"2.26.49":{date:"February 02, 2021",fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed double entry issue."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Only show entries with highest escalation level.","aPAGE[Reports]zPAGE Deduct 5 minutes from trigger time."]},"2.26.48":{date:"January 29, 2021",feature:["aPAGE[Delay Escalation Dashboard]zPAGE Added sound when a delay gets escalated; Show more info of dispatch entry when plate number is clicked."]},"2.25.48":{date:"January 26, 2021",fix:["aPAGE[Reports]zPAGE Fixed sites not showing up in Vehicle CICO Report."]},"2.25.47":{date:"January 22, 2021",improved:["Improved transition of tooltip pop-out.","aPAGE[Dispatch Entries]zPAGE Display name instead of username when a row is updated."],fix:["aPAGE[Dispatch Entries]zPAGE Fixed infinite loading of row buttons."]},"2.25.46":{date:"January 20, 2021",refactor:["Changed 'Dispatch' to 'Assigned'."]},"2.25.45":{date:"January 19, 2021",fix:["aPAGE[Deployment Dashboard]zPAGE Fixed duplicate shipment entries showing upon clicking rows."]},"2.25.44":{date:"January 18, 2021",fix:["aPAGE[Deployment Dashboard]zPAGE Fixed trailer issue.","aPAGE[Dispatch Entries]zPAGE Fixed status being always 'Dispatch' upon submitting."]},"2.25.43":{date:"January 17, 2021",refactor:["aPAGE[Reports]zPAGE Changed 'Vehicle Report' to 'Vehicle CICO Report'."],fix:["aPAGE[Reports]zPAGE Removed 'transit time' in Vehicle CICO Report."]},"2.25.42":{date:"January 15, 2021",improved:["aPAGE[Deployment Dashboard]zPAGE Added title, fixed trailer number issue, and updating summary when selecting in 'Base Plant'."]},"2.25.41":{date:"January 14, 2021",feature:["aPAGE[Reports]zPAGE Allowed 'Vehicle Report' button to all users."]},"2.25.40":{date:"January 13, 2021",feature:["aPAGE[Reports]zPAGE Added 'Vehicle Report' button (temporarily accessible by Developers only)."]},"2.24.40":{date:"January 12, 2021",improved:["aPAGE[Event Viewer/All Events]zPAGE Merged database collections into one. Also changed the database collection structure."]},"2.24.39":{date:"January 11, 2021",other:['aPAGE[Deployment Dashboard]zPAGE Coke\'s request: For origin view, show status "Complete" for status "Queueing (Destination)" and "Processing (Destination)".']},"2.24.38":{date:"January 07, 2021",improved:["Logs are separated from main database."],fix:["aPAGE[Dispatch Entries]zPAGE Fixed saving vehicle data twice."]},"2.24.37":{date:"January 06, 2021",improved:["aPAGE[Vehicles]zPAGE Display last 5 location histories of the vehicle instead of 2."]},"2.24.36":{date:"January 05, 2021",other:["aPAGE[Deployment Dashboard]zPAGE Coca-Cola Team's Request\n                <ol>\n                    <li>“Complete” Status Logic in origin perspective.\n                        <ul>\n                            <li>From: Actual check out at the origin, it will trigger the complete status</li>\n                            <li><b>To: Actual check in or arrival of the unit to its destination site, it will trigger the complete status</b></li>\n                        </ul>\n                    </li>\n                    <li>In Destination view, all incoming shipment to destination site is the only shipment will reflect on each column.</li>\n                    <li>Upon changing the logic of the “Complete” status, in Destination View, the status “Queueing (Destination), Processing (Destination)” will be not shown or even counted on the “Total Shipment” column.</li>\n                </ol>"]},"2.24.35":{date:"January 04, 2021",fix:["aPAGE[Dispatch Entries]zPAGE Fixed bug in logic (auto-detect of event timestamps)."]},"2.24.34":{date:"December 28, 2020",fix:["aPAGE[Deployment Dashboard]zPAGE Fixed bug in reset filter."]},"2.24.33":{date:"December 22, 2020",improved:["aPAGE[Dispatch Entries]zPAGE Improved algorithm for automatic detection of status and event timestamps based on vehicle's last location data."]},"2.24.32":{date:"December 18, 2020",feature:["aPAGE[Deployment Dashboard/Dispatch Entries]zPAGE Filters are saved and can be reset upon clicking 'Reset filters'."]},"2.23.32":{date:"December 17, 2020",fix:["aPAGE[Dashbord]zPAGE Fixed UI of region list when data exceeded maximum width."],refactor:["Added tab icon."]},"2.23.31":{date:"December 16, 2020",improved:["aPAGE[Geofences]zPAGE Allowed to save without cluster."]},"2.23.30":{date:"December 14, 2020",feature:["Added fullscreen feature."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Added 'Delay Escalation Dashboard' title; renamed columns 'Destination' to 'Location' in Long Queueing and Over CICO.","aPAGE[Deployment Dashboard]zPAGE Minor improvement on CSS."]},"2.22.30":{date:"December 11, 2020",fix:["aPAGE[Delay Escalation Dashboard]zPAGE Fixed page to only show 'live' data."],improved:["aPAGE[Delay Escalation Dashboard]zPAGE Allowed multiple selection of site."]},"2.22.29":{date:"December 09, 2020",fix:["aPAGE[Delay Escalation Dashboard]zPAGE fixed bug causing not to update countings."]},"2.22.28":{date:"December 07, 2020",feature:["Added Delay Escalation Dashboard page."]},"2.21.28":{date:"December 04, 2020",improved:["aPAGE[Dispatch Entries]zPAGE Added Site Name in searching origin or destination."]},"2.21.27":{date:"December 02, 2020",fix:["aPAGE[Dispatch Entries]zPAGE Fixed alert message for vehicles inside geofence but does not have history location yet; Fixed toastr when vehicle data is not yet done loading."]},"2.21.26":{date:"December 01, 2020",improved:["aPAGE[Dispatch Entries]zPAGE Improved logic for CICO at Origin."]},"2.21.25":{date:"November 29, 2020",improved:["aPAGE[Dispatch Entries]zPAGE Added 'Version' data in DE History; improved logic."]},"2.21.24":{date:"November 26, 2020",improved:["aPAGE[Dispatch Entries]zPAGE Added 'Vehicle's Location History at Posting Date' data in DE History."]},"2.21.23":{date:"November 25, 2020",feature:["aPAGE[Vehicles]zPAGE Added View button to view location history of the vehicle."]},"2.20.23":{date:"November 24, 2020",fix:["Fixed minor bugs in error handling."],improved:["aPAGE[Vehicles]zPAGE Added Equipment Number column."]},"2.20.22":{date:"November 23, 2020",feature:["aPAGE[Dispatch Entries]zPAGE Added history button (developers only). User actions are saved for record purposes."],improved:["aPAGE[Dispatch Entries]zPAGE Event timestamps will not reset when user manually changes status or edits data in entry. Event time calculation will only show depending on status."]},"2.19.22":{date:"November 20, 2020",improved:["aPAGE[CICO Dashboard]zPAGE "]},"2.19.21":{date:"November 19, 2020",fix:["aPAGE[Dashboard]zPAGE Fixed 'Choose Site' filter source. Source is from WRU Main instead of WD geofences."]},"2.19.20":{date:"November 18, 2020",other:["aPAGE[Dashboard]zPAGE Renamed 'CICO Dashboard' to 'Deployment Dashboard'; Removed CICO related columns; Added 'Choose Site' filter; enabled Deployment Dashboard for all users."]},"2.19.19":{date:"November 17, 2020",improved:["aPAGE[All Events]zPAGE Improved search feature."]},"2.19.18":{date:"November 16, 2020",feature:["aPAGE[All Events]zPAGE Added All Events Page for developers. This page displays all events sent by vehicles to Events function regardless of conditions."],fix:["aPAGE[Dispatch Entries]zPAGE Fixed detection of status."]},"2.18.18":{date:"November 12, 2020",feature:["aPAGE[Vehicles]zPAGE Added 'Last 2 Locations' column with the latest timestamp event recorded."]},"2.17.18":{date:"November 10, 2020",feature:["aPAGE[Dispatch Entries]zPAGE Added checker that looks into the database if vehicle is or has been at the origin or already at destination. Saving event timestamps for CICO purposes."]},"2.16.18":{date:"November 5, 2020",fix:["aPAGE[Login]zPAGE Fixed forever loading when IPInfo (third party) server is down."]},"2.16.17":{date:"November 4, 2020",feature:["Added timeout when page is idle for more than 20 minutes."]},"2.15.17":{date:"November 3, 2020",refactor:["Updated CokeT1 and CokeT2 logos."]},"2.15.16":{date:"October 30, 2020",feature:["aPAGE[Event Viewer]zPAGE Added 'Generate Report' button in table options. Report buttons are only clickable if data are available. Reports for CokeT2 is transferred in Event Viewer page from Reports page. (CokeT2 only)"],refactor:["Updated 'Export Options' icon."]},"2.14.16":{date:"October 29, 2020",feature:["aPAGE[Reports]zPAGE Added Trucks Outside DC Report (for CokeT2)."]},"2.13.16":{date:"October 26, 2020",feature:["aPAGE[Dispatch Entries]zPAGE Added and modified status.[Queueing (Origin), Processing (Origin),Queueing (Destination), Processing (Destination)]."],fix:["aPAGE[Dashboard/Dispatch Entries]zPAGE Fixed CICO and Compliance for Origin."]},"2.12.16":{date:"October 25, 2020",feature:["aPAGE[Dashboard/Dispatch Entries]zPAGE Added Event Queueing, Event Processing, and CICO for origin."],improved:["aPAGE[Event Viewer]zPAGE Improved database structure."]},"2.11.16":{date:"October 23, 2020",fix:["aPAGE[Event Viewer]zPAGE Fixed error caused by null or undefined values."]},"2.11.15":{date:"October 19, 2020",feature:["aPAGE[Dispatch Entries/Dashboard]zPAGE Added CICO Time and CICO Time (Capped) columns. (HH:MM format)"]},"2.10.15":{date:"October 15, 2020",refactor:["Minor UI changes - footer on screen resize. Added version in footer.","aPAGE[Settings]zPAGE The current version will only appear on the Mobile version and will be hidden on the Web version.."]},"2.10.14":{date:"October 14, 2020",feature:["Detect if user's name and/or email is empty. Show popup with instructions to setup profile.","Added new roles specifically for CokeT2 (user & developer).","aPAGE[Profile]zPAGE Added 'Download Profile From WRU Dispatch - CokeT1' button (For CokeT2 only)."]},"2.9.14":{date:"October 10, 2020",other:["Setup CokeT2 WD account."],refactor:["aPAGE[Changelog]zPAGE Minor update on Changelog guide."]},"2.9.13":{date:"October 06, 2020",fix:["aPAGE[Regions]zPAGE Fixed create new region error."]},"2.9.12":{date:"October 02, 2020",fix:["aPAGE[Dispatch Entries]zPAGE Fixed - Wrong Ave. CICO Time showing for some Plant/DC."]},"2.9.11":{date:"October 01, 2020",fix:["aPAGE[Dispatch Entries]zPAGE Fixed - Trailer not showing value."],refactor:["aPAGE[Dispatch Entries]zPAGE Minor UI Changes in Import Batch File and updated link of Excel file URL."]},"2.9.10":{date:"October 01, 2020",fix:["aPAGE[Dispatch Entries]zPAGE Fixed bug in posting date filter."]},"2.9.9":{date:"September 30, 2020",feature:["Allow Dispatcher role to view Dashboard (without CICO information and Compliance)."],refactor:["Added background color when a table row is hovered.","aVERSION(Mobile Version)zVERSION Fixed bottom bar menu width.","aPAGE[Dispatch Entries]zPAGE Minor UI updates in 'Create New Dispatch Entry' modal."],improved:["aPAGE[Dispatch Entries]zPAGE Allow user to filter by Departure Date only. Posting date will be empty only if Departure Date has value."],fix:["Fixed date filter (unable to click default date when filter is cleared)."]},"2.8.9":{date:"September 29, 2020",improved:["aPAGE[Dashboard]zPAGE <ul class='pl-4'><li>CICO Time is capped to 5 hours if destination is Plant.</li><li>Followed the logic and formula provided by Coke.</li></ul>"],fix:["aPAGE[Dashboard]zPAGE Fixed the formula for Ave. CICO Time."]},"2.8.8":{date:"September 28, 2020",fix:["aPAGE[Dashboard]zPAGE Fixed the pop-up error showing when a Geofence/Site is not yet assigned to a Region."]},"2.8.7":{date:"September 24, 2020",feature:["aPAGE[Dashboard]zPAGE Added a toggle to switch between Origin View/Destination View."],improved:["aVERSION(Mobile Version)zVERSION aPAGE[Dashboard]zPAGE Disabled keyboard pop-up when selecting a date."]},"2.7.7":{date:"September 22, 2020",refactor:["Changed the term 'Developers Only' to 'For Developers'."]},"2.7.6":{date:"September 22, 2020",fix:["aPAGE[Changelog]zPAGE Fixed - Multiple changelog types not showing."],refactor:["aPAGE[Changelog]zPAGE Minor UI updates (including Changelog Guide).","aPAGE[Settings]zPAGE Added web application version."]},"2.7.5":{date:"September 21, 2020",feature:["Added Changelog page (accessible to Developers only)."],fix:["aVERSION(Web Version)zVERSION aPAGE[Dashboard]zPAGE Fixed the Customize Display Options height and position."]},"2.6.5":{date:"September 19, 2020",feature:["aPAGE[Dispatch Entries]zPAGE Added feature that enabled users to search for Shipment Number through all records","aVERSION(Mobile Version)zVERSION aPAGE[Notifications]zPAGE Real-time update"]},"2.5.5":{date:"September 17, 2020",improved:["aVERSION(Mobile Version)zVERSION aPAGE[Dashboard]zPAGE Dispatch list User Interface"]},"2.5.4":{date:"September 16, 2020",feature:["aVERSION(Mobile Version)zVERSION aPAGE[Notifications]zPAGE Added refresh and filter button","aPAGE[Dashboard]zPAGE Added option to load existing entry on user click (for duplicate shipment number only)"],improved:["aPAGE[Dashboard/Dispatch/Notifications/Event Viewer]zPAGE Pop-up slide when filter/export/customize display options is clicked"]},"2.4.4":{date:"September 14, 2020",fix:["aPAGE[Dashboard]zPAGE Fixed pop-up tooltip in table headers"],refactor:["aPAGE[Dashboard]zPAGE Added Incomplete table header info"]},"2.4.3":{date:"September 02, 2020",feature:["aPAGE[Dashboard]zPAGE Removed refreshing of data every 5 minutes and implemented real-time update instead","aPAGE[Regions]zPAGE Added 'Sequence' column for sequencing of region tabs in Dashboard"],refactor:["aPAGE[Dashboard]zPAGE Changed 'Plan' to 'Incomplete'","aPAGE[Vehicles]zPAGE Changed the status 'Truck Rehab' to 'Preventive Maintenance'"]},"2.3.3":{date:"August 26, 2020",fix:["aPAGE[Dispatch]zPAGE Fixed bug when submitting a Dispatch entry"]},"2.3.2":{date:"August 21, 2020",feature:["Added Dashboard page"]},"2.2.2":{date:"August 20, 2020",feature:["aPAGE[Vehicles]zPAGE Changing Availability Status will also change the status in WRU Main","aPAGE[Profile]zPAGE Added Edit and Download Profile from WRU Main buttons"]},"2.1.2":{date:"August 13, 2020",refactor:["aPAGE[Geofences]zPAGE Changed term from 'Geofences' to 'Distribution Center' to 'Sites'."]},"2.1.1":{date:"August 12, 2020",fix:["aPAGE[Login]zPAGE Changed username to be case-insensitive"]},"2.1.0":{date:"August 01-09, 2020",feature:["aPAGE[Regions/Clusters/Geofences]zPAGE Region, cluster, and geofence data are separated in terms of database structure and page.","aPAGE[Vehicles/Geofences]zPAGE Data are imported from WRU Main. Watching for updates every 2 minutes."]},"2.0.0":{date:"July 17, 2020",release:["WRU Dispatch hosting on Microsoft Azure.<br>Available to users on August 14, 2020."]},"1.0.0 - v.1.21.57":{date:"mid of May 2020 - September 15, 2020",release:["WRU Dispatch hosted on Google App Engine.<br>Terminated on September 16, 2020.<br>Reason for termination: Google App Engine does not support Web Sockets. Web sockets are used to get real-time data updates. The application instead uses long-polling resulting in thousands of requests per user connection, and the number of requests matters for the billing."]},"0.0.0 - v.0.4.19":{date:"April 2020 - mid of May 2020",release:["WRU Dispatch hosted on MongoDB Stitch.<br>Terminated on mid of May 2020.<br>Reason for termination: MongoDB Stitch uses its own Javascript runtime and the needed modules for the application such as NodeJS, ExpressJS, etc. are not available or supported."]}};var autorizationLevel={dispatcher:()=>["dispatcher"].includes(USER.role),administrator:()=>["administrator","developer"].includes(USER.role)},vehiclePersonnelCalendarOptions={rest_days:{optionTitle:"Rest Days",label:"Rest Day"},on_leave:{optionTitle:"On Leave",label:"On Leave"},absent:{optionTitle:"Absences",label:"Absent"},suspended:{optionTitle:"Suspended",label:"Suspended"},awol:{optionTitle:"AWOL",label:"AWOL"}};function matcher(e,t,a){var i=$(t.element).parent().attr("id"),n=(e.term||"").split(","),s=(n[0]||"")._trim().toUpperCase(),l=(n[1]||"")._trim().toUpperCase(),o=(t.text||"").toUpperCase(),r=($(t.element).attr("data-subtext")||"").replace(/<br>/g," ").toUpperCase(),d=($(t.element).attr("data-subtext")||"").split("<br>"),c=(d[0]||"")._trim().toUpperCase(),u=(d[1]||"")._trim().toUpperCase(),p=(d[2]||"")._trim().toUpperCase();if("route"==i)return!e.term||!l&&o.indexOf(s)>-1||(o.indexOf(s)>-1||c.indexOf(s)>-1)&&u.indexOf(l)>-1?t:null;if("vehicle"==i){var m=u.indexOf("TRAILER")>-1?p:u;return!e.term||o.indexOf(s)>-1||c.indexOf(s)>-1||m.indexOf(s)>-1?t:null}return r.indexOf(s)>-1||o.indexOf(s)>-1?t:null}function formatCustom(e){return $("<div><b>"+e.text+'</b><div class="text-muted">'+($(e.element).attr("data-subtext")||"")+"</div></div>")}function formatCustomGrayed(e){var t=!1;return Object.keys(vehiclePersonnelCalendarOptions).forEach(a=>{e.text.indexOf(vehiclePersonnelCalendarOptions[a].label)>-1&&(t=!0)}),$(`<div class="${t?"text-muted":""}">${e.text}</div>`)}function getSelect2Options(){G_SELECT2["form-vehicles"]='<option value="">&nbsp;</option>',G_SELECT2["form-vehicles-admin"]='<option value="">&nbsp;</option>',(LIST.vehicles||[]).forEach(e=>{var t=VEHICLES.STATUS.find(t=>t.id==(e.status||""))||{value:"Available"},a="",i="";try{function n(a){var i=[];return(clientCustom.gSelect2.vehicles[a]||[]).forEach(a=>{switch(a){case"trailer":var n=getTrailer(e.name)?"Straight Truck":e.Trailer||"-";i.push(`Trailer: ${n}`);break;case"truck_number":i.push(`Truck Number: ${e["Truck Number"]||"-"}`);break;case"conduction_number":i.push(`Conduction #: ${e["Tractor Conduction"]||"-"}`);break;case"availability":i.push(`Availability: ${t.value}`)}}),i.join("<br>")}a=n("subtext"),i=n("subtextAdmin")}catch(e){}G_SELECT2["form-vehicles-admin"]+=`<option value="${e._id}" username="${e.username}" data-subtext="${i}">${e.name}</option>`,G_SELECT2["form-vehicles"]+=`<option value="${e._id}" username="${e.username}" data-subtext="${a}">${e.name}</option>`}),G_SELECT2["form-vehicles_section"]='<option value="">&nbsp;</option>',(LIST.vehicles_section||[]).forEach(e=>{!e.delete&&(G_SELECT2["form-vehicles_section"]+=`<option value="${e._id}">${e.section}</option>`)}),G_SELECT2["form-vehicles_company"]='<option value="">&nbsp;</option>',(LIST.vehicles_company||[]).forEach(e=>{!e.delete&&(G_SELECT2["form-vehicles_company"]+=`<option value="${e._id}">${e.company}</option>`)}),G_SELECT2["form-vehicle_personnel_section"]='<option value="">&nbsp;</option>',(LIST.vehicle_personnel_section||[]).forEach(e=>{!e.delete&&(G_SELECT2["form-vehicle_personnel_section"]+=`<option value="${e._id}">${e.section}</option>`)}),G_SELECT2["form-vehicle_personnel_company"]='<option value="">&nbsp;</option>',(LIST.vehicle_personnel_company||[]).forEach(e=>{!e.delete&&(G_SELECT2["form-vehicle_personnel_company"]+=`<option value="${e._id}">${e.company}</option>`)}),G_SELECT2["form-shift_schedule"]="",(LIST.shift_schedule||[]).forEach(e=>{G_SELECT2["form-shift_schedule"]+=`<option value="${e._id}">${e._id}</option>`}),G_SELECT2["form-trailers"]='<option value="">&nbsp;</option><option disabled>Straight Truck</option>',(LIST.trailers||[]).forEach(e=>{var t=`Pal Cap: ${e.pal_cap||"-"}<br>Region: ${e.region||"-"}<br>Cluster: ${e.cluster||"-"}<br>Site: ${e.site||"-"}`;G_SELECT2["form-trailers"]+=`<option value="${e._id}" data-subtext="${t}">${e._id}</option>`});var e=LIST.routes||[];try{(clientCustom.defaultOrigin.roles||[]).includes(USER.role)&&(e=(LIST.routes||[]).filter(e=>e.origin_id&&e.origin_id.toString()==clientCustom.defaultOrigin.id))}catch(e){}G_SELECT2["form-routes"]='<option value="">&nbsp;</option>',(e||[]).forEach(e=>{var t=getGeofence(e.origin_id)||{},a=getGeofence(e.destination_id)||{},i=`Origin: ${t.short_name} (${t.site_name||"-"})<br>Destination: ${a.short_name} (${a.site_name||"-"})`;G_SELECT2["form-routes"]+=`<option value="${e._id}" data-subtext="${i}">${e._id}</option>`})}function getDuration(e,t){t.events_captured=t.events_captured||{};var a,i,n=OBJECT.sortByKey(t.events_captured),s=0;return Object.keys(n).forEach(t=>{n[t]==e?a=Number(t):a&&!i&&(i=Number(t),s+=i-a,a=null,i=null)}),a&&!i&&(s=0),s}function getDateTime(e,t,a="first"){t.events_captured=t.events_captured||{};var i=OBJECT.sortByKey(t.events_captured),n=0;return Object.keys(i).forEach(t=>{i[t]==e&&("first"!=a||n||(n=Number(t)),"last"==a&&(n=Number(t))),e||("first"!=a||n||(n=Number(t)),"last"==a&&(n=Number(t)))}),n}function withinSchedule(e,t,a){e=moment(new Date(e)).format("MM/DD/YYYY");var i=!1,n=(t||"").split(" - "),s=n[0],l=n[1],o=moment(s,"h:mm A"),r=moment(l,"h:mm A"),d=o.isBefore(r)?e:moment(new Date(e)).add(1,"day").format("MM/DD/YYYY"),c=new Date(`${e}, ${s}`).getTime(),u=new Date(`${d}, ${l}`).getTime(),p=(new Date).getTime();return console.log(e),(p>=c&&p<=u||a&&p<c)&&(i=!0),i}function isFinishedLoading(e,t,a){var i=!0;e.forEach(e=>{(CLIENT.loadInBackground||[]).includes(e)&&(GGS.STATUS[e]||(i=!1))}),1==i&&t&&a()}class Dispatch{constructor(e,t,a){function i(t,a,i,n,s,l){var o;return i=i||{},t?(o=n?(LIST[a].find(e=>e._id==i)||{})[n]:LIST[a].find(e=>e._id==i)||{},s&&(e[s]=o)):l?(o={},l.forEach(e=>{o[e]='<small class="font-italic text-muted">loading...</small>'})):o='<small class="font-italic text-muted">loading...</small>',o}LIST.dispatch=LIST.dispatch||[],e.events_captured=e.events_captured||{},e.destination=e.destination||[],e.destination[0]=e.destination[0]||{};var n=[];["complete"].includes(e.status)&&(n=autorizationLevel.administrator()?["statusUpdate","edit","edit-admin"]:["statusUpdate","edit","edit-admin","delete"]),["in_transit","incomplete"].includes(e.status)&&(n=autorizationLevel.administrator()?[]:["statusUpdate","edit","edit-admin"]),["in_transit","complete","incomplete"].includes(e.status)&&(autorizationLevel.administrator()||n.push("delete"));var s=GGS.STATUS.REGIONS&&GGS.STATUS.CLUSTERS&&GGS.STATUS.GEOFENCES&&GGS.STATUS.VEHICLES&&GGS.STATUS.ROUTES?[]:["edit","edit-admin","view"],l=(getDuration("entered_origin",e),getDuration("queueingAtOrigin",e)),o=getDuration("processingAtOrigin",e),r=getDuration("idlingAtOrigin",e),d=getDuration("in_transit",e),c=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:s,readonlyArr:s,adminArr:["edit-admin"],status:e.status,username:e.username,disabledArr:n}),u=getUser(e.username)||{},p=USER.username==e.username?"You":u.name||e.username,m=u.name||e.username,h=i(LIST.geofences,"geofences",e.origin_id,null,"_origin",["short_name"]),b=i(LIST.geofences,"geofences",e.destination[0].location_id,null,"_destination",["short_name"]),f=i(LIST.regions&&LIST.geofences,"regions",h.region_id,"region","_region"),v=i(LIST.clusters&&LIST.geofences,"clusters",h.cluster_id,"cluster","_cluster"),E=i(LIST.vehicles,"vehicles",e.vehicle_id,null,"_vehicle",["name","Trailer"]),g=i(LIST.routes,"routes",e.route,null,"_route",["transit_time"]),T=i(LIST.trailers,"trailers",e.trailer||E.Trailer,null,null,["_id","pal_cap"]),_=i(LIST.vehicle_personnel,"vehicle_personnel",e.driver_id,null,null,["name"]),y=i(LIST.vehicle_personnel,"vehicle_personnel",e.checker_id,null,null,["name"]),S=i(LIST.vehicle_personnel,"vehicle_personnel",e.helper_id,null,null,["name"]),A=LIST.dispatch.findIndex(t=>t._id==e._id),I=getDateTime("entered_origin",e)||getDateTime("queueingAtOrigin",e)||getDateTime("processingAtOrigin",e)||getDateTime("idlingAtOrigin",e),D=I?getDateTime("in_transit",e,"last")-I:0,O=["in_transit","complete","incomplete"].includes(e.status)?DATETIME.DH(D||0):"-",C="-"==O?"-":DATETIME.HH_MM(null,O).hour_minute,w="-"==O?"-":DATETIME.HH_MM(null,5).hour_minute,N=!!h.short_name&&h.short_name.indexOf(" PL")>-1;a&&(c=TABLE.ROW_BUTTONS(PAGE.GET(),{customButtons:["view"],loadView:s,readonlyArr:s,username:e.username})),t&&$(`${t} th:last-child`).css({"min-width":c.width,width:c.width}),e._id&&(!e._row&&(e._row=GENERATE.RANDOM(36)),A>-1?LIST.dispatch[A]=e:LIST.dispatch.push(e)),"_API_"==p&&(p=`${CLIENT.name} Server`);var L="";e.attachments&&e.attachments.forEach((e,t)=>{L+=`<div style="font-weight: normal;">${t+1}. <a href="${e.url}" target="_blank">${e.filename||"-"}</a></div>`}),this._row=e._row,this._id=e._id,this.ticket_number=e.ticket_number||"-",this.departure_date=DATETIME.FORMAT(e.departure_date),this.departure__date=DATETIME.FORMAT(e.departure_date,"MMM DD, YYYY"),this.departure__time=DATETIME.FORMAT(e.departure_date,"hh:mm A"),this.region=f||"-",this.cluster=v||"-",this.origin=h.short_name||"-",this.route=e.route||"-",this.destination=`${b.short_name||"-"}${GET.LENGTH(b.length).text}`,this.etd=DATETIME.FORMAT(e.destination[0].etd),this.eta=DATETIME.FORMAT(e.destination[0].eta),this.target_transit_time=DATETIME.HH_MM(null,g.transit_time).hour_minute,this.target_cico_time=DATETIME.HH_MM(null,h.cico).hour_minute,this.vehicle=E.name||"-",this.plate_number=E["Plate Number"]||"-",this.truck_number=E["Truck Number"]||"-",this.conduction_number=E["Tractor Conduction"]||"-",this.trailer=T._id||"-",this.pal_cap=T.pal_cap||"-",this.driver=_.name||"-",this.checker=y.name||"-",this.helper=S.name||"-",this.comments=e.comments||"-",this.entered_datetime=DATETIME.FORMAT(getDateTime(null,e)),this.queueing_datetime=DATETIME.FORMAT(getDateTime("queueingAtOrigin",e)),this.queueingDuration=DATETIME.HH_MM(l).hour_minute,this.processing_datetime=DATETIME.FORMAT(getDateTime("processingAtOrigin",e)),this.processingDuration=DATETIME.HH_MM(o).hour_minute,this.idling_datetime=DATETIME.FORMAT(getDateTime("idlingAtOrigin",e)),this.idlingDuration=DATETIME.HH_MM(r).hour_minute,this.cico=["in_transit","onSite","returning","complete","incomplete"].includes(e.status)?C:"-",this.cico_capped=["in_transit","onSite","returning","complete","incomplete"].includes(e.status)?O>5&&N?w:C:"-",this.transit_datetime=["in_transit","onSite","returning","complete","incomplete"].includes(e.status)?DATETIME.FORMAT(getDateTime("in_transit",e,"last")):"-",this.transitDuration=["in_transit","onSite","returning","complete","incomplete"].includes(e.status)?DATETIME.HH_MM(d).hour_minute:"-",this.onSite_datetime=["onSite","returning","complete","incomplete"].includes(e.status)?DATETIME.FORMAT(getDateTime("onSite",e,"last")):"-",this.returning_datetime=["returning","complete","incomplete"].includes(e.status)?DATETIME.FORMAT(getDateTime("returning",e,"last")):"-",this.complete_datetime=["complete"].includes(e.status)?DATETIME.FORMAT(getDateTime("complete",e,"last")):"-",this.status=GET.STATUS(e.status).html,this.statusText=GET.STATUS(e.status).text,this.scheduled_date=DATETIME.FORMAT(e.scheduled_date,"MMM DD, YYYY"),this.shift_schedule=e.shift_schedule||"-",this.posted_by=p,this.postedByWithName=m,this.posting_date=DATETIME.FORMAT(e.posting_date),this.late_entry=e.late_entry?"Yes".bold():"No",this.action=c.buttons,this.attachmentsHTML=L,this.ongoingHTML="complete"!=e.status?'<span class="ongoing" style="width: 7px;height: 7px;background: #00a548;border-radius: 20px;top: 14px;margin-left: 4px;position: absolute;"></span>':"";var x="";Object.keys(e.esc1_remarks||{}).forEach(t=>{var a=e.esc1_remarks[t],i=getUser(a.username)||{};x+=`${a.remarks}<div class="font-11 text-muted mb-1">${i.name||a.username} | ${DATETIME.FORMAT(Number(t))}</div>`});var R="";Object.keys(e.esc2_remarks||{}).forEach(t=>{var a=e.esc2_remarks[t],i=getUser(a.username)||{};R+=`${a.remarks}<div class="font-11 text-muted mb-1">${i.name||a.username} | ${DATETIME.FORMAT(Number(t))}</div>`});var P="";Object.keys(e.esc3_remarks||{}).forEach(t=>{var a=e.esc3_remarks[t],i=getUser(a.username)||{};P+=`${a.remarks}<div class="font-11 text-muted mb-1">${i.name||a.username} | ${DATETIME.FORMAT(Number(t))}</div>`}),this.esc1_remarks=x||"-",this.esc2_remarks=R||"-",this.esc3_remarks=P||"-",this.history=e.history||{}}row(){return{_row:this._row,_id:this._id,"Ticket Number":this.ticket_number,"Departure Date":this.departure_date,Departure__Date:this.departure__date,Departure__Time:this.departure__time,Region:this.region,Cluster:this.cluster,Origin:this.origin,Route:this.route,Destination:this.destination,ETD:this.etd,ETA:this.eta,"Target Transit Time":this.target_transit_time,"Target CICO Time":this.target_cico_time,Vehicle:this.vehicle,"Plate Number":this.plate_number,"Truck Number":this.truck_number,Trailer:this.trailer,"Conduction Number":this.conduction_number,"Pal Cap":this.pal_cap,Driver:this.driver,Checker:this.checker,Helper:this.helper,Comments:this.comments,"Queueing Duration":this.queueingDuration,"Processing Duration":this.processingDuration,"Idling Duration":this.idlingDuration,"CICO Time":this.cico,"CICO Time (Capped)":this.cico_capped,"Transit Duration":this.transitDuration,Status:this.status,"Scheduled Date":this.scheduled_date,"Shift Schedule":this.shift_schedule,"Posted By":this.posted_by,"Posting Date":this.posting_date,"Late Entry":this.late_entry,Action:this.action}}html(){return`<div class="container-parent col-sm-12 p-0 text-dark p-0" _row="${this._row}">\n                    <div class="container-header pt-2 pl-4 pr-4 pb-2">\n                        <span class="container-header-title">${this._id||"-"}${this.ongoingHTML}</span>\n                        <div class="container-header-body">${this.departure_date}, ${this.route}, ${this.vehicle}</div>\n                        <i class="la la-angle-up" style="display:none;"></i>\n                    </div>\n                    <div class="container-body pr-4 pb-2" style="display:none;">\n                        <div><span style="display: table-cell;width: 120px;">Departure Date</span><span style="display: table-cell;">${this.departure_date}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Region</span><span style="display: table-cell;">${this.region}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Cluster</span><span style="display: table-cell;">${this.cluster}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Origin</span><span style="display: table-cell;">${this.origin}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Route</span><span style="display: table-cell;">${this.route}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Destination</span><span style="display: table-cell;">${this.destination}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">ETD</span><span style="display: table-cell;">${this.etd}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">ETA</span><span style="display: table-cell;">${this.eta}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Target Transit Time</span><span style="display: table-cell;">${this.target_transit_time}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Target CICO Time</span><span style="display: table-cell;">${this.target_cico_time}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Vehicle</span><span style="display: table-cell;">${this.vehicle}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Trailer</span><span style="display: table-cell;">${this.trailer}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Conduction #</span><span style="display: table-cell;">${this.conduction_number}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Pal Cap</span><span style="display: table-cell;">${this.pal_cap}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Driver</span><span style="display: table-cell;">${this.driver}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Checker</span><span style="display: table-cell;">${this.checker}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Helper</span><span style="display: table-cell;">${this.helper}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Comments</span><span style="display: table-cell;">${this.comments}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Queueing Duration</span><span style="display: table-cell;"><div>${this.queueingDuration}</div></span></div>\n                        <div><span style="display: table-cell;width: 120px;">Processing Duration</span><span style="display: table-cell;"><div>${this.processingDuration}</div></span></div>\n                        <div><span style="display: table-cell;width: 120px;">Idling Duration</span><span style="display: table-cell;"><div>${this.idlingDuration}</div></span></div>\n                        <div><span style="display: table-cell;width: 120px;">CICO Time</span><span style="display: table-cell;"><div>${this.cico}</div></span></div>\n                        <div><span style="display: table-cell;width: 120px;">'CICO Time (Capped)</span><span style="display: table-cell;"><div>${this.cico_capped}</div></span></div>\n                        <div><span style="display: table-cell;width: 120px;">Transit Duration</span><span style="display: table-cell;"><div>${this.transitDuration}</div></span></div>\n                        <div><span style="display: table-cell;width: 120px;">Scheduled Date</span><span style="display: table-cell;">${this.scheduled_date}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Shift Schedule</span><span style="display: table-cell;">${this.shift_schedule}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Posted By</span><span style="display: table-cell;">${this.posted_by}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Posting Date</span><span style="display: table-cell;">${this.posting_date}</span></div>\n                        <div><span style="display: table-cell;width: 120px;">Late Entry</span><span style="display: table-cell;">${this.late_entry}</span></div>\n                    </div>\n                </div>`}tbl(){var e="width: 50%;float: left !important;padding-bottom: 2px;",t='style="width: 200px;font-weight: bold;vertical-align:top;"';return{tr:e,tdFirst:t,empty:`<tr style="${e}">\n                        <td ${t}>&nbsp;</td>\n                        <td>&nbsp;</td>\n                    </tr>`,getTr:(a,i,n="",s="",l)=>`<tr style="${l||e} ${n}">\n                            <td ${t}>${a}</td>\n                            <td ${s}>${i?`: ${i}`:""}</td>\n                        </tr>`}}de_html(e){var t="Transit";return e["Delay Type"].indexOf("Queueing")>-1&&(t="Queueing"),e["Delay Type"].indexOf("CICO")>-1&&(t="CICO"),`<div id="overlay" attr_row="${e._row}" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                    <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                        <div role="document" class="modal-dialog modal-lg" style="margin:20px auto;">\n                            <div class="modal-content">\n                                <div class="modal-header pb-2">\n                                    <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                    <div class="float-left">\n                                        <h4 class="modal-title" id="myModalLabel2">${this._id.bold()} | Escalation ${e.Escalation}</h4>\n                                        <div>\n                                            <div><b style="width:60px;display: inline-block;">Vehicle</b>: ${this.vehicle}</div>\n                                            <div><b style="width:60px;display: inline-block;">Trailer</b>: ${this.trailer}</div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="modal-body row pl-3 pr-3 pt-2">\n                                    <table style="margin: 0px 30px;">\n                                        <tbody>\n                                            ${this.tbl().getTr("Delay Type",e["Delay Type"],"color:#ca294b;")}\n                                            ${this.tbl().getTr("Site",e.Destination,"color:#ca294b;")}\n                                            ${this.tbl().getTr(`Running ${t} Duration`,"...","color:#ca294b;","_duration")}\n                                            ${this.tbl().empty}\n                                        </tbody>\n                                    </table>\n                                    <div class="border-bottom mt-2"></div>\n                                    <table style="margin: 0px 30px;">\n                                        <tbody>\n                                            ${this.tbl().empty} ${this.tbl().empty}\n            \n                                            ${this.tbl().getTr("Region",this.region)}\n                                            ${this.tbl().getTr("Target Transit Time",this.target_transit_time)}\n                                            ${this.tbl().getTr("Cluster",this.cluster)}\n                                            ${this.tbl().getTr("Target CICO Time",this.target_cico_time)}\n                                            ${this.tbl().getTr("Route",this.route)} ${this.tbl().empty} \n                                            \n                                            ${this.tbl().empty} ${this.tbl().empty}\n            \n                                            ${this.tbl().getTr("Origin",this.origin)}\n                                            ${this.tbl().getTr("Destination",this.destination)}\n            \n                                            ${this.tbl().empty} ${this.tbl().empty}\n\n                                            ${"wilcon"==CLIENT.id?`\n                                                ${this.tbl().getTr("Driver",this.driver)}\n                                                ${this.tbl().getTr("Checker",this.checker)}\n                                                ${this.tbl().getTr("Helper",this.helper)} ${this.tbl().empty}\n\n                                                ${this.tbl().empty} ${this.tbl().empty}\n                                            `:""}\n            \n                                            ${this.tbl().getTr("Check In Date & Time",this.entered_datetime)}\n                                            ${this.tbl().getTr("Status","")}\n                                            ${this.tbl().getTr("Queueing Duration",this.queueingDuration)}\n                                            <tr style="${this.tbl().tr}">\n                                                <td colspan=2><div class="font-18" style="display: contents;">${this.status}</div></td>\n                                            </tr>\n            \n                                        ${e["Delay Type"].indexOf("Queueing")>-1?`\n                                            ${this.tbl().empty} ${this.tbl().empty}\n                                            ${this.tbl().empty} ${this.tbl().getTr("Posted By",this.posted_by)}\n                                            ${this.tbl().empty} ${this.tbl().getTr("Posted On",this.posting_date)}\n                                        `:`\n                                            ${this.tbl().getTr("Processing Duration",this.processingDuration)} ${this.tbl().empty}\n                                            ${this.tbl().getTr("Idling Duration",this.idlingDuration)} ${this.tbl().getTr("Posted By",this.posted_by)}\n                                            ${this.tbl().getTr("Check Out Date & Time",this.transit_datetime)} ${this.tbl().getTr("Posted On",this.posting_date)}\n                                            ${this.tbl().getTr("CICO Time",this.cico)}\n                                        `}\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>`}fullView(){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;z-index:999999 !important;">\n                    <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                        <div role="document" class="modal-dialog modal-lg" style="margin:20px auto;width:90%;">\n                            <div class="modal-content">\n                                <div class="modal-header pb-2">\n                                    <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                    <div class="float-left">\n                                        <h4 class="modal-title" id="myModalLabel2">\n                                            <b>${this._id}${this.ticket_number?` | ${this.ticket_number}`:""}</b> \n                                            <div style="display: inline-block;top: -4px;position: relative;margin-left: 2px;font-size: 12px;">${this.status}</div>\n                                        </h4>\n                                        <div>Full Entry Details</div>\n                                    </div>\n                                </div>\n                                <div class="modal-body row p-0" max-height: 480px;overflow-y: auto;>\n                                    <div class="main-details col-sm-9" style="border-right: 1px solid #eee;padding: 15px 0px 10px 30px !important;">\n                                        <table>\n                                            <tbody>\n                                                ${this.tbl().getTr("Region",this.region)}\n                                                ${this.tbl().getTr("Origin",this.origin)}\n                                                ${this.tbl().getTr("Cluster",this.cluster)}\n                                                ${this.tbl().getTr("Destination",this.destination)}\n                                                ${this.tbl().getTr("Route",this.route)} ${this.tbl().empty} \n\n                                                ${this.tbl().empty} ${this.tbl().empty}\n\n                                                ${this.tbl().getTr("Vehicle",this.vehicle)}\n                                                ${this.tbl().getTr("Trailer",this.trailer)}\n                                                ${this.tbl().getTr("Pal Cap",this.pal_cap)}\n                                                ${this.tbl().getTr("Conduction #",this.conduction_number)}\n\n                                                ${this.tbl().empty} ${this.tbl().empty}\n\n                                                ${"wilcon"==CLIENT.id?`\n                                                    ${this.tbl().getTr("Driver",this.driver)}\n                                                    ${this.tbl().getTr("Checker",this.checker)}\n                                                    ${this.tbl().getTr("Helper",this.helper)} ${this.tbl().empty}\n\n                                                    ${this.tbl().empty} ${this.tbl().empty}\n                                                `:""}\n\n                                                ${this.tbl().getTr("Check In Date & Time",this.entered_datetime)} ${this.tbl().empty}\n                                                ${this.tbl().getTr("Queueing Duration",this.queueingDuration)} ${this.tbl().empty}\n                                                ${this.tbl().getTr("Processing Duration",this.processingDuration)} ${this.tbl().empty}\n                                                ${this.tbl().getTr("Idling Duration",this.idlingDuration)} ${this.tbl().empty}\n                                                ${this.tbl().getTr("Check Out Date & Time",this.transit_datetime)} ${this.tbl().empty}\n\n                                                ${this.tbl().empty} ${this.tbl().empty}\n\n                                                ${this.tbl().getTr("CICO Time",this.cico)}\n                                                ${this.tbl().getTr("Target CICO Time",this.target_cico_time)}\n                                                ${this.tbl().getTr("Transit Time",this.transitDuration)}\n                                                ${this.tbl().getTr("Target Transit Time",this.target_transit_time)}\n\n                                                ${this.tbl().empty} ${this.tbl().empty}\n                                                \n                                                ${clientCustom.roundtrip?`\n                                                    ${this.tbl().getTr("On-Site Date & Time",this.onSite_datetime)} ${this.tbl().empty}\n                                                    ${this.tbl().getTr("Returned Date & Time",this.returning_datetime)} ${this.tbl().empty}\n                                                    ${this.tbl().getTr("Completion Date & Time",this.complete_datetime)} ${this.tbl().empty}\n                                                `:` \n                                                    ${this.tbl().getTr("Completion Date & Time",this.complete_datetime)}\n                                                `}\n                                            </tbody>\n                                        </table>\n                                        <div class="border-bottom mb-2 mt-2"></div>\n                                        <div class="col-sm-12 p-0 mb-3">\n                                            <b>Attachments</b>\n                                            <div class="col-sm-12">\n                                                <div class="col-sm-12 pl-3">${this.attachmentsHTML||"-"}</div>\n                                            </div>\n                                        </div>\n                                        <table>\n                                            <tbody>\n                                                ${this.tbl().getTr("Late Entry",this.late_entry)}\n                                                ${this.tbl().getTr("Comments",this.comments)}\n\n                                                ${this.tbl().empty} ${this.tbl().empty}\n\n                                                ${"wilcon"==CLIENT.id?`\n                                                    ${this.tbl().getTr("Scheduled Date",this.scheduled_date)}\n                                                    ${this.tbl().getTr("Shift Schedule",this.shift_schedule)}\n                                                `:""}\n                                                \n                                                ${this.tbl().getTr("Posted By",this.posted_by)}\n                                                ${this.tbl().getTr("Posting Date",this.posting_date)}\n                                            </tbody>\n                                        </table>\n                                        <div class="border-bottom mb-2 mt-2"></div>\n                                        <table>\n                                            <tbody>\n                                                ${this.tbl().getTr("Escalation 1 Remarks",this.esc1_remarks,"","","padding-bottom: 2px;")}\n                                                ${this.tbl().getTr("Escalation 2 Remarks",this.esc2_remarks,"","","padding-bottom: 2px;")}\n                                                ${this.tbl().getTr("Escalation 3 Remarks",this.esc3_remarks,"","","padding-bottom: 2px;")}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                    <div class="history-details col-sm-3" style="overflow-y: auto;padding-right:30px;">\n                                        <h5 class="mb-1">Logs</h5>\n                                        ${DISPATCH.FUNCTION.history(this.history)}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>`}}class loadInBackground{constructor(e,t){this.urlPath=e,this.type=t,this.failed=0}load(){var e=this;if(LIST[e.urlPath]&&LIST[e.urlPath].length>0)GGS.STATUS[e.type]=!0,e.g_select_settings(),TABLE.FINISH_LOADING.START_CHECK();else{var t=0,a=function(i){null==i||i==LIMIT?$.ajax({url:`/api/${e.urlPath}/${CLIENT.id}/${USER.username}/all/${JSON.stringify({})}/${t}/${LIMIT}`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(n){console.log(`${e.urlPath.toUpperCase()}:`,n),n.error?5!=e.failed&&setTimeout(function(){e.failed++,e.load()},1e3):(i=n.length,LIST[e.urlPath]=LIST[e.urlPath]||[],n.forEach(t=>{var a=LIST[e.urlPath].findIndex(e=>e._id.toString()==t._id.toString());a>-1?LIST[e.urlPath][a]=t:(t._row=GENERATE.RANDOM(36),LIST[e.urlPath].push(t))}),t+=i,a(i))}).fail(function(t){console.log(`Error in GGS - ${e.urlPath}`,t),5!=e.failed&&setTimeout(function(){e.failed++,e.load()},1e3)}):(TABLE.WATCH({urlPath:e.urlPath}),GGS.STATUS[e.type]=!0,e.g_select_settings(),TABLE.FINISH_LOADING.START_CHECK())};a()}}g_select_settings(){const e=this;var t,a;G_SELECT[e.urlPath]=[],(LIST[e.urlPath]||[]).forEach(t=>{G_SELECT[e.urlPath].push((t=t,a={},"regions"==e.urlPath&&(a={id:t._id,value:t.region}),"clusters"==e.urlPath&&(a={id:t._id,value:t.cluster,region_id:t.region_id}),"geofences"==e.urlPath&&(a={id:t._id,value:t.short_name,code:t.code}),a))}),G_SELECT[e.urlPath]=SORT.ARRAY_OBJECT(G_SELECT[e.urlPath],"value",{sortType:"asc"})}}class Table{constructor(e){this.id=e.id,this.urlPath=e.urlPath,this.perColumnSearch=e.perColumnSearch,this.url=e.url||`${e.urlPath}/${CLIENT.id}/${USER.username}/all`,this.goto=e.goto,this.initializeCallback=e.initializeCallback,this.dataTableOptions={language:{search:"",searchPlaceholder:"Search",sLengthMenu:"_MENU_"},responsive:!0},this.dataTableOptions=$.extend(this.dataTableOptions,e.dataTableOptions),this._skip=0}get skip(){return this._skip}set skip(e){this._skip=e}get filter(){return this._filter||{}}set filter(e){this._filter=e}get progressBar(){return this._progressBar}set progressBar(e){this._progressBar=e}setButtons(e){var t=this.goto,a=PAGE_FUNCTIONALITIES[t].buttons.table||[],i=e.dt_buttons||[],n=e.loadView||[],s=!autorizationLevel.dispatcher()||!!USER.dc,l=e.actions||{},o={create:{tooltipTitle:"Create New Record",text:"Create",class:"create-btn",icon:"la-plus"},import:{tooltipTitle:"Import Batch File",text:"Import",class:"import-btn",icon:"la-file-upload"},refresh:{tooltipTitle:"Refresh Table",icon:"la-refresh"},filter:{tooltipTitle:"Filter",icon:"la-filter"},export:{tooltipTitle:"Export Options",icon:"la-file-export"},report:{tooltipTitle:"Generate Report",icon:"la-download"},column:{tooltipTitle:"Customize Display Options",icon:"la-columns"},search:{tooltipTitle:"Search Table",icon:"la-search"},clone:{tooltipTitle:"Clone Data from Production",icon:"la-copy"},data_maintenance:{tooltipTitle:"Data Maintenance",text:"Data Maintenance",class:"data_maintenance-btn",icon:"la-tasks"}};function r(e){var t=o[e],a=null==s||1==s?"":"dispatcherCondition",r=n.includes(e)?"la-spin la-spinner":t.icon,d=0==i.length?"ml-1":"";d+=n.includes(e)?" disabled":"",i.push({text:`<i class="la ${r}" data-toggle="tooltip" title="${t.tooltipTitle}"></i> ${t.text||""}`,className:`${t.class||""} ${d} ${a}`,action:function(t,a,i,n){"function"==typeof l[e]&&l[e]()}})}a.forEach(e=>{["create","import"].includes(e)?"none"!=PERMISSION[t].create&&r(e):r(e)}),this.dataTableOptions.buttons=i}initialize(){const e=this;LIST[this.urlPath]=LIST[this.urlPath]||[],$.fn.DataTable.isDataTable(this.id)?$(e.id).DataTable().clear().destroy():PAGE.DISPLAY(),$(".dt-button .la-refresh").addClass("la-spin disabled"),$(".dt-button .la-refresh").parents(".dt-button").addClass("disabled"),$(".cb-container .la-refresh").addClass("la-spin disabled"),this.dt=$(this.id).DataTable(this.dataTableOptions),ISMOBILE&&($(".dt-buttons").addClass("d-inline-block"),$(".dataTables_wrapper").css("text-align","center"),$(".table.dataTable").css("text-align","unset")),$(e.id).on("page.dt length.dt draw.dt order.dt",function(){PAGE.TOOLTIP(),TABLE.FINISH_LOADING.START_CHECK(),$(`${e.id} thead tr th`).each((t,a)=>{$(a).is(":visible")||$(`${e.id} tr:not(.child)`).each((e,a)=>{$(a).find("td").eq(t).hide()})})}),$('.dt-button [data-toggle="tooltip"]').each((e,t)=>{var a=$(t).attr("data-original-title")||$(t).attr("title");$(t).parents(".dt-button").attr({"data-toggle":"tooltip","data-original-title":a}),$(t).removeAttr("data-toggle data-original-title")}),PAGE.TOOLTIP(),e.perColumnSearch&&($(e.id).find("thead").append('<tr class="row-filter"><th></th><th></th><th></th><th></th><th></th></tr>'),$(e.id).find("thead .row-filter th:not(:last-child)").each(function(){$(this).html('<input type="text" class="form-control input-sm" placeholder="Search...">')}),$(e.id).find(".row-filter input").on("keyup change",function(){e.dt.column($(this).parent().index()+":visible").search(this.value).draw()})),$(".row-filter").hide(),TABLE.WATCH({urlPath:e.urlPath,rowData:e.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),"function"==typeof this.filterListener&&this.filterListener(),"function"==typeof this.initializeCallback&&this.initializeCallback()}hideProgressBar(){$("#progress-striped-active .progress-bar").css("width","0%").html("0%"),$("div.tbl-progress-bar").hide()}retrieveData(e){var t=this;if(null==e&&t.progressBar&&t.progressBar.reset(),null==e||e==LIMIT){var a=t.filter?`/${JSON.stringify(t.filter)}`:"";$.ajax({url:`/api/${t.url}${a}/${t.skip}/${LIMIT}`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(a){a.error||(e=a.length,t.display(),a.error?toastr.error(a.error.message):(t.skip+=e,[t.goto].includes(PAGE.GET())&&("function"==typeof t.populateRows&&t.populateRows(a),$(t.id).length>0&&t.retrieveData(e))),TABLE.FINISH_LOADING.START_CHECK())})}else t.hideProgressBar(),t.display()}display(){"function"==typeof FILTER.CALLBACK&&FILTER.CALLBACK(!0),$("#filter-btn").html("Apply").removeClass("disabled"),$(".dt-button .la-refresh").removeClass("la-spin"),$(".dt-button .la-refresh").parents(".dt-button").removeClass("disabled"),"reset"==FILTER.STATUS?$(".cb-container .la-refresh").removeClass("la-spin"):$(".cb-container .la-refresh").removeClass("la-spin disabled"),$("#filter-container input,#filter-container select").attr("disabled",!1),$("#filter-container button,#filter-container a").removeClass("disabled")}watch(){}populateRows(e){const t=this;if($(t.id).length>0&&e.length>0){var a=[];$.each(e,function(e,i){var n=LIST[t.urlPath].findIndex(e=>e._id.toString()==i._id.toString());!i._row&&(i._row=GENERATE.RANDOM(36)),n>-1?LIST[t.urlPath][n]=i:LIST[t.urlPath].push(i),a.push(t.addRow(i))}),t.dt.rows.add(a).draw(!1),TABLE.FINISH_LOADING.START_CHECK(),$("div.tbl-progress-bar").show(),t.progressBar&&t.progressBar.calculate()}}updateRows(e){const t=this;$(t.id).length>0&&e.length>0&&$.each(e,function(e,a){var i=t.dt.row(`[_row="${a._row}"]`).node();i&&t.dt.row(i).data(t.addRow(a))})}countRows(){const e=this;$.ajax({url:`/api/${e.urlPath}/${CLIENT.id}/${USER.username}/all/${JSON.stringify(e.filter)}/count`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(t){console.log("count",t),e.progressBar=new ProgressBar(t),e.skip=0,LIST[e.urlPath]=[],e.dt&&(e.dt.clear().draw(),$(".dataTables_empty").text("Loading...")),e.retrieveData()})}preLoadData(){}}var PROFILE={FUNCTION:{init:function(){var e=null,t=[],a=[],i=[],n=!1;PAGE.DISPLAY(),ISMOBILE&&($("#dl-btn,#dl-odb-btn,#edit-btn").parent().addClass("m-2"),$("#dl-btn,#dl-odb-btn,#edit-btn").css("width","100%"),$("#dl-btn,#dl-odb-btn").css("margin-top","20px"),$("#edit-btn,#dl-odb-btn").removeClass("mt-2").addClass("mt-0"),$(".panel.panel-profile").addClass("mb-0"),$(".page-box").addClass("p-0"),$(".main-content").addClass("p-0")),$.ajax({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}/incharge`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(t){(e=t[0])&&(USER.fullName=e.name,USER.email=e.email,USER.phoneNumber=e.phoneNumber,TABLE.FINISH_LOADING.START_CHECK())});var s=0;$("#dl-btn").click(function(){$("#dl-btn,#dl-odb-btn,#edit-btn").attr("disabled",!0),$("#dl-btn i").removeClass("la-user").addClass("la-spin la-spinner"),$.ajax({url:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/applications/${CLIENT.appId}/users/${USER.username}?Identifier=Username`,method:"GET",headers:{Authorization:USER.apiKey},timeout:9e4,async:!0}).done(function(e){s=0;var t={};name=`${e.name} ${e.surname}`._trim(),name&&(t.name=name),e.email&&(t.email=e.email),e.phoneNumber&&(t.phoneNumber=e.phoneNumber),Object.keys(t).length>0?GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(t)},function(e){$("#dl-btn,#dl-odb-btn,#edit-btn").attr("disabled",!1),$("#dl-btn i").addClass("la-user").removeClass("la-spin la-spinner"),toastr.success("Profile updated successfully.")}):toastr.warning("You profile in WRU Main is empty. No changes has been made.")}).fail(function(e){0==e.status&&s<MAX_TRIES&&(s++,$("#dl-btn").click()),TOASTR.ERROR(e)})}),$("#dl-odb-btn").click(function(){$("#dl-btn,#dl-odb-btn,#edit-btn").attr("disabled",!0),$.ajax({url:`/api/users/${CLIENT.id}/${USER.username}/download/${CLIENT.allowDownloadFromOtherDB.toLowerCase()}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},async:!0,data:JSON.stringify({}),timeout:9e4}).done(function(e){$("#dl-btn,#dl-odb-btn,#edit-btn").attr("disabled",!1),$("#dl-odb-btn i").addClass("la-user").removeClass("la-spin la-spinner"),toastr.success("Profile updated successfully.")})}),$("#edit-btn").click(function(){var e=`This will only update you profile in WRU Dispatch and not in <u data-toggle="tooltip" title="${CLIENT.ggsURL}">WRU Main</u>.`;$("body").append(modalViews.user.create("Edit Profile",null,USER,e)),PAGE.TOOLTIP(),$("#modal #role,#modal #priv-title").parent().remove(),$("#modal .modal-dialog.modal-md").removeClass("modal-md").addClass("modal-sm").css({width:""}),$("#modal .modal-body > div").removeClass("col-sm-5").addClass("col-sm-12"),GET.INTLTELINPUT("#modal #phoneNumber"),$("#modal #submit").click(function(){var e={};name=$("#modal #name").val()._trim(),email=$("#modal #email").val()._trim(),__phoneNumber=$("#modal #phoneNumber").val()._trim(),phoneNumber=GET.INTLTELINPUT_VALUE("#modal #phoneNumber"),name&&(e.name=name),email&&(e.email=email),__phoneNumber&&(e.phoneNumber=phoneNumber),ALERT.REQUIREDFIELDS("#modal-error",$(this).parents("#overlay"))||($("#modal #submit").attr("disabled",!0).html('<i class="la la-spin la-spinner"></i> Submit'),$("#dl-btn,#dl-odb-btn,#edit-btn").attr("disabled",!0),$.ajax({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},async:!0,data:JSON.stringify(e),timeout:9e4}).done(function(e){toastr.success("Profile updated successfully."),$("#overlay").remove(),$("#dl-btn,#dl-odb-btn,#edit-btn").attr("disabled",!1)}))})}),TABLE.FINISH_LOADING.CHECK=function(){if(isFinishedLoading(["REGIONS","CLUSTERS","GEOFENCES"],!0,function(){var e=LIST.geofences&&getGeofence(USER.dc)||{};$("[granted_dc]").html(e.short_name||"N/A")}),e&&!n){function s(e){function t(t,a){return(e[`${t}_${a}`]||[]).includes(USER.username)}var a=[],i=[],n=[];t("esc1","lq")&&a.push("E-1"),t("esc1","oc")&&i.push("E-1"),t("esc1","ot")&&n.push("E-1"),t("esc2","lq")&&a.push("E-2"),t("esc2","oc")&&i.push("E-2"),t("esc2","ot")&&n.push("E-2"),t("esc3","lq")&&a.push("E-3"),t("esc3","oc")&&i.push("E-3"),t("esc3","ot")&&n.push("E-3");var s=[];return a.length>0&&s.push(`Long Queueing - ${a.join(",")}`),i.length>0&&s.push(`Over CICO - ${i.join(",")}`),n.length>0&&s.push(`Over Transit - ${n.join(",")}`),s}console.log(e),n=!0,e.myRegions.forEach((e,a)=>{t.push(`${e.region||"-"}<div class="font-italic font-11 text-muted mb-1">${s(e).join(" | ")}</div>`)}),e.myClusters.forEach((e,t)=>{a.push(`${e.cluster||"-"}<div class="font-italic font-11 text-muted mb-1">${s(e).join(" | ")}</div>`)}),e.myGeofences.forEach((e,t)=>{i.push(`${e.short_name||"-"}<div class="font-italic font-11 text-muted mb-1">${s(e).join(" | ")}</div>`)}),$("[regions]").html(t.join("")||"-"),$("[clusters]").html(a.join("")||"-"),$("[geofences]").html(i.join("")||"-")}},TABLE.FINISH_LOADING.START_CHECK()}}},SETTINGS={FUNCTION:{stream:null,init:function(){var e=new Table({id:"#tbl-sessions",urlPath:"sessions",goto:"settings",dataTableOptions:{columns:CUSTOM.COLUMN.settings,paging:!1,order:[[1,"desc"]],createdRow:function(t,a,i){var n=SESSION_TOKEN==a._id?"background-color: #ebf8f0":"",s=a._row;$(t).attr("_row",a._row),$(t).attr("style",n),e.rowListeners(s,a._id)}}});e.addRow=function(e){var t=e._id==SESSION_TOKEN,a=e.device_info||{metadata:{}},i=t?"<small><small>CURRENT SESSION</small></small>":'<td><button class="btn btn-danger pl-2 pr-2 pt-1 pb-1" logout><small>Logout</small></button></td>',n="mobile"==a.device?"la la-mobile":"la la-desktop";return{_id:e._id,_row:e._row,"Device Info":`<div>\n                                        <i style="font-size: 30px;" class="${n} mr-2"></i>\n                                        <div class="d-inline-block">\n                                            <div>${a.browser}</div>\n                                            <small class="text-muted">${a.metadata.ip}</small>\n                                        </div>\n                                    </div>`,"Last Accessed":DATETIME.FORMAT(e.timestamp,"MM/DD/YYYY hh:mm A"),Expiry:DATETIME.FORMAT(e.expiry,"MM/DD/YYYY hh:mm A"),Location:`${a.metadata.city}, ${a.metadata.region}, ${a.metadata.country}`,Action:i}},e.rowListeners=function(e,t){const a=this;$(a.id).on("click",`[_row="${e}"] [logout],[_row="${e}"] + tr.child [logout]`,function(i){i.stopImmediatePropagation();var n=LIST[a.urlPath].find(e=>e._id.toString()==t.toString());n&&MODAL.CONFIRMATION({confirmCloseCondition:!0,confirmCallback:function(){$.ajax({url:`/api/sessions/${CLIENT.id}/${USER.username}/${n._id}`,method:"DELETE",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(t){1==t.ok&&($("#confirm-modal").remove(),$(a.id).DataTable().row(`[_row="${e}"]`).remove().draw(!1))})}})})},e.filterListener=function(e,t){var a=USER.settings.push_notification||"toast";$(`[name="push_notification"][value="${a}"]`).prop("checked",!0),$('[name="push_notification"]').change(function(){var e=$(this).val(),t=$(this);if(console.log("push_notification",e),"desktop"==e)try{Notification.requestPermission().then(function(e){console.log(e),"granted"==e?i():(alert("Push notification request was denied. Please enable them in your browser if you've changed your mind."),$(`[name="push_notification"][value="${a}"]`).prop("checked",!0))})}catch(e){}else i();function i(){$(t).parent().parent().append('<i class="ml-2 la la-spin la-spinner"></i>'),$('[name="push_notification"]').parents(".fancy-radio").css({"pointer-events":"none",color:"#c4c4c4"}),GET.AJAX({url:`api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({"settings.push_notification":e})},function(e){toastr.success("Push notification settings updated successfully.",null,{timeOut:1500}),console.log("Update Settings push_notification: ",e),$('[name="push_notification"]').parents(".fancy-radio").find(".la-spinner").remove(),$('[name="push_notification"]').parents(".fancy-radio").css({"pointer-events":"unset",color:"unset"})},function(e){console.log("error",e)})}}),$("#toast-test").click(function(){document.getElementById("audio01").play();toastr.error('<span style="background-color:red; display:inline-block;border-radius:20px; width:7px;height:7px;margin-right:4px;"></span><b>00000000</b> | Escalation 1<br>Running CICO Duration: 04:35',"",{positionClass:"toast-bottom-right toastr-white-bg",showDuration:"300",closeButton:!0,hideDuration:"1000",timeOut:"20000"})}),$("#desktop-test").click(function(){try{Notification.requestPermission().then(function(e){(console.log(e),"granted"==e)?(document.getElementById("audio01").play(),new Notification("00000000 | Escalation 1",{body:"Running CICO Duration: 04:35"})):alert("Push notification request was denied. Please enable them in your browser if you've changed your mind.")})}catch(e){}})},e.initialize(),e.countRows()}}},DASHBOARD={FUNCTION:{init:function(){USER.filters.dashboard=USER.filters.dashboard||{};try{USER.filters.dashboard=JSON.parse(USER.filters.dashboard)}catch(e){}PAGE.DISPLAY(),Object.keys(USER.filters.dashboard).length>0&&$("#reset-btn").show(),$("#reset-btn").click(function(){f({})}),ISMOBILE&&($(".panel.panel-profile").addClass("mb-0"),$(".main-content").addClass("p-0"),$("#dashboard-page").css({padding:"15px","padding-bottom":"0px","margin-top":"50px"}),$(".summary-parent").parent().addClass("p-1"),$(".summary-parent").parent().next().addClass("p-1"),$(".summary-parent").removeClass("mr-1").addClass("mr-0"),$("#_date").parents(".col-sm-12").addClass("pl-1 pr-1"),$("#_date").parents(".col-sm-12").find("span.float-right").css({width:"49.5%","max-width":"unset"}),$("#_regions").addClass("nav-tabs-mobile"),$("#_regions").parent().removeClass().addClass("col-sm-12 p-0"),$(".switch-toggle").parent().css("width","49.5%"),$(".switch-toggle").css("height","34px"),$(".switch-toggle > label").css("line-height","34px"),$("#_site").parent().removeAttr("style").css({position:"fixed",top:"69px",width:"100%",background:"white","box-shadow":"0 4px 8px -4px #c6c6c6",height:"28px"}),$("#_site").css("width","100%")),console.log("CUSTOM.COLUMN.dispatch()",CUSTOM.COLUMN.dispatch());var e="dashboard",t="dispatch",a=!1,i={},n=!0,s=USER.filters.dashboard.region||"ALL",l=USER.filters.dashboard.baseplant||"",o=USER.filters.dashboard.selectedDate||new Date,r=USER.filters.dashboard.currentView||"destination",d=null,c={},u=function(){d={in_transit:0,total_shipment:0,incomplete:0,scheduled:0,assigned:0,queueingAtOrigin:0,processingAtOrigin:0,onSite:0,returning:0,complete:0}},p=$("#tbl-dashboard").DataTable({columns:TABLE.COL_ROW(CUSTOM.COLUMN.dashboard()).column,order:[[1,"asc"]],dom:"t",pageLength:1e3,scrollX:!0,scrollY:"calc(100vh - 340px)",paging:!1,createdRow:function(e,t,a){var i=t._row;function n(t,a){var i=c[t]||-1;i>=0&&$($(e).find("td").eq(i)).click(function(){E({status:a,el:this})})}$(e).attr("_row",i),n("In Transit",["in_transit"]),n("Total Shipment",null),n("Incomplete",["incomplete"]),n("Scheduled",["scheduled"]),n("Assigned",["assigned"]),n("Queueing",["queueingAtOrigin"]),n("Processing",["processingAtOrigin"]),n("On-Site",["onSite"]),n("Returning",["returning"]),n("Complete",["complete"])}}),m=GENERATE.RANDOM(36),h=function(t){u(),a=!1,$("#icon-date").removeClass("la-calendar").addClass("la-spin la-spinner"),$("#_regions").css("pointer-events","none"),$('[name="view-d"]').attr("disabled",!0),$(".switch-toggle").css("opacity","0.7"),LIST[e]={},LIST.dispatch=[],m!=t&&(m=t),$("#dashboard-page .summary-container b").html('<i class="la la-spin la-spinner" style="opacity: 0.3;"></i>'),$("#_date").attr("disabled",!0),p&&(p.clear().draw(),$(".dataTables_empty").text("Loading..."));var n=0,s=0,l=function(e){if(null==e||e==LIMIT){var r=FILTER.DATERANGE(DATETIME.FORMAT(new Date(o),"MM/DD/YYYY")),c={posting_date:r};"postingDate-scheduledDate"==clientCustom.filterType.dashboard&&(c=moment(o).format("MM/DD/YYYY")==DEFAULT_DATE?{$or:[{$and:[{posting_date:r},{$or:[{scheduled_date:{$exists:!1}},{scheduled_date:r}]},{status:{$nin:["plan"]}}]},{$and:[{scheduled_date:r},{status:{$nin:["plan"]}}]},{$and:[{scheduled_date:{$gte:r.$lt,$lt:r.$gte}},{posting_date:{$gte:r.$lt,$lt:r.$gte}},{status:{$nin:["plan","complete","incomplete"]}}]}]}:{$or:[{$and:[{posting_date:r},{$or:[{scheduled_date:{$exists:!1}},{scheduled_date:r}]},{status:{$nin:["plan"]}}]},{$and:[{scheduled_date:r},{status:{$nin:["plan"]}}]}]}),GET.AJAX({url:`api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(c)}/${n}/${LIMIT}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(a){console.log("Dashboard",a),m==t&&(a.error?s<5&&(s++,l(e)):(e=a.length,"function"==typeof DASHBOARD.FUNCTION.addDataToTable&&(a=DASHBOARD.FUNCTION.addDataToTable(a)),LIST.dispatch=LIST.dispatch.concat(a),$("#_regions").css("pointer-events","unset"),n+=e,l(e),i.GEOFENCES=!1,TABLE.FINISH_LOADING.START_CHECK()))},function(t){console.log("error",t),s<5&&(s++,l(e))})}else $("#dashboard-page [in_transit]").html(d.in_transit),$("#dashboard-page [total_shipment]").html(d.total_shipment),$("#dashboard-page [incomplete]").html(d.incomplete),$("#dashboard-page [scheduled]").html(d.scheduled),$("#dashboard-page [assigned]").html(d.assigned),$("#dashboard-page [queueingAtOrigin]").html(d.queueingAtOrigin),$("#dashboard-page [processingAtOrigin]").html(d.processingAtOrigin),$("#dashboard-page [onSite]").html(d.onSite),$("#dashboard-page [returning]").html(d.returning),$("#dashboard-page [complete]").html(d.complete),$("#_date").attr("disabled",!1),$("#icon-date").removeClass("la-spin la-spinner").addClass("la-calendar"),$('[name="view-d"]').attr("disabled",!1),$(".switch-toggle").css("opacity","1"),(a=!0)&&i.REGIONS&&i.GEOFENCES&&v()};l()},b=function(){u(),Object.keys(LIST[e]).forEach(t=>{var a=JSON.stringify(LIST[e][t]);LIST[e][t].w_in_cico=0;var i=LIST[e][t].location_id,n=getGeofence(i);n?"ALL"!=s&&s.toString()!=n.region_id.toString()||(LIST[e][t].plant=n.short_name,LIST[e][t].region_id=n.region_id,g(t,a!=JSON.stringify(LIST[e][t]))):(console.log("NONE",i),LIST[e][t].plant="-",g(t,a!=JSON.stringify(LIST[e][t])))}),console.log("summary",d)},f=function(e){if(!n){var t={};new Date(o).toDateString()!=(new Date).toDateString()&&(t.selectedDate=o),"ALL"!=s&&(t.region=s),""!=l&&(t.baseplant=l),"destination"!=r&&(t.currentView=r),USER.filters.dashboard=e||t,GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({"filter.dashboard":JSON.stringify(USER.filters.dashboard)})},function(t){e&&PAGE.GO_TO(),console.log("docs",t)})}},v=function(){Object.keys(USER.filters.dashboard).length>0&&$("#reset-btn").attr("style","text-decoration: underline;"),$(`#_regions #${s}`).trigger("click"),$("#_site").val(l).trigger("change"),n=!1},E=function(i){var n,s=ISMOBILE?"#mini-monitor-container":"#tbl-mini-monitor",l=null;if(!0===a){var o=[],d=Object.keys(LIST[e]).filter(t=>LIST[e][t]._row==$(i.el).parent().attr("_row")).map(t=>LIST[e][t])[0]||{};console.log("_obj_",d);var c=d.location_id,u=getGeofence(c)||{cico:0},p=i.w_in_cico?'<h5 class="mt-1 mb-0 text-muted font-lighter">In CICO Time</h5>':"",m=i.title?i.title:i.status?(n=[],i.status.forEach(e=>{n.push(GET.STATUS(e).text.capitalize())}),n.join(", ")):"All Status";$("body").append(MODAL.MINI_MONITOR({title:`<h3 class="mb-0 mt-0 font-lighter">${d.plant}</h3><h5 class="mt-1 mb-0 text-muted font-lighter">${m.capitalize()}</h5>${p}`})),ISMOBILE||(l=$(s).DataTable({columns:CUSTOM.COLUMN.dispatch(),dom:"lBfrtip",language:{search:"",searchPlaceholder:"Search",sLengthMenu:"_MENU_"},buttons:TABLE.BUTTONS({goto:PAGE.GET(),actions:{column:function(){$("#cv-container").toggle("slide",{direction:"right"},100)}}}),order:[[19,"desc"]],createdRow:function(e,a,i){var n=a._row,l=a._id;$(e).attr("_row",n),TABLE.ROW_LISTENER({table_id:s,_row:n,urlPath:t,_id:l,additionalListeners:function(){$(s).on("click",`[_row="${n}"] [view],[_row="${n}"] + tr.child [view]`,function(e){e.stopImmediatePropagation(),$("body").append(modalViews.dispatch.fullView(l)),$("html, body,#modal").animate({scrollTop:0},"fast")})}})}}),$("#overlay").append(SLIDER.COLUMN_VISIBILITY(CUSTOM.COLUMN.dispatch())),$("#cv-container").css({top:"0px",height:"100%"}),$("span.toggle-vis").on("click",function(e){var t=$(this).attr("data-column"),a=l.column(t);a.visible(!a.visible()),CUSTOM.COLUMN.dispatch()[t].visible=a.visible(),CUSTOM.COLUMN.dispatch()[t].bVisible=a.visible(),$(s).attr("style",""),$(`${s} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${s} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})}),$(s).on("page.dt length.dt draw.dt",function(){$(`${s} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${s} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})})),LIST.dispatch.forEach((e,t)=>{e.destination[0]=e.destination[0]||{};var a=!i.w_in_cico||e.actual_time_lapse<=u.cico,n="destination"==r?e.destination[0].location_id:e.origin_id;if((!i.status||i.status.includes(e.status))&&n==c&&a){var l=new Dispatch(e,null,!0);ISMOBILE?($(s).append(l.html()),$(`[_row="${e._row}"] > .container-header`).click(function(){var e=$(this).parent(),t=LIST.dispatch.findIndex(t=>t._row==$(e).attr("_row")),a=LIST.dispatch[t]||{},i=function(e){$(e).removeClass("active"),$(e).find(".container-body").slideUp(100,null,function(){$(e).find(".container-header-body").slideDown(50)}),$(e).find(".la-angle-up").hide(),$(e).find(".container-header-title .ongoing").css("opacity",1),$(e).find(".container-header-title > [status]").remove()};$(e).hasClass("active")?i(e):($(".container-parent").each((e,t)=>{i(t)}),$(e).addClass("active"),$(e).find(".container-body").slideDown(100,null,function(){$(e).find(".container-header-body").slideUp(50),$(e).find(".la-angle-up").slideDown(50)}),$(e).find(".container-header-title .ongoing").css("opacity",0),$(e).find(".container-header-title").append(`<span status> - ${a.status.capitalize()}</span>`))})):o.push(l.row())}}),ISMOBILE||l.rows.add(o).draw(!1)}else toastr.info("Please wait while data is loading.")};function g(t,a){if(l==LIST[e][t].plant||!l){var i=LIST[e][t].scheduled,n=LIST[e][t].queueingAtOrigin,s=LIST[e][t].processingAtOrigin,o=LIST[e][t].onSite,r=LIST[e][t].returning,c=LIST[e][t].complete,u={_row:LIST[e][t]._row,Region:LIST[e][t].region_id||"-",Plant:LIST[e][t].plant||'<small class="font-italic text-muted">loading...</small>',"In Transit":LIST[e][t].in_transit,"Total Shipment":LIST[e][t].total_shipment,Incomplete:LIST[e][t].incomplete,Scheduled:i,Assigned:LIST[e][t].assigned,Queueing:n,Processing:s,"On-Site":o,Returning:r,Complete:c},m=($(`[_row="${LIST[e][t]._row}"]`).length,p.row(`[_row="${LIST[e][t]._row}"]`).node());null!=a&&1!=a||(m?p.row(m).data(u).draw(!1):p.row.add(u).draw(!1)),d.in_transit+=LIST[e][t].in_transit,d.total_shipment+=LIST[e][t].total_shipment,d.incomplete+=LIST[e][t].incomplete,d.scheduled+=LIST[e][t].scheduled,d.assigned+=LIST[e][t].assigned,d.queueingAtOrigin+=LIST[e][t].queueingAtOrigin,d.processingAtOrigin+=LIST[e][t].processingAtOrigin,d.onSite+=LIST[e][t].onSite,d.returning+=LIST[e][t].returning,d.complete+=LIST[e][t].complete}$("#dashboard-page [in_transit]").html(d.in_transit),$("#dashboard-page [total_shipment]").html(d.total_shipment),$("#dashboard-page [incomplete]").html(d.incomplete),$("#dashboard-page [scheduled]").html(d.scheduled),$("#dashboard-page [assigned]").html(d.assigned),$("#dashboard-page [queueingAtOrigin]").html(d.queueingAtOrigin),$("#dashboard-page [processingAtOrigin]").html(d.processingAtOrigin),$("#dashboard-page [onSite]").html(d.onSite),$("#dashboard-page [returning]").html(d.returning),$("#dashboard-page [complete]").html(d.complete)}p.columns().every(function(){c[this.header().textContent._trim()]=this.index()-1}),$(`[name="view-d"][value="${r}"]`).prop("checked",!0),TABLE.WATCH({urlPath:t}),DASHBOARD.FUNCTION.addDataToTable=function(t,a,n){if(t)t.length>0&&(t.forEach((a,i)=>{if(new Date(a.posting_date).setHours(0,0,0,0)==new Date(o).setHours(0,0,0,0)||new Date(a.scheduled_date).setHours(0,0,0,0)==new Date(o).setHours(0,0,0,0)||["scheduled","assigned","queueingAtOrigin","processingAtOrigin","idlingAtOrigin","in_transit","onSite","returning"].includes(a.status)){var n=a.destination[0]||{},s="destination"==r?n.location_id:a.origin_id,l=LIST[e][s]?LIST[e][s].data[a._id]:null;s&&(!t[i]._row&&(t[i]._row=GENERATE.RANDOM(36)),LIST[e][s]?l?LIST[e][s][l.status]--:"plan"!=a.status&&LIST[e][s].total_shipment++:(LIST[e][s]={_row:GENERATE.RANDOM(36),location_id:s,destination_id:n.location_id,in_transit:0,total_shipment:0,incomplete:0,scheduled:0,assigned:0,queueingAtOrigin:0,processingAtOrigin:0,onSite:0,returning:0,complete:0,data:{}},"plan"!=a.status&&LIST[e][s].total_shipment++),LIST[e][s].data[a._id]={status:a.status},null!=LIST[e][s][a.status]&&LIST[e][s][a.status]++)}}),u(),Object.keys(LIST[e]).forEach(e=>{g(e)}));else{var s=n.destination[0]||{},l="destination"==r?s.location_id:n.origin_id,c=LIST[e][l]?LIST[e][l].data[n._id]:null;c&&(LIST[e][l][c.status]--,delete LIST[e][l].data[n._id]),LIST[e][l].total_shipment--,u(),0===LIST[e][l].total_shipment&&($("#dashboard-page [in_transit]").html(d.in_transit),$("#dashboard-page [total_shipment]").html(d.total_shipment),$("#dashboard-page [incomplete]").html(d.incomplete),$("#dashboard-page [scheduled]").html(d.scheduled),$("#dashboard-page [assigned]").html(d.assigned),$("#dashboard-page [queueingAtOrigin]").html(d.queueingAtOrigin),$("#dashboard-page [processingAtOrigin]").html(d.processingAtOrigin),$("#dashboard-page [onSite]").html(d.onSite),$("#dashboard-page [returning]").html(d.returning),$("#dashboard-page [complete]").html(d.complete),p.row(`[_row="${LIST[e][l]._row}"]`).remove().draw(!1),delete LIST[e][l]),Object.keys(LIST[e]).forEach(e=>{g(e)})}return!1===a&&(i.GEOFENCES=!1,TABLE.FINISH_LOADING.START_CHECK()),t},PAGE.TOOLTIP(),h(m),$("#_date").daterangepicker({opens:"left",singleDatePicker:!0,autoUpdateInput:!1,maxDate:new Date,startDate:DATETIME.FORMAT(new Date(o),"MM/DD/YYYY")},function(e,t,a){$($(this)[0].element).val(DATETIME.FORMAT(new Date(e),"MM/DD/YYYY")),o=new Date(e),f(),h(GENERATE.RANDOM(36))}).val(DATETIME.FORMAT(new Date(o),"MM/DD/YYYY")),$('[name="view-d"]').change(function(){r=$('[name="view-d"]:checked').val(),f(),h(GENERATE.RANDOM(36))});var T=!1;TABLE.FINISH_LOADING.CHECK=function(){if(GGS.STATUS.GEOFENCES&&!1===i.GEOFENCES&&(i.GEOFENCES=!0,b(),a&&i.REGIONS&&i.GEOFENCES&&!T&&(T=!0,v())),GGS.STATUS.REGIONS&&!i.REGIONS){i.REGIONS=!0;var t=SORT.ARRAY_OBJECT(LIST.regions,"sequence",{sortType:"asc"});$("#_regions").append('<li class="active"><a id="ALL" class="summary-tab" href="javascript:void(0)" role="tab" data-toggle="tab">ALL</a></li>'),t.forEach(e=>{$("#_regions").append(`<li><a id="${e._id}" class="summary-tab" href="javascript:void(0)" role="tab" data-toggle="tab">${e.region}</a></li>`)}),$(".summary-tab").css({"border-radius":"2px","margin-bottom":"3px"}),$('#_regions [role="tab"]').click(function(){var e="ALL"==(s=$(this).attr("id"))?"":s,t=$("#tbl-dashboard").DataTable();console.log(s,e,l),t.column(0).search(e).draw(),t.column(1).search(l,!0,!1).draw(),f(),b()}),$("#_site").show().select2({placeholder:"Choose Site (Base Plant)",allowClear:!0}).val("").change(function(){l=$(this).val()||"";var t="ALL"==s?"":s,a=$("#tbl-dashboard").DataTable();a.column(0).search(t).draw(),a.column(1).search(l,!0,!1).draw(),f(),u(),Object.keys(LIST[e]).forEach(e=>{g(e)})}),a&&i.REGIONS&&i.GEOFENCES&&v()}};var _=function(e){GET.AJAX({url:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/applications/${CLIENT.appId}/tags?FromIndex=0&PageSize=1000`,method:"GET",headers:{Authorization:USER.apiKey}},function(e){console.log("Tags:",e);var t='<option value="">Choose Site (Base Plant)</option>';e.forEach(e=>{if(e.name.indexOf("A_Base Plant:")>-1){var a=e.name.split(": ")[1];"STA ROSA PL"==a&&(a="STAROSA PL"),t+=`<option value="${a}">${a}</option>`}}),$("#_site").html(t)},function(t){console.log(t),0==t.status&&e<MAX_TRIES&&_(++e),TOASTR.ERROR(t)})};_(0)}}},DE_DASHBOARD={FUNCTION:{init:function(){PAGE.DISPLAY(),DE_DASHBOARD.FUNCTION.setBadge(),$("#_regions").parent().addClass("mb-1"),$("#_regions").css("border","none");var e="#tbl-ot,#tbl-lq,#tbl-oc",t="notifications",a={},i="ALL",n=[],s="",l=(new Date,function(e){return{columns:TABLE.COL_ROW(CUSTOM.COLUMN.de_dashboard).column,order:[[0,"asc"]],dom:"t",scrollY:"350px",paging:!1,createdRow:function(e,t,a){$(e).attr("_row",t._row),$($(e).find("td").eq(0)).hover(function(e){$(this).css({"text-decoration":"mouseenter"===e.type?"underline":"none",cursor:"mouseenter"===e.type?"pointer":"default"})}),$($(e).find("td").eq(0)).click(function(){o(t)})}}}),o=function(e={}){GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${e.SN}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(t){console.log("docs",t);var a=t[0];if(a){$("html, body,#modal").animate({scrollTop:0},"fast");var i=new Dispatch(a);$("body").append(i.de_html(e))}})};$("#tbl-lq,#tbl-oc").DataTable(l()),$("#tbl-ot").DataTable(l()),$(".dataTables_empty").text("Loading..."),DE_CHECKDUPS=setInterval(function(){LIST[t]&&LIST[t].forEach(e=>{var t=(new Date).getTime()-new Date(e.timestamp).getTime(),a=DATETIME.DH(t)+Number(e.timelapse),i=DATETIME.HH_MM(null,a);$($(`[_row="${e._row}"] > td`)[2]).html(i.hour_minute),$(`#overlay[attr_row="${e._row}"] [_duration]`).html(`: ${i.hour_minute}`);var n="";if("Long Queueing"==e.delay_type&&(n="#tbl-lq"),"Over CICO"==e.delay_type&&(n="#tbl-oc"),"Over Transit"==e.delay_type&&(n="#tbl-ot"),BASE_PLANTS){var s=$(n).DataTable(),l=$($(`[_row="${e._row}"] > td`)[4]).text(),o=BASE_PLANTS.find(t=>t.usersIds.includes(e.dispatch_vehicle_id));if(o){if(l!=o.plant){var r=s.row(`[_row="${e._row}"]`).node(),d=s.row(r).index();s.cell({row:d,column:7}).data(o.plant).draw(!1)}}else $($(`[_row="${e._row}"] > td`)[4]).text("-")}});["lq","oc","ot"].forEach(e=>{var t=[],a=[],i=[];$(`#tbl-${e}`).DataTable().column(2).data().sort().each(e=>{t.push(e)}),"lq"==e&&(i=["queueingAtOrigin"]),"oc"==e&&(i=["processingAtOrigin","idlingAtOrigin"]),"ot"==e&&(i=["in_transit"]);var n=[];t.forEach(e=>{var t=LIST.dispatch.find(t=>t._id==e);t&&!i.includes(t.status)&&(n.push(e),n.push(e))}),t=(t=t.filter((e,t,a)=>a.indexOf(e)!==t)).concat(n),$(`#tbl-${e}`).DataTable().rows(function(e,i,n){return t.includes(i.SN)&&(a.push(e),t=jQuery.grep(t,function(e){return e!=i.SN})),!1}),a.forEach(t=>{$(`#tbl-${e}`).DataTable().row(t).remove().draw(!1)})})},1e3),$(".dataTables_scrollBody").css("overflow-x","hidden"),$(".summary-container").css({"margin-right":"unset",border:"unset"}),TABLE.WATCH({urlPath:"dispatch"}),TABLE.FINISH_LOADING.CHECK=function(){if(GGS.STATUS.GEOFENCES&&!a.GEOFENCES&&GGS.STATUS.VEHICLES&&!a.VEHICLES){a.GEOFENCES=!0,a.VEHICLES=!0;var l="";LIST.geofences.forEach(e=>{l+=`<option value="${e.short_name}">${e.short_name}</option>`}),$("#_site").html(l),LIST[t]=[],done=!1,$("#filter-container").css("pointer-events","none"),$(".switch-toggle").css("opacity","0.7"),$("#dashboard-page .summary-container b").html('<i class="la la-spin la-spinner" style="opacity: 0.3;"></i>'),$(".dataTables_empty").text("Loading..."),GET.AJAX({url:`api/${t}/${CLIENT.id}/${USER.username}/all/de/${JSON.stringify({timestamp:FILTER.DATERANGE()})}/0/0`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(e){function a(a,i,n){var s=[],l=$(a).DataTable(),o=e.filter(e=>e.delay_type==i);$.each(o,function(e,a){var i=LIST[t].find(e=>e.dispatch_id==a.dispatch_id&&e.delay_type==a.delay_type),l=[];"lq"==n&&(l=["queueingAtOrigin"]),"oc"==n&&(l=["processingAtOrigin","idlingAtOrigin"]),"ot"==n&&(l=["in_transit"]),!i&&l.includes(a.dispatch_status)&&s.push(DE_DASHBOARD.FUNCTION.createRow(a))}),l.rows.add(s).draw(!1),DE_DASHBOARD.FUNCTION.setSummary(n)}$("#filter-container").css("pointer-events","unset"),console.log("DE Dashboard",e),a("#tbl-lq","Long Queueing","lq"),a("#tbl-oc","Over CICO","oc"),a("#tbl-ot","Over Transit","ot")},function(e){console.log("error",e)})}if(GGS.STATUS.REGIONS&&!a.REGIONS){a.REGIONS=!0;var o=SORT.ARRAY_OBJECT(LIST.regions,"sequence",{sortType:"asc"});$("#_regions").append('<li class="active"><a id="ALL" class="summary-tab" href="javascript:void(0)" role="tab" data-toggle="tab">ALL</a></li>'),o.forEach(e=>{$("#_regions").append(`<li><a id="${e._id}" class="summary-tab" href="javascript:void(0)" role="tab" data-toggle="tab">${e.region}</a></li>`)}),$(".summary-tab").css({"border-radius":"2px","margin-bottom":"3px"}),$('#_regions [role="tab"]').click(function(){i=$(this).attr("id"),n=(n||[]).filter(e=>e);var t="ALL"==i?"":i;$(e).DataTable().columns(0).search(t),$(e).DataTable().columns(4).search(n.join("|"),!0,!1),$(e).DataTable().columns(7).search(s),$(e).DataTable().draw(),DE_DASHBOARD.FUNCTION.setSummary(null,{region_id:t,site:n,base:s})}),$("#_site").show().select2({placeholder:"Choose Site",allowClear:!0}).change(function(){$("#_site").parent().find(".select2").css({width:"unset","min-width":"160px"}),n=((n=$(this).val())||[]).filter(e=>e);var t="ALL"==i?"":i;$(e).DataTable().columns(0).search(t),$(e).DataTable().columns(4).search(n.join("|"),!0,!1),$(e).DataTable().columns(7).search(s),$(e).DataTable().draw(),DE_DASHBOARD.FUNCTION.setSummary(null,{region_id:t,site:n,base:s})}),$("#_site").parent().find(".select2").css({width:"160px"}),$("#_site").parent().find(".select2-selection").css({height:"32px"}),$("#_baseplant").show().select2({placeholder:"Choose Unit Base Plant",allowClear:!0}).val("").change(function(){s=$(this).val(),n=(n||[]).filter(e=>e);var t="ALL"==i?"":i;$(e).DataTable().columns(0).search(t),$(e).DataTable().columns(4).search(n.join("|"),!0,!1),$(e).DataTable().columns(7).search(s),$(e).DataTable().draw(),DE_DASHBOARD.FUNCTION.setSummary(null,{region_id:t,site:n,base:s})}),$("#_baseplant").parent().find(".select2-selection").css({height:"32px"})}},TABLE.FINISH_LOADING.CHECK(),BASE_PLANTS=null;var r=function(e){GET.AJAX({url:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/applications/${CLIENT.appId}/tags?FromIndex=0&PageSize=1000`,method:"GET",headers:{Authorization:USER.apiKey}},function(e){BASE_PLANTS=BASE_PLANTS||[],console.log("Tags:",e);var t='<option value="">Choose Unit Base Plant</option>';e.forEach(e=>{if(e.name.indexOf("A_Base Plant:")>-1){var a=e.name.split(": ")[1];"STA ROSA PL"==a&&(a="STAROSA PL"),t+=`<option value="${a}">${a}</option>`,BASE_PLANTS.push({plant:a,usersIds:e.usersIds})}}),$("#_baseplant").html(t)},function(t){console.log(t),0==t.status&&e<MAX_TRIES&&r(++e),TOASTR.ERROR(t)})};r(0);setInterval(function(){var e=moment();$("[_DATE_]").html(e.format("MM/DD/YYYY")),$("[_TIME_]").html(e.format("HH:mm"))},100)},createRow:function(e,t){LIST.dispatch=LIST.dispatch||[],t=t||e.dispatchDetails||{destination:[]};var a=e.dispatch_vehicle_id||t.vehicle_id,i=getVehicle(a),n=t.destination[0]||{location_id:""},s=getGeofence(e.dispatch_location_id||n.location_id),l=LIST.notifications.findIndex(t=>t.id==e.id);LIST.dispatch.findIndex(e=>e._id==t._id);return e.region_id=s.region_id,e.dispatch_vehicle_id||(e.id=e._id,e.dispatch_vehicle_id=a,e.dispatch_status=t.status),!e._row&&(e._row=GENERATE.RANDOM(36)),l>-1?LIST.notifications[l]=e:LIST.notifications.push(e),TABLE.COL_ROW(null,{"Region ID":s.region_id,"Delay Type":e.delay_type,SN:e.dispatch_id,_row:e._row,"Plate No":i.name||"-","Base Plant":"...",Destination:e.site||"-",Duration:"...",Escalation:e.escalation||"-"}).row},addDataToTable:function(e){return new Promise((t,a)=>{LIST.dispatch=LIST.dispatch||[];var i=LIST.dispatch.find(t=>t._id==e.dispatch_id),n=function(){t(DE_DASHBOARD.FUNCTION.createRow(e,i))};i?n():GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${e.dispatch_id}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(e){var t=e[0];t&&LIST.dispatch.push(t),i=t||{destination:[]},n()})})},setSummary:function(e,t){var a={ot:{1:0,2:0,3:0},lq:{1:0,2:0,3:0},oc:{1:0,2:0,3:0}},i=LIST.notifications;t&&(i=LIST.notifications.filter(e=>(!t.region_id||e.region_id==t.region_id)&&(!(t.site&&t.site.length>0)||t.site.includes(e.site))&&(!t.base||e.site==t.base))),$.each(i,function(t,i){"Over Transit"!=i.delay_type||e&&"ot"!=e||a.ot[i.escalation]++,"Long Queueing"!=i.delay_type||e&&"lq"!=e||a.lq[i.escalation]++,"Over CICO"!=i.delay_type||e&&"oc"!=e||a.oc[i.escalation]++}),Object.keys(a).forEach(t=>{Object.keys(a[t]).forEach(i=>{e&&e!=t||$(`[${t}_esc_${i}]`).html(a[t][i]||"-")})})},setBadge:function(e){e&&"de_dashboard"!=PAGE.GET()||(DE_NOTIF_COUNT=[]),0==DE_NOTIF_COUNT.length||"de_dashboard"==PAGE.GET()?$("#de_dashboard-badge").hide():$("#de_dashboard-badge").show(),$("#de_dashboard-badge").html(DE_NOTIF_COUNT.length)}}},DISPATCH={FUNCTION:{monitoring:function(){var e=new URLSearchParams(window.location.search),t=CRYPTO.DECRYPT(e.get("data")),a="#tbl-dispatch",i="dispatch",n=USER.filters.dispatch||{},s=null,l=!0,o=!0,r=!1,d=function(e){var t=new Dispatch(e,a);return TABLE.COL_ROW(null,t.row()).row},c=function(e,t,l,o){l||(LIST.dispatch=[]),n=o||USER.filters.dispatch||{};try{n=JSON.parse(n)}catch(e){}inTransitData=!1;var m=$.isEmptyObject(n)?{posting_date:FILTER.DATERANGE()}:n;if("postingDate-scheduledDate"==clientCustom.filterType.dashboard){if(m.posting_date&&!m.scheduled_date){var h={$or:[{posting_date:m.posting_date},{$and:[{scheduled_date:m.posting_date},{status:{$ne:"scheduled"}}]}]};Object.keys(m).forEach(e=>{m[e]&&"posting_date"!=e&&(h[e]=m[e])}),m=h}USER.filters.dispatch=m}console.log(m);var b=TABLE.BUTTONS({goto:PAGE.GET(),loadView:["create","create-admin","import"],actions:{create:function(){$("body").append(MODAL.CREATE.EMPTY("Create New Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({asAdmin:!0})},import:function(){$("body").append(MODAL.CREATE.EMPTY("Import Batch File",modalViews.dispatch.import())),DISPATCH.FUNCTION.import({})},refresh:function(){c(null)},column:function(){$("#export-container").hide("slide",{direction:"right"},100),$("#filter-container").hide("slide",{direction:"right"},100),$("#clone-container").hide("slide",{direction:"right"},100),$("#cv-container").toggle("slide",{direction:"right"},100)},filter:function(){$("#export-container").hide("slide",{direction:"right"},100),$("#cv-container").hide("slide",{direction:"right"},100),$("#clone-container").hide("slide",{direction:"right"},100),$("#filter-container").toggle("slide",{direction:"right"},100)},export:function(){$("#filter-container").hide("slide",{direction:"right"},100),$("#cv-container").hide("slide",{direction:"right"},100),$("#clone-container").hide("slide",{direction:"right"},100),$("#export-container").toggle("slide",{direction:"right"},100)},clone:function(){$("#export-container").hide("slide",{direction:"right"},100),$("#cv-container").hide("slide",{direction:"right"},100),$("#filter-container").hide("slide",{direction:"right"},100),$("#clone-container").toggle("slide",{direction:"right"},100)}}});r=!1,s&&!t&&(s.clear().draw(),$(".dataTables_empty").text("Loading...")),GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(m)}/count`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(t){var n=1,l=1,o=0,c=0;console.log("count",t),TABLE.POPULATE({url:`dispatch/${CLIENT.id}/${USER.username}/all`,goto:PAGE.GET(),commentTitle:"Dispatch Entry",withFilter:!0,filter:m,urlPath:i,withPagination:!0,newlyLoaded:e,dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.dispatch()).column,createdRow:function(e,t,n){var s=t._row,l=t._id;$(e).attr("_row",t._row),TABLE.ROW_LISTENER({table_id:a,_row:s,urlPath:i,_id:l,deleteURL:`/api/dispatch/${CLIENT.id}/${USER.username}/${l}`,editCallback:function(){$("body").append(MODAL.CREATE.EMPTY("Update Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({_id:t._id,asAdmin:!0}),$("html, body,#modal").animate({scrollTop:0},"fast")},additionalListeners:function(){$(a).on("click",`[_row="${s}"] [view],[_row="${s}"] + tr.child [view]`,function(e){e.stopImmediatePropagation(),$("body").append(modalViews.dispatch.fullView(t._id)),$("html, body,#modal").animate({scrollTop:0},"fast")}),$(a).on("click",`[_row="${s}"] [statusUpdate],[_row="${s}"] + tr.child [statusUpdate]`,function(e){e.stopImmediatePropagation();var t=LIST.dispatch.find(e=>e._id&&e._id.toString()==l.toString());t&&($("body").append(modalViews.dispatch.statusUpdate(t._id)),DISPATCH.FUNCTION.status(l))})}})},order:[[1,"desc"]],dom:'lB<"toolbar">frti<"tbl-progress-bar">p',buttons:b},table_id:a,initializeCallback:function(e,t){s=t,p(),u(),TABLE.WATCH({urlPath:i,rowData:d,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),$(a).on("search.dt length.dt page.dt",function(){isFinishedLoading(["GEOFENCES","VEHICLES","TRAILERS","VEHICLES_HISTORY","ROUTES","VEHICLE_PERSONNEL"],!0,function(){TABLE.FINISH_LOADING.UPDATE(),setTimeout(function(){TABLE.FINISH_LOADING.UPDATE()},300)})}),$("div.tbl-progress-bar").html(LOADING.PROGRESSBAR.UI()).css({position:"absolute",left:"0px",bottom:"-6px",width:"160px",height:"20px"}),LOADING.PROGRESSBAR.INITIALIZE()},populateCallback:function(e){if($(a).length>0){r=!0,$("#search-btn").css({"pointer-events":"",color:""});var i=[];$.each(e,function(e,t){i.push(d(t))}),s.rows.add(i).draw(!1),TABLE.FINISH_LOADING.START_CHECK(),$("div.tbl-progress-bar").show();var u=t/LIMIT,p=Math.floor(u);u%1>0&&p++,!o&&(o=100/p),c+=o,n=l,l=Math.floor(c),LOADING.PROGRESSBAR.MOVE(n,l)}}})})},u=function(){$(".page-box").append(SLIDER.COLUMN_VISIBILITY(CUSTOM.COLUMN.dispatch())),$("span.toggle-vis").on("click",function(e){var t=$(this).attr("data-column"),i=s.column(t);i.visible(!i.visible()),CUSTOM.COLUMN.dispatch()[t].visible=i.visible(),CUSTOM.COLUMN.dispatch()[t].bVisible=i.visible(),$(a).attr("style",""),$(`${a} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${a} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})}),$(".page-box").append(SLIDER.EXPORT()),TABLE.TOOLBAR(s),$(".buttons-copy span").html("Copy Table"),$(".buttons-csv span").html("Export Table As CSV File"),$(".buttons-excel span").html("Export Table As Excel File"),$("#_departure_date,#_posting_date,#_scheduled_date,#clone_posting_date").daterangepicker({opens:"left",timePicker:!0,locale:{format:"MM/DD/YYYY hh:mm A"},autoUpdateInput:!1,autoApply:!0},function(e,t,a){FILTER.INITIALIZE($(this)[0].element,e,t,"MM/DD/YYYY hh:mm A"),$(".clearable").trigger("input")}).on("apply.daterangepicker",function(e,t){FILTER.INITIALIZE($(this),t.startDate,t.endDate,"MM/DD/YYYY hh:mm A"),$(".clearable").trigger("input")}),$("#_region").change(function(){$("#_cluster").val("all")}),$("#_cluster").change(function(){$("#_region").val("all")}),n.departure_date&&FILTER.INITIALIZE("#_departure_date",n.departure_date.$gte,n.departure_date.$lt,"MM/DD/YYYY hh:mm A"),n.scheduled_date&&FILTER.INITIALIZE("#_scheduled_date",n.scheduled_date.$gte,n.scheduled_date.$lt,"MM/DD/YYYY hh:mm A"),n.posting_date&&FILTER.INITIALIZE("#_posting_date",n.posting_date.$gte,n.posting_date.$lt,"MM/DD/YYYY hh:mm A"),n.status&&$("#_status").val(n.status),n.region&&$("#_region").val(n.region),n.cluster&&$("#_cluster").val(decodeURIComponent(n.cluster)),(n.departure_date||n.posting_date||n.scheduled_date||n.status||n.region||n.cluster)&&($("#filter-container").toggle("slide",{direction:"right"},100),$(".clearable").trigger("input"),FILTER.STATUS="new"),FILTER.RESET({dateEl:"#_posting_date",dateElnoVal:"#_departure_date,#_scheduled_date",selectEl:"#_status,#_region,#_cluster",urlPath:i,populateTable:c}),$("#filter-btn").click(function(){n={};var e=$("#_departure_date").val(),t=$("#_scheduled_date").val()||"",a=e||t?$("#_posting_date").val():$("#_posting_date").val()||DEFAULT_DATE,i=$("#_status").val(),s=$("#_region").val(),l=$("#_cluster").val();(_origin_id=[],console.log("_departure_date",e,a),!e.isEmpty()&&(n.departure_date=FILTER.DATERANGE(e,!0,!0)),!a.isEmpty()&&(n.posting_date=FILTER.DATERANGE(a,!0,!0)),!t.isEmpty()&&(n.scheduled_date=FILTER.DATERANGE(t,!0,!0)),"all"!=i&&(n.status=i),"all"!=s)&&(n.region=encodeURIComponent(s),LIST.geofences.filter(e=>e.region_id==s).forEach(e=>{_origin_id.push(e._id)}));"all"!=l&&(n.cluster=encodeURIComponent(l),LIST.geofences.filter(e=>e.cluster_id==l).forEach(e=>{_origin_id.push(e._id)}));_origin_id.length>0&&(n.origin_id={$in:_origin_id}),"reset"!=FILTER.STATUS||(FILTER.STATUS="new"),USER.filters.dispatch=n,GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({"filter.dispatch":JSON.stringify(n)})},function(e){console.log("docs",e)}),$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),c()}),m(),$("#clone-btn").click(function(){n={};var e=$("#clone_posting_date").val();console.log("clone_posting_date",e),GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/clone/${JSON.stringify({posting_date:FILTER.DATERANGE(e,!0,!0)})}`,method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN}},function(e){console.log("Clone",e),$("#clone-btn").html("Apply").removeClass("disabled")}),$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled")})},p=function(){var e=null,t=null;s.on("search.dt",function(){0===s.page.info().recordsDisplay&&s.search()?!0===r&&($("#search-alert").html().isEmpty()?($("#search-alert").html(ALERT.HTML.INFO(`<span id="alert-message">Click <u id="search-btn" style="cursor: pointer;">here</u> to search for Shipment Number: <b id="search-text">${s.search()}</b> through all records.</span><span id="no-result-message" style="display:none;"></span>`,"m-3",!0)).show(),$("#search-btn").click(function(){$("#search-btn").css({"pointer-events":"none",color:"#aaadae"}),e=s.search(),t=n,n={_id:s.search()},c(null,!0,!0,n)})):e===s.search()?($("#alert-message").hide(),$("#no-result-message").html(`No result for Shipment Number: <b id="search-text">${e}</b>.`).show(),e=null):($("#alert-message").hide().show(),$("#no-result-message").html("").hide(),$("#search-text").html(s.search()))):($("#search-alert").html("").hide(),t&&(n=t,t=null))})},m=function(){if(GGS.STATUS.REGIONS&&GGS.STATUS.CLUSTERS){var e='<option value="all">All</option>',t='<option value="all">All</option>';LIST.regions.forEach(t=>{e+=`<option value="${t._id}">${t.region}</option>`}),LIST.clusters.forEach(e=>{t+=`<option value="${e._id}">${e.cluster}</option>`}),$("#_region").html(e),$("#_cluster").html(t)}};t.for=i;try{n=JSON.parse(n)}catch(e){}LIST.dispatch=[],c(!0),TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["REGIONS","CLUSTERS","GEOFENCES","VEHICLES","TRAILERS","VEHICLES_HISTORY","ROUTES","USERS","VEHICLE_PERSONNEL"],l,function(){l=!1,$.each(LIST.dispatch,function(e,t){var a=s.row(`[_row="${t._row}"]`).node();a&&s.row(a).data(d(t))}),TABLE.FINISH_LOADING.UPDATE()}),isFinishedLoading(["GEOFENCES","VEHICLES","TRAILERS","VEHICLES_HISTORY","ROUTES","VEHICLE_PERSONNEL"],!0,function(){TABLE.FINISH_LOADING.UPDATE()}),isFinishedLoading(["REGIONS","CLUSTERS"],o,function(){o=!1,m()})},TABLE.FINISH_LOADING.START_CHECK()},form:function(e){console.log("__data",e);var t="wilcon"==CLIENT.id?"dispatch_mod2":"dispatch",a=/^\d{8}$/;getSelect2Options(),CUSTOM.FORM[t]().forEach(e=>{e.remove&&($(e.id).parents(`${e.parent}`).find("input,select,textarea").length>=1&&$(e.id).parents(`${e.parent}`).remove(),$(e.id).remove())}),LIST.dispatch=LIST.dispatch||[];var i,n,s,l=e._id,o=e.type,r=(Number(e.escalation),""),d=null,c={},u=null,p=null,m=clientCustom.editableTrailer?G_SELECT2["form-vehicles-admin"]:G_SELECT2["form-vehicles"],h=G_SELECT2["form-trailers"],b=G_SELECT2["form-routes"],f=G_SELECT2["form-shift_schedule"],v=null,E=!1,g=null,T=null,_={new:function(){$("#submit").text("Submit"),$("#loading-text").remove()}},y=function(e){(o||e)&&("delay"==o?($("#submit").html("Submit"),$("#modal input,#modal textarea,#modal select").attr("disabled",!0),$("#new-attachment,#new-destination").remove(),$("#modal table > tbody > tr > td input:disabled").parents("tr").css("background-color","#eee")):"view"==o?($("#modal input,#modal textarea,#modal select").attr("disabled",!0),$("#submit").remove(),$("#new-attachment,#new-destination").remove(),$("#modal table > tbody > tr > td input:disabled").parents("tr").css("background-color","#eee")):["in_transit"].includes(e)&&(autorizationLevel.administrator()||($("#modal input,#modal textarea,#modal select").attr("disabled",!0),$("#new-destination").remove(),$("#comments,#new-file").attr("disabled",!1),$("#modal table > tbody > tr > td input:disabled").parents("tr").css("background-color","#eee"))))},S=function(){return p&&"incomplete"==p.status};!function(){var e=1,A=function(){return new Promise((e,t)=>{var l=$("#shipment_number").val()._trim(),m=$("#scheduled_date").val(),h=$("#shift_schedule option:selected").val(),b=($("#ticket_number").val()||"")._trim(),f=$("#route").val()._trim(),E=$("#vehicle option:selected").val(),_=s,y=$("#driver_id option:selected").val(),S=($("#checker_id option:selected").val(),!0);if(f||(S=!1),E||(S=!1),"wilcon"==CLIENT.id?(b||(S=!1),y||(S=!1)):(_||(S=!1),l&&a.test(l)||(S=!1)),!["view","delay"].includes(o)&&S){!1,d=null,u=null,c={},v=null,$("#overlay #alert").html("");var A=$("#vehicle option:selected").attr("username"),E=$("#vehicle").val(),I=getGeofence(i)||{},D=I.geofence_id;if(D)if("wilcon"!=CLIENT.id||"wilcon"==CLIENT.id&&withinSchedule(m,h))if(console.log("__originalObj",p),!p||p.route!=f||p.vehicle_id!=Number(E)||g||T)if(A&&D&&(autorizationLevel.administrator()||!["in_transit","complete","incomplete","scheduled"].includes(r))){$("#submit").html('<i class="la la-spinner la-spin mr-2"></i>Detecting vehicle\'s location..').attr("disabled",!0),function a(i){i=i||0;var s=getGeofence(n)||{};var l=s.short_name;var o=I.short_name;var r=function(e,t,a){var i=null;return t.forEach(t=>{"or"!=a||i||(i=e.indexOf(t)>-1),"and"!=a||null!=i&&1!=i||(i=e.indexOf(t)>-1)}),i},p=function(e,t,a){console.log(v,e,t,c);for(var i="assigned",n=(new Date).getTime(),s=e.length-1;s>=0;s--){var l=e[s],o=new Date(l.timestamp).getTime(),d=!0===a?0:Math.abs(n-o)/36e5;console.log("oEvents",l.RULE_NAME,l.stage,!c[o],d<24),("Inside Geofence"==l.RULE_NAME&&"end"==l.stage||"Outside Geofence"==l.RULE_NAME&&"start"==l.stage)&&1==v&&"in_transit"!=i&&d<24&&(!0,i="in_transit",c[o]="in_transit",n=new Date(l.timestamp).getTime()),r(l.RULE_NAME,["Inside","Idle"],"and")&&!c[o]&&d<24&&(!0,c[o]="idlingAtOrigin"),r(l.RULE_NAME,["Inside Geofence","Processing"],"and")&&!c[o]&&d<24&&(!0,c[o]="processingAtOrigin"),r(l.RULE_NAME,["Inside Geofence","Queueing"],"and")&&!c[o]&&d<24&&(!0,c[o]="queueingAtOrigin"),!c[o]&&d<24&&(c[o]="tempStatus")}1!=v||OBJECT.getKeyByValue(c,"in_transit")||(c[(new Date).getTime()]="in_transit",console.log("YES: In Transit ~~~")),console.log("__events_captured",c);var u,p=OBJECT.sortByKey(c),s=0;if(Object.keys(p).forEach(e=>{0==s&&(s++,"in_transit"!=p[e]&&(p[e]="entered_origin"))}),Object.keys(p).forEach(e=>{"tempStatus"==p[e]&&delete p[e]}),Object.keys(p).forEach(e=>{u=e}),c=p,i=p[u],console.log("sortedEvents",i,p),"entered_origin"==i&&(i=clientCustom.statusWhenTruckEnteredOrigin||"assigned"),1==v){var m=OBJECT.getKeyByValue(c,"in_transit");i="in_transit",t.forEach(e=>{var t=new Date(e.timestamp).getTime(),s=!0===a?0:Math.abs(n-t)/36e5;"start"==e.stage&&!m&&s<24&&(!0,c[t]="in_transit"),clientCustom.roundtrip?("Inside Geofence"==e.RULE_NAME&&"end"==e.stage||"Outside Geofence"==e.RULE_NAME&&"start"==e.stage||"in_transit"!=i||c[t]||(i="onSite",!0,c[t]="onSite"),("Inside Geofence"==e.RULE_NAME&&"end"==e.stage||"Outside Geofence"==e.RULE_NAME&&"start"==e.stage)&&"onSite"==i&&!c[t]&&(i="returning",!0,c[t]="returning")):"in_transit"==i&&!c[t]&&Number(m)<t&&s<24&&(i="complete",!0,c[t]="complete")})}return i};if(g||T)if($("#submit").html('<i class="la la-spinner la-spin mr-2"></i>Adjusting entry status..').attr("disabled",!0),!0,g&&T){v=!0,console.log(T.short_name,l),d=T.short_name==l?p(g.events,(T||{}).events,!0):p(g.events,[],!0);var m=OBJECT.sortByKey(c);c=m,console.log("EYOOOEOEOEOOEOEO1111111111",v,d,c),e()}else GET.AJAX({url:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/applications/${CLIENT.appId}/geofences/${D}/users?FromIndex=0&PageSize=500`,method:"GET",headers:{Authorization:USER.apiKey}},function(t){console.log("Vehicles:",t),v=!0,t.forEach(e=>{e.username==A&&(v=!1)}),d=p(g.events,[],!0);var a=OBJECT.sortByKey(c);c=a,console.log("EYOOOEOEOEOOEOEO222222222",v,d,c),e()},function(e){0==e.status&&i<MAX_TRIES&&a(++i),TOASTR.ERROR(e)});else{GET.AJAX({url:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/applications/${CLIENT.appId}/geofences/${D}/users?FromIndex=0&PageSize=500`,method:"GET",headers:{Authorization:USER.apiKey}},function(a){console.log("Vehicles:",a),v=!0,a.forEach(e=>{e.username==A&&(v=!1)}),$("#submit").html('<i class="la la-spinner la-spin mr-2"></i>Adjusting entry status..').attr("disabled",!0),GET.AJAX({url:`/api/vehicles_history/${CLIENT.id}/${USER.username}/${E}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(a){if(!0,a.length>0){var i=a[0],n=i.location||[];if(u=i.location,v){for(var s=n.length-1;s>=0;s--){if(n[s].short_name==o){v=!0,d=p(n[s].events,[]);break}if(n[s].short_name==l){for(var r=n.slice(0,s),m=!1,h=r.length-1;h>=0&&r[h].short_name!=l;h--)if(r[h].short_name==o){v=!0,d=p(r[h].events,n[s].events),m=!0;break}m||(v=!1,d="assigned");break}}null==d&&(console.log("__tempStat is null"),d="assigned",v=!1)}else n[n.length-1].short_name==o&&(d=p(n[n.length-1].events)),null==d&&(d="assigned",v=!1,console.log("__tempStat is null but vehicle is inside origin."))}else t({message:"Truck selected does not exist."});var b=OBJECT.sortByKey(c);c=b,d=d||"assigned",console.log("EYOOOEOEOEOOEOEO",v,d,c),e()})},function(e){0==e.status&&i<MAX_TRIES&&a(++i),TOASTR.ERROR(e)})}}()}else v=!1,e();else!0,e();else!0,d="assigned",v=!1,c={},e();else!0,d="plan",v=!1,c={},e()}else e()})},I=function(){return new Promise((e,t)=>{var a=$("#scheduled_date").val(),i=$("#shift_schedule option:selected").val(),n=$("#vehicle option:selected").val(),s=$("#driver_id option:selected").val(),o=$("#checker_id option:selected").val(),r=$("#helper_id option:selected").val();if("wilcon"==CLIENT.id&&n&&s&&a&&i){$("#modal #alert").html('<i class="la la-spin la-spinner font-18 mb-3"></i>'),E=!0,$("#submit").attr("disabled",!0);var d=[{vehicle_id:Number(n)},{driver_id:s}];o&&d.push({checker_id:o}),r&&d.push({helper_id:r});var c={$and:[{$or:d},{scheduled_date:new Date(a).toISOString()},{shift_schedule:i},{status:{$nin:["plan","complete","incomplete"]}}]};$.ajax({url:`/api/dispatch/${CLIENT.id}/${USER.username}/vehicle_info/${JSON.stringify(c)}`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(t){if(console.log("docs",t),t.length>0){var a=[];t.forEach(e=>{e._id!=l&&(e.vehicle_id==Number(n)&&a.push(`• Truck is already assigned to shipment ${e._id}.`),e.driver_id.toString()==s.toString()&&a.push(`• Driver is already assigned to shipment ${e._id}.`),o&&e.checker_id.toString()==o.toString()&&a.push(`• Checker is already assigned to shipment ${e._id}.`),r&&e.helper_id.toString()==r.toString()&&a.push(`• Helper is already assigned to shipment ${e._id}.`))}),a.length>0?($("#modal #alert").html(ALERT.HTML.ERROR(`<b>Error:</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${a.join("<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")}`,"ml-0 mr-0 mt-0 mb-3")),$("#modal").animate({scrollTop:0},"fast"),E=!0,$("#submit").attr("disabled",!0)):($("#modal #alert").html(""),$("#modal").animate({scrollTop:0},"fast"),E=!1,$("#submit").attr("disabled",!1))}else $("#modal #alert").html(""),$("#modal").animate({scrollTop:0},"fast"),E=!1,$("#submit").attr("disabled",!1);e()})}else e()})};if((clientCustom.defaultOrigin.roles||[]).includes(USER.role)){var D=getGeofence(clientCustom.defaultOrigin.id);D&&$("#origin").val(D.short_name)}var O,C=moment(new Date(DEFAULT_DATE)).add(1,"days").format("MM/DD/YYYY");function w(){var e=getVehicleHistory($("#vehicle").val())||{};$("#previous-checkins tbody").html(""),$('[name="checkin"]').prop("checked",!1),g=null,T=null;var t=e.location||[],a=[...t].reverse(),s=0;a.forEach((e,t)=>{if(s<5){e.events=e.events||[];var n=a[t-1]||{},l=null,o=null,r='<input type="radio" disabled>',d=getGeofence(i);if(e.events.forEach(e=>{!l&&e.RULE_NAME.indexOf("Inside")>-1&&(l=e),o=e.RULE_NAME.indexOf("Outside")>-1?e:{}}),e.short_name==(d||{}).short_name){s++,r=`<input type="radio" name="checkin" value="${t}">`;var c=$(`<tr>\n                                            <td>${r}</td>\n                                            <td>${DATETIME.FORMAT((l||{}).timestamp)}</td>\n                                            <td>${DATETIME.FORMAT((o||{}).timestamp)}</td>\n                                            <td>${e.short_name}</td>\n                                            <td>${n.short_name||"-"}</td>\n                                        </tr>`);$("#previous-checkins tbody").append(c),p&&l&&Object.keys(p.events_captured||{}).forEach(e=>{moment(Number(e)).format("HH:mm")===moment(l.timestamp).format("HH:mm")&&$(c).find('[name="checkin"]').prop("checked",!0)})}}}),0==$('[name="checkin"]:checked').length&&$($('[name="checkin"]').get(0)).prop("checked",!0),$('[name="checkin"]').change(function(){var e=$(this).prop("checked");if(e){var t=$(this).val();g=a[t];for(var i=getGeofence(n),s=null,l=t-1;l>=0;l--)if(i.short_name==a[l].short_name){s=l;break}T=a[s=!s||s<0?t-1:s],console.log("INDEX",t),console.log("ORIGIN",g),console.log("destinationIndex",s),console.log("DESTINATION",T)}}).trigger("change")}function N(e,t,a){if("wilcon"==CLIENT.id){var i=p||{};function n(e,t,a){var n='<option value="">&nbsp;</option>',s=LIST.vehicle_personnel.filter(t=>t.occupation==e),l=LIST.vehicle_personnel.find(t=>(t.vehicle_id||"").toString()==$("#vehicle").val()&&$("#vehicle").val()&&t.occupation==e)||{},o=LIST.vehicle_personnel.find(e=>e.name==a||i[t])||{},r=[];s.forEach(e=>{var t=e.dates||{},a=new Date($("#scheduled_date").val()).toISOString(),i=[];Object.keys(t).forEach(e=>{var n=t[e]||[];n.includes(a)&&i.push(vehiclePersonnelCalendarOptions[e].label)});var s=i.length>0?` (${i.join(", ")})`:"",l=i.length>0?"disabled":"";n+=`<option value="${e._id}" ${l}>${e.name||"No Name"}${s}</option>`,i.length>0&&r.push(e._id)});var d="";!r.includes(a)&&(d=a),!r.includes(o._id)&&(d=o._id),!r.includes(l._id)&&(d=l._id),$(`#${t}`).empty().html(n).select2().val(d).on("select2:select",function(){I()}).trigger("change")}n("Driver","driver_id",e),n("Checker","checker_id",t),n("Helper","helper_id",a)}}if($("#scheduled_date").daterangepicker({opens:"left",autoApply:!0,singleDatePicker:!0,autoUpdateInput:!1,minDate:DATETIME.FORMAT(new Date,"MM/DD/YYYY"),locale:{format:"MM/DD/YYYY"}},function(e,t,a){}).on("apply.daterangepicker",function(e,t){var a=moment(new Date(t.startDate)).format("MM/DD/YYYY");$(this).val(a),$(this).data("daterangepicker").setStartDate(a),$(this).data("daterangepicker").setEndDate(a),$("#shift_schedule").attr("disabled",!1),a==DEFAULT_DATE?(LIST.shift_schedule||[]).forEach(e=>{withinSchedule(a,e._id,!0)?$(`#shift_schedule option[value="${e._id}"]`).removeAttr("disabled"):$(`#shift_schedule option[value="${e._id}"]`).attr("disabled","disabled")}):$("#shift_schedule option").removeAttr("disabled"),$("#shift_schedule").val("").select2().attr("disabled",!1),N($("#driver_id").val(),$("#checker_id").val(),$("#helper_id").val())}),$("#shift_schedule").html(f).select2().val("").on("select2:select",function(){I()}).trigger("change").attr("disabled",!0),$("#trailer").html(h).select2().val("").on("select2:select",function(){}).change(function(){if(null!=$(this).val()){var e=getTrailer(s=$(this).val()||"")||{};$("td[trailer]").html(s||"-"),$("td[cluster]").html(e.cluster||"-"),$("td[base]").html(e.site||"-"),$("td[region]").html(e.region||"-"),$("td[pallet_type]").html(e.pal_cap||"-")}}).prop("disabled",!0),$("#vehicle").html(m).select2({matcher:matcher,templateResult:formatCustom}).val("").on("select2:select",function(){}).change(function(){$(this).val()?$("#trailer").prop("disabled",!1):$("#trailer").prop("disabled",!0);var e=getVehicle($(this).val())||{},t=getTrailer(e.name),a=e.name==e.Trailer;t||a?(t?s=t._id||"":(s=e.Trailer,t={cluster:e.Cluster,site:e.Site,region:e.Region,pal_cap:e["Pal Cap"]}),$("#trailer").prop("disabled",!0),clientCustom.editableTrailer&&$("#trailer").val("Straight Truck").change(),$("td[trailer]").html("Straight Truck")):((t=getTrailer(O||e.Trailer))?(s=t._id||"",clientCustom.editableTrailer&&$("#trailer").val(s).change(),$("td[trailer]").html(s||"-")):t={},console.log(2,s)),O=null,$("td[conduction_number]").html(e["Tractor Conduction"]||"-"),$("td[cluster]").html(t.cluster||"-"),$("td[base]").html(t.site||"-"),$("td[region]").html(t.region||"-"),$("td[pallet_type]").html(t.pal_cap||"-"),N(),I(),w()}),$("#driver_id,#checker_id,#helper_id").html("").select2(),$("#route").html(b).select2({matcher:matcher,templateResult:formatCustom}).val("").on("select2:select",function(){}).change(function(){var e=getRoute($(this).val());if(e){var t=getGeofence(e.origin_id),a=getGeofence(e.destination_id);i=t._id,n=a._id,$("#origin").val(`${t.short_name} (${t.site_name||"-"})`),$("[location]").val(`${a.short_name} (${a.site_name||"-"})`)}else"view"!=o&&($("#origin,[location]").val(""),i="",n="");M(null,e),w()}),(clientCustom.defaultOrigin.roles||[]).includes(USER.role)){var D=getGeofence(clientCustom.defaultOrigin.id);$("#route").on("select2:open",function(e){$(".select2-search__field").val(`${D.short_name},`).focus()})}$("#scheduled_date").trigger("apply.daterangepicker",{startDate:C});var L=null,x=!1;if(l){$(".main-content .clearfix").css({"pointer-events":"none"}),$("#loading-text").show(),x=!0,L=LIST.dispatch.findIndex(e=>e._id==l);var R=LIST.dispatch[L];function P(){$("#loading-text").remove(),$(".main-content .clearfix").css({"pointer-events":""}),["complete","incomplete"].includes(R.status)&&(S()&&autorizationLevel.administrator()?$("#error").html('<div class="alert alert-danger alert-dismissible mb-1 role="alert">\n                                                    <i class="la la-times-circle"></i> The status of this entry is <b>INCOMPLETE</b>. Any changes made will not affect the status.\n                                                </div>').show():"delay"!=o&&(o="view")),r=R.status,$.each(R.destination,function(e,t){k(t,R.route)}),O=R.trailer,R.scheduled_date&&$("#scheduled_date").trigger("apply.daterangepicker",{startDate:R.scheduled_date}),CUSTOM.FORM[t]().forEach(e=>{var t=R[e.key]||e.alternativeValue||"";if("dateTime"==e.dataType&&(t=DATETIME.FORMAT(R[e.key],"MM/DD/YYYY, hh:mm A",""),"val"==e.inputType)){var a=moment(new Date(R[e.key])).format("MM/DD/YYYY, hh:mm A");$(e.id).data("daterangepicker").setStartDate(a),$(e.id).data("daterangepicker").setEndDate(a)}if("date"==e.dataType&&(t=DATETIME.FORMAT(R[e.key],"MM/DD/YYYY",""),"val"==e.inputType)){var a=moment(new Date(R[e.key])).format("MM/DD/YYYY");$(e.id).data("daterangepicker").setStartDate(a),$(e.id).data("daterangepicker").setEndDate(a)}t&&$(e.id)[e.inputType](t),e.readonly&&$(e.id).attr("readonly",e.readonly),e.trigger&&$(e.id).trigger(e.trigger)}),ATTACHMENTS.set(R.attachments,"delay"==o||"view"==o),0==R.destination.length&&k(),M(R),y(R.status)}p=R,(clientCustom.previousCheckIns.status||[]).includes((p||{}).status)||$("#previous-checkins-container").remove(),L>=0?P():GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${l}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(e){$(".main-content .clearfix").css({"pointer-events":""}),(R=e[0])?(p=R,P()):(x=!1,_.new(),k(),y())})}else $("#previous-checkins-container").remove(),_.new(),k(),y();function k(t,a){t=t||{},e<1&&(e=1);var i=!(!["delay","view"].includes(o)&&!["queueingAtOrigin","processingAtOrigin","in_transit","queueingAtDestination","processingAtDestination"].includes(r)),n=DISPATCH.FUNCTION.add_row.destination(e,t,a,i);e++,$(`[_row="${n}"] [delete-destination]`).click(function(){$(this).parent().parent().remove(),$("#tbl-destination > tbody > tr").length>0?($("#tbl-destination > tbody > tr").each(function(t,a){e=t+1,$(a).children().eq(0).html(e)}),e>0&&e++):e=1,M()})}function M(e,t){e=e||{};var a=t||getRoute(e.route||$("#route").val());if(a){var i=DATETIME.HH_MM(null,a.transit_time),n=getGeofence(a.destination_id)||{},s=DATETIME.HH_MM(null,n.cico);$("[transit_time]").html(`${i.hour} : ${i.minute}`),$("[cico]").html(`${s.hour} : ${s.minute}`)}else $("[transit_time],[cico]").html('<span class="text-muted">HH</span> : <span class="text-muted">MM</span>')}$("#new-destination").click(function(){k()}),ATTACHMENTS.initialize("delay"==o||"view"==o),$("#submit").click(function(){var e="assigned",t={},m="delay"!=o&&x?"Update":"Submit",h="delay"!=o&&x?"Updating..":"Submitting..",b=$(this);$("#error").hide();var f=$("#shipment_number").val()._trim(),_=$("#scheduled_date").val(),y=$("#shift_schedule option:selected").val(),I=($("#ticket_number").val()||"")._trim(),D=i,O=$("#route").val()._trim(),C=[{location_id:n}],w=$("#vehicle option:selected").val(),N=s,L=$("#driver_id option:selected").val(),R=$("#checker_id option:selected").val(),P=$("#helper_id option:selected").val(),k=$("#comments").val()._trim(),M=(ATTACHMENTS.get(CLIENT.dsName),!1),G=!1,U=[],F={"background-color":"white"},Y={"background-color":"#ffe4e4"},B=!1,H={fields:[{key:"vehicle_id",customTitle:"Vehicle",dataExtended:!0,data:LIST.vehicles,dataCompareKey:"_id",dataValueKey:"name",customExternalFunction:function(){B=!0}},{key:"origin_id",customTitle:"Origin",dataExtended:!0,data:LIST.geofences,dataCompareKey:"_id",dataValueKey:"short_name"},{key:"driver_id",customTitle:"Driver",dataExtended:!0,data:LIST.vehicle_personnel,dataCompareKey:"_id",dataValueKey:"name"},{key:"checker_id",customTitle:"Checker",dataExtended:!0,data:LIST.vehicle_personnel,dataCompareKey:"_id",dataValueKey:"name"},{key:"helper_id",customTitle:"Helper",dataExtended:!0,data:LIST.vehicle_personnel,dataCompareKey:"_id",dataValueKey:"name"},{key:"scheduled_date",type:"date",format:"MMM DD, YYYY"},{key:"status",type:"status"},{key:"late_entry",type:"bool"},{key:"destination",custom:!0,customFunction:function(e,t){var a=getGeofence(e[0].location_id)||{},i=getGeofence(t[0].location_id)||{},n=a.short_name==i.short_name;return n?null:`• Destination changed from '${a.short_name||""}' to '${i.short_name||""}'.`}},{key:"attachments",type:"attachments"}]};if(console.log("TRAILER",s),l=f,S()){var z=`/api/dispatch/${CLIENT.id}/${USER.username}`,V="POST";t.origin_id=D,t.route=O,t.destination=C,t.vehicle_id=Number(w),t.trailer=N,t.comments=k,t.attachments=ATTACHMENTS.get(CLIENT.dsName),t.username=USER.username,"wilcon"==CLIENT.id&&(t.ticket_number=I,t.driver_id=L,t.checker_id=R,t.helper_id=P,_&&(t.scheduled_date=new Date(_).toISOString()),y&&(t.shift_schedule=y)),H.excludeKeys=["status","vehicleData","username"],t=HISTORY.check(p,t,USER.username,H);var q=!1;function W(){$(".main-content .clearfix").css({"pointer-events":"none"}),$(b).html(`<i class="la la-spinner la-spin mr-2"></i>${h}`).attr("disabled",!0),!0===x?(z=`/api/dispatch/${CLIENT.id}/${USER.username}/${l}`,V="PUT"):"wilcon"!=CLIENT.id&&(t=$.extend(t,{_id:l})),GET.AJAX({url:z,method:V,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(t)},function(e){if($("#confirm-modal,#overlay").remove(),1==e.ok){console.log(e);var t,a=!1;!0===clientCustom.autoGeneratedId&&(t=`<br>Shipment Number: <b>${e.sequence}</b>`,a=!0),"PUT"==V?TOASTR.UPDATEDSUCCESSFULLY():TOASTR.CREATEDSUCCESSFULLY(t,a),$(".main-content .clearfix").css({"pointer-events":""}),$("#overlay").remove()}else console.log(e.error),$(b).html(m).attr("disabled",!1),$(".main-content .clearfix").css({"pointer-events":""})},function(e){console.log(e),$(b).html(m).attr("disabled",!1),$(".main-content .clearfix").css({"pointer-events":""}),409==e.status||TOASTR.ERROR(e.responseJSON)})}Object.keys(t).forEach(e=>{e.indexOf("history.")>-1&&(q=e)}),q?MODAL.CONFIRMATION_W_FIELD({content:"Please provide a reason for updating this entry.",confirmCloseCondition:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",confirmCallback:function(e){t[q]+=`<br><br>Reason for update: ${e.bold()}`,W()},cancelCallback:function(){$("#submit").html("Submit").attr("disabled",!1)}}):W()}else{function j(){var a=`/api/dispatch/${CLIENT.id}/${USER.username}`,i="POST";t.origin_id=D,t.route=O,t.destination=C,t.vehicle_id=Number(w),t.trailer=N,t.vehicleData=u,t.comments=k,t.attachments=ATTACHMENTS.get(CLIENT.dsName),t.status=e,t.username=USER.username,t.version=VERSION,"wilcon"==CLIENT.id&&(t.ticket_number=I,t.driver_id=L,t.checker_id=R,t.helper_id=P,_&&(t.scheduled_date=new Date(_).toISOString()),y&&(t.shift_schedule=y),_&&!withinSchedule(_,y)&&"plan"!=e&&(e="scheduled",t.status=e));var n=!1;H.excludeKeys=["events_captured","vehicleData","username"],H.customChanges=[function(){var e=null;if(g||T)if(p){var t=!1;if(Object.keys(p.events_captured||{}).forEach(e=>{moment(Number(e)).format("HH:mm:ss")===moment(g.events[0].timestamp).format("HH:mm:ss")&&(t=!0)}),1==t)e=null;else{var a=DATETIME.FORMAT(g.events[0].timestamp);e=`Selected <u>${a}</u> check-in date & time.`,n=!0}}else e=null;else e=null;return e}],(t=HISTORY.check(p,t,USER.username,H)).selectedCheckIn=n;var s=!1;function o(){if($(".main-content .clearfix").css({"pointer-events":"none"}),$(b).html(`<i class="la la-spinner la-spin mr-2"></i>${h}`).attr("disabled",!0),!0===x?(a=`/api/dispatch/${CLIENT.id}/${USER.username}/${l}`,i="PUT"):"wilcon"!=CLIENT.id&&(t=$.extend(t,{_id:l})),!0===t.late_entry){var e=OBJECT.getKeyByValue(c,"in_transit"),n=getRoute(O),s=e?new Date(Number(e)):new Date,o=DATETIME.HH_MM(null,n.transit_time),r=o.hour,d=o.minute;t.departure_date=s.toISOString(),t.destination[0].etd=s.toISOString(),e||(t.events_captured[s.getTime()]="in_transit",t.events_captured=OBJECT.sortByKey(t.events_captured)),r&&s.setHours(s.getHours()+Number(r)),d&&s.setMinutes(s.getMinutes()+Number(d)),t.destination[0].eta=s.toISOString()}t.vehicleChanged=B,GET.AJAX({url:a,method:i,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(t)},function(e){if($("#confirm-modal,#overlay").remove(),1==e.ok){console.log(e);var t,a=!1;!0===clientCustom.autoGeneratedId&&(t=`<br>Shipment Number: <b>${e.sequence}</b>`,a=!0),"PUT"==i?TOASTR.UPDATEDSUCCESSFULLY():TOASTR.CREATEDSUCCESSFULLY(t,a),$(".main-content .clearfix").css({"pointer-events":""}),$("#overlay").remove()}else console.log(e.error),$(b).html(m).attr("disabled",!1),$(".main-content .clearfix").css({"pointer-events":""}),TOASTR.ERROR({statusText:"Shipment # already exists."},'<br><br><a id="toastr-link" href="javascript:void(0);">Click here to Load Existing Entry</a><br><br>or Tap anywhere to close',{timeOut:0,extendedTimeOut:0}),$("body").on("click","#toastr-link",function(e){e.stopImmediatePropagation();var t=$("#shipment_number").val()._trim();$("#overlay").remove(),$("body").append(MODAL.CREATE.EMPTY("View Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({_id:t}),$("html, body,#modal").animate({scrollTop:0},"fast")})},function(e){console.log(e),$(b).html(m).attr("disabled",!1),$(".main-content .clearfix").css({"pointer-events":""}),409==e.status?(TOASTR.ERROR({statusText:"Shipment # already exists."},'<br><br><a id="toastr-link" href="javascript:void(0);">Click here to Load Existing Entry</a><br><br>or Tap anywhere to close',{timeOut:0,extendedTimeOut:0}),$("body").on("click","#toastr-link",function(e){e.stopImmediatePropagation();var t=$("#shipment_number").val()._trim();$("#overlay").remove(),$("body").append(MODAL.CREATE.EMPTY("View Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({_id:t}),$("html, body,#modal").animate({scrollTop:0},"fast")})):TOASTR.ERROR(e.responseJSON)})}Object.keys(t).forEach(e=>{e.indexOf("history.")>-1&&(s=e)}),p?p.route!=O||Number(p.vehicle_id)!=Number(w)||g||T?t.events_captured=c:t.events_captured=p.events_captured:t.events_captured=c,s&&!["plan"].includes(p.status)?MODAL.CONFIRMATION_W_FIELD({content:"Please provide a reason for updating this entry.",confirmCloseCondition:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",confirmCallback:function(e){t[s]+=`<br><br>Reason for update: ${e.bold()}`,o()},cancelCallback:function(){$("#submit").html("Submit").attr("disabled",!1)}}):o()}!0===clientCustom.autoGeneratedId?$("#shipment_number").css(F):l.isEmpty()||!a.test(l)?(G=!0,U.push("shipment_number")):$("#shipment_number").css(F),null==O||null!=O&&O.isEmpty()?U.push("route"):$("#route").css(F),null==w||null!=vehicle&&w.isEmpty()?U.push("vehicle"):$("#vehicle").next(".select2-container").find(".select2-selection").css(F),"wilcon"==CLIENT.id?(null==I||null!=I&&I.isEmpty()?U.push("ticket_number"):$("#ticket_number").css(F),null==L||null!=L&&L.isEmpty()?U.push("driver_id"):$("#driver_id").css(F),null==_||null!=_&&_.isEmpty()?U.push("scheduled_date"):$("#scheduled_date").css(F),null==y||null!=y&&y.isEmpty()?U.push("shift_schedule"):$("#shift_schedule").css(F)):null==N||null!=N&&N.isEmpty()?U.push("trailer"):$("#trailer").next(".select2-container").find(".select2-selection").css(F),$.each(U,function(e,t){$(`#${t}`).next(".select2-container").find(".select2-selection").length>0?$(`#${t}`).next(".select2-container").find(".select2-selection").css(Y):$(`#${t}`).css(Y),M=!0}),!0===G||!0===E?($("#error").html('<div class="alert alert-danger alert-dismissible mb-1 role="alert">\n                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                                    <span aria-hidden="true">×</span>\n                                                </button>\n                                                <i class="la la-times-circle"></i> Please fill all the required fields\n                                            </div>').show(),$("#modal").animate({scrollTop:0},"fast"),"wilcon"!=CLIENT.id&&(a.test(l)||$("#error").append(ALERT.HTML.ERROR("Invalid shipment number indicated. Field should contain eight (8) numerical digit.","mb-1")))):!0===M?MODAL.CONFIRMATION({content:'You have not filled in all of the required fields. This will be saved as <span class="text-info font-bold">PLAN</span><sup style="font-size: 8px;">**</sup> instead. Do you wish to proceed?<span style="font-size: 9px;margin-left: 15px;font-style: italic;" class="d-block text-left mt-5">**Shipments with status <span class="text-info font-bold">PLAN</span> will be ignored during event process.</span>',confirmCloseCondition:!0,confirmButtonText:"Proceed",confirmBGStyle:"background-color:#64b03a;",confirmCallback:function(){e="plan",j(),$("#confirm-modal").remove()}}):(console.log("HIIII"),A().then(()=>{console.log("HEY"),t.late_entry=v,d&&(r=d),r&&"plan"!=r&&(e=r),j()}).catch(e=>{console.log(e)}))}})}()},status:function(e){if($("html, body").animate({scrollTop:0},"fast"),null!=e){var t=LIST.dispatch.find(t=>t._id.toString()==e.toString());if(t){t.destination[0]=t.destination[0]||{};var a,i,n=function(e){var a=!0;return Object.keys(e).forEach(i=>{e[i].forEach(e=>{var n=t[e];Array.isArray(t[i])?n=t[i][0][e]:"object"==typeof t[i]&&null!==t[i]&&(n=t[i][e]),n&&(n=n.toString()||"").toString()||(a=!1)})}),a};if(a=n({main:["origin_id","route","departure_date","vehicle_id"],destination:["location_id","eta","etd"]}),i=n({main:["origin_id","route","vehicle_id"],destination:["location_id"]}),$("[status]").removeClass("active disabled").addClass("inactive"),$(`[status="${t.status}"]`).removeClass("inactive").addClass("active"),!0===a||!0===i){var s="[status=assigned]",l=function(e){var t=[];return e.forEach(e=>{t.push(`[status=${e}]`)}),t.join(",")};$("[status]").addClass("disabled"),["plan"].includes(t.status)?s=l([t.status,"assigned"]):["assigned"].includes(t.status)?s=l([t.status,"plan","queueingAtOrigin","processingAtOrigin","idlingAtOrigin","in_transit","incomplete"]):["queueingAtOrigin"].includes(t.status)?s=l([t.status,"plan","assigned","processingAtOrigin","idlingAtOrigin","in_transit","incomplete"]):["processingAtOrigin"].includes(t.status)?s=l([t.status,"plan","assigned","queueingAtOrigin","idlingAtOrigin","in_transit","incomplete"]):["idlingAtOrigin"].includes(t.status)?s=l([t.status,"plan","assigned","queueingAtOrigin","processingAtOrigin","in_transit","incomplete"]):["in_transit"].includes(t.status)?s=l([t.status,"plan","assigned","queueingAtOrigin","processingAtOrigin","idlingAtOrigin","onSite","complete","incomplete"]):["onSite"].includes(t.status)?s=l([t.status,"plan","assigned","queueingAtOrigin","processingAtOrigin","idlingAtOrigin","in_transit","returning","incomplete"]):["returning"].includes(t.status)?s=l([t.status,"plan","assigned","queueingAtOrigin","processingAtOrigin","idlingAtOrigin","in_transit","onSite","complete","incomplete"]):["incomplete"].includes(t.status)&&(s=l([t.status,"plan","assigned","queueingAtOrigin","processingAtOrigin","idlingAtOrigin","in_transit","onSite","returning","complete","incomplete"])),$(s).click(function(){var a=$(this).attr("status"),i=getRoute(t.route);"incomplete"==t.status&&a!=t.status?MODAL.CONFIRMATION_W_FIELD({content:`You are about to change the status of this entry from Incomplete to ${GET.STATUS(a).text}. Please indicate your reason/s below.`,confirmCloseCondition:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",confirmCallback:function(t){GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${e}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({status:a,i_c_reason:t||"",transit_time:i.transit_time,type:"statusUpdate"})},function(e){1==e.ok?($("#confirm-modal,#overlay").remove(),TOASTR.UPDATEDSUCCESSFULLY()):($("#confirm-modal").remove(),toastr.error("Something went wrong</br></br>Error Code - ec005/03"))})}}):MODAL.CONFIRMATION({content:"Are you sure you want to update the status?",confirmCloseCondition:!0,confirmCallback:function(){GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${e}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({status:a,transit_time:i.transit_time,type:"statusUpdate"})},function(e){1==e.ok?($("#confirm-modal,#overlay").remove(),TOASTR.UPDATEDSUCCESSFULLY()):($("#confirm-modal").remove(),toastr.error("Something went wrong</br></br>Error Code - ec005/03"))})}})}).removeClass("disabled")}else $("#incomplete-data").text("Unable to update status if shipment data is incomplete."),$("[status]").addClass("disabled"),$(`[status=${t.status}]`).removeClass("disabled")}else toastr.error("Something went wrong</br></br>Error Code - ec005/01")}else toastr.error("Something went wrong</br></br>Error Code - ec005/02")},history:function(e={}){var t="";const a=e.original,i=OBJECT.sortByKey(e),n={};if(Object.keys(i).reverse().forEach(function(t){n[t]=e[t]}),Object.keys(n).forEach(e=>{if(!["original","vehicle"].includes(e)){var a=DATETIME.FORMAT(new Date(Number(e)),"MMM D, YYYY, h:mm A"),i=n[e]||"-";if(i.indexOf("System - Status updated")>-1){var s=GET.TEXT_BETWEEN(i,"<status>","</status>")||GET.TEXT_BETWEEN(i,"'","'");t+=` <div class="pt-3">\n                                    <small class="text-muted">${a}</small>\n                                    <div>Status updated to ${GET.STATUS(s).html}</div>\n                                </div>`}else if(i.indexOf("Manual - Status updated")>-1){s=GET.TEXT_BETWEEN(i,"<status>","</status>")||GET.TEXT_BETWEEN(i,"'","'");var l=getUser(o=GET.TEXT_BETWEEN(i,"<username>","</username>"))||{};t+=` <div class="pt-3">\n                                    <small class="text-muted">${a}</small>\n                                    <div>Status manually updated to ${GET.STATUS(s).html} by ${l.name||o||"-"}.</div>\n                                </div>`}else{var o;s=GET.TEXT_BETWEEN(i,"<status>","</status>"),l=getUser(o=GET.TEXT_BETWEEN(i,"<username>","</username>"))||{};s&&(i=i.replace(`<status>${s}</status>`,GET.STATUS(s).html)),l.name&&(i=i.replace(`<username>${o}</username>`,l.name||o)),t+=` <div class="pt-3">\n                                    <small class="text-muted">${a}</small>\n                                    <div>${i}</div>\n                                </div>`}}}),a){var s=JSON.parse(a);console.log("_obj",s),t+=` <div class="pt-3">\n                            <small class="text-muted">${DATETIME.FORMAT(new Date(s.posting_date),"MMM D, YYYY, h:mm A")}</small>\n                            <div>Entry posted with status ${GET.STATUS(s.status).html}</div>\n                        </div>`}return t},import:function(){$("#download-template-btn").click(function(){function e(e){var t=document.getElementById("report-hidden"),a=XLSX.utils.table_to_book(t,{sheet:"Customer Report"}),i=new Blob([function(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),i=0;i<e.length;i++)a[i]=255&e.charCodeAt(i);return t}(XLSX.write(a,{bookType:"xlsx",type:"binary"}))],{type:"application/octet-stream"});return saveAs(i,`${e}.xlsx`)}"wilcon"==CLIENT.id&&(GGS.STATUS.SHIFT_SCHEDULE&&GGS.STATUS.VEHICLES&&GGS.STATUS.ROUTES?($("body").append(CUSTOM.IMPORT_TEMPLATE.wilcon()),e("Wilcon Import Template")):toastr.info("Data is still loading. Please try again in few seconds.")),"coket1"==CLIENT.id&&($("body").append(CUSTOM.IMPORT_TEMPLATE.coket1()),e("CokeT1 Import Template")),$("#report-hidden,#temp-link,[data-SheetName]").remove()});var e=["xls","xlsx","ods"];$(".dropify").dropify(),$(".dropify").change(function(){$("[success_count],[error_count]").html(0),$("[error_list],[warning_list]").html(""),$("#reportDL").hide()}),$("#import-btn").click(function(){$(this).html('<i class="la la-spinner la-spin mr-2"></i>Import').attr("disabled",!0),$(".dropify-wrapper").css("pointer-events","none"),function(t){var n=$(t).val().split(".").pop().toLowerCase();if(console.log(e,n),1==e.includes(n)){var s=new FileReader;s.onload=function(){var e=s.result,n=XLSX.read(e,{type:"binary"}),l=XLSX.utils.sheet_to_row_object_array(n.Sheets[n.SheetNames[0]],{defval:""}),o=[];$.each(l,function(e,t){var i=!1;a[CLIENT.id].forEach(t=>{l[e][t.name]&&(i=!0)}),!0===i&&o.push(l[e])}),console.log("finalRowObject",o),function(e,t){var n={},s={},l=e.length,o=[],r=[],d=[],c=e;if(e.length>0){var u=0;e.forEach((t,l)=>{var r=getGeofence(t.Origin,"short_name"),c=getGeofence(t.Destination,"short_name"),m=getRoute(t.Route),h=getVehicle(t["Truck Name"],"name"),b=(LIST.vehicle_personnel||[]).find(e=>e.name.toString()==t.Driver.toString()&&"Driver"==e.occupation),f=(LIST.vehicle_personnel||[]).find(e=>e.name.toString()==t.Checker.toString()&&"Checker"==e.occupation),v=(LIST.vehicle_personnel||[]).find(e=>e.name.toString()==t.Helper.toString()&&"Helper"==e.occupation),E=DATETIME.FORMAT((e=>{const t=new Date(1899,11,31).getTime(),a=86400*e*1e3+(t-864e5);return isNaN(a)?null:a})(t["Scheduled Date"]),"MM/DD/YYYY"),g=getShiftSchedule(t["Shift Schedule"]),T=!1;function _(e){var t=!1,a=moment(E,"MM/DD/YYYY",!0);if(console.log(a.isValid(),E,e),a.isValid()){var i=new Date(E).toISOString();Object.keys(e).forEach(a=>{var n=e[a]||[];n.includes(i)&&(t=!0)})}return t}_((b||{}).dates||{})&&(b=null),_((f||{}).dates||{})&&(f=null),_((v||{}).dates||{})&&(v=null);var y={origin_id:"",route:"",destination:[{}],vehicle_id:0,username:USER.username,status:"assigned",posting_date:(new Date).toISOString(),late_entry:!1,driver_id:"",checker_id:"",helper_id:"",events_captured:{}},S=function(e,a,i,l,o){if(i=i||Number(t.__rowNum__)+1,"error"==l){var r=a?`<ul level=2><li>${a.join("</li><li>")}</li></ul>`:"";n[i]?n[i].push(e+r):n[i]=[e+r],T=!0}if("warning"==l){var r=a?`<ul level=2><li>${a.join("</li><li>")}</li></ul>`:"";e=!0===o?`<small class="text-muted">[FIELD NOT SAVED]</small> ${e}`:e,s[i]?s[i].push(e+r):s[i]=[e+r]}y.status="plan"};(t[i]||t.__rowNum__).toString()._trim()?(a[CLIENT.id].forEach(e=>{t[e.name].toString()._trim()?e.key?y[e.key]=t[e.name].toString()._trim():function(e,a){if("Origin"==e)if(r){if(y.origin_id=r._id,y.origin_id&&y.destination[0].location_id){var n=LIST.routes.find(e=>e.origin_id==r._id&&c&&e.destination_id==c._id);n?y.route=n._id:S("Invalid data in 'Route'.  Possible causes:",["The origin and destination is not a valid route."],t[i],"warning",!0)}}else S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0);if("Destination"==e)if(c){if(y.destination[0].location_id=c._id,y.origin_id&&y.destination[0].location_id){var n=LIST.routes.find(e=>e.origin_id==r._id&&c&&e.destination_id==c._id);n?y.route=n._id:S("Invalid data in 'Route'.  Possible causes:",["The origin and destination is not a valid route."],t[i],"warning",!0)}}else S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0);"Route"==e&&(m?(y.route=m._id,y.origin_id=m.origin_id,y.destination[0].location_id=m.destination_id,r=getGeofence(m.origin_id),c=getGeofence(m.destination_id)):S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0));"Truck Name"==e&&(h?y.vehicle_id=h._id:S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0));"Driver"==e&&(b?y.driver_id=b._id:S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0));"Checker"==e&&(f?y.checker_id=f._id:S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0));"Helper"==e&&(v?y.helper_id=v._id:S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"warning",!0));function s(){var e=(g._id||"").split(" - "),t=e[0],a=e[1],i=moment(t,"h:mm A"),n=moment(a,"h:mm A"),s=i.isBefore(n)?o:moment(new Date(o)).add(1,"day").format("MM/DD/YYYY");return`${s}, ${a}`}if("Scheduled Date"==e){var l=moment(E,"MM/DD/YYYY",!0),o=l.format("MM/DD/YYYY");l.isValid()?"plan"!=y.status&&g&&(moment(s(),"MM/DD/YYYY, hh:mm A",!0).isBefore()||moment(s(),"MM/DD/YYYY, h:mm A",!0).isBefore()?S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"error",!0):(y.scheduled_date=new Date(E).toISOString(),withinSchedule(E,g._id)?y.status="assigned":y.status="scheduled")):S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"error",!0)}if("Shift Schedule"==e)if(g){var l=moment(E,"MM/DD/YYYY",!0),o=l.format("MM/DD/YYYY");"plan"!=y.status&&l.isValid()&&(moment(s(),"MM/DD/YYYY, hh:mm A",!0).isBefore()||moment(s(),"MM/DD/YYYY, h:mm A",!0).isBefore()?S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"error",!0):(y.shift_schedule=g._id,withinSchedule(E,g._id)?y.status="assigned":y.status="scheduled"))}else S(`Invalid data in '${e}'.  Possible causes:`,a,t[i],"error",!0)}(e.name,e.error):!0===e.required?S(`Missing data in '${e.name}'. `,null,t[i],"warning"):e.codependent&&(t[e.codependent]?S(`Missing data in '${e.name}'. `,null,t[i],"warning"):y[e.key]="")}),new Promise((e,a)=>{if(console.log("scheduled_date",E),"wilcon"==CLIENT.id&&h&&b&&E&&g&&"-"!=E){var n=[{vehicle_id:Number(h._id)},{driver_id:b._id}];f&&n.push({checker_id:f._id}),v&&n.push({helper_id:v._id});var s={$and:[{$or:n},{scheduled_date:new Date(E).toISOString()},{shift_schedule:g._id},{status:{$nin:["plan","complete","incomplete"]}}]};$.ajax({url:`/api/dispatch/${CLIENT.id}/${USER.username}/vehicle_info/${JSON.stringify(s)}`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(a){if(console.log("docs",a),a.length>0){var n=[];a.forEach(e=>{e.vehicle_id==Number(h._id)&&n.push(`Truck is already assigned to shipment # ${e._id}.`),e.driver_id.toString()==b._id.toString()&&n.push(`Driver is already assigned to shipment # ${e._id}.`),f&&e.checker_id.toString()==f._id.toString()&&n.push(`Checker is already assigned to shipment # ${e._id}.`),v&&e.helper_id.toString()==v._id.toString()&&n.push(`Helper is already assigned to shipment # ${e._id}.`)}),n.length>0&&S(`<b>Error:</b><br><ul level=2><li>${n.join("</li><li>")}</li></ul>`,null,t[i],"error")}e()})}else e()}).then(function(){new Promise((e,t)=>{["plan","scheduled"].includes(y.status)?e():function a(i){i=i||0,console.log(USER.apiKey),GET.AJAX({url:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/applications/${CLIENT.appId}/geofences/${r.geofence_id}/users?FromIndex=0&PageSize=500`,method:"GET",headers:{Authorization:USER.apiKey}},function(a){var i;console.log("Vehicles:",a),y.late_entry=!0,a.forEach(e=>{e.username==h.username&&(y.late_entry=!1)}),i=y.late_entry,GET.AJAX({url:`/api/vehicles_history/${CLIENT.id}/${USER.username}/${h._id}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(a){if(a.length>0){var n=null,s=c.short_name,l=r.short_name,o=a[0],d=o.location||[],u=function(e,t,a){var i=null;return t.forEach(t=>{"or"!=a||i||(i=e.indexOf(t)>-1),"and"!=a||null!=i&&1!=i||(i=e.indexOf(t)>-1)}),i},p=function(e,t){for(var a="assigned",n=!1,s=(new Date).getTime(),l=e.length-1;l>=0;l--){var o=e[l],r=new Date(o.timestamp).getTime(),d=Math.abs(s-r)/36e5;("Inside Geofence"==o.RULE_NAME&&"end"==o.stage||"Outside Geofence"==o.RULE_NAME&&"start"==o.stage)&&1==i&&"in_transit"!=a&&d<24&&(n=!0,a="in_transit",y.events_captured[r]="in_transit",s=new Date(o.timestamp).getTime()),u(o.RULE_NAME,["Inside","Idle"],"and")&&!y.events_captured[r]&&d<24&&(n=!0,y.events_captured[r]="idlingAtOrigin"),u(o.RULE_NAME,["Inside Geofence","Processing"],"and")&&!y.events_captured[r]&&d<24&&(n=!0,y.events_captured[r]="processingAtOrigin"),u(o.RULE_NAME,["Inside Geofence","Queueing"],"and")&&!y.events_captured[r]&&d<24&&(n=!0,y.events_captured[r]="queueingAtOrigin"),!y.events_captured[r]&&d<24&&(y.events_captured[r]="tempStatus")}1!=i||OBJECT.getKeyByValue(y.events_captured,"in_transit")||(y.events_captured[(new Date).getTime()]="in_transit");var c,p=OBJECT.sortByKey(y.events_captured),l=0;if(Object.keys(p).forEach(e=>{0==l&&(l++,"in_transit"!=p[e]&&(p[e]="entered_origin")),c=e}),Object.keys(p).forEach(e=>{"tempStatus"==p[e]&&delete p[e]}),y.events_captured=p,"entered_origin"==(a=p[c])&&(a="assigned"),1==i){var m=OBJECT.getKeyByValue(y.events_captured,"in_transit");a="in_transit",t.forEach(e=>{var t=new Date(e.timestamp).getTime(),i=Math.abs(s-t)/36e5;"start"==e.stage&&!m&&i<24&&(n=!0,y.events_captured[t]="in_transit"),clientCustom.roundtrip?("Inside Geofence"==e.RULE_NAME&&"end"==e.stage||"Outside Geofence"==e.RULE_NAME&&"start"==e.stage||"in_transit"!=a||y.events_captured[t]||(a="onSite",n=!0,y.events_captured[t]="onSite"),("Inside Geofence"==e.RULE_NAME&&"end"==e.stage||"Outside Geofence"==e.RULE_NAME&&"start"==e.stage)&&"onSite"==a&&!y.events_captured[t]&&(a="returning",n=!0,y.events_captured[t]="returning")):"in_transit"==a&&!y.events_captured[t]&&Number(m)<t&&i<24&&(a="complete",n=!0,y.events_captured[t]="complete")})}return n?a:null};if(i){for(var m=d.length-1;m>=0;m--){if(d[m].short_name==l){y.late_entry=!0,n=p(d[m].events,[]);break}if(d[m].short_name==s){for(var h=d.slice(0,m),b=!1,f=h.length-1;f>=0&&h[f].short_name!=s;f--)if(h[f].short_name==l){y.late_entry=!0,n=p(h[f].events,d[m].events),b=!0;break}b||(y.late_entry=!1,n="assigned");break}}null==n&&(console.log("__tempStat is null"),n="assigned",y.late_entry=!1)}else d[d.length-1].short_name==l&&(n=p(d[d.length-1].events)),null==n&&(n="assigned",y.late_entry=!1,console.log("__tempStat is null but vehicle is inside origin."));var v=OBJECT.sortByKey(y.events_captured);y.events_captured=v,y.status=n,console.log("EYOOOEOEOEOOEOEO",i,n,y.events_captured),e()}else t({message:"Truck selected does not exist."})})},function(e){0==e.status&&i<MAX_TRIES&&a(++i),TOASTR.ERROR(e)})}()}).then(function(){console.log("importData",d);var a=[];d.forEach(e=>{"plan"!=e.status&&e.scheduled_date==y.scheduled_date&&e.shift_schedule==y.shift_schedule&&(Number(e.vehicle_id)==Number(y.vehicle_id)&&a.push(`Truck is already assigned to ROW #: ${Number(e.__rowNum__)+1}.`),y.driver_id&&(e.driver_id||"").toString()==(y.driver_id||"").toString()&&a.push(`Driver is already assigned to ROW #: ${Number(e.__rowNum__)+1}.`),y.checker_id&&(e.checker_id||"").toString()==(y.checker_id||"").toString()&&a.push(`Checker is already assigned to ROW #: ${Number(e.__rowNum__)+1}.`),y.helper_id&&(e.helper_id||"").toString()==(y.helper_id||"").toString()&&a.push(`Helper is already assigned to ROW #: ${Number(e.__rowNum__)+1}.`))}),a.length>0&&S(`<b>Error:</b><br><ul level=2><li>${a.join("</li><li>")}</li></ul>`,null,t[i],"error"),"plan"==y.status&&S('Incomplete data. Shipment is saved as <b style="color: #5bc0de;">PLAN</b>.',null,t[i],"warning"),!1===T&&(o.push(y._id),y.__rowNum__=t.__rowNum__,d.push(y)),++u==e.length&&p()})})):S(`Missing data in '${i}'.`,null,t[i],"error")})}else n["--"]=["Empty columns"],p();function p(){GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/batch/${JSON.stringify(o)}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(e){function a(e){Object.keys(n).forEach(e=>{s[e]&&delete s[e]}),toastr.info("Done. Please check the report for import details."),$("[success_count]").html(e),$("[error_count]").html(Object.keys(n).length);var a=Object.keys(n).length>0?"":"--",o=Object.keys(s).length>0?"":"--",r=/(<([^>]+)>)|(&lt;([^>]+)&gt;)/gi,d=function(){return"----------------------------------------------------------------------------------"},c=`Report Import:\n\n${d()}\nFilename: ${t}\nDate and time: ${DATETIME.FORMAT(new Date)}\nTotal # of Rows: ${l} rows\n${d()}\nSuccessful imports: ${e} rows\nWarnings:`,u=function(e){for(var t="",a=0;a<e;a++)t+=" ";return t},p=function(e,t){$("body").append(`<ul ${e} style="display:none;">${$(`[${t}]`).html()}</ul>`);var a=$(`[${e}] sn`);a.each((e,t)=>{var a=$(t).text();$(t).html(`${u(3)}_BIGBULLET_ ${a}`)});var i=$(`[${e}] ul[level=2]`);i.each((e,t)=>{var a=$(t).html(),i=a.replace(/<li>/g,`\n${u(12)}_SMALLBULLET_ `).replace(/<\/li>/g,"");$(t).html(i)});var n=$(`[${e}] ul[level=1]`);n.each((e,t)=>{var a=$(t).html(),i=a.replace(/<li>/g,`${u(7)}_DASH_ `).replace(/<\/li>/g,"\n ");$(t).html(i)});var s=$(`[${e}]`).html().replace(r,"").replace(/^\s*[\r\n]/gm,"")._trim().replace(/&nbsp;/g," ").replace(/_BIGBULLET_/g,"•").replace(/_SMALLBULLET_/g,"∙").replace(/_DASH_/g,"-");c+=`\n${s}`};Object.keys(s).forEach(e=>{o+=`<li>\n                                                    <sn><span class="text-muted">${i||"Row #"}: </span><b>${e}</b></sn>\n                                                    <ul level=1><li>${s[e].join("</li><li>")}</li></ul>\n                                                </li>`}),$("[warning_list]").html(o),p("warning_note","warning_list"),c+=`\n${d()}\nUnsuccessful imports: ${Object.keys(n).length} rows\nErrors:`,Object.keys(n).forEach(e=>{a+=`<li>\n                                                <sn><span class="text-muted">${i||"Row #"}: </span><b>${e}</b></sn>\n                                                <ul level=1><li>${n[e].join("</li><li>")}</li></ul>\n                                            </li>`}),$("[error_list]").html(a),p("error_note","error_list"),c+=`\n${d()}`,$("[warning_note],[error_note]").remove(),$("#import-btn").html("Import").attr("disabled",!1),$(".dropify-wrapper").css("pointer-events",""),$(".dropify-clear").click(),$("#reportDL").attr("href",`data:text/plain;charset=UTF-8,${encodeURIComponent(c)}`).show()}e.forEach(e=>{!function(e,t,a,i,l){"error"==i&&(n[a]?n[a].push(e):n[a]=[e]);if("warning"==i){var o=t?`<ul level=2><li>${t.join("</li><li>")}</li></ul>`:"";e=!0===l?`<small class="text-muted">[FIELD NOT SAVED]</small> ${e}`:e,s[a]?s[a].push(e+o):s[a]=[e+o]}}("Shipment number already exists",null,e._id,"error"),d=$.grep(d,function(t){return t._id!=e._id})}),d.forEach(e=>{r.push(e)}),console.log("Temp Final:",c),console.log("Error List:",n),console.log("Batched Data:",r),r.length>0?GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/batch`,method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({batchedData:r})},function(e){e.error?(console.log(e.error),r.forEach(t=>{409==e.error.status?n[t._id||t.ticket_number]=["Record already exists."]:n[t._id||t.ticket_number]=[e.error.statusText]}),a(0)):a(r.length)},function(e){console.log(e),r.forEach(t=>{409==e.status?n[t._id||t.ticket_number]=["Record already exists."]:n[t._id||t.ticket_number]=[e.statusText]}),a(0)}):a(0)})}}(o,$(t)[0].files[0].name)},$(t)[0].files.length>0?s.readAsBinaryString($(t)[0].files[0]):console.log("No file selected.")}else toastr.error(`Only ${e.join(", ")} files are allowed.`),$("#import-btn").html("Import").attr("disabled",!1),$(".dropify-wrapper").css("pointer-events",""),$(".dropify-clear").click()}(".dropify")});var t=Object.keys(vehiclePersonnelCalendarOptions).map(e=>vehiclePersonnelCalendarOptions[e].label).join("/"),a={coket1:[{name:"Shipment Number",key:"_id",required:!0,identifier:!0},{name:"Origin",required:!0,error:["Origin does not exist in database."]},{name:"Destination",required:!0,error:["Destination does not exist in database."]},{name:"Truck Name",required:!0,error:["Truck Name does not exist in database."]},{name:"Comments",key:"comments",required:!1}],wilcon:[{name:"Scheduled Date",required:!0,codependent:"Shift Schedule",error:["Scheduled Date entered is not a valid date.","Scheduled Date is before current date/time."]},{name:"Shift Schedule",required:!0,codependent:"Scheduled Date",error:["Shift Schedule is before current date/time.","Shift Schedule does not exist in database."]},{name:"Ticket Number",key:"ticket_number",required:!0},{name:"Route",required:!0,error:["Route does not exist in database."]},{name:"Truck Name",required:!0,error:["Truck Name does not exist in database."]},{name:"Driver",required:!0,error:["Driver's Name does not exist in database.","Selected Driver is on "+t+"."]},{name:"Checker",error:["Checker's Name does not exist in database.","Selected Checker is on "+t+"."]},{name:"Helper",error:["Helper's Name does not exist in database.","Selected Helper is on "+t+"."]},{name:"Comments",key:"comments",required:!1}]},i=(a[CLIENT.id].find(e=>!0===e.identifier)||{}).name},add_row:{destination:function(e,t,a,i){var n=GENERATE.RANDOM(36),s=getGeofence(t.location_id)||{},l=getRoute(a)||{},o=DATETIME.HH_MM(null,l.transit_time),r=DATETIME.HH_MM(null,s.cico),d=`<tr _row="${n}">\n                                <td class="text-muted">${e}</td>\n                                <td><input location type="text" class="form-control" autocomplete="off" readonly></td>\n                                <td transit_time>${o.hour||'<span class="text-muted">HH</span>'} : ${o.minute||'<span class="text-muted">MM</span>'}</td>\n                                <td cico>${r.hour||'<span class="text-muted">HH</span>'} : ${r.minute||'<span class="text-muted">MM</span>'}</td>\n                            </tr>`;return $("#tbl-destination tbody").append(d),n}},monitoring_deleted:function(){var e="wilcon"==CLIENT.id?"dispatch_mod2_deleted":"dispatch_deleted",t=new URLSearchParams(window.location.search),a=CRYPTO.DECRYPT(t.get("data")),i="#tbl-dispatch_deleted",n="user_action",s=USER.filters.dispatch_deleted||{},l=null,o=!1,r=!1,d=function(e){var t=new Dispatch(e,i).row();return t["Deleted By"]=e.deleted_by||"-",t["Deleted Date"]=DATETIME.FORMAT(e.deleted_date),TABLE.COL_ROW(null,t).row},c=function(t,a,o,m){o||(LIST[n]=[]),s=m||USER.filters.dispatch_deleted||{};try{s=JSON.parse(s)}catch(e){}var h=$.isEmptyObject(s)?{timestamp:FILTER.DATERANGE()}:s;h.collection="dispatch";var b=TABLE.BUTTONS({goto:PAGE.GET(),loadView:["create","create-admin","import"],actions:{refresh:function(){c(null)},column:function(){$("#export-container").hide("slide",{direction:"right"},100),$("#filter-container").hide("slide",{direction:"right"},100),$("#cv-container").toggle("slide",{direction:"right"},100)},filter:function(){$("#export-container").hide("slide",{direction:"right"},100),$("#cv-container").hide("slide",{direction:"right"},100),$("#filter-container").toggle("slide",{direction:"right"},100)},export:function(){$("#filter-container").hide("slide",{direction:"right"},100),$("#cv-container").hide("slide",{direction:"right"},100),$("#export-container").toggle("slide",{direction:"right"},100)}}});r=!1,l&&!a&&(l.clear().draw(),$(".dataTables_empty").text("Loading...")),GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(h)}/count`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(a){var s=1,o=1,c=0,m=0;console.log("count",a),TABLE.POPULATE({url:`${n}/${CLIENT.id}/${USER.username}/all`,goto:PAGE.GET(),commentTitle:"Dispatch Entry (Deleted)",withFilter:!0,filter:h,urlPath:n,withPagination:!0,newlyLoaded:t,dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN[e]).column,createdRow:function(e,t,a){var s=t._row,l=t._id;$(e).attr("_row",t._row),TABLE.ROW_LISTENER({table_id:i,_row:s,urlPath:n,_id:l,additionalListeners:function(){$(i).on("click",`[_row="${s}"] [view],[_row="${s}"] + tr.child [view]`,function(e){e.stopImmediatePropagation(),$("body").append(modalViews.dispatch.fullView(t._id)),$("html, body,#modal").animate({scrollTop:0},"fast")})}})},order:[[1,"desc"]],dom:'lB<"toolbar">frti<"tbl-progress-bar">p',buttons:b},table_id:i,initializeCallback:function(e,t){l=t,p(),u(),$(i).on("search.dt length.dt page.dt",function(){GGS.STATUS.REGIONS&&GGS.STATUS.CLUSTERS&&GGS.STATUS.GEOFENCES&&GGS.STATUS.VEHICLES&&GGS.STATUS.ROUTES&&(TABLE.FINISH_LOADING.UPDATE(),setTimeout(function(){TABLE.FINISH_LOADING.UPDATE()},300))}),$("div.tbl-progress-bar").html(LOADING.PROGRESSBAR.UI()).css({position:"absolute",left:"0px",bottom:"-6px",width:"160px",height:"20px"}),LOADING.PROGRESSBAR.INITIALIZE()},populateCallback:function(e){if($(i).length>0){r=!0,$("#search-btn").css({"pointer-events":"",color:""});var t=[];$.each(e,function(e,a){var i={};try{i=JSON.parse(a.data)}catch(e){}i.deleted_by=a.username,i.deleted_date=a.timestamp,t.push(d(i))}),l.rows.add(t).draw(!1),TABLE.FINISH_LOADING.START_CHECK(),$("div.tbl-progress-bar").show();var n=a/LIMIT,u=Math.floor(n);n%1>0&&u++,!c&&(c=100/u),m+=c,s=o,o=Math.floor(m),LOADING.PROGRESSBAR.MOVE(s,o)}}})})},u=function(){$(".page-box").append(SLIDER.COLUMN_VISIBILITY(CUSTOM.COLUMN[e])),$("span.toggle-vis").on("click",function(t){var a=$(this).attr("data-column"),n=l.column(a);n.visible(!n.visible()),CUSTOM.COLUMN[e][a].visible=n.visible(),CUSTOM.COLUMN[e][a].bVisible=n.visible(),$(i).attr("style",""),$(`${i} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${i} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})}),$(".page-box").append(SLIDER.EXPORT()),TABLE.TOOLBAR(l),$(".buttons-copy span").html("Copy Table"),$(".buttons-csv span").html("Export Table As CSV File"),$(".buttons-excel span").html("Export Table As Excel File"),$("#_timestamp,#_posting_date").daterangepicker({opens:"left",timePicker:!0,locale:{format:"MM/DD/YYYY hh:mm A"},autoUpdateInput:!1,autoApply:!0},function(e,t,a){FILTER.INITIALIZE($(this)[0].element,e,t,"MM/DD/YYYY hh:mm A"),$(".clearable").trigger("input")}).on("apply.daterangepicker",function(e,t){FILTER.INITIALIZE($(this),t.startDate,t.endDate,"MM/DD/YYYY hh:mm A"),$(".clearable").trigger("input")}),s.timestamp&&FILTER.INITIALIZE("#_timestamp",s.timestamp.$gte,s.timestamp.$lt,"MM/DD/YYYY hh:mm A"),s.posting_date&&FILTER.INITIALIZE("#_posting_date",s.posting_date.$gte,s.posting_date.$lt,"MM/DD/YYYY hh:mm A"),(s.timestamp||s.posting_date)&&($("#filter-container").toggle("slide",{direction:"right"},100),$(".clearable").trigger("input"),FILTER.STATUS="new"),FILTER.RESET({dateEl:"#_timestamp",dateElnoVal:"#_posting_date",urlPath:"dispatch_deleted",populateTable:c}),$("#filter-btn").click(function(){s={};var e=$("#_posting_date").val()||"",t=e?$("#_timestamp").val():$("#_timestamp").val()||DEFAULT_DATE;!t.isEmpty()&&(s.timestamp=FILTER.DATERANGE(t,!0,!0)),!e.isEmpty()&&(s.posting_date=FILTER.DATERANGE(e,!0,!0)),"reset"!=FILTER.STATUS||(FILTER.STATUS="new"),USER.filters.dispatch_deleted=s,GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({"filter.dispatch":JSON.stringify(s)})},function(e){console.log("docs",e)}),$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),c()})},p=function(){var e=null,t=null;l.on("search.dt",function(){0===l.page.info().recordsDisplay&&l.search()?!0===r&&($("#search-alert").html().isEmpty()?($("#search-alert").html(ALERT.HTML.INFO(`<span id="alert-message">Click <u id="search-btn" style="cursor: pointer;">here</u> to search for Shipment Number: <b id="search-text">${l.search()}</b> through all records.</span><span id="no-result-message" style="display:none;"></span>`,"m-3",!0)).show(),$("#search-btn").click(function(){$("#search-btn").css({"pointer-events":"none",color:"#aaadae"}),e=l.search(),t=s,s={unique_filter:`_id: ${l.search()}`},c(null,!0,!0,s)})):e===l.search()?($("#alert-message").hide(),$("#no-result-message").html(`No result for Shipment Number: <b id="search-text">${e}</b>.`).show(),e=null):($("#alert-message").hide().show(),$("#no-result-message").html("").hide(),$("#search-text").html(l.search()))):($("#search-alert").html("").hide(),t&&(s=t,t=null))})};a.for=n;try{s=JSON.parse(s)}catch(e){}LIST[n]=[],c(!0),TABLE.FINISH_LOADING.CHECK=function(){GGS.STATUS.REGIONS&&GGS.STATUS.CLUSTERS&&GGS.STATUS.GEOFENCES&&GGS.STATUS.VEHICLES&&GGS.STATUS.TRAILERS&&GGS.STATUS.ROUTES&&!o&&l&&("wilcon"!=CLIENT.id||"wilcon"==CLIENT.id&&GGS.STATUS.VEHICLE_PERSONNEL)&&(o=!0,$.each(LIST.dispatch,function(e,t){var a=l.row(`[_row="${t._row}"]`).node();a&&l.row(a).data(d(t))}),TABLE.FINISH_LOADING.UPDATE())},TABLE.FINISH_LOADING.START_CHECK()}}},SHIFT_SCHEDULE={FUNCTION:{init:function(){var e="shift_schedule",t=!1,a=new Table({id:"#tbl-shift_schedule",urlPath:e,goto:"shift_schedule",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.shift_schedule).column,createdRow:function(e,t,i){var n=t._row;$(e).attr("_row",n),a.rowListeners(n,t._id)},dom:'lB<"toolbar">frti<"tbl-progress-bar">p'},initializeCallback:function(){TABLE.WATCH({urlPath:e,rowData:a.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),TABLE.FINISH_LOADING.UPDATE()}});a.setButtons({loadView:["create"],actions:{create:function(){i({url:`/api/${e}/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){a.countRows()}}}),a.addRow=function(e){var t=TABLE.ROW_BUTTONS(PAGE.GET());return $(`${a.id} th:last-child`).css({"min-width":t.width,width:t.width}),TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Action:t.buttons}).row},a.rowListeners=function(t,n){TABLE.ROW_LISTENER({table_id:a.id,_row:t,urlPath:e,_id:n,initializeModal:i})};var i=function(e){var t="PUT"==e.method?"Edit Shift Schedule":"Create Shift Schedule";$("body").append(MODAL.CREATE.BASIC({title:t,el:function(e){e=e||{};var t=[{id:"12:00 AM"},{id:"1:00 AM"},{id:"2:00 AM"},{id:"3:00 AM"},{id:"4:00 AM"},{id:"5:00 AM"},{id:"6:00 AM"},{id:"7:00 AM"},{id:"8:00 AM"},{id:"9:00 AM"},{id:"10:00 AM"},{id:"11:00 AM"},{id:"12:00 PM"},{id:"1:00 PM"},{id:"2:00 PM"},{id:"3:00 PM"},{id:"4:00 PM"},{id:"5:00 PM"},{id:"6:00 PM"},{id:"7:00 PM"},{id:"8:00 PM"},{id:"9:00 PM"},{id:"10:00 PM"},{id:"11:00 PM"}];return[{title:"Start of Shift",id:"start_shift",type:"select",options:t,attr:"doNotSave=true"},{title:"End of Shift",id:"end_shift",type:"select",options:t,attr:"doNotSave=true"},{id:"_id",type:"text"}]}(e.obj)})),$("#_id").parent().hide(),$("#start_shift").change(function(){$("#start_shift").val()&&$("#end_shift").val()&&$("#_id").val(`${$("#start_shift option:selected").val()} - ${$("#end_shift option:selected").val()}`)}),$("#end_shift").change(function(){$("#start_shift").val()&&$("#end_shift").val()&&$("#_id").val(`${$("#start_shift option:selected").val()} - ${$("#end_shift option:selected").val()}`)}),MODAL.SUBMIT(e)};LIST[e]=LIST[e]||[],TABLE.FINISH_LOADING.CHECK=function(){GGS.STATUS.SHIFT_SCHEDULE&&(t||(t=!0,a.initialize(),a.populateRows(LIST[e]),a.hideProgressBar()))},TABLE.FINISH_LOADING.START_CHECK()}}},REPORTS={UI:{REPORT_MODAL_01:function(e,t){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12">\n                                            <small><span class="text-danger">*</span>Select Departure Date Range:</small>\n                                            <input id="daterange" type="input" class="form-control">\n                                        </div>\n                                        <div class="col-sm-12">\n                                            <small>${t}:</small>\n                                            <select id="_site" class="select-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-12"> \n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORT_MODAL_02:function(e,t,a){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12">\n                                            <small><span class="text-danger">*</span>${a||"Select Departure Date"}:</small>\n                                            <input id="daterange" type="input" class="form-control">\n                                        </div>\n                                        <div class="col-sm-12">\n                                            <small>${t}:</small>\n                                            <select id="_site" class="select-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-12"> \n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORT_MODAL_03:function(e){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12">\n                                            <small><span class="text-danger">*</span>Select Date:</small>\n                                            <input id="daterange" type="input" class="form-control">\n                                        </div>\n                                        <div class="col-sm-12"> \n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORT_MODAL_04:function(e,t,a){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12">\n                                            <small><span class="text-danger">*</span>Select Date:</small>\n                                            <input id="daterange" type="input" class="form-control">\n                                        </div>\n                                        <div class="col-sm-12">\n                                            <small>Plant Site:</small>\n                                            <select id="_origin_site" class="select-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-12">\n                                            <small>Destination Site:</small>\n                                            <select id="_destination_site" class="select-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-12"> \n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORT_MODAL_05:function(e,t="Select Date Range"){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12">\n                                            <small><span class="text-danger">*</span>Select Date Range:</small>\n                                            <input id="daterange" type="input" class="form-control">\n                                        </div>\n                                        <div class="col-sm-12"> \n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORT_MODAL_06:function(e,t="Select Date Range"){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12"> \n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORT_MODAL_07:function(e){for(var t="",a=2020;a<Number(moment().format("YYYY"))+1;a++)t+=`<option>${a}</option>`;return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12"> \n                                            <select id="_month" class="form-control" style="width: 49%;display: inline-block;">\n                                                <option value="01">January</option>\n                                                <option value="02">February</option>\n                                                <option value="03">March</option>\n                                                <option value="04">April</option>\n                                                <option value="05">May</option>\n                                                <option value="06">June</option>\n                                                <option value="07">July</option>\n                                                <option value="08">August</option>\n                                                <option value="09">September</option>\n                                                <option value="10">October</option>\n                                                <option value="11">November</option>\n                                                <option value="12">December</option>\n                                            </select>\n                                            <select id="_year" class="form-control" style="width: 49%;display: inline-block;">${t}</select>\n                                            <button id="generate-btn" type="button" class="btn btn-primary col-sm-12 mt-4">Generate report</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},REPORTS:{CICOR:function(e,t,a,i,n){var s="",l={},o={in_site:0,over_cico:0,w_in_cico:0,count_time_lapse:0,sum_time_lapse:0,count_cico:0,sum_cico:0},r="",d="",c="border:2px solid black;mso-number-format:'@';",u=clientCustom.reports.cicor||[];return u.forEach(e=>{switch(e){case"origin":r+='<td style="background-color:black;color:white;">Origin (Plant)</td>';break;case"destination":r+='<td style="background-color:black;color:white;">Destination (DC)</td>';break;case"route":r+='<td style="background-color:black;color:white;">Route</td>';break;case"sn":r+='<td style="background-color:black;color:white;">SN</td>';break;case"plateNumber":r+='<td style="background-color:black;color:white;">Plate No.</td>';break;case"trailer":r+='<td style="background-color:black;color:white;">Trailer</td>';break;case"palCap":r+='<td style="background-color:black;color:white;">Pal Cap</td>';break;case"haulerName":r+='<td style="background-color:black;color:white;">Hauler Name</td>';break;case"targetCico":r+='<td style="background-color:black;color:white;">Target CICO (hrs)</td>';break;case"actualTimelapse":r+='<td style="background-color:black;color:white;">Actual Time Lapse (hrs)</td>';break;case"remarks1":r+='<td style="background-color:black;color:white;">Remarks1</td>';break;case"remarks2":r+='<td style="background-color:black;color:white;">Remarks2</td>';break;case"truckBasePlant":r+='<td style="background-color:black;color:white;">Truck Base Plant</td>'}}),t.forEach(function(e,t){e.destination[0]=e.destination[0]||{};var a,i,n="",s=getGeofence(e.origin_id)||{},o=getGeofence(e.destination[0].location_id)||{},r=getVehicle(e.vehicle_id)||{},p=`${s.short_name}_${o.short_name}`,m="w/in CICO Time",h=getDateTime("entered_origin",e)||getDateTime("queueingAtOrigin",e)||getDateTime("processingAtOrigin",e)||getDateTime("idlingAtOrigin",e);a=(h?getDateTime("in_transit",e,"last")-h:0)||0,i=Number(DATETIME.DH(a,null,"0")),l[p]?(l[p].in_site++,null!=i&&(l[p].sum_time_lapse=l[p].sum_time_lapse||0,l[p].count_time_lapse++,l[p].sum_time_lapse+=i)):l[p]={destination:o.short_name,origin:s.short_name,in_site:1,over_cico:0,w_in_cico:0,sum_time_lapse:i,count_time_lapse:null!=i?1:0,cico_target:o.cico||0},null!=i&&(i>o.cico?(n="background-color:#ffc7ce;color:#9c0006",m="Over CICO Time",l[p].over_cico++):l[p].w_in_cico++),d+="<tr>",u.forEach(t=>{switch(t){case"destination":d+=`<td style="${c}">${o.short_name}</td>`;break;case"origin":d+=`<td style="${c}">${s.short_name}</td>`;break;case"route":d+=`<td style="${c}">${e.route}</td>`;break;case"sn":d+=`<td style="${c}">${e._id}</td>`;break;case"plateNumber":d+=`<td style="${c}">${r.name||""}</td>`;break;case"trailer":d+=`<td style="${c}">${r.Trailer||""}</td>`;break;case"palCap":d+=`<td style="${c}">${r["Pal Cap"]||""}</td>`;break;case"haulerName":d+=`<td style="${c}"></td>`;break;case"targetCico":d+=`<td style="${c}">${DATETIME.HH_MM(null,o.cico).hour_minute}</td>`;break;case"actualTimelapse":d+=`<td style="${c}">${DATETIME.HH_MM(null,i).hour_minute}</td>`;break;case"remarks1":d+=`<td style="${c}">${e.remarks||""}</td>`;break;case"remarks2":d+=`<td style="${c}${n}">${m}</td>`;break;case"truckBasePlant":d+=`<td style="${c}">${r.Site||""}</td>`}}),d+="</tr>"}),Object.values(l).forEach(e=>{var t=e.sum_time_lapse/e.count_time_lapse;s+=`<tr>\n                                    <td style="${c}">${e.destination}</td>\n                                    <td style="${c}">${e.origin}</td>\n                                    <td style="${c}">${e.in_site}</td>\n                                    <td style="${c}">${e.over_cico}</td>\n                                    <td style="${c}">${e.w_in_cico}</td>\n                                    <td style="${c}">${DATETIME.HH_MM(null,t).hour_minute}</td>\n                                    <td style="${c}">${DATETIME.HH_MM(null,e.cico_target).hour_minute}</td>\n                                </tr>`,o.in_site+=e.in_site,o.over_cico+=e.over_cico,o.w_in_cico+=e.w_in_cico,o.count_cico++,o.sum_cico+=Number(e.cico_target),null!=e.sum_time_lapse&&(o.count_time_lapse++,o.sum_time_lapse+=e.sum_time_lapse)}),o.ave_time_lapse=o.sum_time_lapse/o.count_time_lapse,o.ave_cico=o.sum_cico/o.count_cico,console.log("summary_total",o),s+=`<tr>\n                                <td style="${c}font-weight: bold;" colspan=2>TOTAL</td>\n                                <td style="${c}font-weight: bold;">${o.in_site||0}</td>\n                                <td style="${c}font-weight: bold;">${o.over_cico||0}</td>\n                                <td style="${c}font-weight: bold;">${o.w_in_cico||0}</td>\n                                <td style="${c}font-weight: bold;">${DATETIME.HH_MM(null,o.ave_time_lapse).hour_minute}</td>\n                                <td style="${c}font-weight: bold;">${DATETIME.HH_MM(null,o.ave_cico).hour_minute}</td>\n                            </tr>`,`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="border: none;">Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border: none;"><b>Summary:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;">\n                                    <div>\n                                        <div>Plant Site: ${a}</div>\n                                        <div>Date from: ${moment(new Date(i)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>Date to: ${moment(new Date(n)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="background-color:black;color:white;">Destination (DC)</td>\n                                <td style="background-color:black;color:white;">Origin (Plant)</td>\n                                <td style="background-color:black;color:white;">In Site</td>\n                                <td style="background-color:#757070;color:white;">Over CICO</td>\n                                <td style="background-color:#757070;color:white;">W/in CICO</td>\n                                <td style="background-color:black;color:white;">Ave. Time Lapse (hrs)</td>\n                                <td style="background-color:black;color:white;">CICO Target (hrs)</td>\n                            </tr>\n                            ${s}\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border: none;"><b>Details:</b></td>\n                            </tr>\n                            <tr>${r}</tr>\n                            ${d}\n                        </table> `},OTR:function(e,t,a,i,n){var s="",l={},o={in_site:0,over_transit:0,w_in_transit:0,sum_time_lapse:0,count_time_lapse:0,count_transit:0,sum_transit:0},r="border:2px solid black;mso-number-format:'@';",d="",c="",u=clientCustom.reports.otr||[];return u.forEach(e=>{switch(e){case"origin":d+='<td style="background-color:black;color:white;">Origin (Plant)</td>';break;case"destination":d+='<td style="background-color:black;color:white;">Destination (DC)</td>';break;case"route":d+='<td style="background-color:black;color:white;">Route</td>';break;case"sn":d+='<td style="background-color:black;color:white;">SN</td>';break;case"plateNumber":d+='<td style="background-color:black;color:white;">Plate No.</td>';break;case"trailer":d+='<td style="background-color:black;color:white;">Trailer</td>';break;case"palCap":d+='<td style="background-color:black;color:white;">Pal Cap</td>';break;case"haulerName":d+='<td style="background-color:black;color:white;">Hauler Name</td>';break;case"targetTransit":d+='<td style="background-color:black;color:white;">Target Transit (hrs)</td>';break;case"actualTimelapse":d+='<td style="background-color:black;color:white;">Actual Time Lapse (hrs)</td>';break;case"remarks1":d+='<td style="background-color:black;color:white;">Remarks1</td>';break;case"remarks2":d+='<td style="background-color:black;color:white;">Remarks2</td>';break;case"truckBasePlant":d+='<td style="background-color:black;color:white;">Truck Base Plant</td>'}}),t.forEach(function(e,t){var a,i=getDuration("in_transit",e),n="",s=getGeofence(e.origin_id)||{},o=getGeofence(e.destination[0].location_id)||{},d=LIST.routes.find(e=>e.origin_id==s._id&&e.destination_id==o._id)||{},p=getVehicle(e.vehicle_id)||{},m=`${s.short_name}_${o.short_name}`,h="w/in Transit Time";a=i?Number(DATETIME.DH(i,null,"0")):null,l[m]?(l[m].in_site++,null!=a&&(l[m].count_time_lapse++,l[m].sum_time_lapse+=a)):l[m]={destination:o.short_name,origin:s.short_name,in_site:1,over_transit:0,w_in_transit:0,count_time_lapse:a?1:0,sum_time_lapse:a,transit_target:d.transit_time||0},null!=a&&(a>d.transit_time?(n="background-color:#ffc7ce;color:#9c0006",h="Over Transit Time",l[m].over_transit++):l[m].w_in_transit++),c+="<tr>",u.forEach(t=>{switch(t){case"origin":c+=`<td style="${r}">${s.short_name}</td>`;break;case"destination":c+=`<td style="${r}">${o.short_name}</td>`;break;case"route":c+=`<td style="${r}">${e.route}</td>`;break;case"sn":c+=`<td style="${r}">${e._id}</td>`;break;case"plateNumber":c+=`<td style="${r}">${p.name||""}</td>`;break;case"trailer":c+=`<td style="${r}">${p.Trailer||""}</td>`;break;case"palCap":c+=`<td style="${r}">${p["Pal Cap"]||""}</td>`;break;case"haulerName":c+=`<td style="${r}"></td>`;break;case"targetTransit":c+=`<td style="${r}mso-number-format:'@';">${DATETIME.HH_MM(null,d.transit_time).hour_minute}</td>`;break;case"actualTimelapse":c+=`<td style="${r}mso-number-format:'@';">${DATETIME.HH_MM(null,a).hour_minute}</td>`;break;case"remarks1":c+=`<td style="${r}">${e.remarks||""}</td>`;break;case"remarks2":c+=`<td style="${r}${n}">${h}</td>`;break;case"truckBasePlant":c+=`<td style="${r}">${p.Site||""}</td>`}}),c+="</tr>"}),Object.values(l).forEach(e=>{var t=e.sum_time_lapse/e.count_time_lapse;s+=`<tr>\n                                    <td style="${r}">${e.origin}</td>\n                                    <td style="${r}">${e.destination}</td>\n                                    <td style="${r}">${e.in_site}</td>\n                                    <td style="${r}">${e.over_transit}</td>\n                                    <td style="${r}">${e.w_in_transit}</td>\n                                    <td style="${r}">${DATETIME.HH_MM(null,t).hour_minute}</td>\n                                    <td style="${r}">${DATETIME.HH_MM(null,e.transit_target).hour_minute}</td>\n                                </tr>`,o.in_site+=e.in_site,o.over_transit+=e.over_transit,o.w_in_transit+=e.w_in_transit,o.count_transit++,o.sum_transit+=Number(e.transit_target),null!=e.sum_time_lapse&&(o.count_time_lapse++,o.sum_time_lapse+=t)}),o.ave_time_lapse=o.sum_time_lapse/o.count_time_lapse,o.ave_transit=o.sum_transit/o.count_transit,s+=`<tr>\n                                <td style="${r}font-weight: bold;" colspan=2>TOTAL</td>\n                                <td style="${r}font-weight: bold;">${o.in_site||0}</td>\n                                <td style="${r}font-weight: bold;">${o.over_transit||0}</td>\n                                <td style="${r}font-weight: bold;">${o.w_in_transit||0}</td>\n                                <td style="${r}font-weight: bold;">${DATETIME.HH_MM(null,o.ave_time_lapse).hour_minute}</td>\n                                <td style="${r}font-weight: bold;">${DATETIME.HH_MM(null,o.ave_transit).hour_minute}</td>\n                            </tr>`,`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="border: none;">Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border: none;"><b>Summary:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;">\n                                    <div>\n                                        <div>Plant Site: ${a}</div>\n                                        <div>Date from: ${moment(new Date(i)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>Date to: ${moment(new Date(n)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="background-color:black;color:white;">Origin (Plant)</td>\n                                <td style="background-color:black;color:white;">Destination (DC)</td>\n                                <td style="background-color:black;color:white;">In Site</td>\n                                <td style="background-color:#757070;color:white;">Over Transit</td>\n                                <td style="background-color:#757070;color:white;">W/in Transit</td>\n                                <td style="background-color:black;color:white;">Ave. Time Lapse (hrs)</td>\n                                <td style="background-color:black;color:white;">Ave. Transit Target (hrs)</td>\n                            </tr>\n                            ${s}\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border: none;"><b>Details:</b></td>\n                            </tr>\n                            <tr>${d}</tr>\n                            ${c}\n                        </table> `},PBPA:function(e,t,a,i,n){var s="",l=0,o="border:2px solid black;mso-number-format:'@';",r=["width:280px;","width:150px;","width:150px;","width:150px;","width:150px;","width:150px;","width:150px;","width:300px;","width:300px;","width:150px;","width:175px;","width:150px;"];return t.forEach(function(e,t){l++;var a,i=getDuration("in_transit",e),n=getGeofence(e.origin_id)||{},d=getGeofence(e.destination[0].location_id)||{},c=getVehicle(e.vehicle_id)||{};a=i?Number(DATETIME.DH(i,null,"0")):null,s+=`<tr style="text-align:center;">\n                                <td style="${o}${r[0]}">${c.name||""}</td>\n                                <td style="${o}${r[1]}">${c["Pal Cap"]||""}</td>\n                                <td style="${o}${r[2]}">-</td>\n                                <td style="${o}${r[3]}">-</td>\n                                <td style="${o}${r[4]}">${e.remarks||""}</td>\n                                <td style="${o}${r[5]}">w/in Transit Time</td>\n                                <td style="${o}${r[6]}">${e._id}</td>\n                                <td style="${o}${r[7]}">${n.short_name}</td>\n                                <td style="${o}${r[8]}">${d.short_name}</td>\n                                <td style="${o}${r[9]}">${e.route}</td>\n                                <td style="${o}${r[10]}">${DATETIME.HH_MM(null,a).hour_minute}</td>\n                            </tr>`}),`<table id="report-hidden" style="opacity:0;">\n                        <tr>\n                            <td style="border: none;" colspan=2>Report name: <b style="color:#c00000;">${e}</b></td>\n                        </tr>\n                        <tr><td style="border: none;"></td></tr>\n                        <tr>\n                            <td style="border: none;"><b>Summary:</b></td>\n                        </tr>\n                        <tr>\n                            <td style="border: none;" colspan=2>\n                                <div>\n                                    <div>Plant Base: ${a}</div>\n                                    <div>Date from: ${moment(new Date(i)).format("MM/DD/YYYY hh:mm A")}</div>\n                                    <div>Date to: ${moment(new Date(n)).format("MM/DD/YYYY hh:mm A")}</div>\n                                    <div>&nbsp;</div>\n                                    <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                </div>\n                            </td>\n                        </tr>\n                        <tr><td style="border: none;"></td></tr>\n                        <tr>\n                            <td style="background-color:black;color:white;"><b>Inventory:</b></td>\n                            <td style="border:2px solid black;font-weight: bold;text-align:center;">${l}</td>\n                        </tr>\n                        <tr>\n                            <td style="background-color:black;color:white;"><b>Attendance:</b></td>\n                            <td style="border:2px solid black;font-weight: bold;text-align:center;">-%</td>\n                        </tr>\n                        <tr style="text-align:center;">\n                            <td style="background-color:black;color:white;text-align:left;"><b>Breakdown:</b></td>\n                            <td style="border:2px solid black;font-weight: bold;"></td>\n                            <td style="background-color:black;color:white;"><b>In Transit</b></td>\n                            <td style="background-color:#757070;color:white;"><b>Over Transit</b></td>\n                            <td style="background-color:#757070;color:white;"><b>W/in Transit</b></td>\n                            <td style="background-color:black;color:white;"><b>In Site</b></td>\n                            <td style="background-color:#757070;color:white;"><b>Over CICO</b></td>\n                            <td style="background-color:#757070;color:white;"><b>W/in CICO</b></td>\n                        </tr>\n                        <tr style="text-align:center;">\n                            <td style="background-color:black;color:white;text-align:right;font-style:italic;"><b>Active Assigned</b></td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                        </tr>\n                        <tr style="text-align:center;">\n                            <td style="background-color:black;color:white;text-align:right;font-style:italic;"><b>Waiting for Assignment</b></td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                            <td style="border:2px solid black;font-weight: bold;color:red;">-</td>\n                        </tr>\n                        <tr style="text-align:center;">\n                            <td style="background-color:black;color:white;text-align:right;font-style:italic;"><b>Inactive</b></td>\n                            <td style="border:2px solid black;font-weight: bold;">-</td>\n                            <td style="background-color:black;"></td>\n                            <td style="background-color:black;"></td>\n                            <td style="background-color:black;"></td>\n                            <td style="background-color:black;"></td>\n                            <td style="background-color:black;"></td>\n                            <td style="background-color:black;"></td>\n                        </tr>\n                        <tr><td style="border: none;"></td></tr>\n                        <tr>\n                            <td style="border: none;"><b>Details:</b></td>\n                        </tr>\n                        <tr style="text-align:center;">\n                            <td style="background-color:black;color:white;">Plate No.</td>\n                            <td style="background-color:black;color:white;">Pal Cap</td>\n                            <td style="background-color:black;color:white;">Activity</td>\n                            <td style="background-color:black;color:white;">Activity Status</td>\n                            <td style="background-color:black;color:white;">Remarks1</td>\n                            <td style="background-color:black;color:white;">Remarks2</td>\n                            <td style="background-color:black;color:white;">SN</td>\n                            <td style="background-color:black;color:white;">Origin (Plant)</td>\n                            <td style="background-color:black;color:white;">Destination (DC)</td>\n                            <td style="background-color:black;color:white;">Route</td>\n                            <td style="background-color:black;color:white;">Actual Time Lapse (hrs)</td>\n                        </tr>\n                        ${s}\n                    </table>`},HWTR:function(e,t,a,i){var n="",s="",l=0,o=0,r=0,d={},c=["width:115px;","width:215px;","width:215px;","width:215px;"];var u=function(e){var t=new Date,a=new Date;t.setHours(6),t.setMinutes(0),t.setSeconds(0),a.setHours(6),a.setMinutes(0),a.setSeconds(0),t.setTime(t.getTime()+60*e*60*1e3);for(var i={};t>=a;)i[moment(a).format("h a")]={time:moment(a).format("h:mm A"),ti_shipment:0,ti_arrived:0},a.setTime(a.getTime()+36e5);return i}(23);return t.forEach(function(e,t){l++;var a=getGeofence(e.origin_id)||{},i=getGeofence(e.destination[0].location_id)||{},n=LIST.routes.find(e=>e.origin_id==a._id&&e.destination_id==i._id)||{},s=`${a.short_name}_${i.short_name}`,o=moment(e.departure_date).format("h a");d[s]?d[s].count++:d[s]={destination:i.short_name,origin:a.short_name,count:1},u[o].ti_shipment++;var r=getDuration("in_transit",e),c=Number(DATETIME.DH(r,null,"0"));u[o].ti_arrived+=(n.transit_time||0)>=c?1:0}),Object.keys(u).forEach(e=>{var t=u[e].time,a=u[e].ti_shipment,i=u[e].ti_arrived,s=i<a?"Non Compliance":"Complied";r+="Complied"==s?1:0,o+=a,n+=`<tr>\n                                    <td style="border:2px solid black;text-align:center;">${t}</td>\n                                    <td style="border:2px solid black;text-align:center;">${a}</td>\n                                    <td style="border:2px solid black;text-align:center;">${i}</td>\n                                    <td style="border:2px solid black;text-align:center;">${s}</td>\n                                </tr>`}),Object.values(d).forEach(e=>{s+=`<tr>\n                                    <td style="border:2px solid black;text-align:center;" colspan=2>${e.origin}</td>\n                                    <td style="border:2px solid black;text-align:center;">${e.count}</td>\n                                </tr>`}),`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="border: none;" colspan=3>Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border: none;"><b>Summary:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;" colspan=3>\n                                    <div>\n                                        <div>Destination Site: ${a}</div>\n                                        <div>Date: ${moment(new Date(i)).format("MM/DD/YYYY")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="background-color:black;color:white;" colspan=2><b>Total T1 Shipment:</b></td>\n                                <td style="border:2px solid black;font-weight: bold;text-align:center;">${l}</td>\n                            </tr>\n                            <tr>\n                                <td style="background-color:black;color:white;" colspan=2><b>Breakdown:</b></td>\n                                <td style="border:2px solid black;"></td>\n                            </tr>\n                            ${s}\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border:2px solid black;text-align:center;" colspan=2>Whse Capacity to Process</td>\n                                <td style="border:2px solid black;text-align:center;"><b>${o}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border:2px solid black;text-align:center;" colspan=2>Capacity vs Shipment</td>\n                                <td style="border:2px solid black;text-align:center;"><b>${l>o?"Capacity to Process Issue":"No Processing Issue"}</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border:2px solid black;text-align:center;" colspan=2>% Compliance</td>\n                                <td style="border:2px solid black;text-align:center;"><b>${GET.ROUND_OFF(r/24*100)}%</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="background-color:black;color:white;${c[0]}text-align:center;"><b>Time</b></td>\n                                <td style="background-color:black;color:white;text-align:center;${c[1]}"><b>T1 Shipments/Hr</b></td>\n                                <td style="background-color:black;color:white;text-align:center;${c[2]}"><b>T1 that arrived/Hr</b></td>\n                                <td style="background-color:black;color:white;text-align:center;${c[3]}"><b>% compliance</b></td>\n                            </tr>\n                            ${n}\n                        </table>`},TR:function(e,t,a){for(var i="",n=["width:100px;","width:100px;","width:100px;","width:100px;"],s=0;s<16;s++)i+='<tr style="text-align:center">\n                                    <td style="border:2px solid black;"></td>\n                                    <td style="border:2px solid black;"></td>\n                                    <td style="border:2px solid black;"></td>\n                                    <td style="border:2px solid black;"></td>\n                                </tr>';return`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="border: none;" colspan=4>Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="border: none;" colspan=4><b>Summary:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;" colspan=4>\n                                    <div>\n                                        <div>Plant Site: ${t.origin}</div>\n                                        <div>Destination Site: ${t.destination}</div>\n                                        <div>Destination Region: ${t.region}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Day: ${moment(new Date(a)).format("DD")}</div>\n                                        <div>Week: ${moment(new Date(a)).format("dddd")}</div>\n                                        <div>Month: ${moment(new Date(a)).format("MMMM")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="background-color:black;color:white;${n[0]}text-align:center;"><b>Period</b></td>\n                                <td style="background-color:black;color:white;text-align:center;${n[1]}"><b>Week</b></td>\n                                <td style="background-color:black;color:white;text-align:center;${n[2]}"><b>Date</b></td>\n                                <td style="background-color:black;color:white;text-align:center;${n[3]}"><b>Trippage</b></td>\n                            </tr>\n                            ${i}\n                        </table>`},VCR:function(e,t,a,i){var n,s,l="",o=["width:100px;","width:100px;","width:100px;","width:110px;","width:100px;","width:180px;","width:180px;"],r=!0;return t.forEach((e,o)=>{function d(){r=!1;var a=t[o-1],d=t[o+1],c=n||e.timestamp,u=a&&a.USER_NAME==e.USER_NAME?a.GEOFENCE_NAME:null,p=e.GEOFENCE_NAME,m=d&&d.USER_NAME==e.USER_NAME?d.GEOFENCE_NAME:null,h=function(e){var t="";if(e){var a=e.split(" - "),i=function(e){t=(t+=` ${e}`).replace(" DC","").replace(" PL","").replace(/Ñ/g,"N").replace(/ñ/g,"n")};t=a[0].capitalize(" ").replace(" Dc"," DC").replace(" Pl"," PL"),e.indexOf("Process")>-1&&i(" Process"),e.indexOf("Queue")>-1&&i(" Queue"),e.indexOf("Idle")>-1&&i(" Idle")}else t="Unknown";return console.log("finalStr",e,t),t},b=function(e){return e&&-1==e.indexOf(" - ")?"color:#ca294b;font-style: italic;":"color:black;"},f=function(e){return(e=e||"").split(" - ")[0]},v=b(p),E=b(m),g=(f(p),f(u),f(p)==f(m)),T=d&&d.USER_NAME==e.USER_NAME?d.timestamp:null,_=T?Math.abs(new Date(c).getTime()-new Date(T).getTime()):null,y=function(t,a){var n=null!=_?`<td style="font-family:Arial;font-size:15px;border:1px solid black;${t}">${h(a)}</td>`:'<td style="font-family:Arial;font-size:15px;border:1px solid black;">-</td>',s=DATETIME.FORMAT(T,"D-M"),l=DATETIME.FORMAT(T,"hh:mm A"),o="Finished",r=null!=_?GET.ROUND_OFF(DATETIME.DH(_,null,"0")):"-";return new Date(i).getTime()>(new Date).getTime()&&null==_&&(s="-",l="-",o="Pending"),`<tr style="text-align:center">\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${e.USER_NAME}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${DATETIME.FORMAT(c,"D-M")}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${DATETIME.FORMAT(c,"hh:mm A")}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${s}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${l}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${r}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';">${o}</td>\n                                            <td style="font-family:Arial;font-size:15px;border:1px solid black;mso-number-format:'@';${v}">${h(p)}</td>\n                                            ${n}\n                                        </tr>`};g||(r=!0),d&&d.GEOFENCE_NAME==e.GEOFENCE_NAME&&d.USER_NAME==e.USER_NAME?n||(n=e.timestamp):(n=null,g?(s=f(p),l+=y(E,m)):s&&u&&s==f(u)||(s=f(p),_=Math.abs(new Date(c).getTime()-new Date(e.timestamp).getTime()),T=e.timestamp,l+=y(v,p)))}if(r){if(-1==e.GEOFENCE_NAME.indexOf("-")){var c=new Date(e.timestamp);c.setMinutes(c.getMinutes()-5),DATETIME.FORMAT(e.timestamp,"D-MMM")==DATETIME.FORMAT(a,"D-MMM")?DATETIME.FORMAT(a,"D-MMM")==DATETIME.FORMAT(c,"D-MMM")&&(e.timestamp=c.getTime()):e.timestamp=c.getTime(),d()}}else d()}),`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border: none;" colspan=4>Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border: none;" colspan=4><b>Date Info:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;font-family:Arial;font-size:15px;" colspan=4>\n                                    <div>\n                                        <div>Date from: ${moment(new Date(a)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>Date to: ${moment(new Date(i)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;${o[0]}text-align:center;"><b>Vehicle</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[1]}"><b>Start Date</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[2]}"><b>Start Time</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[1]}"><b>End Date</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[2]}"><b>End Time</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[3]}"><b>Duration (hrs)</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[4]}"><b>Event State</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[5]}"><b>Start Address</b></td>\n                                <td style="font-family:Arial;font-size:15px;background-color:black;color:white;text-align:center;${o[6]}"><b>End Address</b></td>\n                            </tr>\n                            ${l}\n                        </table>`},ULAR:function(e,t,a,i){var n="",s=["width:150px;","width:200px;","width:160px;","width:160px;","width:70px;","width:15px;","width:115px;","width:400px;"];return t.forEach((e,t)=>{var a=getUser(e.username)||{},i=e.logout_date?new Date(e.logout_date).getTime()-new Date(e.login_date).getTime():"-";n+=`<tr style="text-align:center">\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${e.username}</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${a.name||"-"}</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${DATETIME.FORMAT(e.login_date)}</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${DATETIME.FORMAT(e.logout_date)}</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${DATETIME.HH_MM(i).hour_minute}</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;mso-number-format:'@';">&nbsp;</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${e.ip||"-"}</td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #eee;mso-number-format:'@';text-align:left;">${e.location||"-"}</td>\n                            </tr>`}),`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border: none;" colspan=4>Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border: none;" colspan=4><b>Date Info:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;font-family:Arial;font-size:15px;" colspan=4>\n                                    <div>\n                                        <div>Date from: ${moment(new Date(a)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>Date to: ${moment(new Date(i)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;${s[0]}text-align:left;"><b>Username</b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;text-align:left;${s[1]}"><b>Name</b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;text-align:left;${s[2]}"><b>Login Date</b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;text-align:left;${s[3]}"><b>Logout Date</b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;text-align:left;${s[4]}"><b>Duration</b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;text-align:center;${s[5]}"><b></b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;text-align:left;${s[6]}"><b>I.P. Address</b></td>\n                                <td style="font-family:Arial;font-size:15px;border:none;border-bottom:1px solid #D0CECE;background-color:#D0CECE;color:#262626;text-align:left;${s[7]}"><b>Location (Based on I.P. Address)</b></td>\n                            </tr>\n                            ${n}\n                        </table>`},DESR:function(e,t,a,i){var n="",s="font-family:Arial;font-size:15px;background-color:#404040;border-color:#404040;color:white;text-align:center;",l="font-family:Arial;font-size:15px;border:none;mso-number-format:'@';vertical-align:top;";function o(e){var t=moment(new Date(e)).format("MM/DD/YYYY"),a=moment(new Date(e)).format("H:mm");return{date:"Invalid date"==t?"-":t,time:"Invalid date"==a?"-":a}}return t.forEach(e=>{var t=new Dispatch(e),a=[];Object.keys(t.history).forEach(e=>{var i=t.history[e]||"";if(i.indexOf("Entry Update")>-1||i.indexOf("Record updated")>-1){var n=DATETIME.FORMAT(Number(e),"MM/DD/YYYY h:mm A"),s=i.replace(/•/g,"-").replace(/Entry Update - /g,"- ").replace(/<br><br>/g,"<br>");a.push(`${n}<br>${s}`)}}),n+=`<tr>\n                                <td style="${l}">${t._id}</td>\n                                <td style="${l}">${t.vehicle}</td>\n                                <td style="${l}">${t.trailer}</td>\n                                <td style="${l}">${t.pal_cap}</td>\n                                <td style="${l}">${t.origin}</td>\n                                <td style="${l}">${t.destination}</td>\n                                <td style="${l}">${t.route}</td>\n                                <td style="${l}">${o(t.entered_datetime).date}</td>\n                                <td style="${l}">${o(t.entered_datetime).time}</td>\n                                <td style="${l}">${o(t.departure_date).date}</td>\n                                <td style="${l}">${o(t.departure_date).time}</td>\n                                <td style="${l}">${t.queueingDuration}</td>\n                                <td style="${l}">${t.processingDuration}</td>\n                                <td style="${l}">${t.idlingDuration}</td>\n                                <td style="${l}">${t.cico}</td>\n                                <td style="${l}">${t.transitDuration}</td>\n                                <td style="${l}">${o(t.complete_datetime).date}</td>\n                                <td style="${l}">${o(t.complete_datetime).time}</td>\n                                <td style="${l}">${t.postedByWithName}</td>\n                                <td style="${l}">${o(t.posting_date).date}</td>\n                                <td style="${l}">${o(t.posting_date).time}</td>\n                                <td style="${l}">${t.statusText}</td>\n                                <td style="${l}">${$(`<span>${t.late_entry}</span>`).text()}</td>\n                                <td style="${l}">${t.comments}</td>\n                                <td style="${l}width:500px;">${a.join("<br><br>")}</td>\n                            </tr>`}),`<table id="report-hidden" style="opacity:0;">\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border: none;" colspan=22>Report name: <b style="color:#c00000;">${e}</b></td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="font-family:Arial;font-size:15px;border: none;" colspan=22><b>Date Info:</b></td>\n                            </tr>\n                            <tr>\n                                <td style="border: none;font-family:Arial;font-size:15px;" colspan=22>\n                                    <div>\n                                        <div>Date from: ${moment(new Date(a)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>Date to: ${moment(new Date(i)).format("MM/DD/YYYY hh:mm A")}</div>\n                                        <div>&nbsp;</div>\n                                        <div>Generated on: ${moment(new Date).format("MM/DD/YYYY hh:mm A")}</div>\n                                    </div>\n                                </td>\n                            </tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr><td style="border: none;"></td></tr>\n                            <tr>\n                                <td style="${s}"><b>Shipment</b></td>\n                                <td style="${s}"><b>Vehicle</b></td>\n                                <td style="${s}"><b>Trailer</b></td>\n                                <td style="${s}"><b>Pal Cap</b></td>\n                                <td style="${s}"><b>Origin</b></td>\n                                <td style="${s}"><b>Destination</b></td>\n                                <td style="${s}"><b>Route</b></td>\n                                <td style="${s}"><b>Check In Date</b></td>\n                                <td style="${s}"><b>Check In Time</b></td>\n                                <td style="${s}"><b>Check Out Date</b></td>\n                                <td style="${s}"><b>Check Out Time</b></td>\n                                <td style="${s}"><b>Queueing Duration</b></td>\n                                <td style="${s}"><b>Processing Duration</b></td>\n                                <td style="${s}"><b>Idling Duration</b></td>\n                                <td style="${s}"><b>CICO Duration</b></td>\n                                <td style="${s}"><b>Transit Duration</b></td>\n                                <td style="${s}"><b>Completion Date</b></td>\n                                <td style="${s}"><b>Completion Time</b></td>\n                                <td style="${s}"><b>Posted By</b></td>\n                                <td style="${s}"><b>Posting Date</b></td>\n                                <td style="${s}"><b>Posting Time</b></td>\n                                <td style="${s}"><b>Status</b></td>\n                                <td style="${s}"><b>Late Entry</b></td>\n                                <td style="${s}"><b>Comments</b></td>\n                                <td style="${s}width:500px;"><b>Remarks</b></td>\n                            </tr>\n                            ${n}\n                        </table>`},SER:function(e,t,a,i){var n="",s="font-family:Arial;font-size:12px;font-weight:bold;text-align:center;height:22px;vertical-align:middle;",l="font-family:Arial;font-size:12px;mso-number-format:'@';font-weight:bold;text-align:center;";t.forEach(e=>{var t=new Dispatch(e),a="-"==t.comments?"":t.comments;n+=`<tr>\n                                <td style="${l}">${t.truck_number}</td>\n                                <td style="${l}">${t.destination}</td>\n                                <td style="${l}">${t.shift_schedule}</td>\n                                <td style="${l}">${t.departure_date}</td>\n                                <td style="${l}">${t.complete_datetime}</td>\n                                <td style="${l}">${(t.driver||"").toUpperCase()}</td>\n                                <td style="${l}">${(t.checker||"").toUpperCase()}</td>\n                                <td style="${l}">${(t.helper||"").toUpperCase()}</td>\n                                <td style="${l}">${(a||"").toUpperCase()}</td>\n                            </tr>`});var o=moment(new Date(a)).format("MMMM DD, YYYY").toUpperCase(),r=moment(new Date(i)).format("MMMM DD, YYYY").toUpperCase();return`<table id="report-hidden" style="opacity:0;" data-SheetName="My custom sheet 0">\n                            <tbody>\n                                <tr> <td style="font-family:Arial;font-size:16.5px;text-align:center;" colspan=9><b>STRAIGHT AHEAD DELIVERY CORPORATION</b></td> </tr>\n                                <tr> <td style="font-family:Arial;font-size:15px;text-align:center;" colspan=9><b>DELIVERY PERSONNEL TRUCK SCHEDULE</b></td> </tr>\n                                <tr> <td style="font-family:Arial;font-size:13px;text-align:center;" colspan=9><b>SKELETAL WORK FORCE</b></td> </tr>\n                                <tr> <td style="font-family:Arial;font-size:12px;text-align:center;" colspan=9><b>BASE TO BASE DELIVERY</b></td> </tr>\n                                <tr> \n                                    <td style="font-family:Arial;font-size:12px;text-align:center;" colspan=7></td> \n                                    <td style="font-family:Arial;font-size:12px;text-align:right;"><b>DATE:</b></td> \n                                    <td style="font-family:Arial;font-size:12px;text-align:center;"><b>${o==r?o:`${o} - ${r}`}</b></td> \n                                </tr>\n                                <tr>\n                                    <td style="${s}width:70px;"><b>TRUCK</b></td>\n                                    <td style="${s}width:65px;"><b>DEPOT</b></td>\n                                    <td style="${s}width:125px;"><b>SCHEDULE</b></td>\n                                    <td style="${s}width:100px;"><b>TIME OUT</b></td>\n                                    <td style="${s}width:100px;"><b>TIME IN</b></td>\n                                    <td style="${s}width:200px;"><b>DRIVER</b></td>\n                                    <td style="${s}width:200px;"><b>CHECKER</b></td>\n                                    <td style="${s}width:200px;"><b>HELPER</b></td>\n                                    <td style="${s}width:300px;"><b>REMARKS</b></td>\n                                </tr>\n                                ${n}\n                            </tbody>\n                        </table>`},mtur:function(e,t,a,i){var n="font-family:Arial;font-size:12px;font-weight:bold;vertical-align:middle;border:none;",s="font-family:Arial;font-size:12px;font-weight:bold;text-align:center;height:22px;vertical-align:middle;border:thin solid black;",l="font-family:Arial;font-size:12px;mso-number-format:'@';border:thin solid black;",o=[{cluster:"Total",sequence:0}];o=o.concat(LIST.clusters||[]);var r=moment(a).format("MMM"),d=moment(a).format("YYYY"),c=moment(a).daysInMonth(),u=LIST.vehicles.length,p=LIST.vehicle_personnel.filter(e=>"Driver"==e.occupation||"Checker"==e.occupation||"Helper"==e.occupation).length,m=[],h=[],b="",f={},v={},E={},g={},T=0,_=[],y={},$=[],S=[],A=[],I=[];var D=[],O=[],C=[],w=[],N={};(o=SORT.ARRAY_OBJECT(o,"sequence",{sortType:"asc"})).forEach(e=>{D.push(`<td style="${s}width:160px;text-align:left;" colspan=2><b>${e.cluster}</b></td>`),_.push(`<td style="${s}text-align:left;" colspan=2><b>${e.cluster}</b></td>`),O.push(`<td style="${s}width:90px;" rowspan=2><b>Date</b></td>\n                                      <td style="${s}width:160px;" colspan=2><b>Truck Utilization</b></td>\n                                      <td style="${s}width:160px;" colspan=6><b>Manpower Utilization</b></td>`),I.push(`<td style="${s}width:30px;"><b>#</b></td>\n                                              <td style="${s}width:180px;"><b>Truck</b></td>\n                                              <td style="${s}width:60px;"><b>Trips</b></td>`),C.push(`<td style="${s}width:80px;"><b># Used</b></td>\n                                         <td style="${s}width:80px;"><b>Percentage</b></td>\n                                         <td style="${s}width:130px;"><b># Used (Driver)</b></td>\n                                         <td style="${s}width:130px;"><b>Percentage (Driver)</b></td>\n                                         <td style="${s}width:130px;"><b># Used (Checker)</b></td>\n                                         <td style="${s}width:130px;"><b>Percentage (Checker)</b></td>\n                                         <td style="${s}width:130px;"><b># Used (Helper)</b></td>\n                                         <td style="${s}width:130px;"><b>Percentage (Helper)</b></td>`),function(e){T++;for(var a=[],i=1;i<c+1;i++){var n=moment(`${r} ${i}, ${d}`).format("MM/DD/YYYY"),s=moment(n,"MM/DD/YYYY"),o=[],b=[],_=[],y=[],$=[],S=[],A=[],I=[];t.filter(e=>moment(moment(e.scheduled_date).format("MM/DD/YYYY"),"MM/DD/YYYY").isBetween(s,s,"days","[]")).forEach(t=>{var a=getGeofence(t.origin_id)||{};e&&a.cluster_id!=e||(t.vehicle_id&&o.push(t.vehicle_id),t.driver_id&&b.push(t.driver_id),t.checker_id&&_.push(t.checker_id),t.helper_id&&y.push(t.helper_id),t.vehicle_id&&!$.includes(t.vehicle_id)&&$.push(t.vehicle_id),t.driver_id&&!S.includes(t.driver_id)&&S.push(t.driver_id),t.checker_id&&!A.includes(t.checker_id)&&A.push(t.checker_id),t.helper_id&&!I.includes(t.helper_id)&&I.push(t.helper_id),!m.includes(t.vehicle_id)&&m.push(t.vehicle_id),!h.includes(t.driver_id)&&h.push(t.driver_id),!h.includes(t.checker_id)&&h.push(t.checker_id),!h.includes(t.helper_id)&&h.push(t.helper_id))});var D=GET.ROUND_OFF($.length/u*100),O=GET.ROUND_OFF(S.length/p*100),C=GET.ROUND_OFF(A.length/p*100),w=GET.ROUND_OFF(I.length/p*100);function N(e,t,a,n){var s={};if(e.forEach(e=>{var t=n(e);t&&(s[t.name||t._id]=s[t.name||t._id]||0,s[t.name||t._id]++)}),t[i]=t[i]||{},Object.keys(s).forEach((e,n)=>{GET.ROUND_OFF(s[e]/a*100),t[i][n]=t[i][n]||[],t[i][n].push(`<td style="${l}text-align:center;">${n+1}</td>\n                                                            <td style="${l}text-align:left;">${e}</td>\n                                                            <td style="${l}text-align:center;">${s[e]}</td>`)}),Object.keys(t[i]).length>0)Object.keys(t[i]).forEach(e=>{for(;t[i][e].length<T;)t[i][e].push("<td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td>")});else for(var o=0;o<T;o++)t[i][o]=t[i][o]||[],t[i][o].push("<td>&nbsp;</td> <td>&nbsp;</td>  <td>&nbsp;</td>");return t}a.push({date:n,totalVehicleCount:o.length,uniqueVehicleCount:$.length,totalVehiclePercentage:D,totalDriverCount:b.length,uniqueDriverCount:S.length,totalDriverPercentage:O,totalCheckerCount:_.length,uniqueCheckerCount:A.length,totalCheckerPercentage:C,totalHelperCount:y.length,uniqueHelperCount:I.length,totalHelperPercentage:w}),f=N(o,f,u,e=>getVehicle(e)),v=N(b,v,p,e=>getVehiclePersonnel(e)),E=N(_,E,p,e=>getVehiclePersonnel(e)),g=N(y,g,p,e=>getVehiclePersonnel(e))}return a}(e._id).forEach((e,t)=>{N[e.date]=N[e.date]||[],N[e.date].push(`<td style="${l}text-align:center;font-weight:bold;">${e.date}</td>\n                                            <td style="${l}text-align:center;">${e.uniqueVehicleCount}</td>\n                                            <td style="${l}text-align:center;">${e.totalVehiclePercentage}%</td>\n                                            <td style="${l}text-align:center;">${e.uniqueDriverCount}</td>\n                                            <td style="${l}text-align:center;">${e.totalDriverPercentage}%</td>\n                                            <td style="${l}text-align:center;">${e.uniqueCheckerCount}</td>\n                                            <td style="${l}text-align:center;">${e.totalCheckerPercentage}%</td>\n                                            <td style="${l}text-align:center;">${e.uniqueHelperCount}</td>\n                                            <td style="${l}text-align:center;">${e.totalHelperPercentage}%</td>`),y[t]=y[t]||[],y[t].push(`<td style="${s}" colspan=3><b>Truck Utilization (${e.totalVehiclePercentage}%)</b></td>`),$[t]=$[t]||[],$[t].push(`<td style="${s}" colspan=3><b>Manpower Utilization - Driver (${e.totalDriverPercentage}%)</b></td>`),S[t]=S[t]||[],S[t].push(`<td style="${s}" colspan=3><b>Manpower Utilization - Checker (${e.totalCheckerPercentage}%)</b></td>`),A[t]=A[t]||[],A[t].push(`<td style="${s}" colspan=3><b>Manpower Utilization - Helper (${e.totalHelperPercentage}%)</b></td>`)})});for(var L=1;L<c+1;L++){var x=moment(`${r} ${L}, ${d}`);function R(e){var t=[];return Object.keys(e[L]).forEach(a=>{t.push(`<tr>${e[L][a].join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>`)}),t}b+=`<table id="report-hidden-${L}" data-SheetName="${x.format("MMM DD")}" border="1" style="border-collapse: collapse;opacity:0;">\n                                        <tbody>\n                                            <tr> <td style="${n}text-align:left;" colspan=5><b>Date: ${x.format("MMM DD, YYYY (dddd)")}</b></td> </tr>\n                                            <tr> <td style="${n}text-align:left;" colspan=5><b>${e}</b></td> </tr>\n\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;color:red;font-weight:bold;" colspan=3>TRUCK UTILIZATION</td> </tr>\n                                            <tr>${_.join('<td style="border:none;" colspan=3>&nbsp;</td>')}</tr>\n                                            <tr>${y[L-1].join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            <tr>${I.join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            ${R(f).join("")}\n\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;color:red;font-weight:bold;" colspan=3>MANPOWER UTILIZATION (DRIVER)</td> </tr>\n                                            <tr>${_.join('<td style="border:none;" colspan=3>&nbsp;</td>')}</tr>\n                                            <tr>${$[L-1].join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            <tr>${I.join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            ${R(v).join("")}\n\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;color:red;font-weight:bold;" colspan=3>MANPOWER UTILIZATION (CHECKER)</td> </tr>\n                                            <tr>${_.join('<td style="border:none;" colspan=3>&nbsp;</td>')}</tr>\n                                            <tr>${S[L-1].join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            <tr>${I.join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            ${R(E).join("")}\n\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;" colspan=2>&nbsp;</td> </tr>\n                                            <tr> <td style="border:none;color:red;font-weight:bold;" colspan=3>MANPOWER UTILIZATION (HELPER)</td> </tr>\n                                            <tr>${_.join('<td style="border:none;" colspan=3>&nbsp;</td>')}</tr>\n                                            <tr>${A[L-1].join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            <tr>${I.join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                            ${R(g).join("")}\n                                        </tbody>\n                                    </table>`}Object.keys(N).forEach((e,t)=>{w.push(`<tr>${N[e].join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>`)});var P=GET.ROUND_OFF(m.length/u*100),k=GET.ROUND_OFF(h.length/u*100);return`<table id="report-hidden" data-SheetName="Overview" border="1" style="border-collapse: collapse;opacity:0;">\n                            <tbody>\n                                <tr> <td style="${n}text-align:center;" colspan=5><b>${e}</b></td> </tr>\n                                <tr> <td style="${n}text-align:center;" colspan=5><b>${moment(a).format("MM-YYYY")}</b></td> </tr>\n                                <tr> <td style="border:none;" colspan=5>&nbsp;</td> </tr>\n                                <tr> <td style="${n}" colspan=5>Total # of Trucks: <b>${u}</b></td> </tr>\n                                <tr> <td style="${n}" colspan=5>Total # of Manpower: <b>${p}</b></td> </tr>\n                                <tr> <td style="border:none;" colspan=5>&nbsp;</td> </tr>\n                                <tr> <td style="${n}" colspan=5>Monthly Truck Utilization: <b>${P}%</b></td> </tr>\n                                <tr> <td style="${n}" colspan=5>Monthly Manpower Utilization: <b>${k}%</b></td> </tr>\n                                <tr> <td style="border:none;" colspan=5>&nbsp;</td> </tr>\n\n                                <tr>${D.join('<td style="border:none;" colspan=9>&nbsp;</td>')}</tr>\n                                <tr>${O.join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                <tr>${C.join('<td style="border:none;" colspan=2>&nbsp;</td>')}</tr>\n                                ${w}\n                            </tbody>\n                        </table>\n                        ${b}`},TODR:{process:function(e,t){var a={},i=moment(new Date(t)).format("MM/DD/YYYY"),n=moment(new Date(t)).subtract(1,"days").format("MM/DD/YYYY"),s=[],l=[],o=function(e,t){return moment(new Date(`${"t"==e?i:n} ${t}`),"hh:mm:ss A")},r={total:0,"P05:01:00 PM - 12:00:59 AM":0,"12:01:00 AM - 07:00:59 AM":0,"07:01:00 AM - 09:00:59 AM":0,"09:01:00 AM - 12:00:59 PM":0,"12:01:00 PM - 03:00:59 PM":0,"03:01:00 PM - 05:00:59 PM":0};e.forEach(e=>{var a=moment(new Date(e.timestamp)).format("YYYY-MM-DD"),i=moment(new Date(t)).format("YYYY-MM-DD"),n=moment(new Date(t)).subtract(1,"days").format("YYYY-MM-DD");a==i&&l.push(e),a==n&&s.push(e)}),l.length>0&&l.forEach(e=>{if("end"==e.stage){a[e.GEOFENCE_NAME]||(a[e.GEOFENCE_NAME]={"P05:01:00 PM - 12:00:59 AM":[],"12:01:00 AM - 07:00:59 AM":[],"07:01:00 AM - 09:00:59 AM":[],"09:01:00 AM - 12:00:59 PM":[],"12:01:00 PM - 03:00:59 PM":[],"03:01:00 PM - 05:00:59 PM":[]});var t=moment(new Date(e.timestamp),"hh:mm:ss A");t.isBetween(o("t","12:00:00 AM"),o("t","12:00:59 AM"))&&-1==a[e.GEOFENCE_NAME]["P05:01:00 PM - 12:00:59 AM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["P05:01:00 PM - 12:00:59 AM"].push(e.USER_NAME),t.isBetween(o("t","12:01:00 AM"),o("t","07:00:59 AM"))&&-1==a[e.GEOFENCE_NAME]["12:01:00 AM - 07:00:59 AM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["12:01:00 AM - 07:00:59 AM"].push(e.USER_NAME),t.isBetween(o("t","07:01:00 AM"),o("t","09:00:59 AM"))&&-1==a[e.GEOFENCE_NAME]["07:01:00 AM - 09:00:59 AM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["07:01:00 AM - 09:00:59 AM"].push(e.USER_NAME),t.isBetween(o("t","09:01:00 AM"),o("t","12:00:59 PM"))&&-1==a[e.GEOFENCE_NAME]["09:01:00 AM - 12:00:59 PM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["09:01:00 AM - 12:00:59 PM"].push(e.USER_NAME),t.isBetween(o("t","12:01:00 PM"),o("t","03:00:59 PM"))&&-1==a[e.GEOFENCE_NAME]["12:01:00 PM - 03:00:59 PM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["12:01:00 PM - 03:00:59 PM"].push(e.USER_NAME),t.isBetween(o("t","03:01:00 PM"),o("t","05:00:59 PM"))&&-1==a[e.GEOFENCE_NAME]["03:01:00 PM - 05:00:59 PM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["03:01:00 PM - 05:00:59 PM"].push(e.USER_NAME)}}),s.length>0&&s.forEach(e=>{"end"==e.stage&&(a[e.GEOFENCE_NAME]||(a[e.GEOFENCE_NAME]={"P05:01:00 PM - 12:00:59 AM":[],"12:01:00 AM - 07:00:59 AM":[],"07:01:00 AM - 09:00:59 AM":[],"09:01:00 AM - 12:00:59 PM":[],"12:01:00 PM - 03:00:59 PM":[],"03:01:00 PM - 05:00:59 PM":[]}),moment(new Date(e.timestamp),"hh:mm:ss A").isBetween(o("y","05:01:00 PM"),o("y","11:59:59 PM"))&&-1==a[e.GEOFENCE_NAME]["P05:01:00 PM - 12:00:59 AM"].indexOf(e.USER_NAME)&&a[e.GEOFENCE_NAME]["P05:01:00 PM - 12:00:59 AM"].push(e.USER_NAME))});const d={};return Object.keys(a).sort().forEach(function(e){d[e]=a[e]}),a=d,Object.keys(a).forEach(e=>{Object.keys(a[e]).forEach(t=>{r.total+=a[e][t].length,r[t]+=a[e][t].length})}),{summaryTotal:r,obj:a,date:t}},generate:function(e,t,a){var i="";return Object.keys(a).forEach(e=>{var n="";Object.keys(a[e]).forEach(i=>{i==t&&(n+=`<td style="text-align:left;word-wrap: break-word;vertical-align:top;${exlStyle}">${a[e][i].length}</td>`,n+=`<td style="text-align:left;word-wrap: break-word;vertical-align:top;${exlStyle}">${a[e][i].join(", ")}</td>`)}),i+=`<tr>\n                                        <td style="text-align:left;word-wrap: break-word;vertical-align:top;${exlStyle}">${e}</td>\n                                        ${n}\n                                    </tr>`}),`<table id="report-hidden" style="opacity:0;">\n                                <colgroup>\n                                    <col width="250" style="vertical-align:middle;" />\n                                    <col width="200" style="vertical-align:middle;" />\n                                    <col width="750" style="vertical-align:middle;" />\n                                </colgroup>\n                                <tr>\n                                    <td style="border: none;text-align:left;${exlStyle}" colspan=3>Report name: <b style="color:#c00000;">${e}</b></td>\n                                </tr>\n                                <tr>\n                                    <td style="border: none;text-align:left;${exlStyle}" colspan=3>Date and Time of Download: ${DATETIME.FORMAT(new Date,"MM/DD/YYYY hh:mm:ss A")}</td>\n                                </tr>\n                                <tr><td style="border: none;"></td></tr>\n                                <tr>\n                                    <td style="background-color:black;color:white;vertical-align:middle;${exlStyle}">Distribution Center (DC)</td>\n                                    <td style="background-color:black;color:white;vertical-align:middle;${exlStyle}">Total No. of Trucks Outside DC</td>\n                                    <td style="background-color:black;color:white;vertical-align:middle;${exlStyle}">Truck List</td>\n                                </tr>\n                                ${i}\n                            </table> `}}}},FUNCTION:{init:function(){PAGE.DISPLAY();var e=[],t=!0,a=function(){var e='<option value="">All</option>';LIST.geofences.forEach(t=>{e+=`<option value="${t._id}">${t.value}</option>`});var t,a,i="",n="All",s=function(t,a,s,l){i="",$("body").append(REPORTS.UI[a](t,s)),$("#date_from,#date_to").val(DATETIME.FORMAT(new Date,"YYYY-MM-DD")),$("#_site,#_origin_site,#_destination_site").html(e).select2().val("").change(function(){i=$(this).find("option:selected").val(),n=$(this).find("option:selected").text()}),$("#generate-btn").click(function(){l()})},l=function(e){$("#generate-btn").html('<i class="la la-spinner la-spin mr-2"></i>Generating... 0%').attr("disabled",!0),$.ajax({url:e.countURL,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(t){console.log("count",t);var a=new ProgressBar(t),i=[],n=0;!function t(s){null==s||s==LIMIT?$.ajax({url:`${e.dataURL}/${n}/${LIMIT}`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(e){if(!e.error)if(s=e.length,e.error)toastr.error(e.error.message);else{n+=s,i=i.concat(e);var l=a.calculate();$("#generate-btn").html(`<i class="la la-spinner la-spin mr-2"></i>Generating... ${l}%`),t(s)}}):($("#generate-btn").html('<i class="la la-spinner la-spin mr-2"></i>Generating... 100%'),e.callback(i),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove())}()})},o=function(e,n){var s=$("#daterange").val(),o=FILTER.DATERANGE(s);if(t=o.$gte,a=o.$lt,t.isEmpty()||a.isEmpty())toastr.error("Please fill all the required fields.");else{var r={status:e.status||"complete",departure_date:FILTER.DATERANGE(`${DATETIME.FORMAT(t,"MM/DD/YYYY")} - ${DATETIME.FORMAT(a,"MM/DD/YYYY")}`)},d=""!=i?e:{};r=$.extend(r,d),l({countURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(r)}/count`,dataURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(r)}`,callback:n})}};$("[cicor]").click(function(){var e="CICO Report";s(e,"REPORT_MODAL_01","Plant Site",function(){o({origin_id:i},function(i){$("body").append(REPORTS.UI.REPORTS.CICOR(e,i,n,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY")}`)})}),$("#daterange").daterangepicker({locale:{format:"MM/DD/YYYY"}})}),$("[otr]").click(function(){var e="Over Transit Report";s(e,"REPORT_MODAL_01","Plant Site",function(){o({origin_id:i,status:{$in:["complete"]}},function(i){$("body").append(REPORTS.UI.REPORTS.OTR(e,i,n,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY")}`)})}),$("#daterange").daterangepicker({locale:{format:"MM/DD/YYYY"}})}),$("[pbpa]").click(function(){var e="Per Base Plant Activity";s(e,"REPORT_MODAL_01","Plant Base",function(){!function(e,n){var s=$("#daterange").val(),o=FILTER.DATERANGE(s);if(t=o.$gte,a=o.$lt,t.isEmpty()||a.isEmpty())toastr.error("Please fill all the required fields.");else{var r={status:"complete",departure_date:FILTER.DATERANGE(`${DATETIME.FORMAT(t,"MM/DD/YYYY")} - ${DATETIME.FORMAT(a,"MM/DD/YYYY")}`)},d=""!=i?e:{};r=$.extend(r,d),l({countURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(r)}/count`,dataURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(r)}`,callback:n})}}({origin_id:i},function(i){$("body").append(REPORTS.UI.REPORTS.PBPA(e,i,n,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY")}`)})}),$("#daterange").daterangepicker({locale:{format:"MM/DD/YYYY"}})}),$("[hwtr]").click(function(){var e="Haulage Window Time Report";s(e,"REPORT_MODAL_02","Destination Site",function(){!function(e,a){var n=$("#daterange").val(),s=FILTER.DATERANGE(n);if((t=s.$gte).isEmpty())toastr.error("Please fill all the required fields.");else{var o={departure_date:FILTER.DATERANGE(`${DATETIME.FORMAT(t,"MM/DD/YYYY")}`)},r=""!=i?e:{};o=$.extend(o,r),l({countURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}/count`,dataURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}`,callback:a})}}({destination:{$elemMatch:{location_id:i}}},function(a){$("body").append(REPORTS.UI.REPORTS.HWTR(e,a,n,t)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY")}`)})}),$("#daterange").daterangepicker({singleDatePicker:!0,locale:{format:"MM/DD/YYYY"}})}),$("[tr]").click(function(){var e="Trippage Report";s(e,"REPORT_MODAL_04",null,function(){!function(e){var a=$("#daterange").val(),i=FILTER.DATERANGE(a);t=i.$gte;var n=$("#_origin_site option:selected").text()||"All",s=$("#_destination_site option:selected").text()||"All",l=$("#_destination_site option:selected").val()||0,o="-";t.isEmpty()?toastr.error("Please fill all the required fields."):($("#generate-btn").html('<i class="la la-spinner la-spin mr-2"></i>Generate report').attr("disabled",!0),"All"!=s?GET.AJAX({url:`api/geofences/${CLIENT.id}/${USER.username}/${l}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(t){console.log("Geofence:",t),t[0]&&(o=t[0].region.region||"-"),e({origin:n,destination:s,region:o}),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()},function(t){console.log(t),e({origin:n,destination:s,region:o}),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()}):(e({origin:n,destination:s,region:o}),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()))}(function(a){$("body").append(REPORTS.UI.REPORTS.TR(e,a,t)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY")}`),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()})}),$("#daterange").daterangepicker({singleDatePicker:!0,locale:{format:"MM/DD/YYYY"}})}),$("[vcr]").click(function(){var e="Vehicle CICO Report";s(e,"REPORT_MODAL_05",null,function(){var i,n,s;i=function(i){$("body").append(REPORTS.UI.REPORTS.VCR(e,i,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY_hh_mm_A")}_${DATETIME.FORMAT(a,"MM_DD_YYYY_hh_mm_A")}`),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()},n=$("#daterange").val(),s={timestamp:FILTER.DATERANGE(n,!0,!0)},t=s.timestamp.$gte,a=s.timestamp.$lt,l({countURL:`/api/events/${CLIENT.id}/${USER.username}/all/${JSON.stringify(s)}/count`,dataURL:`/api/events/${CLIENT.id}/${USER.username}/all/${JSON.stringify(s)}`,callback:function(e){e.sort(function(e,t){return e.USER_NAME.localeCompare(t.USER_NAME)||new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()}),i(e)}})}),$("#daterange").daterangepicker({timePicker:!0,locale:{format:"MM/DD/YYYY hh:mm A"}})}),$("[ular]").click(function(){var e="User Login Activity Report";s(e,"REPORT_MODAL_05",null,function(){var i,n,s,o;i=function(i){$("body").append(REPORTS.UI.REPORTS.ULAR(e,i,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY_hh_mm_A")}_${DATETIME.FORMAT(a,"MM_DD_YYYY_hh_mm_A")}`),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()},n=$("#daterange").val(),s=FILTER.DATERANGE(n,!0,!0),o={$or:[{login_date:s},{logout_date:s}]},t=s.$gte,a=s.$lt,l({countURL:`/api/user_login_activity/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}/count`,dataURL:`/api/user_login_activity/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}`,callback:function(e){e.sort(function(e,t){return e.username.localeCompare(t.username)||new Date(e.login_date).getTime()-new Date(t.login_date).getTime()}),i(e)}})}),$("#daterange").daterangepicker({timePicker:!0,locale:{format:"MM/DD/YYYY hh:mm A"}})}),$("[desr]").click(function(){var e="Dispatch Entries Summary Report";s(e,"REPORT_MODAL_05",null,function(){var i,n,s,o;i=function(i){$("body").append(REPORTS.UI.REPORTS.DESR(e,i,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY_hh_mm_A")}_${DATETIME.FORMAT(a,"MM_DD_YYYY_hh_mm_A")}`),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()},n=$("#daterange").val(),s=FILTER.DATERANGE(n,!0,!0),o={posting_date:s},t=s.$gte,a=s.$lt,l({countURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}/count`,dataURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}`,callback:function(e){e.sort(function(e,t){return new Date(e.posting_date).getTime()-new Date(t.posting_date).getTime()}),i(e)}})}),$("#daterange").daterangepicker({timePicker:!0,locale:{format:"MM/DD/YYYY hh:mm A"}})}),$("[ser]").click(function(){var e="Scheduled Entries Report";s(e,"REPORT_MODAL_05",null,function(){var i,n,s,o;i=function(i){$("body").append(REPORTS.UI.REPORTS.SER(e,i,t,a)),GENERATE.TABLE_TO_EXCEL("report-hidden",`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY_hh_mm_A")}_${DATETIME.FORMAT(a,"MM_DD_YYYY_hh_mm_A")}`),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()},n=$("#daterange").val(),s=FILTER.DATERANGE(n),o={scheduled_date:s},t=s.$gte,a=s.$lt,l({countURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}/count`,dataURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(o)}`,callback:function(e){e.sort(function(e,t){return new Date(e.posting_date).getTime()-new Date(t.posting_date).getTime()}),i(e)}})});var i=moment().add(1,"days").format("MM/DD/YYYY"),n=moment().add(2,"days").format("MM/DD/YYYY");$("#daterange").daterangepicker({opens:"left",locale:{format:"MM/DD/YYYY"}}).val(`${i} - ${n}`),$("#daterange").data("daterangepicker").setStartDate(i),$("#daterange").data("daterangepicker").setEndDate(n)}),$("[mtur]").click(function(){var e="Manpower and Truck Utilization Report";s(e,"REPORT_MODAL_07",null,function(){var i,n,s,o,r,d,c;i=function(i){$("body").append(REPORTS.UI.REPORTS.mtur(e,i,t,a));var n=[];$("[data-SheetName]").each((e,t)=>{n.push(`#${$(t).attr("id")}`)}),tablesToExcel(n.join(","),`${e}_${DATETIME.FORMAT(t,"MM_DD_YYYY_hh_mm_A")}_${DATETIME.FORMAT(a,"MM_DD_YYYY_hh_mm_A")}.xls`),$("#report-hidden,#overlay,#temp-link,[data-SheetName]").remove()},n=$("#_month").val(),s=$("#_year").val(),o=moment(`${n} 01, ${s}`),r=`${o.clone().startOf("month").format("MM/DD/YYYY")} - ${o.clone().endOf("month").format("MM/DD/YYYY")}`,d=FILTER.DATERANGE(r),c={scheduled_date:d},t=d.$gte,a=d.$lt,l({countURL:`/api/dispatch/${CLIENT.id}/${USER.username}/all/${JSON.stringify(c)}/count`,dataURL:`/api/dispatch/${CLIENT.id}/${USER.username}/mtur/${JSON.stringify(c)}`,callback:function(e){console.log("docs",e),e.sort(function(e,t){return new Date(e.scheduled_date).getTime()-new Date(t.scheduled_date).getTime()}),i(e)}})}),$("#_month").val(moment().format("MM")),$("#_year").val(moment().format("YYYY"))})};TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["GEOFENCES","ROUTES","VEHICLES","CLUSTERS"],t,function(){t=!1,LIST.geofences.forEach(t=>{t.value=t.short_name,e.push(t)}),a(),$(".custom-btn-01 i").removeClass("la-spin la-spinner").addClass("la-download"),$(".custom-btn-01:not([no_function])").removeClass("disabled")})},TABLE.FINISH_LOADING.START_CHECK()}}},NOTIFICATIONS={FUNCTION:{stream:null,init:function(){var e=new URLSearchParams(window.location.search),t=CRYPTO.DECRYPT(e.get("data")),a="notifications",i=!0,n=t.filter||{},s=t._ids||[],l=t.escalation;if(t.for=a,s.length>0){n={};var o=[];s.forEach(e=>{o.push(e)}),n.dispatch_id={$in:o},n.username=USER.username,l&&(n.escalation=Number(l))}var r="#tbl-notifications",d=null,c=function(e){var t=e.dispatchDetails||{status:"deleted"},i=TABLE.ROW_BUTTONS(PAGE.GET(),{username:e.username,status:t.status,loadView:["comment"],readonlyArr:["comment"]});$(`${r} th:last-child`).css({"min-width":i.width,width:i.width}),!e._row&&(e._row=GENERATE.RANDOM(36)),LIST[a].push(e);var n=getUser(e.username||"")||{},s=USER.username==e.username?"You":n.name||e.username||"-",l="lq";return"Over CICO"==e.delay_type&&(l="oc"),"Over Transit"==e.delay_type&&(l="ot"),TABLE.COL_ROW(null,{dispatch_id:e.dispatch_id,_row:e._row,_id:e._id,type:l,"Shipment No":t._id||e.dispatch_id,"Departure Date":DATETIME.FORMAT(t.departure_date),"Delay Type":e.delay_type||"-",Escalation:e.escalation||"-",Timelapse:DATETIME.HH_MM(null,e.timelapse).hour_minute,Site:e.site||"-",Status:GET.STATUS(t.status).html,DateTime:DATETIME.FORMAT(e.timestamp),"Sent to":s,Action:i.buttons},"Sent to").row},u=function(e){LIST[a]=[];var t=$.isEmptyObject(n)?{timestamp:FILTER.DATERANGE()}:n,i=TABLE.BUTTONS({goto:PAGE.GET(),actions:{refresh:function(){u(null)},filter:function(){$("#export-container").hide("slide",{direction:"right"},100),$("#filter-container").toggle("slide",{direction:"right"},100)},export:function(){$("#filter-container").hide("slide",{direction:"right"},100),$("#export-container").toggle("slide",{direction:"right"},100)}}});ISMOBILE?($("#refresh-toggle .la-refresh").addClass("la-spin"),$("#refresh-toggle").addClass("disabled"),$("#filter-container input,#filter-container select").attr("disabled",!0),$("#filter-container button,#filter-container a").addClass("disabled"),"development"!=ENVIRONMENT&&(t.username=USER.username),GET.AJAX({url:`/api/${a}/${CLIENT.id}/${USER.username}/all/${JSON.stringify(t)}/0/0`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(t){console.log("docs",t);var i="";t.forEach((e,t)=>{var n=LIST[a].findIndex(t=>t._id.toString()==e._id.toString());n>-1?LIST[a][n]=e:(e._row=GENERATE.RANDOM(36),LIST[a].push(e)),i+=NOTIFICATIONS.FUNCTION.mobileAddToList({val:e,urlPath:a})}),$("#refresh-toggle .la-refresh").removeClass("la-spin"),$("#refresh-toggle").removeClass("disabled"),$("#filter-container input,#filter-container select").attr("disabled",!1),$("#filter-container button,#filter-container a").removeClass("disabled"),$("#filter-btn").html("Apply"),e&&(PAGE.DISPLAY(),$("#filter-container").css({width:"70%",top:"69px",height:"calc(100% - 134px)"}),$(".panel.panel-profile .page-box").css("margin-top","30px"),$(".panel.panel-profile .clearfix").before(mobileOptions.notifications.filter()),$("#refresh-toggle").click(function(){d||$(".page-box.row > .col-sm-12").html('<div style="text-align: center;margin-top: 15px;">Loading...</div>'),u(null)}),$("#filter-toggle").click(function(){$("#filter-container").toggle("slide",{direction:"right"},100)}),p(),$(".page-box.row").addClass("p-2"),$(".page-box.row > .col-sm-12").removeClass().addClass("col-sm-12 p-0"),$(".main-content").addClass("p-0")),t.length>0?$(".page-box.row > .col-sm-12").html(i):$(".page-box.row > .col-sm-12").html('<div style="text-align: center;margin-top: 15px;">You do not have any notifications</div>'),TABLE.WATCH({urlPath:a,options:function(){TABLE.FINISH_LOADING.START_CHECK()}})})):(d&&d.clear().draw(),TABLE.POPULATE({url:`${a}/${CLIENT.id}/${USER.username}/all`,withFilter:!0,goto:a,urlPath:a,withPagination:!0,filter:t,commentTitle:"Notifications",newlyLoaded:e,table_id:r,dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.notifications(),null,"Sent to").column,order:[[6,"desc"]],createdRow:function(e,t,i){var n=t._row;$(e).attr("_row",t._row);var s=t.dispatch_id,l=t.type,o=t._id;TABLE.ROW_LISTENER({table_id:r,_row:n,urlPath:a,_id:o,additionalListeners:function(){$(r).on("click",`[_row="${n}"] [view],[_row="${n}"] + tr.child [view]`,function(e){e.stopImmediatePropagation(),$("body").append(MODAL.CREATE.EMPTY("View Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({_id:s}),$("html, body,#modal").animate({scrollTop:0},"fast")}),$(r).on("click",`[_row="${n}"] [comment],[_row="${n}"] + tr.child [comment]`,function(e){e.stopImmediatePropagation();var a=Number(t.Escalation),i="";1==a&&(i="ESCALATION 1"),2==a&&(i="ESCALATION 2"),3==a&&(i="ESCALATION 3"),MODAL.CONFIRMATION_W_FIELD({content:`<div style="font-weight: normal;border-bottom: 1px solid #eee;padding: 3px 0px;border-top: 1px solid #eee;">${i}</div>Please add your comments/remarks below.<a id="${s}-view" href="javascript:void(0);" class="mt-1 d-block">View shipment entry</a>`,confirmCloseCondition:!0,confirmButtonText:"Submit",confirmBGStyle:"background-color: #00a548;",cancelButtonText:"Cancel",confirmCallback:function(e){var t={},i=(new Date).getTime();1==a&&(t[`esc1_remarks.${i}`]={remarks:e,username:USER.username,type:l}),2==a&&(t[`esc2_remarks.${i}`]={remarks:e,username:USER.username,type:l}),3==a&&(t[`esc3_remarks.${i}`]={remarks:e,username:USER.username,type:l}),Object.keys(t).length>0&&(t[`history.${i}`]=`<username>${USER.username}</username> added a comment/remark.`,GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${s}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(t)},function(e){1==e.ok?toastr.success("Comment/remark added successfully.",null,{timeOut:1500}):toastr.error("Something went wrong</br></br>Error Code - ec023/03"),$("#confirm-modal").remove()},function(e){console.log(e),$("#confirm-modal").remove(),toastr.error("Something went wrong</br></br>Error Code - ec023/03")}))}}),$(`#${s}-view`).click(function(){$("body").append(modalViews.dispatch.fullView(s)),$("html, body,#modal").animate({scrollTop:0},"fast")})})}})},dom:'lB<"toolbar">frtip',buttons:i},initializeCallback:function(e,t){d=t,p(),TABLE.WATCH({urlPath:a,rowData:c,options:function(){TABLE.FINISH_LOADING.START_CHECK()}})},populateCallback:function(e){var t=[];$.each(e,function(e,a){t.push(c(a))}),d.rows.add(t).draw(!1)}}))},p=function(){$(".page-box").append(SLIDER.EXPORT()),TABLE.TOOLBAR(d),$(".buttons-copy span").html("Copy Table"),$(".buttons-csv span").html("Export Table As CSV File"),$(".buttons-excel span").html("Export Table As Excel File"),FILTER.RESET({dateEl:"#_timestamp",selectEl:"#_delay_type,#_escalation",populateTable:u}),$("#_timestamp").daterangepicker({opens:"left",autoUpdateInput:!1,autoApply:!0},function(e,t,a){FILTER.INITIALIZE($(this)[0].element,e,t),$(".clearable").trigger("input")}).on("apply.daterangepicker",function(e,t){FILTER.INITIALIZE($(this),t.startDate,t.endDate),$(".clearable").trigger("input")}),n.dispatch_id||(n.timestamp&&FILTER.INITIALIZE("#_timestamp",n.timestamp.$gte,n.timestamp.$lt),n.delay_type&&$("#_delay_type").val(n.delay_type),n.escalation&&$("#_escalation").val(n.escalation),(n.timestamp||n.delay_type||n.escalation)&&($("#filter-container").toggle("slide",{direction:"right"},100),$(".clearable").trigger("input"),$("#reset-btn").removeClass("disabled"),FILTER.STATUS="new")),$("#filter-btn").click(function(){n={};var e=$("#_timestamp").val()||DEFAULT_DATE,a=$("#_delay_type").val(),i=$("#_escalation").val();!e.isEmpty()&&(n.timestamp=FILTER.DATERANGE(e)),"all"!=a&&(n.delay_type=a),"all"!=i&&(n.escalation=Number(i)),FILTER.STATUS="new",$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),t=$.extend(t,{filter:n}),window.history.pushState({},null,`?data=${CRYPTO.ENCRYPT(t)}#${PAGE.GET()}`),d||$(".page-box.row > .col-sm-12").html('<div style="text-align: center;margin-top: 15px;">Loading...</div>'),u()})};LIST[a]=[],u(!0),TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["GEOFENCES","ROUTES","VEHICLES"],i,function(){i=!1,TABLE.FINISH_LOADING.UPDATE(),$(r).on("page.dt length.dt draw.dt order.dt",function(){TABLE.FINISH_LOADING.START_CHECK(),$(`${r} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${r} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})})}),isFinishedLoading(["GEOFENCES","ROUTES","VEHICLES"],!0,function(){TABLE.FINISH_LOADING.UPDATE()})},TABLE.FINISH_LOADING.START_CHECK()},mobileAddToList:function(e,t){var a=e.val,i=e.urlPath,n=a.dispatch_id,s=function(e){var t=(e.dispatchDetails?e.dispatchDetails[0]:{status:"deleted"})||{status:"deleted"},a=getUser(e.username)||{},i=t.status,s="deleted"==i?{buttons:""}:TABLE.ROW_BUTTONS(PAGE.GET(),{username:e.username,status:i}),l=!1===e.read?"unread":"",o=["complete","incomplete","deleted"].includes(i)?"":'<span class="ongoing" style="width: 7px;height: 7px;background: #00a548;border-radius: 20px;top: 14px;margin-left: 4px;position: absolute;"></span>';return`<div class="container-parent col-sm-12 p-0 text-dark p-0" _row="${e._row}">\n                                    <div class="container-header pt-2 pl-4 pr-4 pb-2 ${l}">\n                                        <span class="container-header-title">${n||"-"}${o}</span>\n                                        <div class="container-header-body">${e.site}, ${e.escalation}, ${e.delay_type}</div>\n                                        <i class="la la-angle-up" style="display:none;"></i>\n                                    </div>\n                                    <div class="container-body pr-4 pb-2" style="display:none;">\n                                        <div><span style="display: table-cell;width: 80px;">Site</span><span style="display: table-cell;">${e.site}</span></div>\n                                        <div><span style="display: table-cell;width: 80px;">Date/Time</span><span style="display: table-cell;">${DATETIME.FORMAT(e.timestamp)}</span></div>\n                                        <div><span style="display: table-cell;width: 80px;">Escalation</span><span style="display: table-cell;">${e.escalation}</span></div>\n                                        <div><span style="display: table-cell;width: 80px;">Timelapse</span><span style="display: table-cell;">${DATETIME.HH_MM(null,e.timelapse).hour_minute}</span></div>\n                                        <div><span style="display: table-cell;width: 80px;">Delay Type</span><span style="display: table-cell;">${e.delay_type}</span></div>\n                                        <div><span style="display: table-cell;width: 80px;">Sent to</span><span style="display: table-cell;">${a.name||e.username}</span></div>\n                                        <div><span style="display: table-cell;width: 80px;">Action</span><span style="display: table-cell;">${s.buttons}</span></div>\n                                    </div>\n                                </div>`},l=function(){var e=(a.dispatchDetails?a.dispatchDetails[0]:{status:"deleted"})||{status:"deleted"};$("body").on("click",`[_row="${a._row}"] > .container-header`,function(){var t=$(this).parent(),a=LIST[i].findIndex(e=>e._row==$(t).attr("_row")),n=LIST[i][a],s=function(e){$(e).removeClass("active"),$(e).find(".container-body").slideUp(100,null,function(){$(e).find(".container-header-body").slideDown(50)}),$(e).find(".la-angle-up").hide(),$(e).find(".container-header-title .ongoing").css("opacity",1),$(e).find(".container-header-title > [status]").remove()};$(t).hasClass("active")?s(t):($(".container-parent").each((e,t)=>{s(t)}),$(t).addClass("active"),$(t).find(".container-body").slideDown(100,null,function(){$(t).find(".container-header-body").slideUp(50),$(t).find(".la-angle-up").slideDown(50)}),$(t).find(".container-header-title .ongoing").css("opacity",0),$(t).find(".container-header-title").append(`<span status> - ${e.status.capitalize()}</span>`),n&&!n.read&&(LIST[i][a].read=!0,$(t).find(".container-header").removeClass("unread"),GET.AJAX({url:`/api/${i}/${CLIENT.id}/${USER.username}/${n._id}/read`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify({})})))}),$("body").on("click",`[_row="${a._row}"] [view]`,function(e){e.stopImmediatePropagation(),$("body").append(MODAL.CREATE.EMPTY("View Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({_id:n}),$("html, body,#modal").animate({scrollTop:0},"fast")}),$("body").on("click",`[_row="${a._row}"] [comment]`,function(e){e.stopImmediatePropagation(),$("body").append(MODAL.CREATE.EMPTY("Add Comment on Dispatch Entry",modalViews.dispatch.form())),DISPATCH.FUNCTION.form({_id:n,escalation:a.escalation,type:"delay"}),$("html, body,#modal").animate({scrollTop:0},"fast")})};return!0===t?new Promise((e,t)=>{GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${a.dispatch_id}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(t){var i=t[0];i&&(a.dispatchDetails=[i]),l(),e(s(a))})}):(l(),s(a))}}},EVENT_VIEWER={FUNCTION:{stream:null,init:function(){var e=new Table({id:"#tbl-events",urlPath:"events",goto:"events_sn",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.event_viewer()).column,order:[[0,"desc"]],createdRow:function(t,a,i){var n=a._row;$(t).attr("_row",n),e.rowListeners(n,a._id)},dom:'lB<"toolbar">frti<"tbl-progress-bar">p'}});e.filter=2!=CLIENT.type?{timestamp:FILTER.DATERANGE(),shipment_number:{$exists:!0}}:{timestamp:FILTER.DATERANGE()},e.setButtons({actions:{refresh:function(){e.countRows()},filter:function(){$("#filter-container").toggle("slide",{direction:"right"},100)},report:function(){$("#report-container").toggle("slide",{direction:"right"},100)}}}),e.addRow=function(e){var t="start"==e.stage?"text-success":"text-danger",a=TABLE.ROW_BUTTONS(PAGE.GET());return $(`${this.id} th:last-child`).css({"min-width":a.width,width:a.width}),e.shipment_number=e.shipment_number||[],TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Date:DATETIME.FORMAT(e.timestamp),"Shipment Numbers":`${e.shipment_number[0]}${GET.LENGTH(e.shipment_number.length).text}`,"Rule Name":`${e.RULE_NAME} (<span class="${t}">${e.stage}</span>)`,"Vehicle Name":e.USER_NAME||"-","Geofence Name":e.GEOFENCE_NAME||"-",Action:a.buttons}).row},e.rowListeners=function(e,t){const a=this;$(a.id).on("click",`[_row="${e}"] [view],[_row="${e}"] + tr.child [view]`,function(e){e.stopImmediatePropagation();var i=LIST[a.urlPath].find(e=>e._id.toString()==t.toString());if(i){var n="";$("body").append(modalViews.events.details(i._id,i.shipment_number)),["stage","GEOFENCE_NAME","GEOFENCE_ID","RULE_NAME","USER_NAME","USER_USERNAME","ASSIGNED_VEHICLE_ID","Region","Cluster","Site"].forEach(e=>{n+=`<tr>\n                                <td>${e}</td>\n                                <td>${i[e]||"-"}</td>\n                            </tr>`}),$("#tbl-notification > tbody").html(n)}})},e.filterListener=function(t,a){var i;FILTER.RESET({dateEl:"#_date,#_rdate",populateTable:function(){var t=$("#_date").val()||DEFAULT_DATE;FILTER.STATUS="new",$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),e.filter=2!=CLIENT.type?{timestamp:FILTER.DATERANGE(t),shipment_number:{$exists:!0}}:{timestamp:FILTER.DATERANGE(t)},e.countRows()}}),$("#_date,#_rdate").daterangepicker({opens:"left",autoUpdateInput:!1,singleDatePicker:!0,autoApply:!0},function(e,t,a){FILTER.INITIALIZE($(this)[0].element,e,t),$(".clearable").trigger("input")}).on("apply.daterangepicker",function(e,t){FILTER.INITIALIZE($(this),t.startDate,t.endDate),$(".clearable").trigger("input")}),$("#filter-btn").click(function(){var t=$("#_date").val()||DEFAULT_DATE;FILTER.STATUS="new",$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),e.filter=2!=CLIENT.type?{timestamp:FILTER.DATERANGE(t),shipment_number:{$exists:!0}}:{timestamp:FILTER.DATERANGE(t)},e.countRows()}),$("#report-btn").click(function(){var e=$("#_rdate").val()||DEFAULT_DATE;$(this).html('<i class="la la-spinner la-spin"></i> Generate').addClass("disabled"),$("#mreport-container").hide(),$("[mreport]").addClass("disabled");var t=moment(new Date(e)).subtract(1,"days").format("MM/DD/YYYY"),a={timestamp:FILTER.DATERANGE(`${t}, 05:00 PM - ${e}`,!0)};$.ajax({url:`/api/events/${CLIENT.id}/${USER.username}/all/${JSON.stringify(a)}/0/0`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(t){console.log("Events SN:",t),i=REPORTS.UI.REPORTS.TODR.process(t,e),$("#report-btn").html("Generate").removeClass("disabled"),$("#mreport-container").show(),$("#mreport-date").html(moment(e).format("MMMM DD, YYYY")),Object.keys(i.summaryTotal).forEach(e=>{i.summaryTotal[e]>0&&("P05:01:00 PM - 12:00:59 AM"==e&&$('[mreport="todr-05-12"]').removeClass("disabled"),"12:01:00 AM - 07:00:59 AM"==e&&$('[mreport="todr-12-07"]').removeClass("disabled"),"07:01:00 AM - 09:00:59 AM"==e&&$('[mreport="todr-07-09"]').removeClass("disabled"),"09:01:00 AM - 12:00:59 PM"==e&&$('[mreport="todr-09-12"]').removeClass("disabled"),"12:01:00 PM - 03:00:59 PM"==e&&$('[mreport="todr-12-03"]').removeClass("disabled"),"03:01:00 PM - 05:00:59 PM"==e&&$('[mreport="todr-03-05"]').removeClass("disabled"))})}).fail(function(e){console.log(e),$("#report-btn").html("Generate").removeClass("disabled"),toastr.error("Something went wrong</br></br>Error Code - ec016/01")})});var n=function(e,t){var a=`Trucks Outside DC On ${i.date} @ ${t||e}`,n=a.replace(/\//g,"_").replace(/:/g,"_").replace(/ /g,"_").replace(/@/g,"");$("body").append(REPORTS.UI.REPORTS.TODR.generate(a,e,i.obj)),GENERATE.TABLE_TO_EXCEL("report-hidden",n),$("#report-hidden,#temp-link,[data-SheetName]").remove()};$('[mreport="todr-05-12"]').click(function(){n("P05:01:00 PM - 12:00:59 AM","(Prev) 05:01:00 PM - 12:00:59 AM")}),$('[mreport="todr-12-07"]').click(function(){n("12:01:00 AM - 07:00:59 AM")}),$('[mreport="todr-07-09"]').click(function(){n("07:01:00 AM - 09:00:59 AM")}),$('[mreport="todr-09-12"]').click(function(){n("09:01:00 AM - 12:00:59 PM")}),$('[mreport="todr-12-03"]').click(function(){n("12:01:00 PM - 03:00:59 PM")}),$('[mreport="todr-03-05"]').click(function(){n("03:01:00 PM - 05:00:59 PM")})},e.initialize(),e.countRows()}}},ALL_EVENTS={FUNCTION:{stream:null,init:function(){var e=new Table({id:"#tbl-all-events",urlPath:"events",perColumnSearch:!0,goto:"all_events",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.all_events).column,order:[[0,"desc"]],createdRow:function(t,a,i){var n=a._row;$(t).attr("_row",n),e.rowListeners(n,a._id)},dom:'lBrti<"tbl-progress-bar">p'}});e.filter={timestamp:FILTER.DATERANGE()},e.setButtons({actions:{refresh:function(){e.countRows()},filter:function(){$("#filter-container").toggle("slide",{direction:"right"},100)},search:function(){$(".row-filter").toggle()}}}),e.addRow=function(e){var t="start"==e.stage?"text-success":"text-danger",a=TABLE.ROW_BUTTONS(PAGE.GET());return $(`${this.id} th:last-child`).css({"min-width":a.width,width:a.width}),e.shipment_number=e.shipment_number||[],TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Date:DATETIME.FORMAT(e.timestamp,"MMM D, YYYY, h:mm:ss A"),"Rule Name":`${e.RULE_NAME} (<span class="${t}">${e.stage}</span>)`,"Vehicle Name":e.USER_NAME||"-","Geofence Name":e.GEOFENCE_NAME||"-",Action:a.buttons}).row},e.rowListeners=function(t,a){const i=this;$(e.id).on("click",`[_row="${t}"] [view],[_row="${t}"] + tr.child [view]`,function(e){e.stopImmediatePropagation();var t=LIST[i.urlPath].find(e=>e._id.toString()==a.toString());if(t){var n="";$("body").append(modalViews.events.details(t._id)),["stage","GEOFENCE_NAME","GEOFENCE_ID","RULE_NAME","USER_NAME","USER_USERNAME","ASSIGNED_VEHICLE_ID","Region","Cluster","Site"].forEach(e=>{n+=`<tr>\n                                <td>${e}</td>\n                                <td>${t[e]||"-"}</td>\n                            </tr>`}),$("#tbl-notification > tbody").html(n)}})},e.filterListener=function(t,a){FILTER.RESET({dateEl:"#_date",populateTable:function(){var t=$("#_date").val()||DEFAULT_DATE;FILTER.STATUS="new",$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),e.filter={timestamp:FILTER.DATERANGE(t)},e.countRows()}}),$("#_date").daterangepicker({opens:"left",autoUpdateInput:!1,singleDatePicker:!0,autoApply:!0},function(e,t,a){FILTER.INITIALIZE($(this)[0].element,e,t),$(".clearable").trigger("input")}).on("apply.daterangepicker",function(e,t){FILTER.INITIALIZE($(this),t.startDate,t.endDate),$(".clearable").trigger("input")}),$("#filter-btn").click(function(){var t=$("#_date").val()||DEFAULT_DATE;FILTER.STATUS="new",$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),e.filter={timestamp:FILTER.DATERANGE(t)},e.countRows()})},e.initialize(),e.countRows()}}},USERS={FUNCTION:{stream:null,init:function(){var e="0px",t=!0,a=PERMISSION[PAGE.GET()]||{},i=new Table({id:"#tbl-users",urlPath:"users",goto:"users",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.users()).column,createdRow:function(e,t,a){var n=t._row;$(e).attr("_row",t._row),i.rowListeners(n,t._id)},dom:'lB<"toolbar">frti<"tbl-progress-bar">p'}});i.setButtons({actions:{create:function(){n({url:`/api/users/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){i.countRows()}}}),i.addRow=function(t){var a=TABLE.ROW_BUTTONS(PAGE.GET(),{username:t._id});return"0px"!=a.width&&(e=a.width),$(`${this.id} th:last-child`).css({"min-width":e,width:e}),TABLE.COL_ROW(null,{_row:t._row,Name:t.name||"-",_id:t._id,Title:t.title||"-",Email:t.email||"-","Phone Number":t.phoneNumber||"-",Role:(t.role||"User").capitalize(),Exempted:t.exemptAutoLogout?"Yes":"No",Action:a.buttons}).row},i.rowListeners=function(e,t){TABLE.ROW_LISTENER({table_id:this.id,_row:e,urlPath:"users",_id:t,initializeModal:n})};var n=function(e){var t="POST"==e.method?"Create New User":"Edit User";$("body").append(modalViews.user.create(t,e.obj,null,"Please note that upon creating or updating user's information here will <u>not</u> affect the user in WRU Main.")),e.obj=e.obj||{},e.obj.role=e.obj.role||"user",GET.INTLTELINPUT("#phoneNumber"),"all"!==a.editPermission&&($("#role,#priv-title,#exemptAutoLogout").parent().remove(),$(".modal-dialog.modal-md").removeClass("modal-md").addClass("modal-sm").css({width:""}),$(".modal-body > div").removeClass("col-sm-5").addClass("col-sm-12")),CLIENT.tabCloseAutoLogout||$("#exemptAutoLogout").parent().remove();var i=PERMISSION_BY_ROLE[e.obj.role]||{},n=function(e){i={},$("#tbl-permission > tbody").html(""),Object.keys(e).forEach(t=>{if(PAGE_FUNCTIONALITIES[t]){var a="",n=e[t].read||"None",s=e[t].create||"None",l=e[t].update||"None",o=e[t].delete||"None";i[t]=e[t],"all"==e[t].editPermission&&(a='<small class="d-block text-muted">Allowed to Update User\'s Role & Privileges</small>'),$("#tbl-permission > tbody").append(`\n                                <tr>\n                                    <td class="font-normal" style="word-break: break-word;">${PAGE_FUNCTIONALITIES[t].title||"Unknown"}${a}</td>\n                                    <td>${n.capitalize()}</td>\n                                    <td>${s.capitalize()}</td>\n                                    <td>${l.capitalize()}</td>\n                                    <td>${o.capitalize()}</td>\n                                </tr>`)}})},s="";Object.keys(PERMISSION_BY_ROLE).forEach(t=>{var a=!0;if(clientCustom.ignoreRolesWithString.forEach(e=>{t.indexOf(e)>-1&&(a=!1)}),a){var i=e.obj.role==t?"selected":"";s+=`<option value="${t}" ${i}>${t.capitalize()}</option>`}}),$("#role").append(s);var l=$("#role option:selected").val()||"user";n(PERMISSION_BY_ROLE[l]),$("#priv-title").text(`Privileges of ${l.capitalize()}`),$("#role").change(function(){var e=$(this).val();n(PERMISSION_BY_ROLE[e.toLowerCase()]),$("#priv-title").text(`Privileges of ${e.capitalize()}`)}),$("#exemptAutoLogout").val((e.obj.exemptAutoLogout||"false").toString()),$("#submit").click(function(){var t=$("#name").val()._trim(),a=$("#username").val()._trim().toLowerCase(),i=$("#email").val()._trim(),n=($("#role option:selected").val()||e.obj.role)._trim(),s=GET.INTLTELINPUT_VALUE("#phoneNumber"),l=$("#exemptAutoLogout option:selected").val()||e.obj.exemptAutoLogout||!1;if(ALERT.REQUIREDFIELDS("#modal-error",$(this).parents("#overlay")));else{$("#submit").html('<i class="la la-spinner la-spin mr-2"></i>Submit').attr("disabled",!0);var o={_id:a,name:t,email:i,phoneNumber:s,role:n.toLowerCase(),exemptAutoLogout:"true"==l||1==l};"PUT"==e.method&&delete o._id,GET.AJAX({url:e.url,method:e.method,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(o)},function(t){1==t.ok?($("#overlay").remove(),"PUT"==e.method?TOASTR.UPDATEDSUCCESSFULLY():TOASTR.CREATEDSUCCESSFULLY()):(console.log(t),TOASTR.ERROR(t),$("#submit").html("Submit").attr("disabled",!1))},function(e){console.log(e),TOASTR.ERROR(e.responseJSON),$("#submit").html("Submit").attr("disabled",!1)})}})};TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["USERS"],t,function(){t=!1,i.initialize(),i.populateRows(LIST.users),i.hideProgressBar()})},TABLE.FINISH_LOADING.START_CHECK()}}},LOCATIONS={FUNCTION:{regions:{stream:null,init:function(){var e="regions",t=!0,a=null,i=new Table({id:"#tbl-regions",urlPath:e,goto:"regions",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.regions).column,order:[[1,"asc"]],createdRow:function(e,t,a){var n=t._row;$(e).attr("_row",n),i.rowListeners(n,t._id)},dom:'lB<"toolbar">frti<"tbl-progress-bar">p'},initializeCallback:function(){TABLE.WATCH({urlPath:e,rowData:i.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),a&&TABLE.FINISH_LOADING.UPDATE()}});i.setButtons({loadView:["create"],actions:{create:function(){n({url:`/api/regions/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){i.countRows()},column:function(){$("#cv-container").toggle("slide",{direction:"right"},100)}}}),i.addRow=function(e){var t=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:["edit"],readonlyArr:["edit"]});$(`${i.id} th:last-child`).css({"min-width":t.width,width:t.width});var n=function(t,i){var n=e.person_in_charge||{};n[t]=n[t]||{};var s=n[t][i]||[],l=null;if(a){var o=[];s.forEach(e=>{var t=LIST.users.find(t=>t._id===e);t?o.push(t.name||e):o.push(`<span class="text-danger" style="font-style: italic;">${e}</span>`)}),l=o.join(", ")||'<span class="text-muted font-italic">Unassigned</span>'}else l='<small class="font-italic text-muted">loading...</small>';return l};return TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Region:e.region||"-",Sequence:e.sequence,esq1_lq:n("escalation1","lq"),esq1_oc:n("escalation1","oc"),esq1_ot:n("escalation1","ot"),esq2_lq:n("escalation2","lq"),esq2_oc:n("escalation2","oc"),esq2_ot:n("escalation2","ot"),esq3_lq:n("escalation3","lq"),esq3_oc:n("escalation3","oc"),esq3_ot:n("escalation3","ot"),Action:t.buttons}).row},i.rowListeners=function(t,a){TABLE.ROW_LISTENER({table_id:i.id,_row:t,urlPath:e,_id:a,initializeModal:n,deleteModalContent:"All of the clusters and geofences linked to this region will be deleted too. Are you sure you still want to delete this region?"})},i.filterListener=function(){$(".page-box").append(SLIDER.COLUMN_VISIBILITY(CUSTOM.COLUMN.regions)),$("span.toggle-vis").on("click",function(e){var t=$(this).attr("data-column"),a=i.dt.column(t);a.visible(!a.visible()),CUSTOM.COLUMN.regions[t].visible=a.visible(),CUSTOM.COLUMN.regions[t].bVisible=a.visible(),$(i.id).attr("style",""),$(`${i.id} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${i.id} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})})};var n=function(e){var t="PUT"==e.method?"Edit Region Data":"Create New Region",i=`${ALERT.HTML.INFO("This will be overridden by the Person In-Charge set in clusters and/or sites linked to this region.","m-0 mb-3",!0)}\n                                            <div class="panel panel-tab">\n                                                <div class="panel-heading">\n                                                    <h3 class="panel-title">Person In-Charge</h3>\n                                                    <ul class="nav nav-tabs pull-right">\n                                                        <li class="active"><a href="#esc1" data-toggle="tab" aria-expanded="false"><i class="fa fa-user"></i> Escalation 1</a></li>\n                                                        <li class=""><a href="#esc2" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Escalation 2</a></li>\n                                                        <li class=""><a href="#esc3" data-toggle="tab" aria-expanded="false"><i class="fa fa-gear"></i> Escalation 3</a></li>\n                                                    </ul>\n                                                </div>\n                                                <div class="panel-body p-0">\n                                                    <div class="tab-content no-padding">\n                                                        <div class="tab-pane fade active in" id="esc1">\n                                                            <div class="panel panel-tab" style="border: none;">\n                                                                <div class="panel-heading">\n                                                                    <h3 class="panel-title"></h3>\n                                                                    <ul class="nav nav-tabs pull-right">\n                                                                        <li class="active"><a href="#_esc1-lq_" data-toggle="tab" aria-expanded="false"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                        <li class=""><a href="#_esc1-oc_" data-toggle="tab" aria-expanded="false"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                        <li class=""><a href="#_esc1-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                    </ul>\n                                                                </div>\n                                                                <div class="panel-body">\n                                                                    <div class="tab-content no-padding">\n                                                                        <div class="tab-pane fade active in" id="_esc1-lq_">\n                                                                            <select id="esc1-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                        <div class="tab-pane fade" id="_esc1-oc_">\n                                                                        <select id="esc1-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                        <div class="tab-pane fade" id="_esc1-ot_">\n                                                                            <select id="esc1-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                        <div class="tab-pane fade" id="esc2">\n                                                            <div class="panel panel-tab" style="border: none;">\n                                                                <div class="panel-heading">\n                                                                    <h3 class="panel-title"></h3>\n                                                                    <ul class="nav nav-tabs pull-right">\n                                                                        <li class="active"><a href="#_esc2-lq_" data-toggle="tab" aria-expanded="true"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                        <li class=""><a href="#_esc2-oc_" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                        <li class=""><a href="#_esc2-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                    </ul>\n                                                                </div>\n                                                                <div class="panel-body">\n                                                                    <div class="tab-content no-padding">\n                                                                        <div class="tab-pane fade active in" id="_esc2-lq_">\n                                                                            <select id="esc2-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                        <div class="tab-pane fade" id="_esc2-oc_">\n                                                                            <select id="esc2-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                        <div class="tab-pane fade" id="_esc2-ot_">\n                                                                            <select id="esc2-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                        <div class="tab-pane fade" id="esc3">\n                                                            <div class="panel panel-tab" style="border: none;">\n                                                                <div class="panel-heading">\n                                                                    <h3 class="panel-title"></h3>\n                                                                    <ul class="nav nav-tabs pull-right">\n                                                                        <li class="active"><a href="#_esc3-lq_" data-toggle="tab" aria-expanded="true"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                        <li class=""><a href="#_esc3-oc_" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                        <li class=""><a href="#_esc3-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                    </ul>\n                                                                </div>\n                                                                <div class="panel-body">\n                                                                    <div class="tab-content no-padding">\n                                                                        <div class="tab-pane fade active in" id="_esc3-lq_">\n                                                                            <select id="esc3-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                        <div class="tab-pane fade" id="_esc3-oc_">\n                                                                            <select id="esc3-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                        <div class="tab-pane fade" id="_esc3-ot_">\n                                                                            <select id="esc3-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                            <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>`;$("body").append(MODAL.CREATE.BASIC({modalStyle:"width:900px;",title:t,el:function(e){return[{title:"Region",id:"region",type:"text",required:!0,value:(e=e||{}).region},{title:"Sequence",id:"sequence",type:"number",required:!0,value:e.sequence,sub_title:"Please enter a number. This refers to the sequence of the tabs in the Deployment Dashboard."}]}(e.obj),columned:!0,column1Style:"col-sm-5",column2Style:"col-sm-7",column2Content:i}));var n=(e.obj||{}).person_in_charge||{},s="";function l(e,t,i){if(n[e]&&n[e][i]){var s=n[e][i]||[],l="";a.forEach(e=>{var t=s.includes(e.id)?"selected":"";l+=`<option value="${e.id}" ${t}>${e.value||e.id}</option>`}),$(`#${t}-${i}`).html(l).select2({multiple:!0,tokenSeparators:[",",", "],matcher:function(e,t){var a=e.term,i=t.text,n=t.id;return i.toUpperCase().indexOf(a.toUpperCase())>-1||n.toUpperCase().indexOf(a.toUpperCase())>-1?t:null}})}}a.forEach(e=>{s+=`<option value="${e.id}">${e.value||e.id}</option>`}),$("#esc1-lq,#esc2-lq,#esc3-lq,#esc1-oc,#esc2-oc,#esc3-oc,#esc1-ot,#esc2-ot,#esc3-ot").html(s).select2({multiple:!0,tokenSeparators:[",",", "],matcher:function(e,t){var a=e.term,i=t.text,n=t.id;return i.toUpperCase().indexOf(a.toUpperCase())>-1||n.toUpperCase().indexOf(a.toUpperCase())>-1?t:null}}),l("escalation1","esc1","lq"),l("escalation1","esc1","oc"),l("escalation1","esc1","ot"),l("escalation2","esc2","lq"),l("escalation2","esc2","oc"),l("escalation2","esc2","ot"),l("escalation3","esc3","lq"),l("escalation3","esc3","oc"),l("escalation3","esc3","ot"),MODAL.SUBMIT(e,null,function(){return{person_in_charge:{escalation1:{lq:$("#esc1-lq").val()||[],oc:$("#esc1-oc").val()||[],ot:$("#esc1-ot").val()||[]},escalation2:{lq:$("#esc2-lq").val()||[],oc:$("#esc2-oc").val()||[],ot:$("#esc2-ot").val()||[]},escalation3:{lq:$("#esc3-lq").val()||[],oc:$("#esc3-oc").val()||[],ot:$("#esc3-ot").val()||[]}}}})};LIST.regions=LIST.regions||[],TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["REGIONS"],t,function(){t=!1,i.initialize(),i.populateRows(LIST.regions),i.hideProgressBar()}),a&&(LIST.regions.length>0&&!LIST.regions[0]._users&&i.dt&&i.updateRows(LIST.regions),TABLE.FINISH_LOADING.UPDATE())};var s={urlPath:"users",populate:function(){a=[],LIST[this.urlPath].forEach(e=>{a.push({id:e._id,value:e.name})}),a=SORT.ARRAY_OBJECT(a,"value",{sortType:"asc"}),TABLE.FINISH_LOADING.START_CHECK()},fetch:function(){var e=this;LIST[e.urlPath]?s.populate():GET.AJAX({url:`/api/${e.urlPath}/${CLIENT.id}/${USER.username}/all/${JSON.stringify({})}/0/0`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(t){console.log("Users",t),LIST[e.urlPath]=LIST[e.urlPath]||[],t.forEach(t=>{var a=LIST[e.urlPath].findIndex(e=>e._id==t._id);a>-1?LIST[e.urlPath][a]=t:(t._row=GENERATE.RANDOM(36),LIST[e.urlPath].push(t))}),s.populate()})}};s.fetch(),TABLE.FINISH_LOADING.START_CHECK()}},clusters:{stream:null,init:function(){var e,t="clusters",a=!1,i=null,n=new Table({id:"#tbl-clusters",urlPath:t,goto:"clusters",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.clusters()).column,order:[[3,"asc"]],createdRow:function(e,t,a){var i=t._row;$(e).attr("_row",t._row),n.rowListeners(i,t._id)},dom:'lB<"toolbar">frti<"tbl-progress-bar">p'},initializeCallback:function(){TABLE.WATCH({urlPath:t,rowData:n.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),i&&GGS.STATUS.REGIONS&&TABLE.FINISH_LOADING.UPDATE()}});n.setButtons({loadView:["create"],actions:{create:function(){s({url:`/api/clusters/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){n.countRows()},search:function(){$(".row-filter").toggle()},column:function(){$("#cv-container").toggle("slide",{direction:"right"},100)}}}),n.addRow=function(e){new loadInBackground("regions","REGIONS").g_select_settings();var t,a,n=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:["edit"],readonlyArr:["edit"]});$(`${this.id} th:last-child`).css({"min-width":n.width,width:n.width}),G_SELECT.regions?(t=G_SELECT.regions.find(t=>t.id==e.region_id)||{},e._region=t.value):t={value:'<small class="font-italic text-muted">loading...</small>'},GGS.STATUS.GEOFENCES?(a=LIST.geofences.filter(t=>t.cluster_id==e._id).length,e.totalGeofences=a):a='<small class="font-italic text-muted">loading...</small>';var s=function(t,a){var n=e.person_in_charge||{};n[t]=n[t]||{};var s=n[t][a]||[],l=null;if(i){var o=[];s.forEach(e=>{var t=LIST.users.find(t=>t._id===e);t?o.push(t.name||e):o.push(`<span class="text-danger" style="font-style: italic;">${e}</span>`)}),l=o.join(", ")||'<span class="text-muted font-italic">Unassigned</span>'}else l='<small class="font-italic text-muted">loading...</small>';return l};return TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Cluster:e.cluster||"-",Region:t.value||"-",Geofences:a,Sequence:e.sequence||"-",esq1_lq:s("escalation1","lq"),esq1_oc:s("escalation1","oc"),esq1_ot:s("escalation1","ot"),esq2_lq:s("escalation2","lq"),esq2_oc:s("escalation2","oc"),esq2_ot:s("escalation2","ot"),esq3_lq:s("escalation3","lq"),esq3_oc:s("escalation3","oc"),esq3_ot:s("escalation3","ot"),Action:n.buttons}).row},n.rowListeners=function(e,a){TABLE.ROW_LISTENER({table_id:this.id,_row:e,urlPath:t,_id:a,initializeModal:s,deleteModalContent:"All of the geofences linked to this cluster will be deleted too. Are you sure you still want to delete this cluster?"})},n.filterListener=function(){$(".page-box").append(SLIDER.COLUMN_VISIBILITY(CUSTOM.COLUMN.clusters())),$("span.toggle-vis").on("click",function(e){var t=$(this).attr("data-column"),a=n.dt.column(t);a.visible(!a.visible()),CUSTOM.COLUMN.clusters()[t].visible=a.visible(),CUSTOM.COLUMN.clusters()[t].bVisible=a.visible(),$(n.id).attr("style",""),$(`${n.id} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${n.id} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})})};var s=function(e){new loadInBackground("regions","REGIONS").g_select_settings();var t,a=e.obj||{},n="PUT"==e.method?"Edit Cluster Data":"Create New Cluster",s=`${ALERT.HTML.INFO("This will override the Person In-Charge set in cluster's region but will be overridden by the Person In-Charge set per Site, if any.","m-0 mb-3",!0)}\n                                        <div class="panel panel-tab">\n                                            <div class="panel-heading">\n                                                <h3 class="panel-title">Person In-Charge</h3>\n                                                <ul class="nav nav-tabs pull-right">\n                                                    <li class="active"><a href="#esc1" data-toggle="tab" aria-expanded="false"><i class="fa fa-user"></i> Escalation 1</a></li>\n                                                    <li class=""><a href="#esc2" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Escalation 2</a></li>\n                                                    <li class=""><a href="#esc3" data-toggle="tab" aria-expanded="false"><i class="fa fa-gear"></i> Escalation 3</a></li>\n                                                </ul>\n                                            </div>\n                                            <div class="panel-body p-0">\n                                                <div class="tab-content no-padding">\n                                                    <div class="tab-pane fade active in" id="esc1">\n                                                        <div class="panel panel-tab" style="border: none;">\n                                                            <div class="panel-heading">\n                                                                <h3 class="panel-title"></h3>\n                                                                <ul class="nav nav-tabs pull-right">\n                                                                    <li class="active"><a href="#_esc1-lq_" data-toggle="tab" aria-expanded="false"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                    <li class=""><a href="#_esc1-oc_" data-toggle="tab" aria-expanded="false"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                    <li class=""><a href="#_esc1-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                </ul>\n                                                            </div>\n                                                            <div class="panel-body">\n                                                                <div class="tab-content no-padding">\n                                                                    <div class="tab-pane fade active in" id="_esc1-lq_">\n                                                                        <select id="esc1-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc1-oc_">\n                                                                    <select id="esc1-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                    <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc1-ot_">\n                                                                        <select id="esc1-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="esc2">\n                                                        <div class="panel panel-tab" style="border: none;">\n                                                            <div class="panel-heading">\n                                                                <h3 class="panel-title"></h3>\n                                                                <ul class="nav nav-tabs pull-right">\n                                                                    <li class="active"><a href="#_esc2-lq_" data-toggle="tab" aria-expanded="true"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                    <li class=""><a href="#_esc2-oc_" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                    <li class=""><a href="#_esc2-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                </ul>\n                                                            </div>\n                                                            <div class="panel-body">\n                                                                <div class="tab-content no-padding">\n                                                                    <div class="tab-pane fade active in" id="_esc2-lq_">\n                                                                        <select id="esc2-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc2-oc_">\n                                                                        <select id="esc2-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc2-ot_">\n                                                                        <select id="esc2-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="esc3">\n                                                        <div class="panel panel-tab" style="border: none;">\n                                                            <div class="panel-heading">\n                                                                <h3 class="panel-title"></h3>\n                                                                <ul class="nav nav-tabs pull-right">\n                                                                    <li class="active"><a href="#_esc3-lq_" data-toggle="tab" aria-expanded="true"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                    <li class=""><a href="#_esc3-oc_" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                    <li class=""><a href="#_esc3-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                </ul>\n                                                            </div>\n                                                            <div class="panel-body">\n                                                                <div class="tab-content no-padding">\n                                                                    <div class="tab-pane fade active in" id="_esc3-lq_">\n                                                                        <select id="esc3-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc3-oc_">\n                                                                        <select id="esc3-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc3-ot_">\n                                                                        <select id="esc3-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>`;$("body").append(MODAL.CREATE.BASIC({modalStyle:"width:900px;",title:n,el:(t=[],clientCustom.modalFields.clusters.forEach(e=>{switch(e){case"cluster":t.push({title:"Cluster",id:"cluster",type:"text",required:!0,value:a.cluster});break;case"region_id":t.push({title:"Region",id:"region_id",type:"select",required:!0,value:a.region_id,options:G_SELECT.regions});break;case"sequence":t.push({title:"Sequence",id:"sequence",type:"number",value:a.sequence,sub_title:"Please enter a number. This refers to the sequence/order of the clusters in the reports."})}}),t),columned:!0,column1Style:"col-sm-5",column2Style:"col-sm-7",column2Content:s}));var l=a.person_in_charge||{},o="";function r(e,t,a){if(l[e]&&l[e][a]){var n=l[e][a]||[],s="";i.forEach(e=>{var t=n.includes(e.id)?"selected":"";s+=`<option value="${e.id}" ${t}>${e.value||e.id}</option>`}),$(`#${t}-${a}`).html(s).select2({multiple:!0,tokenSeparators:[",",", "],matcher:function(e,t){var a=e.term,i=t.text,n=t.id;return i.toUpperCase().indexOf(a.toUpperCase())>-1||n.toUpperCase().indexOf(a.toUpperCase())>-1?t:null}})}}i.forEach(e=>{o+=`<option value="${e.id}">${e.value||e.id}</option>`}),$("#esc1-lq,#esc2-lq,#esc3-lq,#esc1-oc,#esc2-oc,#esc3-oc,#esc1-ot,#esc2-ot,#esc3-ot").html(o).select2({multiple:!0,tokenSeparators:[",",", "],matcher:function(e,t){var a=e.term,i=t.text,n=t.id;return i.toUpperCase().indexOf(a.toUpperCase())>-1||n.toUpperCase().indexOf(a.toUpperCase())>-1?t:null}}),r("escalation1","esc1","lq"),r("escalation1","esc1","oc"),r("escalation1","esc1","ot"),r("escalation2","esc2","lq"),r("escalation2","esc2","oc"),r("escalation2","esc2","ot"),r("escalation3","esc3","lq"),r("escalation3","esc3","oc"),r("escalation3","esc3","ot"),MODAL.SUBMIT(e,null,function(){return{person_in_charge:{escalation1:{lq:$("#esc1-lq").val()||[],oc:$("#esc1-oc").val()||[],ot:$("#esc1-ot").val()||[]},escalation2:{lq:$("#esc2-lq").val()||[],oc:$("#esc2-oc").val()||[],ot:$("#esc2-ot").val()||[]},escalation3:{lq:$("#esc3-lq").val()||[],oc:$("#esc3-oc").val()||[],ot:$("#esc3-ot").val()||[]}}}})};LIST.clusters=LIST.clusters||[],TABLE.FINISH_LOADING.CHECK=function(){i&&LIST.clusters.length>0&&!LIST.clusters[0]._users&&n.dt&&n.updateRows(LIST.clusters),GGS.STATUS.GEOFENCES&&LIST.clusters.length>0&&null==LIST.clusters[0].totalGeofences&&n.dt&&n.updateRows(LIST.clusters),GGS.STATUS.REGIONS&&LIST.clusters.length>0&&!LIST.clusters[0]._region&&n.updateRows(LIST.clusters),GGS.STATUS.CLUSTERS&&(a||(a=!0,n.initialize(),n.populateRows(LIST.clusters),n.hideProgressBar())),i&&GGS.STATUS.REGIONS&&TABLE.FINISH_LOADING.UPDATE()},(e={urlPath:"users",populate:function(){i=[],LIST[this.urlPath].forEach(e=>{i.push({id:e._id,value:e.name})}),i=SORT.ARRAY_OBJECT(i,"value",{sortType:"asc"}),TABLE.FINISH_LOADING.START_CHECK()},fetch:function(){var t=this;LIST[t.urlPath]?e.populate():GET.AJAX({url:`/api/${t.urlPath}/${CLIENT.id}/${USER.username}/all/${JSON.stringify({})}/0/0`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(a){console.log("Users",a),LIST[t.urlPath]=LIST[t.urlPath]||[],a.forEach(e=>{var a=LIST[t.urlPath].findIndex(t=>t._id==e._id);a>-1?LIST[t.urlPath][a]=e:(e._row=GENERATE.RANDOM(36),LIST[t.urlPath].push(e))}),e.populate()})}}).fetch(),TABLE.FINISH_LOADING.START_CHECK()}},geofences:{stream:null,init:function(){var e,t="geofences",a=!1,i=null,n=new Table({id:"#tbl-geofences",urlPath:t,goto:"geofences",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.geofences).column,order:[[0,"desc"]],createdRow:function(e,t,a){var i=t._row;$(e).attr("_row",t._row),n.rowListeners(i,t._id)},dom:'lB<"toolbar">frti<"tbl-progress-bar">p'},initializeCallback:function(){$(".row-filter").hide(),PAGE.TOOLTIP(),TABLE.WATCH({urlPath:t,rowData:n.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),i&&GGS.STATUS.REGIONS&&GGS.STATUS.CLUSTERS&&TABLE.FINISH_LOADING.UPDATE()}});n.filter={},n.setButtons({loadView:["create"],actions:{refresh:function(){n.countRows()},column:function(){$("#cv-container").toggle("slide",{direction:"right"},100)}}}),n.addRow=function(e){var t=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:["edit"],readonlyArr:["edit"]}),a=function(t,a,i){var n;return t?(n=t.find(t=>t.id==e[a])||{},e[i]=n.value):n={value:'<small class="font-italic text-muted">loading...</small>'},n},s=function(t,a){var n=e.person_in_charge||{};n[t]=n[t]||{};var s=n[t][a]||[],l=null;if(i){var o=[];s.forEach(e=>{var t=LIST.users.find(t=>t._id===e);t?o.push(t.name||e):o.push(`<span class="text-danger" style="font-style: italic;">${e}</span>`)}),l=o.join(", ")||'<span class="text-muted font-italic">Unassigned</span>'}else l='<small class="font-italic text-muted">loading...</small>';return l},l=a(G_SELECT.regions,"region_id","_region"),o=a(G_SELECT.clusters,"cluster_id","_cluster"),r=function(t,a){var n=null;if(i){e[t]=e[t]||[];var s=[];e[t].forEach(e=>{var t=LIST.users.find(t=>t._id===e);t?s.push(t.name||e):s.push(`<span class="text-danger" style="font-style: italic;">${e}</span>`)}),e[a]=s.join(", ")||'<span class="text-muted font-italic">Unassigned</span>',n=e[a]}else n='<small class="font-italic text-muted">loading...</small>';return n}("dispatcher","_dUsers");return $(`${n.id} th:last-child`).css({"min-width":t.width,width:t.width}),TABLE.COL_ROW(null,{_id:e._id,_row:e._row,"Site Code":e.code||"-","Site Name":e.site_name||"-","Short Name":e.short_name||"-",CICO:DATETIME.HH_MM(null,e.cico).hour_minute,Cluster:o.value||"-",Region:l.value||"-",Dispatcher:r,esq1_lq:s("escalation1","lq"),esq1_oc:s("escalation1","oc"),esq1_ot:s("escalation1","ot"),esq2_lq:s("escalation2","lq"),esq2_oc:s("escalation2","oc"),esq2_ot:s("escalation2","ot"),esq3_lq:s("escalation3","lq"),esq3_oc:s("escalation3","oc"),esq3_ot:s("escalation3","ot"),Action:t.buttons}).row},n.rowListeners=function(e,a){TABLE.ROW_LISTENER({table_id:this.id,_row:e,urlPath:t,_id:a,initializeModal:s})},n.filterListener=function(){$(".page-box").append(SLIDER.COLUMN_VISIBILITY(CUSTOM.COLUMN.geofences)),$("span.toggle-vis").on("click",function(e){var t=$(this).attr("data-column"),a=n.dt.column(t);a.visible(!a.visible()),CUSTOM.COLUMN.geofences[t].visible=a.visible(),CUSTOM.COLUMN.geofences[t].bVisible=a.visible(),$(n.id).attr("style",""),$(`${n.id} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${n.id} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})})};var s=function(e){new loadInBackground("regions","REGIONS").g_select_settings(),new loadInBackground("clusters","CLUSTERS").g_select_settings();var t=`${ALERT.HTML.INFO("This will override the Person In-Charge set in site's region and cluster.","m-0 mb-3",!0)}\n                                        <div class="panel panel-tab">\n                                            <div class="panel-heading">\n                                                <h3 class="panel-title">Person In-Charge</h3>\n                                                <ul class="nav nav-tabs pull-right">\n                                                    <li class="active"><a href="#esc1" data-toggle="tab" aria-expanded="false"><i class="fa fa-user"></i> Escalation 1</a></li>\n                                                    <li class=""><a href="#esc2" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Escalation 2</a></li>\n                                                    <li class=""><a href="#esc3" data-toggle="tab" aria-expanded="false"><i class="fa fa-gear"></i> Escalation 3</a></li>\n                                                </ul>\n                                            </div>\n                                            <div class="panel-body p-0">\n                                                <div class="tab-content no-padding">\n                                                    <div class="tab-pane fade active in" id="esc1">\n                                                        <div class="panel panel-tab" style="border: none;">\n                                                            <div class="panel-heading">\n                                                                <h3 class="panel-title"></h3>\n                                                                <ul class="nav nav-tabs pull-right">\n                                                                    <li class="active"><a href="#_esc1-lq_" data-toggle="tab" aria-expanded="false"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                    <li class=""><a href="#_esc1-oc_" data-toggle="tab" aria-expanded="false"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                    <li class=""><a href="#_esc1-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                </ul>\n                                                            </div>\n                                                            <div class="panel-body">\n                                                                <div class="tab-content no-padding">\n                                                                    <div class="tab-pane fade active in" id="_esc1-lq_">\n                                                                        <select id="esc1-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc1-oc_">\n                                                                    <select id="esc1-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                    <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc1-ot_">\n                                                                        <select id="esc1-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="esc2">\n                                                        <div class="panel panel-tab" style="border: none;">\n                                                            <div class="panel-heading">\n                                                                <h3 class="panel-title"></h3>\n                                                                <ul class="nav nav-tabs pull-right">\n                                                                    <li class="active"><a href="#_esc2-lq_" data-toggle="tab" aria-expanded="true"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                    <li class=""><a href="#_esc2-oc_" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                    <li class=""><a href="#_esc2-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                </ul>\n                                                            </div>\n                                                            <div class="panel-body">\n                                                                <div class="tab-content no-padding">\n                                                                    <div class="tab-pane fade active in" id="_esc2-lq_">\n                                                                        <select id="esc2-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc2-oc_">\n                                                                        <select id="esc2-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc2-ot_">\n                                                                        <select id="esc2-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="esc3">\n                                                        <div class="panel panel-tab" style="border: none;">\n                                                            <div class="panel-heading">\n                                                                <h3 class="panel-title"></h3>\n                                                                <ul class="nav nav-tabs pull-right">\n                                                                    <li class="active"><a href="#_esc3-lq_" data-toggle="tab" aria-expanded="true"><i class="fa fa-user"></i>Long Queueing</a></li>\n                                                                    <li class=""><a href="#_esc3-oc_" data-toggle="tab" aria-expanded="true"><i class="fa fa-feed"></i> Over CICO</a></li>\n                                                                    <li class=""><a href="#_esc3-ot_" data-toggle="tab" aria-expanded="true"><i class="fa fa-gear"></i>Over Transit</a></li>\n                                                                </ul>\n                                                            </div>\n                                                            <div class="panel-body">\n                                                                <div class="tab-content no-padding">\n                                                                    <div class="tab-pane fade active in" id="_esc3-lq_">\n                                                                        <select id="esc3-lq" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc3-oc_">\n                                                                        <select id="esc3-oc" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                    <div class="tab-pane fade" id="_esc3-ot_">\n                                                                        <select id="esc3-ot" class="select-multiple-basic" multiple="multiple" style="width:100%;" doNotSave="true"></select>\n                                                                        <small class="text-muted">Search by name or username.<br>Press enter key or comma (,) to add value to list.</small>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>`;$("body").append(MODAL.CREATE.BASIC({modalStyle:"width:900px;",title:"Edit Site Data",el:function(e){var t=!!(e=e||{}).code;return[{title:"Site Name",id:"site_name",type:"text",required:!0,value:e.site_name},{title:"Short Name",id:"short_name",type:"text",required:!0,value:e.short_name},{title:"Site Code",id:"code",type:"text",required:!0,value:e.code,readonly:t,sub_title:"You <u>cannot</u> change the site code once saved."},{title:"CICO (HH:MM)",id:"cico",type:"time",required:!0,value:e.cico},{title:"Cluster",id:"cluster_id",type:"select",value:e.cluster_id,options:G_SELECT.clusters},{title:"Region",id:"region_id",type:"select",required:!0,value:e.region_id,options:G_SELECT.regions},{title:"Dispatcher",id:"dispatcher",type:"select2",multiple:!0,value:e.dispatcher,options:i}]}(e.obj),columned:!0,column1Style:"col-sm-5",column2Style:"col-sm-7",column2Content:t}));var a=(e.obj||{}).person_in_charge||{},n="";function s(e,t,n){if(a[e]&&a[e][n]){var s=a[e][n]||[],l="";i.forEach(e=>{var t=s.includes(e.id)?"selected":"";l+=`<option value="${e.id}" data-subtext="Username: ${e.id}<br>Email: ${e.email||"-"}" ${t}>${e.value||e.id}</option>`}),$(`#${t}-${n}`).html(l).select2({multiple:!0,tokenSeparators:[",",", "],matcher:matcher,templateResult:formatCustom})}}i.forEach(e=>{n+=`<option value="${e.id}" data-subtext="Username: ${e.id}<br>Email: ${e.email||"-"}" data-token-separators="[',']">${e.value||e.id}</option>`}),$("#esc1-lq,#esc2-lq,#esc3-lq,#esc1-oc,#esc2-oc,#esc3-oc,#esc1-ot,#esc2-ot,#esc3-ot").html(n).select2({multiple:!0,tokenSeparators:[",",", "],matcher:matcher,templateResult:formatCustom}),s("escalation1","esc1","lq"),s("escalation1","esc1","oc"),s("escalation1","esc1","ot"),s("escalation2","esc2","lq"),s("escalation2","esc2","oc"),s("escalation2","esc2","ot"),s("escalation3","esc3","lq"),s("escalation3","esc3","oc"),s("escalation3","esc3","ot"),$("#dispatcher").select2(),$("#cico-hh,#cico-mm").change(function(){var e=$("#cico-hh").val()||0,t=$("#cico-mm").val()||0,a=Number(DATETIME.DH(null,`${e}:${t}`,"0"));$("#cico").val(a)}),$("#region_id").change(function(){$("#cluster_id option").hide();var e=G_SELECT.clusters.filter(e=>e.region_id.toString()==$(this).val()),t=$("#cluster_id").val(),a=!1;e.forEach(e=>{$(`#cluster_id option[value="${e.id}"]`).show(),t==e.id.toString()&&(a=!0)}),a||$("#cluster_id").val("")}),$("#cluster_id").change(function(){var e=G_SELECT.clusters.find(e=>e.id.toString()==$(this).val()),t=G_SELECT.regions.find(t=>t.id==e.region_id);$("#region_id").val(t.id)}),MODAL.SUBMIT(e,{id:"short_name",method:"POST",url:`api/geofences/${CLIENT.id}/${USER.username}/short_name/`},function(){return{person_in_charge:{escalation1:{lq:$("#esc1-lq").val()||[],oc:$("#esc1-oc").val()||[],ot:$("#esc1-ot").val()||[]},escalation2:{lq:$("#esc2-lq").val()||[],oc:$("#esc2-oc").val()||[],ot:$("#esc2-ot").val()||[]},escalation3:{lq:$("#esc3-lq").val()||[],oc:$("#esc3-oc").val()||[],ot:$("#esc3-ot").val()||[]}}}})};TABLE.FINISH_LOADING.CHECK=function(){i&&LIST[t]&&LIST[t].length>0&&!LIST[t][0]._picUsers&&n.dt&&n.updateRows(LIST[t]),GGS.STATUS.REGIONS&&LIST[t]&&LIST[t].length>0&&!LIST[t][0]._region&&n.dt&&n.updateRows(LIST[t]),GGS.STATUS.CLUSTERS&&LIST[t]&&LIST[t].length>0&&!LIST[t][0]._cluster&&n.dt&&n.updateRows(LIST[t]),GGS.STATUS.GEOFENCES&&(a||(a=!0,n.initialize(),n.populateRows(LIST[t]),n.hideProgressBar())),i&&GGS.STATUS.REGIONS&&GGS.STATUS.CLUSTERS&&TABLE.FINISH_LOADING.UPDATE()},(e={urlPath:"users",populate:function(){i=[],LIST[this.urlPath].forEach(e=>{i.push({id:e._id,value:e.name,email:e.email})}),i=SORT.ARRAY_OBJECT(i,"value",{sortType:"asc"}),TABLE.FINISH_LOADING.START_CHECK()},fetch:function(){var t=this;LIST[t.urlPath]?e.populate():GET.AJAX({url:`/api/${t.urlPath}/${CLIENT.id}/${USER.username}/all/${JSON.stringify({})}/0/0`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(a){console.log("Users",a),LIST[t.urlPath]=LIST[t.urlPath]||[],a.forEach(e=>{var a=LIST[t.urlPath].findIndex(t=>t._id==e._id);a>-1?LIST[t.urlPath][a]=e:(e._row=GENERATE.RANDOM(36),LIST[t.urlPath].push(e))}),e.populate()})}}).fetch(),TABLE.FINISH_LOADING.START_CHECK()}},routes:{stream:null,init:function(){var e=!0,t=null,a=new Table({id:"#tbl-routes",urlPath:"routes",goto:"routes",perColumnSearch:!0,dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.routes).column,createdRow:function(e,t,i){var n=t._row;$(e).attr("_row",t._row),a.rowListeners(n,t._id)},dom:'lBrti<"tbl-progress-bar">p'},initializeCallback:function(){TABLE.WATCH({urlPath:"routes",rowData:a.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}}),GGS.STATUS.GEOFENCES&&TABLE.FINISH_LOADING.UPDATE()}});a.setButtons({actions:{create:function(){i({url:`/api/routes/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){a.countRows()},search:function(){$(".row-filter").toggle()}}}),a.addRow=function(e){new loadInBackground("geofences","GEOFENCES").g_select_settings();var t,a,i=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:["edit"],readonlyArr:["edit"]});return $(`${this.id} th:last-child`).css({"min-width":i.width,width:i.width}),G_SELECT.geofences?(t=G_SELECT.geofences.find(t=>t.id==e.origin_id)||{},a=G_SELECT.geofences.find(t=>t.id==e.destination_id)||{},e._origin=t.value,e._destination=a.value):(t={value:'<small class="font-italic text-muted">loading...</small>'},a={value:'<small class="font-italic text-muted">loading...</small>'}),TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Origin:e._origin||t.value||"-",Destination:e._destination||a.value||"-","Transit Time":DATETIME.HH_MM(null,e.transit_time).hour_minute,Action:i.buttons}).row},a.rowListeners=function(e,t){TABLE.ROW_LISTENER({table_id:this.id,_row:e,urlPath:"routes",_id:t,initializeModal:i})};var i=function(e){new loadInBackground("geofences","GEOFENCES").g_select_settings();var t,a,i="PUT"==e.method?"Edit Route Data":"Create New Route";$("body").append(MODAL.CREATE.BASIC({title:i,el:(t=e.obj,a=!!t,[{title:"Origin",id:"origin_id",type:"select2",multiple:!1,required:!0,value:(t=t||{}).origin_id,options:G_SELECT.geofences,disabled:a,sub_title:"Site Code is required for geofence to apper in the options"},{title:"Destination",id:"destination_id",type:"select2",multiple:!1,required:!0,value:t.destination_id,options:G_SELECT.geofences,disabled:a,sub_title:"Site Code is required for geofence to apper in the options"},{title:"Route",id:"_id",type:"text",required:!0,value:t._id,readonly:!0},{title:"Transit Time (HH:MM)",id:"transit_time",type:"time",required:!0,value:t.transit_time}])})),$("#origin_id,#destination_id").select2().change(function(){var e=$("#origin_id").val(),t=$("#destination_id").val(),a=G_SELECT.geofences.find(t=>t.id==e)||{},i=G_SELECT.geofences.find(e=>e.id==t)||{};$("#_id").val(`${a.code}${clientCustom.originDestinationSeparator}${i.code}`)}).trigger("change"),$("#transit_time-hh,#transit_time-mm").change(function(){var e=$("#transit_time-hh").val()||0,t=$("#transit_time-mm").val()||0,a=Number(DATETIME.DH(null,`${e}:${t}`,"0"));$("#transit_time").val(a)}),MODAL.SUBMIT(e)};TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["ROUTES"],e,function(){e=!1,a.initialize(),a.populateRows(LIST.routes),a.hideProgressBar()}),isFinishedLoading(["GEOFENCES"],!0,function(){LIST.routes.length>0&&!LIST.routes[0]._origin&&a.dt&&a.updateRows(LIST.routes),TABLE.FINISH_LOADING.UPDATE()})},TABLE.FINISH_LOADING.START_CHECK()}}}},VEHICLES={STATUS:[{id:"Available",desc:"Working vehicle."},{id:"For Restoration (WRU)",desc:"WRU has been informed that the device is offline and has to be restored."},{id:"Standby",desc:"Working vehicle but not used."},{id:"Preventive Maintenance",desc:"Vehicle undergoing rehabilitation work."},{id:"Truck Breakdown",desc:"Vehicle is under repair."}],FUNCTION:{init:function(){var e=!0,t=!0,a=new Table({id:"#tbl-vehicles",urlPath:"vehicles",goto:"vehicles",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.vehicles()).column,order:clientCustom.columnOrder.vehicles,createdRow:function(e,t,i){var n=t._row;$(e).attr("_row",t._row),a.rowListeners(n,t._id)},dom:'lBfrti<"tbl-progress-bar">p'},initializeCallback:function(){TABLE.WATCH({urlPath:"vehicles",rowData:a.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}})}});a.setButtons({actions:{refresh:function(){a.countRows()},filter:function(){$("#filter-container").toggle("slide",{direction:"right"},100)},export:function(){$("#filter-container").hide("slide",{direction:"right"},100),$("#cv-container").hide("slide",{direction:"right"},100),$("#export-container").toggle("slide",{direction:"right"},100)},data_maintenance:function(){var e=CLIENT.id,t=USER.username,a=USER.role,i=modalViews.vehicles.data_maintenance(),n=[{urlPath:"vehicles_section",key:"section",objectData:e=>getVehiclesSection(e)},{urlPath:"vehicles_company",key:"company",objectData:e=>getVehiclesCompany(e)}];HISTORY.defaults.data_maintenance(e,t,a,SESSION_TOKEN,i,n)}}}),a.addRow=function(e){var t=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:["edit","view"],readonlyArr:["edit","view"]});VEHICLES.STATUS.find(t=>t.id==(e.Availability||""));$(`${this.id} th:last-child`).css({"min-width":t.width,width:t.width});var a=(getVehicleHistory(e._id)||{}).location||[],i=a[a.length-2],n=a[a.length-1],s="";if(n){var l=n.events[n.events.length-1].timestamp;s+=`<div><i class="la la-map-marker text-muted font-16"></i>${n.short_name} (2)<small class="text-muted ml-2">[${DATETIME.FORMAT(l,"MM/DD/YYYY hh:mm A")}]</small></div>`}if(i){l=i.events[i.events.length-1].timestamp;s+=`<div><i class="la la-map-marker text-muted font-16"></i>${i.short_name} (1)<small class="text-muted ml-2">[${DATETIME.FORMAT(l,"MM/DD/YYYY hh:mm A")}]</small></div>`}e.Site&&0==$("#_site").find(`option[value='${e.Site}']`).length&&$("#_site").append(`<option value="${e.Site}">${e.Site}</option>`);var o='<small class="font-italic text-muted">loading...</small>';LIST.vehicles_section&&(o=(getVehiclesSection(e.section_id)||{}).section||"-");var r='<small class="font-italic text-muted">loading...</small>';return LIST.vehicles_company&&(r=(getVehiclesCompany(e.company_id)||{}).company||"-"),TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Name:e.name||"-","Plate Number":e["Plate Number"]||"-",Trailer:e.Trailer||"-","Equipment Number":e["Equipment Number"]||"-","Conduction Number":e["Tractor Conduction"]||"-","Truck Number":e["Truck Number"]||"-",Site:e.Site||"-",Section:o,Company:r,Availability:e.Availability||"Available","Last 2 Locations":s||"-",Action:t.buttons}).row},a.rowListeners=function(e,t){const a=this;TABLE.ROW_LISTENER({table_id:a.id,_row:e,urlPath:"vehicles",_id:t,editCallback:function(){getSelect2Options();var e,i=LIST[a.urlPath].find(e=>e._id==t);$("body").append(MODAL.CREATE.BASIC({title:"Edit Vehicle Details",el:(e=[],clientCustom.modalFields.vehicles.forEach(t=>{switch(t){case"Trailer":e.push({title:"Trailer",id:"Trailer",type:"select2",attr:"blankStringIfEmpty"});break;case"section_id":e.push({title:"Section",id:"section_id",type:"select2"});break;case"company_id":e.push({title:"Company",id:"company_id",type:"select2"});break;case"Availability":e.push({title:"Availability",id:"Availability",type:"select",value:i.Availability,options:VEHICLES.STATUS,noDefault:!0});break;case"desc":e.push({title:"Description",id:"desc",type:"textarea",disabled:!0,notInclude:!0})}}),e)})),$("#Availability").change(function(){var e=VEHICLES.STATUS.find(e=>e.id==$(this).val())||{desc:""};$("#desc").val(e.desc)}).trigger("change"),$("#Trailer").html(G_SELECT2["form-trailers"]).select2({matcher:matcher,templateResult:formatCustom}).val(i.Trailer||"").trigger("change"),$("#section_id").html(G_SELECT2["form-vehicles_section"]).select2().val(i.section_id||"").trigger("change"),$("#company_id").html(G_SELECT2["form-vehicles_company"]).select2().val(i.company_id||"").trigger("change");var n={object:[],ggsURL:`https://${CLIENT.ggsURL}/comGpsGate/api/v.1/batch/applications/${CLIENT.appId}/users/${t}/customfields`};clientCustom.modalFields.vehicles.forEach(e=>{switch(e){case"Trailer":n.object.push({name:"Trailer",el:"#Trailer option:selected"});break;case"Availability":n.object.push({name:"Availability",el:"#Availability option:selected"})}}),MODAL.SUBMIT({method:"PUT",url:`/api/${a.urlPath}/${CLIENT.id}/${USER.username}/${t}`},n)},additionalListeners:function(){$(a.id).on("click",`[_row="${e}"] [view],[_row="${e}"] + tr.child [view]`,function(e){e.stopImmediatePropagation();var a=(getVehicle(t)||{}).name,i=getVehicleHistory(t)||{};$("body").append(modalViews.vehicles.location_history({title:`Location History for ${a}`,location:i.location}));var n;$((n=[],[0,1,2,3,4].forEach(e=>{n.push(`#vehicleLocation${e}`)}),n.join(","))).DataTable({scrollY:"200px",order:[[0,"desc"]],paging:!1,dom:"t",columns:TABLE.COL_ROW([{data:"Date",title:"Date",type:"date",visible:!0},{data:"Rule Name",title:"Rule Name",visible:!0}]).column})})}})},a.filterListener=function(){const e=this;var t=USER.filters.vehicles||{};try{t=JSON.parse(USER.filters.vehicles)}catch(e){}$(".page-box").append(SLIDER.EXPORT()),TABLE.TOOLBAR(e.dt),$(".buttons-copy span").html("Copy Table"),$(".buttons-csv span").html("Export Table As CSV File"),$(".buttons-excel span").html("Export Table As Excel File"),t.site&&"All"!=t.site&&($("#filter-container").toggle("slide",{direction:"right"},100),setTimeout(function(){$("#_site").val(t.site),$("#filter-btn").trigger("click")},100)),$("#filter-btn").click(function(){$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),function(a){if(t.site!=a.site){var i={};i["filter.vehicles"]=JSON.stringify(a),GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(i)},function(i){console.log("docs1",i),e.dt.column(4).search(a.site).draw(!1),USER.filters.vehicles=a,t.site=a.site,$("#filter-btn").html("Apply").removeClass("disabled")})}else e.dt.column(4).search(a.site).draw(!1),$("#filter-btn").html("Apply").removeClass("disabled")}({site:"All"==$("#_site").val()?"":$("#_site").val()})}),$("#reset-btn").click(function(){$("#_site").val("All"),$("#filter-btn").trigger("click")})},TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["VEHICLES"],e,function(){e=!1,a.initialize(),a.populateRows(LIST.vehicles),a.hideProgressBar()}),isFinishedLoading(["TRAILERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLES_HISTORY"],t,function(){(LIST.vehicles||[]).length>0&&a.dt&&t&&(t=!1,a.updateRows(LIST.vehicles))}),isFinishedLoading(["TRAILERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLES_HISTORY"],!0,function(){TABLE.FINISH_LOADING.UPDATE()})},TABLE.FINISH_LOADING.START_CHECK()}}},VEHICLE_PERSONNEL={FUNCTION:{init:function(){var e="vehicle_personnel",t=!0,a=!0,i=new Table({id:"#tbl-vehicle_personnel",urlPath:e,goto:"vehicle_personnel",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.vehicle_personnel).column,order:[[3,"asc"]],createdRow:function(e,t,a){var n=t._row;$(e).attr("_row",t._row),i.rowListeners(n,t._id)},dom:'lBfrti<"tbl-progress-bar">p'},initializeCallback:function(){TABLE.WATCH({urlPath:e,rowData:i.addRow,options:function(){TABLE.FINISH_LOADING.START_CHECK()}})}});i.setButtons({loadView:["create"],actions:{create:function(){n({url:`/api/${e}/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){i.countRows()},data_maintenance:function(){var e=CLIENT.id,t=USER.username,a=USER.role,i=modalViews.vehicle_personnel.data_maintenance(),n=[{urlPath:"vehicle_personnel_section",key:"section",objectData:e=>getVehiclePersonnelSection(e)},{urlPath:"vehicle_personnel_company",key:"company",objectData:e=>getVehiclePersonnelCompany(e)}];HISTORY.defaults.data_maintenance(e,t,a,SESSION_TOKEN,i,n)}}}),i.addRow=function(e){var t=TABLE.ROW_BUTTONS(PAGE.GET(),{loadView:["edit"],readonlyArr:["edit"],deleteArr:[{button:"edit-rest-days",byPassCondition:"Driver"!=e.occupation&&"Checker"!=e.occupation&&"Helper"!=e.occupation}]});$(`${this.id} th:last-child`).css({"min-width":t.width,width:t.width});var a='<small class="font-italic text-muted">loading...</small>';LIST.vehicles&&(a=(getVehicle(e.vehicle_id)||{}).name||"-");var i='<small class="font-italic text-muted">loading...</small>';LIST.vehicle_personnel_section&&(i=(getVehiclePersonnelSection(e.section_id)||{}).section||"-");var n='<small class="font-italic text-muted">loading...</small>';return LIST.vehicle_personnel_company&&(n=(getVehiclePersonnelCompany(e.company_id)||{}).company||"-"),TABLE.COL_ROW(null,{_id:e._id,_row:e._row,Name:e.name||"-",Occupation:e.occupation||"-",Vehicle:a,Section:i,Company:n,Action:t.buttons}).row},i.rowListeners=function(t,a){TABLE.ROW_LISTENER({table_id:i.id,_row:t,urlPath:e,_id:a,initializeModal:n,additionalListeners:function(){$(i.id).on("click",`[_row="${t}"] [edit-rest-days],[_row="${t}"] + tr.child [edit-rest-days]`,function(t){t.stopImmediatePropagation(),$("body").append(modalViews.vehicle_personnel.rest_days(a)),$("html, body,#modal").animate({scrollTop:0},"fast");var i=LIST.vehicle_personnel.find(e=>e._id.toString()==a.toString())||{},n={};$("#calendar_type").change(function(){var e=$(this).val();$("#inline-calendar").data("daterangepicker").setDates(n[e]||[]),"_rest_days"==e?($("#recurring").parent().parent().show(),0==n[e].length?($("#recurring").attr("disabled",!0),$("#recurring").parent().parent().addClass("text-muted").css({"pointer-events":"none"})):($("#recurring").attr("disabled",!1),$("#recurring").parent().parent().removeClass("text-muted").css({"pointer-events":""}))):$("#recurring").parent().parent().hide()}),$("#inline-calendar").daterangepicker({multipleDates:!0,showSingleCalendar:!0,displayAsInlineCalendar:!0,alwaysShowCalendars:!0,customStyle:{width:"268px",adjustTop:40},parentEl:$("#inline-calendar").parent(),isInvalidDate:function(e){var t=moment(e._d).format("YY-MM-DD"),a=$("#calendar_type").val(),i=[];return Object.keys(n).forEach(e=>{e!=a&&(n[e]||[]).forEach(e=>{i.push(moment(e).format("YY-MM-DD"))})}),-1!=i.indexOf(t)}}).on("apply.daterangepicker",function(e,t){var a=$("#calendar_type").val();n[a]=$("#inline-calendar").data("daterangepicker").getDates(),"_rest_days"==a&&(0==n[a].length?($("#recurring").attr("disabled",!0),$("#recurring").parent().parent().addClass("text-muted").css({"pointer-events":"none"})):($("#recurring").attr("disabled",!1),$("#recurring").parent().parent().removeClass("text-muted").css({"pointer-events":""})))}),$("#inline-calendar").trigger("click"),$("#recurring").change(function(){var e=[],t=$("#inline-calendar").data("daterangepicker").getDates()[0];if(t){if(e.push(new Date(t)),$(this).is(":checked")){var a=null;for(var i=0;i<29;i++)a=moment(new Date(a||t)).add(7,"day").format("MM/DD/YYYY"),e.push(new Date(a))}$("#inline-calendar").data("daterangepicker").setDates(e)}}),$("#recurring").prop("checked",i.recurring||!1);var s=i.dates||{};$("#calendar_type option").each((e,t)=>{var a=$(t).val(),i=a.substring(1),l=[];(s[i]||[]).forEach(e=>{l.push(new Date(e))}),n[a]=l}),$("#calendar_type").trigger("change"),$("#submit").click(function(){var t={recurring:$("#recurring").is(":checked"),dates:{}};Object.keys(n).forEach(e=>{var a=e.substring(1),i=(n[e]||[]).map(e=>moment(e).startOf("day").toISOString());t.dates[a]=i}),$("#submit").html('<i class="la la-spin la-spinner"></i> Submit').attr("disabled",!0),GET.AJAX({url:`/api/${e}/${CLIENT.id}/${USER.username}/${a}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(t)},function(e){$(".daterangepicker").hide(),$("#overlay").remove(),TOASTR.UPDATEDSUCCESSFULLY()})})})}})},i.filterListener=function(){const e=this;var t=USER.filters.vehicles||{};try{t=JSON.parse(USER.filters.vehicles)}catch(e){}t.site&&"All"!=t.site&&($("#filter-container").toggle("slide",{direction:"right"},100),setTimeout(function(){$("#_site").val(t.site),$("#filter-btn").trigger("click")},100)),$("#filter-btn").click(function(){$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),function(a){if(t.site!=a.site){var i={};i["filter.vehicles"]=JSON.stringify(a),GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(i)},function(i){console.log("docs1",i),e.dt.column(4).search(a.site).draw(!1),USER.filters.vehicles=a,t.site=a.site,$("#filter-btn").html("Apply").removeClass("disabled")})}else e.dt.column(4).search(a.site).draw(!1),$("#filter-btn").html("Apply").removeClass("disabled")}({site:"All"==$("#_site").val()?"":$("#_site").val()})}),$("#reset-btn").click(function(){$("#_site").val("All"),$("#filter-btn").trigger("click")})};var n=function(e={}){getSelect2Options(),e.obj=e.obj||{};var t,a="PUT"==e.method?"Edit Personnel Data":"Create New Vehicle Personnel";$("body").append(MODAL.CREATE.BASIC({title:a,el:(t=e.obj,[{title:"Name",id:"name",type:"text",required:!0,value:t.name},{title:"Occupation",id:"occupation",type:"select",required:!0,value:t.occupation,options:[{id:"Driver",value:"Driver"},{id:"Checker",value:"Checker"},{id:"Helper",value:"Helper"}]},{title:"Vehicle",id:"vehicle_id",type:"select2",attr:"blankStringIfEmpty"},{title:"Section",id:"section_id",type:"select2",attr:"blankStringIfEmpty"},{title:"Company",id:"company_id",type:"select2",attr:"blankStringIfEmpty"}])})),$("#vehicle_id").html(G_SELECT2["form-vehicles"]).select2({matcher:matcher,templateResult:formatCustom}).val(e.obj.vehicle_id||"").trigger("change"),$("#section_id").html(G_SELECT2["form-vehicle_personnel_section"]).select2().val(e.obj.section_id||"").trigger("change"),$("#company_id").html(G_SELECT2["form-vehicle_personnel_company"]).select2().val(e.obj.company_id||"").trigger("change"),MODAL.SUBMIT(e)};TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["VEHICLE_PERSONNEL"],t,function(){t=!1,i.initialize(),i.populateRows(LIST[e]),i.hideProgressBar()}),isFinishedLoading(["VEHICLES","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY"],a,function(){(LIST[e]||[]).length>0&&i.dt&&(a=!1,i.updateRows(LIST[e]))}),isFinishedLoading(["VEHICLES","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY"],!0,function(){TABLE.FINISH_LOADING.UPDATE()})},TABLE.FINISH_LOADING.START_CHECK()}}},TRAILERS={FUNCTION:{init:function(){var e=!0,t=new Table({id:"#tbl-trailers",urlPath:"trailers",goto:"trailers",dataTableOptions:{columns:TABLE.COL_ROW(CUSTOM.COLUMN.trailers).column,order:[[4,"asc"]],createdRow:function(e,a,i){var n=a._row;$(e).attr("_row",a._row),t.rowListeners(n,a._id)},dom:'lBfrti<"tbl-progress-bar">p'},initializeCallback:function(){}});t.setButtons({loadView:["create"],actions:{create:function(){a({url:`/api/trailers/${CLIENT.id}/${USER.username}`,method:"POST"})},refresh:function(){t.countRows()},filter:function(){$("#filter-container").toggle("slide",{direction:"right"},100)}}}),t.addRow=function(e){var t=TABLE.ROW_BUTTONS(PAGE.GET());return $(`${this.id} th:last-child`).css({"min-width":t.width,width:t.width}),e.site&&0==$("#_site").find(`option[value='${e.site}']`).length&&$("#_site").append(`<option value="${e.site}">${e.site}</option>`),TABLE.COL_ROW(null,{_row:e._row,_id:e._id,"Pal Cap":e.pal_cap||"-",Region:e.region||"-",Cluster:e.cluster||"-",Site:e.site||"-",Action:t.buttons}).row},t.rowListeners=function(e,t){TABLE.ROW_LISTENER({table_id:this.id,_row:e,urlPath:"trailers",_id:t,initializeModal:a})},t.filterListener=function(){const e=this;var t=USER.filters.trailers||{};try{t=JSON.parse(USER.filters.trailers)}catch(e){}t.site&&"All"!=t.site&&($("#filter-container").toggle("slide",{direction:"right"},100),setTimeout(function(){$("#_site").val(t.site),$("#filter-btn").trigger("click")},100)),$("#filter-btn").click(function(){$(this).html('<i class="la la-spinner la-spin"></i> Apply').addClass("disabled"),function(a){if(t.site!=a.site){var i={};i["filter.trailers"]=JSON.stringify(a),GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(i)},function(i){console.log("docs1",i),e.dt.column(4).search(a.site).draw(!1),USER.filters.trailers=a,t.site=a.site,$("#filter-btn").html("Apply").removeClass("disabled")})}else e.dt.column(4).search(a.site).draw(!1),$("#filter-btn").html("Apply").removeClass("disabled")}({site:"All"==$("#_site").val()?"":$("#_site").val()})}),$("#reset-btn").click(function(){$("#_site").val("All"),$("#filter-btn").trigger("click")})};var a=function(e){var t,a,i="PUT"==e.method?"Edit Trailer Data":"Create New Trailer";$("body").append(MODAL.CREATE.BASIC({title:i,el:(t=e.obj,a="PUT"==e.method,[{title:"Trailer",id:"_id",type:"text",required:!0,value:(t=t||{})._id,readonly:a,sub_title:"Once saved, trailer cannot be edited."},{title:"Pal Cap",id:"pal_cap",type:"text",required:!0,value:t.pal_cap},{title:"Region",id:"region",type:"text",required:!0,value:t.region},{title:"Cluster",id:"cluster",type:"text",required:!0,value:t.cluster},{title:"Site",id:"site",type:"text",required:!0,value:t.site}])})),MODAL.SUBMIT(e)};TABLE.FINISH_LOADING.CHECK=function(){isFinishedLoading(["TRAILERS"],e,function(){e=!1,t.initialize(),t.populateRows(LIST.trailers),t.hideProgressBar(),TABLE.FINISH_LOADING.UPDATE()})},TABLE.FINISH_LOADING.START_CHECK()}}},CHANGELOG={FUNCTION:{init:function(){PAGE.DISPLAY(),PAGE.TOOLTIP();var e,t,a,i,n,s,l=CHANGELOG.FUNCTION.changelogs,o="";Object.keys(l).forEach((a,n)=>{0===n&&$("#version").html(a),o+=(e=a,t=l[a],n=n,s="",Object.keys(t).forEach(e=>{["hotfix","date"].includes(e)||t[e].forEach(t=>{s+=(i=e,t=(t=(t=(t=(t=t).replace("aPAGE",'<span style="color: #334fe5;">')).replace("zPAGE","</span>")).replace("aVERSION",'<span style="color: #adadad;">')).replace("zVERSION","</span>"),`<li>\n                                    <div style="display: table-cell;"><span style="background: ${{feature:"#7ac943",fix:"#ff1d25",release:"#3fa9f5",other:"gray",improved:"#ff931e",refactor:"#a9489a"}[i]};color: white;padding: 1px 5px;border-radius: 2px;font-weight: bold;font-size: 10px;margin-right: 2px;">${i}</span></div>\n                                    <span style="display: table-cell;padding-left: 3px;">${t}</span>\n                                </li>`)})}),`<div class="col-sm-12 ${n>0?"mt-3":""}">\n                            <div class="p-3" style="border: 1px solid #eee;">\n                                <h4 style="border-bottom: 1px solid #dcdcdc;font-weight: bold;" class="pb-2 mb-3 mt-1">v.${e}<span class="text-muted" style="font-size: 11px;font-weight: 100;float: right;">${t.date}</span></h4>\n                                <ul>${s}</ul>\n                            </div>\n                        </div>`)}),$(".page-box").append(o),$("#guide-btn").click(function(){$("body").append(modalViews.changelogs.guide())})},changelogs:changelogList}},LOADING={SPINNER:{UI:function(){return'<div class="loading-screen">\n                        <div>\n                            <i class="la la-spinner la-spin"></i>\n                            <div id="loading-description" class="col-md-12 text-muted" style="font-size: 10px;font-weight: 100;margin-top: 8px;"></div>\n                        </div>\n                    </div>'}},PROGRESSBAR:{UI:function(){return'<div id="progress-striped-active" class="progress progress-striped active" style="width: 100%;">\n                        <div class="progress-bar progress-bar-success" data-transitiongoal="0"></div>\n                    </div>'},INITIALIZE:function(){$("#progress-striped .progress-bar, #progress-striped-active .progress-bar").progressbar({display_text:"fill"})},MOVE:function(e,t){var a=0;!function(){if(0==a){a=1;var i=$("#progress-striped-active .progress-bar"),n=setInterval(function(){e>=t?(clearInterval(n),a=0,TABLE.FINISH_LOADING.START_CHECK()):(e++,$(i).css("width",`${e}%`).html(`${e}%`))},10)}}()}}},PAGE={EXISTING:[],LOGOUT:function(){SESSION_TOKEN&&USER?($("body").append('<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;background-color: #ffffffc2;z-index: 999999;">\n                                <h3 style="text-align: center;margin-top: 40vh;font-weight: 100;">Logging out...</h3>\n                                </div>'),GET.AJAX({url:`/api/sessions/${CLIENT.id}/${USER.username}/${SESSION_TOKEN}`,method:"DELETE",headers:{Authorization:SESSION_TOKEN}},function(e){Cookies.remove("GKEY"),Cookies.remove("session_token"),location.href=`./${CLIENT.name}/login`})):(Cookies.remove("GKEY"),Cookies.remove("session_token"),location.href=`./${CLIENT.name}/login`)},MAIN:{UI:{PAGE:function(){return`\x3c!-- WRAPPER --\x3e\n                        <div id="wrapper">\n                            ${PAGE.MAIN.UI.NAVBAR()}\n                            ${PAGE.MAIN.UI.LEFT_SIDEBAR()}\n                            ${PAGE.MAIN.UI.BODY()}\n                            <div class="clearfix"></div>\n                        </div>\n                        \x3c!-- END WRAPPER --\x3e`},NAVBAR:function(){return`\x3c!-- NAVBAR --\x3e\n                        <nav class="navbar navbar-default navbar-fixed-top">\n                            <div class="container-fluid pl-0">\n                                <div class="brand">\n                                    <img src="public/img/logo-02.png" alt="WRU Logo" class="img-responsive logo" style="image-rendering: -webkit-optimize-contrast;">\n                                </div>\n                                <div id="tour-fullwidth" class="navbar-btn pl-2">\n                                    <button type="button" class="btn-toggle-fullwidth"><i class="la la-arrow-circle-left"></i></button>\n                                    <button type="button" class="btn-fullscreen pl-2 p-2"><i class="la la-expand-arrows-alt"></i></button>\n                                </div>\n                                <div id="navbar-menu">\n                                    <ul class="nav navbar-nav navbar-right">\n                                        <li class="dropdown">\n                                            \x3c!--<div style="display: inline-block;">\n                                                <span style="display: inline-block;padding-right: 20px;padding-top: 0px;">\n                                                    <img id="junkOne" src="" style="display: none;">\n                                                    <i class="la la-wifi mr-1 text-success"></i>\n                                                    <small id="timer">-ms</small>\n                                                </span>\n                                            </div>--\x3e\n                                            <img src="../public/img/${CLIENT.id}-dashboard.png" style="height: 17px;margin-top: 13px;image-rendering: -webkit-optimize-contrast;">\n                                            <a href="#" class="dropdown-toggle pt-0 pr-2 pl-1" style="min-width: 100px;float: right;text-align: right;" data-toggle="dropdown">\n                                                <span>${USER.username}<i style="font-size: 9px;margin-left: 6px;" class="icon-submenu la la-angle-down"></i></span>\n                                            </a>\n                                            <ul class="dropdown-menu logged-user-menu">\n                                                <li><a href="#profile"><i class="la la-user"></i> <span>Profile</span></a></li>\n                                                \x3c!-- <li><a href="appviews-inbox.html"><i class="la la-email"></i> <span>Message</span></a></li> --\x3e\n                                                <li><a href="#settings"><i class="la la-cog"></i> <span>Settings</span></a></li>\n                                                <li><a href="#logout"><i class="la la-sign-out-alt"></i> <span>Logout</span></a></li>\n                                            </ul>\n                                        </li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </nav>\n                        \x3c!-- END NAVBAR --\x3e`},LEFT_SIDEBAR:function(){var e=function(e){var t=e.notification?`<span id="${e.name}-badge" class="badge" style="display:none;">0</span>`:"";return`<li><a href="#${e.name}"><i class="${e.icon}"></i> <span class="title">${e.title}</span>${t}</a></li>`},t="";return GRANTED_PAGES.forEach(a=>{if(!ISMOBILE||ISMOBILE&&!0===a.allowOnMobile){var i="";if(a.menu_group)i=`<li class="menu-group ${a.menu_group.class||""}">${a.menu_group.title}</li>`;t+=i,a.sub_menu?t+=function(t,a){var i=a||"Parent Menu";i=i.capitalize();var n="",s="";return t.forEach(t=>{var a=PAGE_FUNCTIONALITIES[t];n+=e(a),s=a.icon}),`<li class="panel">\n                                    <a href="#${a}" data-toggle="collapse" class="collapsed" aria-expanded="false"><i class="${s}"></i> <span class="title">${i}</span> <i class="icon-submenu la la-angle-left"></i></a>\n                                    <div id="${a}" class="collapse" aria-expanded="false" style="height: 0px;">\n                                        <ul class="submenu">${n}</ul>\n                                    </div>\n                                </li>`}(a.sub_menu,a.name):t+=e(a)}}),`\x3c!-- LEFT SIDEBAR --\x3e\n                        <div id="sidebar-nav" class="sidebar">\n                            <nav>\n                                <ul class="nav" id="sidebar-nav-menu">\n                                    \x3c!-- <li class="menu-group">Menu</li> --\x3e\n                                    <li class="panel">${t}</li>\n                                </ul>\n                            </nav>\n                        </div>\n                        \x3c!-- END LEFT SIDEBAR --\x3e`},BODY:function(){var e="";return Object.keys(CHANGELOG.FUNCTION.changelogs).forEach((t,a)=>{0===a&&(e=t)}),`\x3c!-- MAIN --\x3e\n                        <div class="main">\n                            \x3c!-- MAIN CONTENT --\x3e\n                            <div class="main-content">\n                                <div class="container-fluid p-0">\n                                    <a href="javascript:void(0)" class="btn-close-fullscreen" style="display:none;position: absolute;width: 100%;text-align: center;padding: 7px 0px 2px;">Click here to exit fullscreen or press ESC key</a>\n                                    <div class="panel panel-profile">\n                                        <div class="clearfix"></div>\n                                    </div>\n                                </div>\n                            </div>\n                            \x3c!-- END MAIN CONTENT --\x3e\n                            <footer>\n                                <div class="container-fluid">\n                                    <p class="copyright">\n                                        <span>Version ${e}</span>\n                                        <span class="float-right">&copy; 2020 - ${(new Date).getFullYear()} <a href="https://www.wru.ph" target="_blank">WRU Corporation</a>. All Rights Reserved.</span>\n                                    </p>\n                                </div>\n                            </footer>\n                        </div>\n                        \x3c!-- END MAIN --\x3e`},BOTTOM_NAVBAR:function(){var e,t="",a=GRANTED_PAGES;return a.push(PAGE_FUNCTIONALITIES.profile),a.push(PAGE_FUNCTIONALITIES.settings),a.forEach(a=>{ISMOBILE&&!0===a.allowOnMobile&&(t+=`<a href="#${(e=a).name}" class="navbar-bottom-button"><i class="${e.icon}"></i><div>${e.title_m||e.title}</div></a>`)}),`\x3c!-- BOTTOM NAVBAR --\x3e\n                        <div class="navbar navbar-bottom">\n                            <div class="navbar-bottom-toggle">\n                                <i class="la la-ellipsis-h"></i>\n                            </div>\n                            <div class="flex-container">\n                                ${t}\n                            </div>\n                        </div>\n                        \x3c!-- END BOTTOM NAVBAR --\x3e`},MOBILE:function(){return`\x3c!-- WRAPPER --\x3e\n                            <div id="wrapper">\n                                \x3c!-- MAIN --\x3e\n                                <div class="main pt-0" style="height: calc(100% - 65px);position: fixed;overflow-y: auto;overflow-x: hidden;">\n                                    \x3c!-- MAIN CONTENT --\x3e\n                                    <div class="main-content">\n                                        <div class="container-fluid p-0">\n                                            <div class="panel panel-profile" style="margin-bottom:10px;">\n                                                <div style="height: 40px;position: fixed;top: 0;z-index: 99;background: white;width: 100%;">\n                                                    <img src="../public/img/logo-02.png" style="width: 190px;padding-top: 7px;display: block;margin: auto;image-rendering: -webkit-optimize-contrast;">\n                                                </div>\n                                                <div class="clearfix"></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \x3c!-- END MAIN CONTENT --\x3e\n                                </div>\n                                \x3c!-- END MAIN --\x3e\n                                ${PAGE.MAIN.UI.BOTTOM_NAVBAR()}\n                            </div>\n                            \x3c!-- END WRAPPER --\x3e`}},FUNCTION:{init:function(){function e(){document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||$(".main,.main .main-content .container-fluid").attr("style")&&($(".main,.main .main-content .container-fluid").attr("style",""),"de_dashboard"==PAGE.GET()&&(document.body.style.zoom=1),setTimeout(function(){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},400))}Object.keys(CHANGELOG.FUNCTION.changelogs).forEach((e,t)=>{0===t&&(VERSION=e)}),DEFAULT_DATE=moment(new Date).format("MM/DD/YYYY"),PAGE.SET_FUNCTIONALITIES(),GRANTED_PAGES=[],Object.keys(PERMISSION).forEach(e=>{if(["all","self"].includes(PERMISSION[e].read)){var t=PAGE_FUNCTIONALITIES[e];t&&GRANTED_PAGES.push({name:t.name,title:t.title,notification:t.notification,title_m:t.title_m,icon:t.icon,allowOnMobile:t.allowOnMobile,menu_group:t.menu_group})}}),USER.username?(ISMOBILE?($("#version").remove(),$("#body-main").html(PAGE.MAIN.UI.MOBILE()),$(".navbar-bottom-toggle").click(function(){$(".navbar-bottom,.main,#filter-container").toggleClass("navbar-bottom-hidden")}),$(".panel.panel-profile .clearfix").css({"margin-top":"40px"}),HASNOTIFICATION&&$('a[href="#notifications"] > .la-business-time').html('<div style="width: 10px;height: 10px;background: #fce146;border-radius: 20px;position: absolute;top: 22px;margin-left: -2px;border: 1px solid #daeb60;"></div>')):$("#body-main").html(PAGE.MAIN.UI.PAGE()),PAGE.GO_TO(),"user"!=USER.role.toLowerCase()&&$("#sidebar-nav").css("padding-top","27px").prepend(`\n                        <div style="padding: 3px;text-align: center;color: white;background-color: #00a548;font-size: 10px;">${USER.role.capitalize().toUpperCase()}</div>\n                        `),PAGE_SETUP(),window.onhashchange=function(){window.history.pushState({},null,`${window.location.pathname}#${PAGE.GET()}`),PAGE.GO_TO()}):LOGOUT(),$("body").append('<audio id="audio01" src="public/sounds/notif.mp3" autostart="0" ></audio>'),$(".btn-toggle-fullwidth").click(function(){setTimeout(function(){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},400)}),$(".btn-fullscreen").click(function(){$(".main,.main .main-content .container-fluid").attr("style","position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index:9999;"),"de_dashboard"==PAGE.GET()&&(document.body.style.zoom=1.3),setTimeout(function(){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},400);var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()}),document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),$(document).keyup(function(e){"Escape"===e.key&&($(".main,.main .main-content .container-fluid").attr("style",""),"de_dashboard"==PAGE.GET()&&(document.body.style.zoom=1),setTimeout(function(){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},400))});var t=function(e,t){(CLIENT.loadInBackground||[]).includes(e)&&e&&new loadInBackground(e.toLowerCase(),e.toUpperCase()).load(),setTimeout(function(){t.forEach(e=>{(CLIENT.loadInBackground||[]).includes(e)&&new loadInBackground(e.toLowerCase(),e.toUpperCase()).load()})},2e3)},a=function(e){(CLIENT.loadInBackground||[]).includes(e.toUpperCase())&&TABLE.WATCH({urlPath:e})};"regions"==PAGE.GET()?t("REGIONS",["CLUSTERS","GEOFENCES","ROUTES","VEHICLES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"clusters"==PAGE.GET()?t("CLUSTERS",["REGIONS","GEOFENCES","ROUTES","VEHICLES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"geofences"==PAGE.GET()?t("GEOFENCES",["REGIONS","CLUSTERS","ROUTES","VEHICLES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"routes"==PAGE.GET()||"dashboard"==PAGE.GET()?t("ROUTES",["GEOFENCES","REGIONS","CLUSTERS","VEHICLES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLES_HISTORY"]):"trailers"==PAGE.GET()?t("TRAILERS",["REGIONS","CLUSTERS","GEOFENCES","ROUTES","VEHICLES","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"vehicles"==PAGE.GET()?t("VEHICLES",["REGIONS","CLUSTERS","GEOFENCES","ROUTES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"vehicle_personnel"==PAGE.GET()?t("VEHICLE_PERSONNEL",["REGIONS","CLUSTERS","GEOFENCES","ROUTES","VEHICLES","TRAILERS","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"shift_schedule"==PAGE.GET()?t("SHIFT_SCHEDULE",["REGIONS","CLUSTERS","GEOFENCES","ROUTES","VEHICLES","TRAILERS","VEHICLE_PERSONNEL","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):"users"==PAGE.GET()?t("USERS",["REGIONS","CLUSTERS","GEOFENCES","ROUTES","VEHICLES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]):t("VEHICLES",["REGIONS","CLUSTERS","GEOFENCES","ROUTES","TRAILERS","VEHICLE_PERSONNEL","SHIFT_SCHEDULE","USERS","VEHICLES_SECTION","VEHICLES_COMPANY","VEHICLE_PERSONNEL_SECTION","VEHICLE_PERSONNEL_COMPANY","VEHICLES_HISTORY"]),a("notifications"),a("users"),a("sessions"),a("vehicles_history"),a("vehicles_section"),a("vehicles_company"),a("vehicle_personnel_section"),a("vehicle_personnel_company"),USER&&_SESSION_.lastActive(CLIENT.id,USER.username,SESSION_TOKEN)}}},GO_TO:function(){var e=PAGE.GET(),t=`a[href="#${e}"]`,a=new URLSearchParams(window.location.search),i=CRYPTO.DECRYPT(a.get("data"));PAGE.SET_TITLE(e),i.for!=e&&window.history.pushState({},null,`/${CLIENT.name}#${e}`),$(".panel-profile > .dt-buttons").remove(),DASHBOARD.FUNCTION.addDataToTable=null,DASHBOARD.FUNCTION.addDataToTable2=null,TABLE.FINISH_LOADING.CHECK=null,clearInterval(DE_CHECKDUPS),DEFAULT_DATE=moment(new Date).format("MM/DD/YYYY"),$(".main-content .clearfix").css({height:$(window).innerHeight()-167+"px"}).html(LOADING.SPINNER.UI());var n=$(t).parents(".collapse").attr("id");"false"==$(`#${n}`).attr("aria-expanded")&&$(`[href="#${n}"]`).click(),$(`[aria-expanded="true"][href!="#${n}"]:not(#${n})`).click(),$("li > a.active,.navbar > .flex-container > a.active").removeClass("active"),$(t).length>0?$(t).addClass("active"):$('a[href="#create"]').addClass("active"),PAGE_FUNCTIONALITIES[e]&&(["profile","settings","logout"].includes(e)||GRANTED_PAGES.some(t=>t.name==e))?ISMOBILE&&(PAGE_FUNCTIONALITIES[e]&&!0===PAGE_FUNCTIONALITIES[e].allowOnMobile||(e="default")):e="default",PAGE_FUNCTIONALITIES[e].function(e),$("html, body").animate({scrollTop:0},"fast")},DISPLAY:function(){var e=PAGE_FUNCTIONALITIES[PAGE.GET()]?PAGE.GET():"default";$(".main-content .clearfix").html(PAGE_FUNCTIONALITIES[e].display()).css({height:""})},SET_TITLE:function(e){e=PAGE_FUNCTIONALITIES[e]?e:"default",document.title=`${PAGE_FUNCTIONALITIES[e].title} | WRU Dispatch`},DEFAULT:function(){var e=null;return GRANTED_PAGES.forEach(t=>{"dispatch_entry"==t.name&&autorizationLevel.dispatcher()&&!USER.dc||(t.sub_menu&&null==e&&PAGE_FUNCTIONALITIES[t.name]?e=t.sub_menu[0]:null==e&&PAGE_FUNCTIONALITIES[t.name]&&(e=t.name))}),window.history.pushState({},null,`#${e}`),e},GET:function(){return window.location.hash.replace("#","")||PAGE.DEFAULT()},TOOLTIP:function(){$('[data-toggle="tooltip"]').tooltip({html:"true",container:"body",delay:{show:50,hide:50}})},SET_FUNCTIONALITIES:function(){PERMISSION.dispatch;var e,t,a=2==CLIENT.type?["refresh","filter","report"]:["refresh","filter"],i="developer"==USER.role?["edit","view"]:["edit"],n=clientCustom.allowExportTable.notifications?["refresh","filter","export"]:["refresh","filter"];function s(e){var t=clientCustom.tableButtons[e].buttons||[];return(clientCustom.tableButtons[e].condition||[]).forEach(e=>{(e.roles||[]).includes(USER.role)&&(t=t.concat(e.additionalButton||[]))}),t}PAGE_FUNCTIONALITIES={dashboard:{title:"Deployment Dashboard",title_m:"Dashboard",name:"dashboard",icon:"la la-chart-line",display:function(){return views.dashboard()},function:function(){DASHBOARD.FUNCTION.init()},buttons:{table:["column"],row:["view"]},allowOnMobile:!0},de_dashboard:{title:"Delay Escalation Dashboard",name:"de_dashboard",icon:"la la-chart-line",display:function(){return views.de_dashboard()},function:function(){DE_DASHBOARD.FUNCTION.init()},notification:!0,buttons:{table:["column"]}},dispatch:{title:"Dispatch Entries",name:"dispatch",icon:"la la-table",display:function(){return views.dispatch()},function:function(){DISPATCH.FUNCTION.monitoring()},buttons:{table:"development"==ENVIRONMENT?["create","import","refresh","column","export","filter","clone"]:["create","import","refresh","column","export","filter"],row:(e="dispatch",t=clientCustom.rowButtons[e].buttons||[],(clientCustom.rowButtons[e].condition||[]).forEach(e=>{e.not?(e.roles||[]).includes(USER.role)||(e.removeButtons||[]).forEach(e=>{var a=t.indexOf(e);-1!==a&&t.splice(a,1)}):(e.roles||[]).includes(USER.role)&&(t=t.concat(e.additionalButton||[]))}),t)}},shift_schedule:{title:"Shift Schedule",name:"shift_schedule",icon:"la la-clock",display:function(){return views.shift_schedule()},function:function(){SHIFT_SCHEDULE.FUNCTION.init()},buttons:{table:["create","refresh"],row:["delete"]}},dispatch_deleted:{title:"Dispatch Entries (Deleted)",name:"dispatch_deleted",icon:"la la-table",display:function(){return views.dispatch_deleted()},function:function(){DISPATCH.FUNCTION.monitoring_deleted()},buttons:{table:["refresh","column","export","filter"],row:["view"]}},reports:{title:"Reports",name:"reports",icon:"la la-chart-bar",display:function(){return views.reports()},function:function(){REPORTS.FUNCTION.init()},buttons:{}},users:{title:"Users",name:"users",icon:"la la-users",display:function(){return views.users()},function:function(){USERS.FUNCTION.init()},buttons:{table:["create","refresh"],row:["edit","delete"]}},notifications:{title:"Delay Notifications",title_m:"Notifications",name:"notifications",icon:"la la-business-time",display:function(){return views.notifications()},function:function(){NOTIFICATIONS.FUNCTION.init()},buttons:{table:n,row:["comment","delete"]},allowOnMobile:!0},events_sn:{title:"Event Viewer",name:"events_sn",icon:"la la-calendar-day",display:function(){return views.event_viewer()},function:function(){EVENT_VIEWER.FUNCTION.init()},buttons:{table:a,row:["view"]}},vehicles:{title:"Vehicles",name:"vehicles",icon:"la la-truck",display:function(){return views.vehicles()},function:function(){VEHICLES.FUNCTION.init()},menu_group:{title:"Vehicles"},buttons:{table:s("vehicles"),row:i}},vehicle_personnel:{title:"Vehicle Personnel",name:"vehicle_personnel",icon:"la la-users-cog",display:function(){return views.vehicle_personnel()},function:function(){VEHICLE_PERSONNEL.FUNCTION.init()},buttons:{table:s("vehicle_personnel"),row:["edit","edit-rest-days","delete"]}},trailers:{title:"Trailers",name:"trailers",icon:"la la-truck-loading",display:function(){return views.trailers()},function:function(){TRAILERS.FUNCTION.init()},buttons:{table:["create","refresh","filter"],row:["edit","delete"]}},regions:{title:"Regions",name:"regions",icon:"la la-map-marked-alt",display:function(){return views.regions()},function:function(){LOCATIONS.FUNCTION.regions.init()},menu_group:{title:"Locations"},buttons:{table:["create","refresh","column"],row:["edit","delete"]}},clusters:{title:"Clusters",name:"clusters",icon:"la la-sitemap",display:function(){return views.clusters()},function:function(){LOCATIONS.FUNCTION.clusters.init()},buttons:{table:["create","refresh","column"],row:["edit","delete"]}},geofences:{title:"Sites",name:"geofences",icon:"la la-warehouse",display:function(){return views.geofences()},function:function(){LOCATIONS.FUNCTION.geofences.init()},buttons:{table:["refresh","column"],row:"developer"==USER.role?["edit","delete"]:["edit"]}},routes:{title:"Routes",name:"routes",icon:"la la-route",display:function(){return views.routes()},function:function(){LOCATIONS.FUNCTION.routes.init()},buttons:{table:["create","refresh","search"],row:["edit","delete"]}},all_events:{title:"All Events",name:"all_events",icon:"la la-calendar",display:function(){return views.all_events()},function:function(){ALL_EVENTS.FUNCTION.init()},buttons:{table:["refresh","filter","search"],row:["view"]},menu_group:{title:"For Developers"}},changelog:{title:"Changelog",name:"changelog",icon:"la la-tasks",display:function(){return views.changelogs()},function:function(){CHANGELOG.FUNCTION.init()}},profile:{title:"Profile",name:"profile",icon:"la la-user",display:function(){return views.profile()},function:function(){PROFILE.FUNCTION.init()},allowOnMobile:!0},settings:{title:"Settings",name:"settings",icon:"la la-cog",display:function(){return views.settings()},function:function(){SETTINGS.FUNCTION.init()},allowOnMobile:!0},logout:{title:"Logging out...",display:function(){return LOADING.SPINNER.UI()},function:function(){LOGOUT()},allowOnMobile:!0},default:{title:"Profile",display:function(){return views.profile()},function:function(e){var t=PAGE.EXISTING.includes(e)?PAGE.DEFAULT():"profile";window.history.pushState({},null,`#${t}`),PAGE.GO_TO()},allowOnMobile:!0}}}};GET.STATUS=function(e=""){var t={color:"label-default",text:""};return"plan"==e&&(t={color:"label-info",text:"Plan"}),"assigned"==e&&(t={color:"label-brown",text:"Assigned"}),"scheduled"==e&&(t={color:"label-default",text:"Scheduled"}),"queueingAtOrigin"==e&&(t={color:"label-warning",text:"Queueing (Origin)"}),"processingAtOrigin"==e&&(t={color:"label-lime",text:"Processing (Origin)"}),"idlingAtOrigin"==e&&(t={color:"label-purple",text:"Idling (Origin)"}),"in_transit"==e&&(t={color:"label-orange",text:"In Transit"}),"onSite"==e&&(t={color:"label-blue",text:"On-Site"}),"returning"==e&&(t={color:"label-pink",text:"Returning"}),"complete"==e&&(t={color:"label-success",text:"Complete"}),"incomplete"==e&&(t={color:"label-danger",text:"Incomplete"}),"deleted"==e&&(t={color:"label-default",text:"Deleted"}),{html:`<span class="label ${t.color} label-transparent">${t.text.toUpperCase()}</span>`,color:t.color,text:t.text}};var FILTER={INITIALIZE:function(e,t,a,i="MM/DD/YYYY"){var n=DATETIME.FORMAT(new Date(t),i),s=DATETIME.FORMAT(new Date(a),i);n==s?i.indexOf("h:mm")>-1?(n=moment(new Date(t)).startOf("day").format(i),s=moment(new Date(a)).endOf("day").format(i),$(e).val(`${n} - ${s}`)):$(e).val(n):$(e).val(`${n} - ${s}`),$(e).data("daterangepicker").setStartDate(n),$(e).data("daterangepicker").setEndDate(s)},ISEMPTY:function(e){var t=!0;return e.forEach(e=>{!1===e&&(t=!1)}),!0===t&&$("#filter-btn,#reset-btn").addClass("disabled"),t},CHECKING:function(e){if(e.dateEl=e.dateEl||[],e.dateElnoVal=e.dateElnoVal||[],e.selectEl=e.selectEl||[],$(e.dateEl[0]).length>0||$(e.dateElnoVal[0]).length>0||$(e.selectEl[0]).length>0){var t=[];e.dateEl.forEach(e=>{t.push($(e).val()==DEFAULT_DATE)}),e.dateElnoVal.forEach(e=>{t.push($(e).val().isEmpty())}),e.selectEl.forEach(e=>{t.push("all"==$(e).val())}),e.isPopulate||!0!==FILTER.ISEMPTY(t)?$("#filter-btn").removeClass("disabled"):($("#filter-btn,#reset-btn").addClass("disabled"),"reset"!=FILTER.STATUS&&$("#reset-btn").removeClass("disabled"))}},CALLBACK:null,DATE:function(e=DATETIME.FORMAT(new Date,"MM/DD/YYYY")){var t=new Date(e),a=t.setHours(0,0,0,0),i=t.setHours(23,59,59,999);return{start:new Date(a).toISOString(),end:new Date(i).toISOString()}},convertTZ:function(e,t){return new Date(("string"==typeof e?new Date(e):e).toLocaleString("en-US",{timeZone:t}))},DATERANGE:function(e=DATETIME.FORMAT(new Date,"MM/DD/YYYY"),t,a){var i=e.split(" - "),n=new Date(i[0]),s=i[1]?new Date(i[1]):new Date(i[0]);return t||(n=moment(n).startOf("day")),a||(s=moment(s).endOf("day")),new Date(n).getTime()==new Date(s).getTime()&&(n=moment(n).startOf("day"),s=moment(s).endOf("day")),{$gte:n.toISOString(),$lt:s.toISOString()}},RESET:function(e){$("#reset-btn").click(function(){FILTER.STATUS="reset",(e.dateEl||e.dateElnoVal)&&($(e.dateEl).data("daterangepicker").setStartDate(DEFAULT_DATE),$(e.dateEl).data("daterangepicker").setEndDate(DEFAULT_DATE),e.dateEl&&$(e.dateEl).removeClass("x onX").val(DEFAULT_DATE).change().blur(),e.dateElnoVal&&$(e.dateElnoVal).removeClass("x onX").val("").change().blur()),e.selectEl&&$(e.selectEl).val("all");var t={};t[`filter.${e.urlPath}`]=JSON.stringify({}),USER.filters[e.urlPath]={},GET.AJAX({url:`/api/users/${CLIENT.id}/${USER.username}/${USER.username}`,method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(t)},function(e){console.log("docs1",e)}),"function"==typeof e.populateTable&&e.populateTable()})},STATUS:"new",APPROVAL:{dispatch:function(e=[],t,a){var i=USER.filters.dispatch||{};try{i=JSON.parse(i)}catch(e){}console.log(i);var n=[];e.forEach(e=>{var t=!0;if(i.departure_date)if(e.departure_date){var s=new Date(i.departure_date.$gte).getTime(),l=new Date(i.departure_date.$lt).getTime();s<=(o=new Date(e.departure_date).getTime())&&o<l||(t=!1)}else t=!1;if(i.posting_date)if(e.posting_date){s=new Date(i.posting_date.$gte).getTime(),l=new Date(i.posting_date.$lt).getTime();s<=(o=new Date(e.posting_date).getTime())&&o<l||(t=!1)}else t=!1;if(i.scheduled_date)if(e.scheduled_date){var o;s=new Date(i.scheduled_date.$gte).getTime(),l=new Date(i.scheduled_date.$lt).getTime();s<=(o=new Date(e.scheduled_date).getTime())&&o<l||(t=!1)}else t=!1;i.status&&(i.status==e.status||(t=!1)),t&&i.$or&&(t=!1,i.$or.forEach(a=>{if(a.posting_date&&e.posting_date){var i=new Date(a.posting_date.$gte).getTime(),n=new Date(a.posting_date.$lt).getTime();i<=(s=new Date(e.posting_date).getTime())&&s<n&&(t=!0)}if(a.scheduled_date&&e.scheduled_date){var s;i=new Date(a.scheduled_date.$gte).getTime(),n=new Date(a.scheduled_date.$lt).getTime();i<=(s=new Date(e.scheduled_date).getTime())&&s<n&&(t=!0)}a.status&&a.status==e.status&&(t=!0),a.$and&&a.$and.forEach(a=>{if(console.log("HIIII",a),a.scheduled_date&&e.scheduled_date){var i=new Date(a.scheduled_date.$gte).getTime(),n=new Date(a.scheduled_date.$lt).getTime(),s=new Date(e.scheduled_date).getTime();i<=s&&s<n&&(t=!0)}})})),t&&n.push(a(e))}),t.rows.add(n).draw(!1)}}},SLIDER={FILTER:function(e){return`<div id="filter-container" class="slider-container" style="display:none;">\n                    <h5 class="pl-3">Filter<i id="slider-close" class="la la-times" style="float: right;font-size: 13px;line-height: 20px;padding: 0px 8px;cursor: pointer;"></i></h5>\n                    <div class="p-3" style="border-top: 1px solid #eee;">\n                        ${e}\n                        <button id="filter-btn" style="width: 100%;" class="btn btn-success mt-3">Apply</button>\n                        <a href="javascript:void(0)" id="reset-btn" style="font-size: 11px;width: max-content;margin: auto;" class="text-success p-2 d-block">Reset filters</a>\n                    </div>\n                </div>`},CLONE:function(e){return`<div id="clone-container" class="slider-container" style="display:none;">\n                    <h5 class="pl-3">Clone Live Data<i id="slider-close" class="la la-times" style="float: right;font-size: 13px;line-height: 20px;padding: 0px 8px;cursor: pointer;"></i></h5>\n                    <div class="p-3" style="border-top: 1px solid #eee;">\n                        ${e}\n                        <button id="clone-btn" style="width: 100%;" class="btn btn-success mt-3">Apply</button>\n                    </div>\n                </div>`},COLUMN_VISIBILITY:function(e){var t="";return e.forEach((e,a)=>{var i=e.disabled?"":"custom-bgcolor-green",n=e.disabled?'style="pointer-events: none;"':"",s=e.visible?"checked":"";e.hiddenInCustomVisibilityOptions||(t+=`<div class="fancy-checkbox ${i}" ${n}>\n                                <label>\n                                    <input type="checkbox" ${s}>\n                                    <span class="toggle-vis" data-column="${a}">${e.title}</span>\n                                </label>\n                            </div>`)}),`<div id="cv-container" class="slider-container" style="display:none;">\n                    <h5 class="pl-3">Customize Display Options<i id="slider-close" class="la la-times" style="float: right;font-size: 13px;line-height: 20px;padding: 0px 8px;cursor: pointer;"></i></h5>\n                    <div class="p-3" style="border-top: 1px solid #eee;">\n                    ${t}\n                    </div>\n                </div>`},EXPORT:function(){return'<div id="export-container" class="slider-container" style="display:none;">\n                    <h5 class="pl-3">Export Options<i id="slider-close" class="la la-times" style="float: right;font-size: 13px;line-height: 20px;padding: 0px 8px;cursor: pointer;"></i></h5>\n                    <div class="p-3" style="border-top: 1px solid #eee;"></div>\n                </div>'},REPORT:function(){return`<div id="report-container" class="slider-container" style="display:none;">\n                    <h5 class="pl-3">Generate Report<i id="slider-close" class="la la-times" style="float: right;font-size: 13px;line-height: 20px;padding: 0px 8px;cursor: pointer;"></i></h5>\n                    <div class="p-3" style="border-top: 1px solid #eee;">\n                        <div>\n                            <div style="font-size: 10px;">Date:</div>\n                            <input type="text" id="_rdate" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" readonly>\n                        </div>\n                        <button id="report-btn" style="width: 100%;" class="btn btn-success mt-3">Apply</button>\n                        <div id="mreport-container" class="mt-3" style="display:none;">\n                            <div class="mt-3 mb-1 font-bold">Generate Report for <span id="mreport-date">October 30, 2020</span>:</div>\n                            <div mreport="todr-05-12" class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span class="float-right pt-1 pl-3 "><i class="la la-download"></i></span>\n                                <span>Trucks Outside DC Report<br>(Prev) 05:01:00 PM - 12:00:59 AM</span>\n                            </div>\n                            <div mreport="todr-07-09" class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 mt-1 disabled">\n                                <span class="float-right pt-1 pl-3 "><i class="la la-download"></i></span>\n                                <span>Trucks Outside DC Report<br>07:01:00 AM - 09:00:59 AM</span>\n                            </div>\n                            <div mreport="todr-09-12" class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 mt-1 disabled">\n                                <span class="float-right pt-1 pl-3 "><i class="la la-download"></i></span>\n                                <span>Trucks Outside DC Report<br>09:01:00 AM - 12:00:59 PM</span>\n                            </div>\n                            <div mreport="todr-12-03" class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 mt-1 disabled">\n                                <span class="float-right pt-1 pl-3 "><i class="la la-download"></i></span>\n                                <span>Trucks Outside DC Report<br>12:01:00 PM - 03:00:59 PM</span>\n                            </div>\n                            <div mreport="todr-03-05" class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 mt-1 disabled">\n                                <span class="float-right pt-1 pl-3 "><i class="la la-download"></i></span>\n                                <span>Trucks Outside DC Report<br>03:01:00 PM - 05:00:59 PM</span>\n                            </div>\n                            <div style="font-size: 9px;font-weight: 100;" class="col-sm-12 text-muted mt-2 p-0">\n                                Please click 'Yes' when a pop-up appears saying "The file format and extension of 'FILENAME.xls' don't match. The file could be corrupted or unsafe. Unless you trust its source, don't open it. Do you want to open it anyway?".\n                            </div>\n                        </div>\n                    </div>\n                </div>`}},MODAL={CONFIRMATION:function(e){var t=`<div class="cd-popup" id="confirm-modal">\n                        <div class="cd-popup-container">\n                            <p class="mb-0">${e.content||"Are you sure you want to delete this entry?"}</p>\n                            <ul class="cd-buttons">\n                                <li><a style="${e.confirmBGStyle||""}" confirm>${e.confirmButtonText||"Yes"}</a></li>\n                                <li><a cancel>No</a></li>\n                            </ul>\n                            <a close class="cd-popup-close img-replace"></a>\n                        </div>\n                    </div>`;$("body").append(t),$("#confirm-modal [confirm]").click(function(){$("#confirm-modal [confirm]").html(`<i class="la la-spinner la-spin mr-2"></i>${e.confirmButtonText||"Yes"}`).addClass("disabled"),"function"==typeof e.confirmCallback&&e.confirmCallback(),!0!==e.confirmCloseCondition&&$("#confirm-modal").remove()}),$("#confirm-modal [cancel],#confirm-modal [close]").click(function(){"function"==typeof e.cancelCallback&&e.cancelCallback(),$("#confirm-modal").remove()})},CONFIRMATION_W_FIELD:function(e){var t=`<div class="cd-popup" id="confirm-modal">\n                        <div class="cd-popup-container">\n                            <div class="pt-5 pb-4">${e.content||"Are you sure you want to delete this entry?"}</div>\n                            <div class="col-sm-12 mb-3">\n                                <textarea class="form-control" id="modal-field"></textarea>\n                            </div>\n                            <ul class="cd-buttons">\n                                <li><a style="${e.confirmBGStyle||""}" confirm>${e.confirmButtonText||"Yes"}</a></li>\n                                <li><a cancel>${e.cancelButtonText||"No"}</a></li>\n                            </ul>\n                            <a close class="cd-popup-close img-replace"></a>\n                        </div>\n                    </div>`;$("body").append(t),$("#confirm-modal [confirm]").click(function(){$("#modal-field").val().isEmpty()||($("#confirm-modal [confirm]").html(`<i class="la la-spinner la-spin mr-2"></i>${e.confirmButtonText||"Yes"}`).addClass("disabled"),"function"==typeof e.confirmCallback&&e.confirmCallback($("#modal-field").val()),!0!==e.confirmCloseCondition&&$("#confirm-modal").remove())}),$("#confirm-modal [cancel],#confirm-modal [close]").click(function(){"function"==typeof e.cancelCallback&&e.cancelCallback(),$("#confirm-modal").remove()})},MINI_MONITOR:function(e){var t='<div class="col-sm-12 mt-2" style="height: 100%;overflow: auto;">\n                            <div class="table-wrapper">\n                                <table id="tbl-mini-monitor" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>';return ISMOBILE&&(t='<div id="mini-monitor-container" class="col-sm-12 p-0" style="max-height: 100%;overflow: auto;"></div>'),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                    <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                        <div role="document" class="modal-dialog" style="width: 100%;margin: 0;height: 100%;">\n                            <div class="modal-content" style="height: 100%;">\n                                <div class="modal-header pb-2">\n                                    <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                    <h4 class="modal-title" id="myModalLabel2">${e.title}</h4>\n                                </div>\n                                <div class="modal-body row pt-2" style="height: calc(100% - 70px);">${t}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>`},CREATE:{EMPTY:function(e="Modal",t="",a="lg"){return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-${a}" style="margin:20px auto;">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                    </div>\n                                    <div class="modal-body row pl-4 pr-4 pt-2">\n                                        ${t}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`},BASIC:function(e){var t="";e.el.forEach(e=>{var a=e.required?'<span class="text-danger">*</span>':"",i=e.required?"required":"",n=e.attr||"",s=e.readonly?"readonly":"",l=e.disabled?'disabled="disabled"':"",o=e.notInclude?"time=true":"",r=e.type||"text",d=e.multiple||!1,c=e.value||"",u=e.sub_title?`<small class="text-muted mb-1 d-block">${e.sub_title}</small>`:"",p=e.placeholder||"";if("select"==r){e.value=e.value||[];var m=e.noDefault?"":`<option value="" disabled selected>Select ${e.title}</option>`;e.options.forEach(e=>{var t=c.includes(e.id)?"selected":"";m+=`<option value="${e.id}" ${t}>${e.value||e.id}</option>`}),t+=`<div class="col-sm-12">\n                                    <small>${a}${e.title}:</small>\n                                    <select id="${e.id}" class="form-control" ${n} ${i} ${s} ${l}>${m}</select>\n                                </div>`}else if("select2"==r){m="";var h=!0===d?"select-multiple-basic":"select-basic",b=!0===d?'multiple="multiple"':"";e.value=e.value||[],e.options=e.options||[],e.options.forEach(t=>{var a=e.value.includes(t.id)?"selected":"";m+=`<option value="${t.id}" ${a}>${t.value||t.id}</option>`}),t+=`<div class="col-sm-12">\n                                    <small>${a}${e.title}:</small>\n                                    <select id="${e.id}" class="${h}" ${b} style="width: 100%;" ${n} ${i} ${l}>${m}</select>\n                                    ${u}\n                                </div>`}else if("time"==r){var f=DATETIME.HH_MM(null,e.value);t+=`<div class="col-sm-12 mb-4">\n                                    <small>${a}${e.title}:</small>\n                                    <div class="form-control">\n                                        <input id="${e.id}-hh" time=true type="number" class="wo_arrow" step="any" min="0" value="${f.hour}" style="border:none;width: 48%;text-align: center;background: transparent;" placeholder="HH">:<input type="number" id="${e.id}-mm" class="wo_arrow" time=true step="any" min="0" value="${f.minute}" style="border:none;width: 48%;text-align: center;background: transparent;" placeholder="MM">\n                                        <input id="${e.id}" type="number" value="${e.value}" class="hidden">\n                                    </div>\n                                </div>`}else t+="textarea"==r?`<div class="col-sm-12">\n                                    <small>${a}${e.title}:</small>\n                                    <textarea id="${e.id}" class="form-control" ${n} ${o} ${i} ${s} ${l}></textarea>\n                                </div>`:`<div class="col-sm-12">\n                                    <small>${a}${e.title}:</small>\n                                    <input id="${e.id}" type="${r}" ${n} class="form-control" placeholder="${p}" value="${c}" autocomplete="off" ${i} ${s}>\n                                    ${u}\n                                </div>`});var a=t;return e.columned&&(a=`<div class="${e.column1Style||"col-sm-6"}">${t}</div>\n                            <div class="${e.column2Style||"col-sm-6"}">${e.column2Content}</div>`),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm" style="${e.modalStyle||""}">\n                                <div class="modal-content">\n                                    <div class="modal-header pb-2">\n                                        <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                        <h4 class="modal-title" id="myModalLabel2">${e.title}</h4>\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div id="modal-error"></div>\n                                        ${a}\n                                        <div class="col-sm-12"> \n                                            <button id="submit" type="button" class="btn btn-primary col-sm-12 mt-4">Submit</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>`}},SUBMIT:function(e,t,a){$("#submit").click(function(){$("#modal-error").hide();var i={},n={"background-color":"white"},s={"background-color":"#ffe4e4"},l=!0;if($('#modal :input[type="text"],#modal :input[type="number"],#modal :input[type="email"],#modal select').each((e,t)=>{var a=$(t).is("select")?[]:$.isNumeric($(t).val())?0:"";if(null==$(t).attr("doNotSave")){null!=$(t).attr("blankStringIfEmpty")&&(a="");var o={id:$(t).attr("id"),value:$(t).val()||a,valueTemp:$(t).val()||a,time:$(t).attr("time"),required:$(t).attr("required")};if(o.id)"phoneNumber"==o.id&&(o.value=GET.INTLTELINPUT_VALUE("#phoneNumber")),o.time||(i[o.id]=o.value);else{var r=$(t).parents("table").attr("id");if(o.id=r,!i[o.id])$(t).parents("table").find("tr").each((e,t)=>{var a={};$(t).find("input").each((e,t)=>{var i=$(t).attr("_attr");"___"!=i.substring(0,3)&&(a[i]=$(t).val()||"")}),i[o.id]||(i[o.id]=[]),Object.keys(a).length>0&&i[o.id].push(a)})}o.required&&o.valueTemp.isEmpty()?($(t).css(s),$(t).next(".select2-container").find(".select2-selection").css(s),l=!1):($(t).css(n),$(t).next(".select2-container").find(".select2-selection").css(n))}}),"function"==typeof a&&(console.log("additionalValues()",a()),i=$.extend(i,a())),l){if($("#submit").html('<i class="la la-spinner la-spin mr-2"></i>Submit').attr("disabled",!0),"PUT"==e.method&&delete i._id,t)if("POST"==e.method&&"POST"==t.method)GET.AJAX({url:`${t.url}${$(`#${t.id}`).val()}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(e){e.length>0?MODAL.CONFIRMATION({content:`A geofence with short name "${$(`#${t.id}`).val()}" already exists. This will overwrite the existing geofence. Do you want to continue?`,confirmCloseCondition:!0,confirmBGStyle:"background-color:#64b03a;",confirmCallback:function(){r(),$("#confirm-modal,#overlay").remove()},cancelCallback:function(){$("#modal #submit").html("Submit").attr("disabled",!1)}}):r()});else if(t.ggsURL){var o=function(e){if(t.object&&t.object.length>0){var a=[];(t.object||[]).forEach(e=>{if(a.push({name:e.name,value:$(e.el).val()||" "}),"Trailer"==e.name&&$(e.el).val()){var t=getTrailer($(e.el).val());t&&(a.push({name:"Pal Cap",value:t.pal_cap}),a.push({name:"Region",value:t.region}),a.push({name:"Cluster",value:t.cluster}),a.push({name:"Site",value:t.site}))}}),console.log("new_object",a),console.log("body",i),GET.AJAX({url:t.ggsURL,method:"PUT",headers:{Authorization:USER.apiKey},data:JSON.stringify(a)},function(e){r()},function(t){0==t.status&&e<MAX_TRIES?o(++e):r(),TOASTR.ERROR(t)})}else r()};o(0)}else r();else r();function r(){GET.AJAX({url:e.url,method:e.method,headers:{"Content-Type":"application/json; charset=utf-8",Authorization:SESSION_TOKEN},data:JSON.stringify(i)},function(t){1==t.ok?($("#overlay").remove(),"PUT"==e.method?TOASTR.UPDATEDSUCCESSFULLY():TOASTR.CREATEDSUCCESSFULLY()):(toastr.error(`${t.error.message}</br></br>Error Code - ec014/01`),$("#submit").html("Submit").attr("disabled",!1))},function(e){console.log(e),409==e.status?toastr.error("Record already exists.</br></br>Error Code - ec014/01"):toastr.error(`${e.responseJSON.error.message}</br></br>Error Code - ec014/01`),$("#submit").html("Submit").attr("disabled",!1)})}}else ALERT.REQUIREDFIELDS("#modal-error")})}},TABLE={BUTTONS:function(e){var t=e.goto,a=PAGE_FUNCTIONALITIES[t].buttons.table||[],i=e.dt_buttons||[],n=e.loadView||[],s=e.actions||{};return a.forEach(e=>{var a=0==i.length?"ml-1":"";if(a+=n.includes(e)?" disabled":"",PERMISSION[t].create&&"none"!=PERMISSION[t].create){if("create"==e){var l=n.includes(e)?"la-spin la-spinner":"la-plus",o="wilcon"!=CLIENT.id?"Create New Record (v2.0)":"Create New Record",r="wilcon"!=CLIENT.id?"Create v2.0":"Create";i.push({text:`<i class="la ${l}" data-toggle="tooltip" title="${o}"></i> ${r}`,className:`create-btn ${a} `,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}})}if("import"==e){l=n.includes(e)?"la-spin la-spinner":"la-file-upload";i.push({text:`<i class="la ${l}" data-toggle="tooltip" title="Import Batch File"></i> Import`,className:`import-btn ${a} `,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}})}}"refresh"==e&&i.push({text:'<i class="la la-refresh" data-toggle="tooltip" title="Refresh Table"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"filter"==e&&i.push({text:'<i class="la la-filter" data-toggle="tooltip" title="Filter"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"export"==e&&i.push({text:'<i class="la la-file-export" data-toggle="tooltip" title="Export Options"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"report"==e&&i.push({text:'<i class="la la-download" data-toggle="tooltip" title="Generate Report"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"column"==e&&i.push({text:'<i class="la la-columns" data-toggle="tooltip" title="Customize Display Options"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"search"==e&&i.push({text:'<i class="la la-search" data-toggle="tooltip" title="Search Table"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"eye"==e&&i.push({text:'<i class="la la-eye" data-toggle="tooltip" title="Hide/Show All In Transit Entries (Including from previous dates)"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}}),"clone"==e&&i.push({text:'<i class="la la-copy" data-toggle="tooltip" title="Clone Live Data"></i>',className:a,action:function(t,a,i,n){"function"==typeof s[e]&&s[e]()}})}),i},POPULATE:function(e){$(".dt-button .la-refresh").addClass("la-spin disabled"),$(".dt-button .la-refresh").parents(".dt-button").addClass("disabled"),$(".cb-container .la-refresh").addClass("la-spin disabled"),$("#filter-container input,#filter-container select").attr("disabled",!0),$("#filter-container button,#filter-container a").addClass("disabled"),e.filter=e.filter||{},e.dataTableOptions=$.extend(e.dataTableOptions,{language:{search:"",searchPlaceholder:"Search",sLengthMenu:"_MENU_"}}),ISMOBILE&&(e.dataTableOptions=$.extend(e.dataTableOptions,{responsive:!0})),e.dataTableOptions=$.extend(e.dataTableOptions,{responsive:!0});var t=null,a=0,i=e.table_id,n=function(l){if(null==l||l==LIMIT){var o=e.withFilter?`/${JSON.stringify(e.filter)}`:"";o+=e.withPagination?`/${a}/${LIMIT}`:"",GET.AJAX({url:`/api/${e.url}${o}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(o){console.log(`${e.commentTitle}:`,o),o.error||("function"==typeof FILTER.CALLBACK&&FILTER.CALLBACK(!0),$("#filter-btn").html("Apply").removeClass("disabled"),$(".dt-button .la-refresh").removeClass("la-spin"),$(".dt-button .la-refresh").parents(".dt-button").removeClass("disabled"),"reset"==FILTER.STATUS?$(".cb-container .la-refresh").removeClass("la-spin"):$(".cb-container .la-refresh").removeClass("la-spin disabled"),$("#filter-container input,#filter-container select").attr("disabled",!1),$("#filter-container button,#filter-container a").removeClass("disabled"),l=o.length,!0===e.newlyLoaded&&(e.newlyLoaded=!1,[e.goto].includes(PAGE.GET())&&(PAGE.DISPLAY(),s(),"function"==typeof e.initializeCallback&&e.initializeCallback(o,t))),o.error?toastr.error(o.error.message):(o.forEach(t=>{LIST[e.urlPath].findIndex(e=>e._id.toString()==t._id.toString())>-1||(t._row=GENERATE.RANDOM(36),LIST[e.urlPath].push(t))}),a+=l,[e.goto].includes(PAGE.GET())&&("function"==typeof e.populateCallback&&e.populateCallback(o),$(i).length>0&&n(l))))})}else $("#progress-striped-active .progress-bar").css("width","0%").html("0%"),$("div.tbl-progress-bar").hide(),!0===e.newlyLoaded&&(e.newlyLoaded=!1,[e.goto].includes(PAGE.GET())&&(PAGE.DISPLAY(),s(),"function"==typeof e.initializeCallback&&e.initializeCallback(null,t)))};function s(){$.fn.DataTable.isDataTable(i)&&$(i).DataTable().clear().destroy(),t=$(i).DataTable(e.dataTableOptions),ISMOBILE&&($(".dt-buttons").addClass("d-inline-block"),$(".dataTables_wrapper").css("text-align","center"),$(".table.dataTable").css("text-align","unset")),$(i).on("page.dt length.dt draw.dt order.dt",function(){PAGE.TOOLTIP(),TABLE.FINISH_LOADING.START_CHECK(),$(`${i} thead tr th`).each((e,t)=>{$(t).is(":visible")||$(`${i} tr:not(.child)`).each((t,a)=>{$(a).find("td").eq(e).hide()})})}),$('.dt-button [data-toggle="tooltip"]').each((e,t)=>{var a=$(t).attr("data-original-title")||$(t).attr("title");$(t).parents(".dt-button").attr({"data-toggle":"tooltip","data-original-title":a}),$(t).removeAttr("data-toggle data-original-title")}),PAGE.TOOLTIP(),e.perColumnSearch&&($(i).find("thead").append('<tr class="row-filter"><th></th><th></th><th></th><th></th><th></th></tr>'),$(i).find("thead .row-filter th:not(:last-child)").each(function(){$(this).html('<input type="text" class="form-control input-sm" placeholder="Search...">')}),$(i).find(".row-filter input").on("keyup change",function(){t.column($(this).parent().index()+":visible").search(this.value).draw()}))}!0===e.noData?(PAGE.DISPLAY(),s(),"function"==typeof e.initializeCallback&&e.initializeCallback(null,t),"function"==typeof e.noDataFunction&&e.noDataFunction(),TABLE.FINISH_LOADING.START_CHECK()):n()},ROW_LISTENER:function(e){var t=e.table_id,a=e._row,i=e._id,n=e.urlPath,s=e.deleteURL||`/api/${n}/${CLIENT.id}/${USER.username}/${i}`,l=e.editCallback||function(){var t=LIST[n].find(e=>e._id.toString()==i.toString());e.initializeModal({url:`/api/${n}/${CLIENT.id}/${USER.username}/${i}`,method:"PUT",obj:t})};$(t).on("click",`[_row="${a}"] [edit],[_row="${a}"] + tr.child [edit]`,function(e){e.stopImmediatePropagation(),l()}),$(t).on("click",`[_row="${a}"] [delete],[_row="${a}"] + tr.child [delete]`,function(i){i.stopImmediatePropagation(),MODAL.CONFIRMATION({confirmCloseCondition:!0,content:e.deleteModalContent,confirmCallback:function(){$.ajax({url:s,method:"DELETE",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(e){1==e.ok?($("#confirm-modal").remove(),$(t).DataTable().row(`[_row="${a}"]`).remove().draw(!1),TOASTR.DELETEDSUCCESSFULLY()):TOASTR.ERROR(e)}).fail(function(e){TOASTR.ERROR(e)})}})}),"function"==typeof e.additionalListeners&&e.additionalListeners()},ROW_BUTTONS:function(e,t={}){var a=(t=t||{}).status,i=t.attrs||"",n=t.readonlyArr||[],s=t.disabledArr||[],l=t.adminArr||[],o=t.loadView||[],r=t.customButtons,d=!autorizationLevel.dispatcher()||!!USER.dc,c=t.username,u=t.deleteArr||[],p=null==d||1==d?"":"dispatcherCondition",m=PAGE_FUNCTIONALITIES[e].buttons||{},h=PERMISSION[e]||{},b=0,f={add:{permission:"update",icon:"la-plus",title:"Add Record",attr:"add"},view:{permission:"read",icon:"la-search-plus",title:"View Record",attr:"view"},edit:{permission:"update",icon:"la-pencil",title:"Edit Record",attr:"edit",statusCheck:!0},"edit-admin":{permission:"update",icon:"la-pencil",title:"Edit Record (v2.0)",attr:"edit-admin",statusCheck:!0},"edit-rest-days":{permission:"update",icon:"la-calendar-week",title:"Edit Rest Days",attr:"edit-rest-days"},comment:{permission:"update",icon:"la-comment",title:"Add Comment",attr:"comment",statusCheck:!0},delete:{permission:"delete",icon:"la-trash-o",title:"Delete Record",attr:"delete"},statusUpdate:{permission:"update",icon:"la-stream",title:"Update Record's Status",attr:"statusUpdate"},history:{permission:"read",icon:"la-history",title:"History",attr:"history"}},v=function(e){var t=!1;return("all"==h[e]||"self"==h[e]&&c==USER.username)&&(t=!0),t},E="";return(m.row||[]).forEach(e=>{function t(){var t,r=f[e],d=l.includes(e)?"admin":"",c=s.includes(e)?"disabled":"",m=n.includes(e)?"readonly":"";if(r){var h=o.includes(e)?"la-spin la-spinner":r.icon;v(r.permission)&&(t=!1,u.forEach(i=>{i.button==e&&i.byPassCondition?t=!0:i.button==e&&(i.status||[]).includes(a)&&(t=!0)}),!t)&&(E+=`<a title="${r.title}" class="dt-button action-icon ${d} ${c} ${m} ${p}" ${i} ${r.attr}><i class="la ${h}"></i></a>`,b++)}}r?r.includes(e)&&t():t()}),{buttons:`<div style="text-align:center;">${E}</div>`,width:`${22*b}px`}},WATCH:function(e){var t=e.urlPath;CHANGESTREAMS[t]=function(a){var i=`#tbl-${t}`,n=null,s=a.operationType,l=a.documentKey._id,o=a.fullDocument,r=LIST[t]?LIST[t].findIndex(e=>e._id.toString()==l.toString()):null,d=LIST[t]?LIST[t][r]:null;if(console.log(t,s,l,o),"insert"==s){if("notifications"==t&&"test"!=o.type&&PERMISSION.de_dashboard){var c=`${o.escalation}_${o.delay_type}_${o.dispatch_id}_${o.site}`;if(!DE_NOTIF_COUNT.includes(c))if(DE_NOTIF_COUNT.push(c),DE_DASHBOARD.FUNCTION.setBadge("add"),"none"==USER.settings.push_notification);else{document.getElementById("audio01").play();var u="Transit";o.delay_type.indexOf("Queueing")>-1&&(u="Queueing"),o.delay_type.indexOf("CICO")>-1&&(u="CICO");try{if("desktop"==USER.settings.push_notification)try{if("granted"==Notification.permission)new Notification(`${o.dispatch_id} | Escalation ${o.escalation}`,{body:`Running ${u} Duration: ${DATETIME.HH_MM(null,o.timelapse).hour_minute}`,tag:`${o.dispatch_id} | Escalation ${o.escalation}`}).onclick=function(e){window.history.pushState({},null,"#de_dashboard"),PAGE.GO_TO()}}catch(e){}else toastr.error(`<span style="background-color:red; display:inline-block;border-radius:20px; width:7px;height:7px;margin-right:4px;"></span><b>${o.dispatch_id}</b> | Escalation ${o.escalation}<br>Running ${u} Duration: ${DATETIME.HH_MM(null,o.timelapse).hour_minute}`,"",{positionClass:"toast-bottom-right toastr-white-bg",showDuration:"300",closeButton:!0,hideDuration:"1000",timeOut:"20000",preventDuplicates:!0,onclick:function(){window.history.pushState({},null,"#de_dashboard"),PAGE.GO_TO()}})}catch(e){}}}if(LIST[t]){var p=LIST[t].findIndex(e=>e._id.toString()==o._id.toString());if("notifications"==t&&$.fn.DataTable.isDataTable("#tbl-oc")){var m=[100,500,1e3,1500,2e3],h=Math.floor(Math.random()*m.length),b=Math.floor(Math.random()*m.length),f=Math.floor(Math.random()*m[b])+m[h];console.log("ms",h,b,f),setTimeout(function(){"Over Transit"==o.delay_type&&(i="#tbl-ot"),"Long Queueing"==o.delay_type&&(i="#tbl-lq"),"Over CICO"==o.delay_type&&(i="#tbl-oc"),n=$(i).DataTable();var e=LIST[t].find(e=>e.dispatch_id==o.dispatch_id&&e.delay_type==o.delay_type);if(e){if(o.escalation>e.escalation){n.row(`[_row="${e._row}"]`).remove().draw(!1);var a=$.grep(LIST[t],function(e){return e.dispatch_id!=o.dispatch_id});LIST.notifications=a,DE_DASHBOARD.FUNCTION.setSummary(),o.id=o._id,DE_DASHBOARD.FUNCTION.addDataToTable(o).then(e=>{n.row.add(e).draw(!1),DE_DASHBOARD.FUNCTION.setSummary()})}}else o.id=o._id,DE_DASHBOARD.FUNCTION.addDataToTable(o).then(e=>{n.row.add(e).draw(!1),DE_DASHBOARD.FUNCTION.setSummary()})},f)}"notifications"==t&&$.fn.DataTable.isDataTable(i)?$.ajax({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${o.dispatch_id}`,method:"GET",timeout:9e4,headers:{Authorization:SESSION_TOKEN},async:!0}).done(function(a){var s=a[0];o.dispatchDetails={status:s.status,departure_date:s.departure_date},o._row=p>-1?d._row:GENERATE.RANDOM(36),p>-1?LIST[t][p]=o:LIST[t].push(o),$.fn.DataTable.isDataTable(i)&&e.rowData&&(n=$(i).DataTable(),FILTER.APPROVAL[t]&&PAGE.GET()==t?FILTER.APPROVAL[t]([o],n,e.rowData):n.row.add(e.rowData(o)).draw(!1))}):("notifications"==t&&$.fn.DataTable.isDataTable("#tbl-oc")||(o._row=p>-1?d._row:GENERATE.RANDOM(36),p>-1?LIST[t][p]=o:LIST[t].push(o)),$.fn.DataTable.isDataTable(i)&&e.rowData&&(n=$(i).DataTable(),FILTER.APPROVAL[t]&&PAGE.GET()==t?FILTER.APPROVAL[t]([o],n,e.rowData):n.row.add(e.rowData(o)).draw(!1))),"dispatch"==t&&$.fn.DataTable.isDataTable("#tbl-dashboard")&&("function"==typeof DASHBOARD.FUNCTION.addDataToTable&&DASHBOARD.FUNCTION.addDataToTable([o],!1),"function"==typeof DASHBOARD.FUNCTION.addDataToTable2&&DASHBOARD.FUNCTION.addDataToTable2([o],!1)),"notifications"==t&&ISMOBILE&&NOTIFICATIONS.FUNCTION.mobileAddToList({val:o,urlPath:t},!0).then(e=>{$(".page-box.row > .col-sm-12 [_row]").length>0?$(".page-box.row > .col-sm-12").prepend(e):$(".page-box.row > .col-sm-12").html(e)})}}if("update"==s||"replace"==s){if(d)if(o._row=d._row,(p=LIST[t].findIndex(e=>e._row==o._row))>-1?LIST[t][p]=o:LIST[t].push(o),$.fn.DataTable.isDataTable(i)){var v=(n=$(i).DataTable()).row(`[_row="${d._row}"]`).node();v&&e.rowData&&n.row(v).data(e.rowData(o)).draw(!1)}if("dispatch"==t&&$.fn.DataTable.isDataTable("#tbl-dashboard")&&("function"==typeof DASHBOARD.FUNCTION.addDataToTable&&DASHBOARD.FUNCTION.addDataToTable([o],!1),"function"==typeof DASHBOARD.FUNCTION.addDataToTable2&&DASHBOARD.FUNCTION.addDataToTable2([o],!1)),"dispatch"==t&&$.fn.DataTable.isDataTable("#tbl-oc"))if(["processingAtOrigin","idlingAtOrigin","in_transit","complete","incomplete"].includes(o.status)&&(g="#tbl-lq"),["in_transit","complete","incomplete"].includes(o.status)&&(g="#tbl-oc"),["complete","incomplete"].includes(o.status)&&(g="#tbl-ot"),g&&LIST.notifications){LIST.notifications.filter(e=>e.dispatch_id==o._id).forEach(e=>{$.fn.DataTable.isDataTable(g)&&$(g).DataTable().row(`[_row="${e._row}"]`).remove().draw(!1)});var E=$.grep(LIST.notifications,function(e){return e.dispatch_id!=o._id});LIST.notifications=E,DE_DASHBOARD.FUNCTION.setSummary()}}if("delete"==s){E=$.grep(LIST[t]||[],function(e){return e._id.toString()!=l.toString()});if($.fn.DataTable.isDataTable(i)&&(n=$(i).DataTable()).row(`[_row="${d._row}"]`).remove().draw(!1),"dispatch"==t&&$.fn.DataTable.isDataTable("#tbl-oc")){var g="#tbl-ot,#tbl-lq,#tbl-oc";LIST.notifications.filter(e=>e.dispatch_id==l).forEach(e=>{$.fn.DataTable.isDataTable(g)&&$(g).DataTable().row(`[_row="${e._row}"]`).remove().draw(!1)});E=$.grep(LIST.notifications,function(e){return e.dispatch_id!=l});LIST.notifications=E,DE_DASHBOARD.FUNCTION.setSummary()}if("notifications"==t&&$.fn.DataTable.isDataTable("#tbl-oc")){console.log("Deleted notifications",l);g="#tbl-ot,#tbl-lq,#tbl-oc";LIST[t].filter(e=>e.id&&e.id.toString()==l.toString()||e._id.toString()==l.toString()).forEach(e=>{$.fn.DataTable.isDataTable(g)&&$(g).DataTable().row(`[_row="${e._row}"]`).remove().draw(!1)});E=$.grep(LIST[t],function(e){return e.id&&e.id.toString()!=l.toString()||e._id.toString()!=l.toString()});LIST[t]=E,DE_DASHBOARD.FUNCTION.setSummary()}"notifications"==t&&$.fn.DataTable.isDataTable("#tbl-oc")&&"dispatch"==t&&$.fn.DataTable.isDataTable("#tbl-oc")||(LIST[t]=E),"dispatch"==t&&$.fn.DataTable.isDataTable("#tbl-dashboard")&&("function"==typeof DASHBOARD.FUNCTION.addDataToTable&&DASHBOARD.FUNCTION.addDataToTable(null,!1,d),"function"==typeof DASHBOARD.FUNCTION.addDataToTable2&&DASHBOARD.FUNCTION.addDataToTable2(null,!1,d)),"notifications"==t&&ISMOBILE&&($(`.page-box.row > .col-sm-12 [_row="${d._row}"]`).remove(),0==$(".page-box.row > .col-sm-12 [_row]").length&&$(".page-box.row > .col-sm-12").html('<div style="text-align: center;margin-top: 15px;">You do not have any notifications</div>')),"sessions"==t&&l==SESSION_TOKEN&&LOGOUT()}if("users"==t&&o&&o._id==USER.username){var T=USER.role;USER.fullName=o.name,USER.email=o.email,USER.phoneNumber=o.phoneNumber,USER.role=o.role,$("#profile-page #fullname").html(o.name),$("#profile-page #email").html(o.email),$("#profile-page #phoneNumber").html(o.phoneNumber),$("#profile-page #role").html(USER.role.capitalize()),(o.role||"user")!=T&&(toastr.warning("Your privileges has been changed. This page will automatically refresh in 5 seconds.",null,{timeOut:5e3}),setTimeout(function(){location.reload()},5e3))}"function"==typeof e.options&&e.options()}},COL_ROW:function(e,t,a){var i=PERMISSION[PAGE.GET()]||{},n=function(a){var i;e&&((i=e.findIndex(e=>e.data==a))>-1&&e.splice(i,1));(t&&delete t[a],CUSTOM.COLUMN[PAGE.GET()]&&a)&&((i=CUSTOM.COLUMN[PAGE.GET()].findIndex(e=>e.text==a))>-1&&CUSTOM.COLUMN[PAGE.GET()].splice(i,1))};return["all","self"].includes(i.read)||["all","self"].includes(i.update)||["all","self"].includes(i.delete)||(n("Action"),n(a)),{column:e,row:t}},TOOLBAR:function(e){new $.fn.dataTable.Buttons(e,{buttons:[{extend:"copy",text:"Copy",title:null,exportOptions:{modifier:{search:"applied",order:"applied"},columns:":not(.notExport)",format:{body:function(e,t,a,i){var n=e;return"You"===n&&(n=n.replace("You",USER.fullName)),n.indexOf("<")>-1&&(n=$(n).text()),n}}}},{extend:"csv",text:"CSV",title:null,exportOptions:{modifier:{search:"applied",order:"applied"},columns:":not(.notExport)",format:{body:function(e,t,a,i){var n=e;return"You"===n&&(n=n.replace("You",USER.fullName)),n.indexOf("<")>-1&&(n=$(n).text()),n}}}},{extend:"excel",text:"Excel",title:null,exportOptions:{modifier:{search:"applied",order:"applied"},columns:":not(.notExport)",format:{body:function(e,t,a,i){var n=e;return"You"===n&&(n=n.replace("You",USER.fullName)),n.indexOf("<")>-1&&(n=$(n).text()),n}}}}]}).container().appendTo($("#export-container"))},FINISH_LOADING:{CHECK:null,START_CHECK:function(){"function"==typeof TABLE.FINISH_LOADING.CHECK&&TABLE.FINISH_LOADING.CHECK()},UPDATE:function(){$(".create-btn:not(.dispatcherCondition),.import-btn:not(.dispatcherCondition),.create-admin-btn:not(.dispatcherCondition),.data_maintenance-btn").removeClass("disabled"),$(".create-btn i,.create-admin-btn i").removeClass("la-spin la-spinner").addClass("la-plus"),$(".import-btn i").removeClass("la-spin la-spinner").addClass("la-file-upload"),$(".table a[edit]:not(.dispatcherCondition),.table a[edit-admin]:not(.dispatcherCondition),.table a[view],.table a[comment]").removeClass("readonly"),$(".table a[edit] i,.table a[edit-admin] i").removeClass("la-spin la-spinner").addClass("la-pencil"),$(".table a[view] i").removeClass("la-spin la-spinner").addClass("la-search-plus"),$(".table a[comment] i").removeClass("la-spin la-spinner").addClass("la-comment"),$(".data_maintenance-btn i").removeClass("la-spin la-spinner").addClass("la-tasks")}}};function getGeofence(e="",t="_id",a="find"){return(LIST.geofences||[])[a](a=>a[t].toString()==e.toString())}function getVehicle(e="",t="_id",a="find"){return(LIST.vehicles||[])[a](a=>a[t].toString()==e.toString())}function getVehicleHistory(e="",t="_id",a="find"){return(LIST.vehicles_history||[])[a](a=>a[t].toString()==e.toString())}function getVehiclesSection(e="",t="_id",a="find"){return(LIST.vehicles_section||[])[a](a=>a[t].toString()==e.toString())}function getVehiclesCompany(e="",t="_id",a="find"){return(LIST.vehicles_company||[])[a](a=>a[t].toString()==e.toString())}function getVehiclePersonnel(e="",t="_id",a="find"){return(LIST.vehicle_personnel||[])[a](a=>a[t].toString()==e.toString())}function getVehiclePersonnelSection(e="",t="_id",a="find"){return(LIST.vehicle_personnel_section||[])[a](a=>a[t].toString()==e.toString())}function getVehiclePersonnelCompany(e="",t="_id",a="find"){return(LIST.vehicle_personnel_company||[])[a](a=>a[t].toString()==e.toString())}function getTrailer(e="",t="_id",a="find"){return(LIST.trailers||[])[a](a=>a[t].toString()==e.toString())}function getRoute(e="",t="_id",a="find"){return(LIST.routes||[])[a](a=>a[t].toString()==e.toString())}function getRegion(e="",t="_id",a="find"){return(LIST.regions||[])[a](a=>a[t].toString()==e.toString())}function getCluster(e="",t="_id",a="find"){return(LIST.clusters||[])[a](a=>a[t].toString()==e.toString())}function getUser(e="",t="_id",a="find"){return(LIST.users||[])[a](a=>a[t].toString()==e.toString())}function getShiftSchedule(e="",t="_id",a="find"){return(LIST.shift_schedule||[])[a](a=>a[t].toString()==e.toString())}const views=new function(){return{profile:function(e=""){return CLIENT.allowDownloadFromOtherDB&&(e=`<div class="text-right mt-2"><button id="dl-odb-btn" class="btn btn-default" style="width: 241px;white-space:normal;"><i class="la la-user"></i>Download Profile From WRU Dispatch - ${CLIENT.allowDownloadFromOtherDB}</a></div>`),`<div class="page-box">\n                        <div id="profile-page" class="col-md-6 mt-4">\n                            <h6 class="mt-0">Details</h6>\n                            <table class="table">\n                                <tr>\n                                    <td>Username</td>\n                                    <td class="text-dark">${USER.username}</td>\n                                </tr>\n                                <tr>\n                                    <td>Full Name</td>\n                                    <td id="fullname" class="text-dark">${USER.fullName}</td>\n                                </tr>\n                                <tr>\n                                    <td>Email</td>\n                                    <td id="email" class="text-dark">${USER.email}</td>\n                                </tr>\n                                <tr>\n                                    <td>Phone Number</td>\n                                    <td id="phoneNumber" class="text-dark">${USER.phoneNumber}</td>\n                                </tr>\n                            </table>\n                            <h6>Role</h6>\n                            <table class="table">\n                                <tr>\n                                    <td id="role" class="text-dark">${USER.role.capitalize()}</td>\n                                </tr>\n                            </table>\n                            <h6>Location Assigned <i class="text-muted">(for dispatchers only)</i></h6>\n                            <table class="table">\n                                <tr>\n                                    <td class="text-dark" granted_dc><small class="font-italic text-muted">loading...</small></td>\n                                </tr>\n                            </table>\n                        </div>\n                        <div class="col-md-12">\n                            <h6 style="border-bottom: 1px solid #eee;" class="mb-0 pb-3">Locations In-Charge</h6>\n                            <table class="table" style="table-layout: fixed;">\n                                <tbody>\n                                    <tr>\n                                        <td style="border-color: #fff !important;" class="p-0 pt-2 pb-2"><small>Region</small></td>\n                                        <td style="border-color: #fff !important;" class="p-0 pt-2 pb-2"><small>Cluster</small></td>\n                                        <td style="border-color: #fff !important;" class="p-0 pt-2 pb-2"><small>Site</small></td>\n                                    </tr>\n                                    <tr>\n                                        <td class="p-0 pt-2" regions><small class="font-italic text-muted">loading...</small></td>\n                                        <td class="p-0 pt-2" clusters><small class="font-italic text-muted">loading...</small></td>\n                                        <td class="p-0 pt-2" geofences><small class="font-italic text-muted">loading...</small></td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                        <div class="text-right"><button id="dl-btn" class="btn btn-default" style="width: 241px;"><i class="la la-user"></i>Download Profile From WRU Main</a></div>\n                        ${e}\n                        <div class="text-right"><button id="edit-btn" class="btn btn-default mt-2" style="width: 241px;"><i class="la la-pencil"></i>Edit Details</a></div>\n                    </div>`},settings:function(){return`<div class="page-box">\n                            <div class="row">\n                                <div class="col-md-12">\n                                    <div class="col-md-12">\n                                        <h5>Push Notifications</h5>\n                                    </div>\n                                    <div class="col-md-12 mt-1">\n                                        <div class="fancy-radio">\n                                            <label class="m-0">\n                                                <input name="push_notification" value="toast" type="radio">\n                                                <span><i></i>Toast Notification<a id="toast-test" href="javascript:void(0);" class="ml-2" style="font-size: 10px;color: #00a548c7;font-style: italic;">Test Me!</a></span>\n                                            </label>\n                                        </div>\n                                        <div class="text-muted mb-2 ml-4">A Toast Notification will only appear on the browser while using this website. It will not appear when the user is on a different website/tabs or uses a different application.</div>\n                                        <div class="fancy-radio">\n                                            <label class="m-0">\n                                                <input name="push_notification" value="desktop" type="radio">\n                                                <span><i></i>Desktop Notification<a id="desktop-test" href="javascript:void(0);" class="ml-2" style="font-size: 10px;color: #00a548c7;font-style: italic;">Test Me!</a></span>\n                                            </label>\n                                        </div>\n                                        <div class="text-muted mb-2 ml-4">\n                                            A Desktop Notification allows the user to be notified even when the user uses a different application, is on a different website/tab, or when the browser is minimized.\n                                            <div style="font-style: italic;">Note: Please <b>allow</b> the browser to send you notifications from this website.</div>\n                                        </div>\n                                        <div class="fancy-radio">\n                                            <label class="m-0">\n                                                <input name="push_notification" value="none" type="radio">\n                                                <span><i></i>None</span>\n                                            </label>\n                                        </div>\n                                        <div class="text-muted mb-2 ml-4">The user will not receive any type of push notifications from this website.</div>\n                                    </div>\n                                    <div class="col-md-12" style="padding-top: 15px;border-top: 1px solid #eee;margin-top: 15px;">\n                                        <h5>Log-in Sessions</h5>\n                                        <span class="text-muted">If you notice any unfamiliar devices or locations, click 'Logout' to end the session.</span>\n                                    </div>\n                                    <div class="col-md-12 mt-1">\n                                        <div class="table-wrapper">\n                                            <table id="tbl-sessions" class="table table-hover table-bordered">\n                                                <thead></thead>\n                                                <tbody></tbody>\n                                            </table>\n                                        </div>\n                                    </div>\n                                    ${!0===ISMOBILE?`<div class="col-md-12 mt-4">\n                                        <h5>Current Version</h5>\n                                        <span class="text-muted">${VERSION}</span>\n                                    </div>`:""}\n                                </div>\n                            </div>\n                        </div>`},dashboard:function(){var e="";return(clientCustom.visibleStatus||[]).forEach(t=>{switch(t){case"in_transit":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.5%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b in_transit><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">In Transit</div>\n                                                </div>\n                                            </div>';break;case"total_shipment":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b total_shipment><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Total Shipment</div>\n                                                </div>\n                                            </div>';break;case"incomplete":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b incomplete><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Incomplete</div>\n                                                </div>\n                                            </div>';break;case"scheduled":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b scheduled><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Scheduled</div>\n                                                </div>\n                                            </div>';break;case"assigned":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b assigned><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Assigned</div>\n                                                </div>\n                                            </div>';break;case"queueingAtOrigin":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b queueingAtOrigin><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Queueing (Origin)</div>\n                                                </div>\n                                            </div>';break;case"processingAtOrigin":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b processingAtOrigin><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Processing (Origin)</div>\n                                                </div>\n                                            </div>';break;case"onSite":e+=' <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                    <div class="summary-container" style="height: 92px;">\n                                                        <b onSite><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                        <div class="summary-red font-11 font-normal">On-Site</div>\n                                                    </div>\n                                                </div>';break;case"returning":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b returning><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Returning</div>\n                                                </div>\n                                            </div>';break;case"complete":e+='<div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                                <div class="summary-container" style="height: 92px;">\n                                                    <b complete><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></b>\n                                                    <div class="summary-red font-11 font-normal">Complete</div>\n                                                </div>\n                                            </div>'}}),`<div id="dashboard-page" class="page-box row">\n                        <div class="col-sm-12" style="height: 66px;">\n                            <span style="font-size: 30px;font-family: Montserrat;" class="font-lighter mt-2 d-inline-block">\n                                <span class="text-success" style="font-weight: 500;">Deployment</span> Dashboard\n                            </span>\n                        </div>\n                        <div class="col-sm-12 mb-2"><a id="reset-btn" href="javascript:void(0);" style="display:none;color: gray;text-decoration: underline;pointer-events:none;">Reset filters</a></div>\n                        <div class="col-sm-12" style="height: 28px;">\n                            <div class="d-inline-block" style="width: 160px;">\n                                <div class="switch-toggle switch-3 switch-candy">\n                                    <input id="on" name="view-d" type="radio" checked="checked" value="destination">\n                                    <label for="on">Destination</label>\n                                    <input id="off" name="view-d" type="radio" value="origin">\n                                    <label for="off">Origin</label>\n                                    <a></a>\n                                </div>\n                            </div>\n                            <span class="float-right" style="max-width:200px;display:inline-block;">\n                                <span>\n                                    <div class="input-group">\n                                        <span class="input-group-addon"><i id="icon-date" class="la la-calendar"></i></span>\n                                        <input id="_date" class="form-control" type="text" readonly>\n                                    </div>\n                                </span>\n                            </span>\n                        </div>\n                        <div class="summary-parent-container col-sm-12 mt-2">\n                            ${e}\n                        </div>\n                        <div class="col-sm-12 mt-3">\n                            <ul id="_regions" class="nav nav-tabs" role="tablist" style="pointer-events: none;width: 84%;"></ul>\n                            <div style="position: absolute;top: -9px;right: 15px;z-index: 0;">\n                                <select id="_site" style="width:160px !important;display:none;"></select>\n                            </div>\n                            <div class="table-wrapper">\n                                <table id="tbl-dashboard" class="table table-hover table-bordered" style="margin-top:0px !important;">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},de_dashboard:function(){return'<div id="dashboard-page" class="page-box row">\n                        <div class="col-sm-12" style="height: 66px;">\n                            <span style="font-size: 30px;font-family: Montserrat;" class="font-lighter mt-2 d-inline-block">\n                                <span class="text-success" style="font-weight: 500;">Delay Escalation</span> Dashboard\n                            </span>\n                            <span class="float-right" style="max-width:200px;display:inline-block;">\n                                <h2 _TIME_ class="m-0 font-italic font-bold">00:00</h2>\n                                <span _DATE_ style="color: gray;font-size: 16px;">-/-/-</span>\n                            </span>\n                        </div>\n                        <div id="filter-container" class="col-sm-12" style="pointer-events: none;">\n                            <ul id="_regions" class="nav nav-tabs" role="tablist" style="width: 70%;"></ul>\n                            <div style="position: absolute;top: -9px;right: 15px;z-index: 0;">\n                                <select id="_baseplant" style="width:160px !important;;display:none;"></select>\n                            </div>\n                            <div style="position: absolute;top: -9px;right: 180px;z-index: 0;">\n                                <select id="_site" class="select-multiple-basic" multiple="multiple" style="min-width:160px !important;display:none;"></select>\n                            </div>\n                        </div>\n                        \x3c!-- LONG QUEUEING --\x3e\n                        <div class="col-sm-4 p-0">\n                            <div class="d-flex col-sm-12">\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.5%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span lq_esc_1 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 1</div>\n                                    </div>\n                                </div>\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span lq_esc_2 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 2</div>\n                                    </div>\n                                </div>\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span lq_esc_3 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 3</div>\n                                    </div>\n                                </div>\n                            </div>\n                            <h5 class="col-sm-12 summary-red text-center font-bold">LONG QUEUEING</h5>\n                            <div class="table-wrapper p-3">\n                                <table id="tbl-lq" class="table table-hover table-bordered" style="margin-top:0px !important;">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                        \x3c!-- END LONG QUEUEING --\x3e\n                        \x3c!-- OVER CICO --\x3e\n                        <div class="col-sm-4 p-0">\n                            <div class="d-flex col-sm-12">\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.5%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span oc_esc_1 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 1</div>\n                                    </div>\n                                </div>\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span oc_esc_2 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 2</div>\n                                    </div>\n                                </div>\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span oc_esc_3 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="font-11 font-normal" style="color: #939393;">Escalation 3</div>\n                                    </div>\n                                </div>\n                            </div>\n                            <h5 class="col-sm-12 summary-red text-center font-bold">OVER CICO</h5>\n                            <div class="table-wrapper p-3">\n                                <table id="tbl-oc" class="table table-hover table-bordered" style="margin-top:0px !important;">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                        \x3c!-- END OVER CICO --\x3e\n                        \x3c!-- OVER TRANSIT --\x3e\n                        <div class="col-sm-4 p-0">\n                            <div class="d-flex col-sm-12">\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.5%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span ot_esc_1 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 1</div>\n                                    </div>\n                                </div>\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span ot_esc_2 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 2</div>\n                                    </div>\n                                </div>\n                                <div class="col-sm-1 p-0 mt-1 summary-parent" style="min-width: 9.4%;">\n                                    <div class="summary-container summary-red" style="height: 92px;background: #f2f2f2;">\n                                        <span ot_esc_3 class="font-lighter" style="font-size: 37px;"><i class="la la-spin la-spinner" style="opacity: 0.3;"></i></span>\n                                        <div class="summary-red font-11 font-normal" style="color: #939393;">Escalation 3</div>\n                                    </div>\n                                </div>\n                            </div>\n                            <h5 class="col-sm-12 summary-red text-center font-bold">OVER TRANSIT</h5>\n                            <div class="table-wrapper p-3">\n                                <table id="tbl-ot" class="table table-hover table-bordered" style="margin-top:0px !important;">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                        \x3c!-- END OVER TRANSIT --\x3e\n                    </div>'},dispatch:function(){var e="",t="";!0===clientCustom.roundtrip&&(t='<option value="onSite">On-Site</option>\n                                <option value="returning">Returning</option>'),!0===clientCustom.scheduled&&(e='<div>\n                                        <div style="font-size: 10px;">Scheduled Date:</div>\n                                        <input type="text" id="_scheduled_date" class="clearable form-control" style="padding-left: 10px;" noval=true readonly>\n                                    </div>');var a="";return"development"==ENVIRONMENT&&(a=SLIDER.CLONE(`<div>\n                                                <div style="font-size: 10px;">Posting Date:</div>\n                                                <input type="text" id="clone_posting_date" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" default=true readonly>\n                                            </div>\n                                            <div class="mt-2 font-10">Note: Existing shipment numbers will not be cloned.</div>`)),`<div class="page-box row">\n                        ${SLIDER.FILTER(`<div>\n                                            <div style="font-size: 10px;">Departure Date:</div>\n                                            <input type="text" id="_departure_date" class="clearable form-control" style="padding-left: 10px;" noval=true readonly>\n                                        </div>\n                                        <div>\n                                            <div style="font-size: 10px;">Posting Date:</div>\n                                            <input type="text" id="_posting_date" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" default=true readonly>\n                                        </div>\n                                        ${e}\n                                        <div class="mt-2">\n                                            <div style="font-size: 10px;">Status:</div>\n                                            <select id="_status" class="form-control">\n                                                <option value="all">All</option>\n                                                <option value="plan">Plan</option>\n                                                <option value="scheduled">Scheduled</option>\n                                                <option value="assigned">Assigned</option>\n                                                <option value="queueingAtOrigin">Queueing (Origin)</option>\n                                                <option value="processingAtOrigin">Processing (Origin)</option>\n                                                <option value="idlingAtOrigin">Idling (Origin)</option>\n                                                <option value="in_transit">In Transit</option>\n                                                ${t}\n                                                <option value="complete">Complete</option>\n                                                <option value="incomplete">Incomplete</option>\n                                            </select>\n                                        </div>\n                                        <div class="mt-2">\n                                            <div style="font-size: 10px;">Region:</div>\n                                            <select id="_region" class="form-control"></select>\n                                        </div>\n                                        <div class="mt-2">\n                                            <div style="font-size: 10px;">Cluster:</div>\n                                            <select id="_cluster" class="form-control"></select>\n                                        </div>`)}\n                        ${a}\n                        <div id="alert"></div>\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-dispatch" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                        <div id="search-alert" class="col-sm-12 p-0" style="display:none;"></div>\n                    </div>`},shift_schedule:function(){return'<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-shift_schedule" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>'},dispatch_deleted:function(){return`<div class="page-box row">\n                        ${SLIDER.FILTER(`<div>\n                                            <div style="font-size: 10px;">Deleted Date:</div>\n                                            <input type="text" id="_timestamp" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" default=true readonly>\n                                        </div>\n                                        <div>\n                                            <div style="font-size: 10px;">Posting Date:</div>\n                                            <input type="text" id="_posting_date" class="clearable form-control" style="padding-left: 10px;" noval=true readonly>\n                                        </div>`)}\n                        <div id="alert"></div>\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-dispatch_deleted" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                        <div id="search-alert" class="col-sm-12 p-0" style="display:none;"></div>\n                    </div>`},reports:function(){var e="",t="";return((clientCustom.reports.ular||{}).roles||[]).includes(USER.role)&&(e='<div ular class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>User Login Activity Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>'),clientCustom.reports.desr&&(t+=' <div desr class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                        <span>Dispatch Entries Summary Report</span>\n                                        <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                                    </div>'),clientCustom.reports.ser&&(t+=' <div ser class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                        <span>Scheduled Entries Report</span>\n                                        <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                                    </div>'),clientCustom.reports.mtur&&(t+=' <div mtur class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                        <span>Manpower and Truck Utilization Report</span>\n                                        <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                                    </div>'),`<div class="page-box row">\n                        <div class="col-sm-4 mt-3">\n                            <div class="custom-btn-01 col-sm-12 pt-2 pb-2 pr-3 pl-3 disabled" no_function>\n                                <span>Deployment Visibility Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div cicor class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>CICO Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div otr class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>Over Transit Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div pbpa class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>Per Base Plant Activity</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div hwtr class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>Haulage Window Time Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled" no_function>\n                                <span>Attendance Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div tr class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>Trippage Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                            <div vcr class="custom-btn-01 col-sm-12 mt-1 pt-2 pb-2 pr-3 pl-3 disabled">\n                                <span>Vehicle CICO Report</span>\n                                <span class="float-right pt-1 pl-3 "><i class="la la-spin la-spinner"></i></span>\n                            </div>\n                        </div>\n                        <div class="col-sm-4 mt-3 ml-3">\n                            ${e}\n                            ${t}\n                        </div>\n                        <div style="font-size: 9px;font-weight: 100;" class="col-sm-12 text-muted mt-5">\n                            Please click 'Yes' when a pop-up appears saying "The file format and extension of 'FILENAME.xls' don't match. The file could be corrupted or unsafe. Unless you trust its source, don't open it. Do you want to open it anyway?".\n                        </div>\n                    </div>`},notifications:function(){return`<div class="page-box row">\n                        ${SLIDER.FILTER(`<div>\n                                                <div style="font-size: 10px;">Date & Time:</div>\n                                                <input type="text" id="_timestamp" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" readonly>\n                                            </div>\n                                            <div class="mt-2">\n                                                <div style="font-size: 10px;">Delay Type:</div>\n                                                <select id="_delay_type" class="form-control">\n                                                    <option value="all">All</option>\n                                                    <option value="Over CICO">Over CICO</option>\n                                                    <option value="Long Queueing">Long Queueing</option>\n                                                    <option value="Over Transit">Over Transit</option>\n                                                </select>\n                                            </div>\n                                            <div class="mt-2">\n                                                <div style="font-size: 10px;">Escalation:</div>\n                                                <select id="_escalation" class="form-control">\n                                                    <option value="all">All</option>\n                                                    <option value="1">1</option>\n                                                    <option value="2">2</option>\n                                                    <option value="3">3</option>\n                                                </select>\n                                            </div>`)}\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-notifications" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},event_viewer:function(){return`<div class="page-box row">\n                        ${SLIDER.FILTER(`<div>\n                                                <div style="font-size: 10px;">Date:</div>\n                                                <input type="text" id="_date" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" readonly>\n                                            </div>`)}\n                        ${SLIDER.REPORT()}\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-events" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},all_events:function(){return`<div class="page-box row">\n                        ${SLIDER.FILTER(`<div>\n                                                <div style="font-size: 10px;">Date:</div>\n                                                <input type="text" id="_date" class="clearable form-control" style="padding-left: 10px;" value="${DEFAULT_DATE}" readonly>\n                                            </div>`)}\n                        <div class="col-sm-12 mt-2">\n                            ${ALERT.HTML.INFO("This page displays all events sent by vehicles to WRU Dispatch. These events are saved regardless of conditions unlike in Event Viewer Page.","ml-0 mr-0 mt-2 mb-3",!0)}\n                            <div class="table-wrapper">\n                                <table id="tbl-all-events" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},users:function(){return'<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-users" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>'},regions:function(){return'<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-regions" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>'},clusters:function(){return'<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-clusters" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>'},geofences:function(){return`<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <small class="text-muted mb-2 d-block font-italic">Note: Changes made in <u data-toggle="tooltip" title="${CLIENT.ggsURL}">WRU Main</u> will reflect here after 2-4 minutes.</small>\n                            <div class="table-wrapper">\n                                <table id="tbl-geofences" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},routes:function(){return'<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-routes" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>'},vehicles:function(){return`<div class="page-box row">\n                        ${SLIDER.FILTER('<div class="mt-2">\n                                            <div style="font-size: 10px;">Site:</div>\n                                            <select id="_site" class="form-control">\n                                                <option value="All">All</option>\n                                            </select>\n                                        </div>')}\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <small class="text-muted mb-2 d-block font-italic">Note: Changes made in <u data-toggle="tooltip" title="${CLIENT.ggsURL}">WRU Main</u> will reflect here after 2-4 minutes.</small>\n                                <table id="tbl-vehicles" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},vehicle_personnel:function(){return'<div class="page-box row">\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-vehicle_personnel" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>'},trailers:function(){return`<div class="page-box row">\n                        ${SLIDER.FILTER('<div class="mt-2">\n                                            <div style="font-size: 10px;">Site:</div>\n                                            <select id="_site" class="form-control">\n                                                <option value="All">All</option>\n                                            </select>\n                                        </div>')}\n                        <div class="col-sm-12 mt-2">\n                            <div class="table-wrapper">\n                                <table id="tbl-trailers" class="table table-hover table-bordered">\n                                    <thead></thead>\n                                    <tbody></tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>`},changelogs:function(){return'<div class="page-box row">\n                        <div>\n                            <span class="ml-3 font-16">Current version: <b id="version"></b></span>\n                            <i id="guide-btn" class="la la-info-circle float-right pl-3 pr-3 pb-3 font-18" data-toggle="tooltip" title="Changelog Guide" style="cursor:pointer;"></i>\n                        </div>\n                    </div>'},new_version:function(){return'<div style="height: 100%;width: 100%;position: absolute;top: 0px;left: 0px;z-index: 99999999999;background-color: #0000002b;">\n                        <div style="display: table; height: 100%;  overflow: hidden;margin: auto;text-align: center;">\n                            <div style="#position: absolute; #top: 50%;display: table-cell; vertical-align: middle;">\n                                <div style="  background-color: white;padding: 75px 100px;color: #404040;font-size: 14px;border-radius: 4px;">\n                                    <h3>A new version of WD is available.</h3>\n                                    <div style="margin-top: 12px;"><a href="javascript:window.location.reload(true)">Click this to refresh.</a></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>'}}},modalViews=new function(){return{vehicles:{location_history:function(e){e.location=e.location||[];for(var t,a,i="",n=e.location.length-1;n>=0;n--){var s="";e.location[n].events.forEach(e=>{s+=`<tr>\n                                    <td style="border:none;">${DATETIME.FORMAT(new Date(e.timestamp),"MMM D, YYYY, h:mm:ss A")}</td>\n                                    <td>${e.RULE_NAME} (<span class="${"start"==e.stage?"text-success":"text-danger"}">${e.stage}</span>)</td>\n                                </tr>`}),t=`vehicleLocation${n}`,a=`${e.location[n].short_name} (${n+1})`,i+=`<div class="col-sm-12 ${void 0||""}">\n                                        <span class="font-14 font-normal">${a}</span>\n                                        <table id="${t}" class="table " style="width:100%;">\n                                            <thead></thead>\n                                            <tbody>\n                                                ${s}\n                                            </tbody>\n                                        </table>\n                                    </div>`}return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog">\n                                    <div class="modal-content" style="height: 100%;">\n                                        <div class="modal-header pb-2">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">${e.title}</h4>\n                                        </div>\n                                        <div class="modal-body row pt-2" style="height: calc(100% - 70px);">${i}</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`},data_maintenance:function(){return'<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog modal-md">\n                                    <div class="modal-content">\n                                        <div class="modal-header pb-2">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">Data Maintenance</h4>\n                                        </div>\n                                        <div class="modal-body row pt-2">\n                                            <div id="modal-error"></div>\n                                            <div class="col-sm-12">\n                                                <ul class="nav nav-tabs" role="tablist">\n                                                    <li class="active"><a href="#vehicles_section" role="tab" data-toggle="tab">Section</a></li>\n                                                    <li class=""><a href="#vehicles_company" role="tab" data-toggle="tab">Company</a></li>\n                                                </ul>\n                                                <div class="tab-content">\n                                                    <div class="tab-pane fade in active" id="vehicles_section">\n                                                        <div class="pb-2" style="border-bottom: 1px solid #eee;">\n                                                            <input id="section" class="form-control" type="text" placeholder="Enter item" style="width: 80%;display: inline-block;">\n                                                            <div style="width: 19%;" class="d-inline-block pl-2">\n                                                                <button id="section-btn" class="form-control">Submit</button>\n                                                            </div>\n                                                        </div>\n                                                        <div id="section-list" style="max-height: 300px;overflow-y: auto;">\n                                                            <i class="la la-spin la-spinner" style="font-size: 18px;margin-top: 10px;color: #cecece;"></i>\n                                                        </div>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="vehicles_company">\n                                                        <div class="pb-2" style="border-bottom: 1px solid #eee;">\n                                                            <input id="company" class="form-control" type="text" placeholder="Enter item" style="width: 80%;display: inline-block;">\n                                                            <div style="width: 19%;" class="d-inline-block pl-2">\n                                                                <button id="company-btn" class="form-control">Submit</button>\n                                                            </div>\n                                                        </div>\n                                                        <div id="company-list" style="max-height: 300px;overflow-y: auto;">\n                                                            <i class="la la-spin la-spinner" style="font-size: 18px;margin-top: 10px;color: #cecece;"></i>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>'}},vehicle_personnel:{rest_days:function(e){var t="";return Object.keys(vehiclePersonnelCalendarOptions).forEach(e=>{var a=vehiclePersonnelCalendarOptions[e];t+=`<option value="_${e}">${a.optionTitle}</option>`}),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog modal-sm">\n                                    <div class="modal-content">\n                                        <div class="modal-header pb-2">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">\n                                                ${getVehiclePersonnel(e).name||"-"}\n                                                <div class="text-muted font-10">Rest Days/On-Leave Dates</div>\n                                            </h4>\n                                        </div>\n                                        <div class="modal-body row pt-2">\n                                            <div class="col-sm-12 p-0" style="border-right: 1px solid #eee;">\n                                                <div id="modal-error"></div>\n                                                <div class="col-sm-12">\n                                                    <small>Please choose:</small>\n                                                    <select id="calendar_type" class="form-control">${t}</select>\n                                                </div>\n                                                <div class="col-sm-12 mt-3" style="height: 310px;">\n                                                    <input type="text" id="inline-calendar" style="opacity:0;">\n                                                    <div class="fancy-checkbox custom-bgcolor-green" style="display:none;margin-top:265px;">\n                                                        <label>\n                                                            <input id="recurring" type="checkbox">\n                                                            <span class="toggle-vis">Recurring (for the next 30 weeks)</span>\n                                                        </label>\n                                                    </div>\n                                                </div>\n                                                <div class="col-sm-12"> \n                                                    <button id="submit" type="button" class="btn btn-primary col-sm-12 mt-4">Submit</button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`},data_maintenance:function(){return'<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog modal-md">\n                                    <div class="modal-content">\n                                        <div class="modal-header pb-2">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">Data Maintenance</h4>\n                                        </div>\n                                        <div class="modal-body row pt-2">\n                                            <div id="modal-error"></div>\n                                            <div class="col-sm-12">\n                                                <ul class="nav nav-tabs" role="tablist">\n                                                    <li class="active"><a href="#vehicle_personnel_section" role="tab" data-toggle="tab">Section</a></li>\n                                                    <li class=""><a href="#vehicle_personnel_company" role="tab" data-toggle="tab">Company</a></li>\n                                                </ul>\n                                                <div class="tab-content">\n                                                    <div class="tab-pane fade in active" id="vehicle_personnel_section">\n                                                        <div class="pb-2" style="border-bottom: 1px solid #eee;">\n                                                            <input id="section" class="form-control" type="text" placeholder="Enter item" style="width: 80%;display: inline-block;">\n                                                            <div style="width: 19%;" class="d-inline-block pl-2">\n                                                                <button id="section-btn" class="form-control">Submit</button>\n                                                            </div>\n                                                        </div>\n                                                        <div id="section-list" style="max-height: 300px;overflow-y: auto;">\n                                                            <i class="la la-spin la-spinner" style="font-size: 18px;margin-top: 10px;color: #cecece;"></i>\n                                                        </div>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="vehicle_personnel_company">\n                                                        <div class="pb-2" style="border-bottom: 1px solid #eee;">\n                                                            <input id="company" class="form-control" type="text" placeholder="Enter item" style="width: 80%;display: inline-block;">\n                                                            <div style="width: 19%;" class="d-inline-block pl-2">\n                                                                <button id="company-btn" class="form-control">Submit</button>\n                                                            </div>\n                                                        </div>\n                                                        <div id="company-list" style="max-height: 300px;overflow-y: auto;">\n                                                            <i class="la la-spin la-spinner" style="font-size: 18px;margin-top: 10px;color: #cecece;"></i>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>'}},events:{details:function(e,t=[]){var a="",i="";return t.forEach(e=>{a+=`<li>${e}</li>`}),CLIENT.allowDownloadFromOtherDB||(i=`<div class="col-sm-12">\n                                    <b>SHIPMENT NUMBERS:</b>\n                                    <ol class="pl-4">${a}</ol>\n                                </div>\n                                <div class="col-sm-12"><hr class="mt-2"></div>`),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                                <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                    <div class="modal-dialog modal-lg" role="document">\n                                        <div class="modal-content">\n                                            <div class="modal-header">\n                                                <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                                <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                            </div>\n                                            <div class="modal-body row">\n                                                ${i}\n                                                <div class="col-sm-12 mt-2">\n                                                    <div class="table-wrapper">\n                                                        <table id="tbl-notification" class="table table-hover table-bordered">\n                                                            <thead>\n                                                                <tr>\n                                                                    <th class="col-md-3">Key</th>\n                                                                    <th class="col-md-9">Value</th>\n                                                                </tr>\n                                                            </thead>\n                                                            <tbody></tbody>\n                                                        </table>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>`}},dispatch:{form:function(){var e="",t="",a="";return t=!0===clientCustom.editableTrailer?'<div class="col-sm-12 p-0">\n                                        <div class="col-sm-3">\n                                            <small><span class="text-danger">*</span>Truck:</small>\n                                            <select id="vehicle" class="select-multiple-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-3">\n                                            <small><span class="text-danger">*</span>Trailer:</small>\n                                            <select id="trailer" class="select-multiple-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-6" style="word-break: break-word;">\n                                            <table class="table mb-0">\n                                                <tbody>\n                                                    <tr>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Conduction #</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Cluster</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Base</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Region</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Pallet Type</small></td>\n                                                    </tr>\n                                                <tr>\n                                                    <td class="text-muted" conduction_number>-</td>\n                                                    <td class="text-muted" cluster>-</td>\n                                                    <td class="text-muted" base>-</td>\n                                                    <td class="text-muted" region>-</td>\n                                                    <td class="text-muted" pallet_type>-</td>\n                                                </tr>\n                                                </tbody>\n                                            </table>      \n                                        </div>\n                                    </div>':'<div class="col-sm-12 p-0">\n                                        <div class="col-sm-4">\n                                            <small><span class="text-danger">*</span>Truck:</small>\n                                            <select id="vehicle" class="select-multiple-basic" style="width:100%;"></select>\n                                        </div>\n                                        <div class="col-sm-8" style="word-break: break-word;">\n                                            <table class="table mb-0">\n                                                <tbody>\n                                                    <tr>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Trailer</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Cluster</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Base</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Region</small></td>\n                                                        <td class="pt-0" style="border-color: #fff !important;"><small>Pallet Type</small></td>\n                                                    </tr>\n                                                <tr>\n                                                    <td class="text-muted" trailer>-</td>\n                                                    <td class="text-muted" cluster>-</td>\n                                                    <td class="text-muted" base>-</td>\n                                                    <td class="text-muted" region>-</td>\n                                                    <td class="text-muted" pallet_type>-</td>\n                                                </tr>\n                                                </tbody>\n                                            </table>      \n                                        </div>\n                                    </div>',!0===clientCustom.autoGeneratedId&&(e="display:none;"),(clientCustom.previousCheckIns.roles||[]).includes(USER.role)&&(a='<div id="previous-checkins-container" style="word-break: break-word;" class="col-sm-7 mb-2">\n                                            <div>Truck\'s Previous Check-Ins (Based on Origin)</div>\n                                            <div>\n                                                <table id="previous-checkins" class="table mb-0 mt-2">\n                                                    <thead>\n                                                        <tr>\n                                                            <td class="pt-0" style="border-color: #fff !important;">&nbsp;</td>\n                                                            <td class="pt-0" style="border-color: #fff !important;"><small>Check-In Time</small></td>\n                                                            <td class="pt-0" style="border-color: #fff !important;"><small>Check-Out Time</small></td>\n                                                            <td class="pt-0" style="border-color: #fff !important;"><small>Origin</small></td>\n                                                            <td class="pt-0" style="border-color: #fff !important;"><small>Destination</small></td>\n                                                        </tr>\n                                                    </thead>\n                                                    <tbody></tbody>\n                                                </table>\n                                            </div>\n                                        </div>'),`<div class="page-box row">\n                            <div id="error" class="ml-3 mr-3" style="display:none;"></div>\n                            <div id="alert" class="col-sm-12"></div>\n                            <div id="loading-text" style="display:none;" class="col-sm-12 pb-3">\n                                <small class="text-danger"><i class="la la-circle-o-notch la-spin mr-2"></i>Loading data...</small>\n                            </div>\n                            <div class="col-sm-12 p-0">\n                                <div class="col-sm-4" style="${e}">\n                                    <small>Shipment Number:</small>\n                                    <input id="shipment_number" type="text" class="form-control" placeholder="Shipment Number" autocomplete="off">\n                                    <small class="text-muted" style="font-style: italic;">Once saved, shipment number cannot be edited.</small>\n                                </div>\n                                <div class="col-sm-4">\n                                    <small><span class="text-danger">*</span>Ticket Number:</small>\n                                    <input id="ticket_number" class="form-control" type="text" placeholder="Ticket Number" autocomplete="off">\n                                    \x3c!--<div class="input-group">\n                                        <input id="ticket_number" class="form-control" type="text" placeholder="Ticket Number" autocomplete="off">\n                                        <span class="input-group-btn">\n                                            <button id="search-ticket-number" class="btn btn-primary" type="button" style="height: 34px;padding: 0px 12px;"><i class="la la-search mr-0" style="font-size: 13px;"></i></button>\n                                        </span>\n                                    </div>--\x3e\n                                </div>\n                                <div class="col-sm-4">\n                                    <small><span class="text-danger">*</span>Scheduled Date:</small>\n                                    <input id="scheduled_date" class="form-control" type="text" onkeydown="event.preventDefault()">\n                                </div>\n                                <div class="col-sm-4">\n                                    <small><span class="text-danger">*</span>Shift Schedule:</small>\n                                    <select id="shift_schedule" class="select-multiple-basic" style="width:100%;"></select>\n                                </div>\n                            </div>\n                            <div class="col-sm-12 mt-3 p-0">\n                                <div class="col-sm-4">\n                                    <small>Origin:</small>\n                                    <input id="origin" type="text" class="form-control" autocomplete="off" readonly>\n                                </div>\n                                <div class="col-sm-5">\n                                    <small><span class="text-danger">*</span>Route:</small>\n                                    <select id="route" class="select-multiple-basic" style="width:100%;"></select>\n                                    <small class="text-muted">Separate origin and destination by comma (,). e.g., Calasiao,BALANGA</small>\n                                    \x3c!--<input id="route" type="text" class="form-control ui-autocomplete-input" placeholder="Route" autocomplete="off" readonly>--\x3e\n                                </div>\n                            </div>\n                            <div class="col-sm-12 mt-2">\n                                <div class="table-wrapper" style="overflow: auto;">\n                                    <div class="table-title">\n                                        <small style="line-height: 28px;">Destination:</small>\n                                        \x3c!--<button type="button" id="new-destination" class="btn btn-default float-right" style="padding: 4px 10px;top: 0px;position: relative;"><i class="la la-plus"></i> Add Destination</button>--\x3e\n                                    </div>\n                                    <table id="tbl-destination" class="table table-bordered">\n                                        <thead>\n                                            <tr>\n                                                <th></th>\n                                                <th class="col-md-6">Location</th>\n                                                <th class="col-md-3">Transit Time (HH:MM)</th>\n                                                <th class="col-md-3">CICO (HH:MM)</th>\n                                                \x3c!--<th>Action</th>--\x3e\n                                            </tr>\n                                        </thead>\n                                        <tbody> </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                            ${t}\n                            ${a}\n                            <div class="col-sm-12 p-0 mb-3">\n                                <div class="col-sm-4">\n                                    <small><span class="text-danger">*</span>Driver:</small>\n                                    <select id="driver_id" class="select-multiple-basic" style="width:100%;"></select>\n                                </div>\n                                <div class="col-sm-4">\n                                    <small>Checker:</small>\n                                    <select id="checker_id" class="select-multiple-basic" style="width:100%;"></select>\n                                </div>\n                                <div class="col-sm-4">\n                                    <small>Helper:</small>\n                                    <select id="helper_id" class="select-multiple-basic" style="width:100%;"></select>\n                                </div>\n                            </div>\n                            <div class="col-sm-12 p-0">\n                                <div class="col-sm-7">\n                                    <small>Comments:</small>\n                                    <textarea id="comments" class="form-control" rows="2"></textarea>\n                                </div>\n                            </div>\n                            <div class="col-sm-7 mt-3">\n                                <div class="table-wrapper">\n                                    <div class="table-title">\n                                        <small style="line-height: 28px;">Attachment:</small>\n                                        <input id="new-file" type="file" class="hide">\n                                        <button id="new-attachment" type="button" class="btn btn-default float-right" style="padding: 4px 10px;top: -3px;position: relative;"><i class="la la-plus"></i> Add Attachment</button>\n                                    </div>\n                                    <table id="tbl-attachment" class="table table-bordered">\n                                        <thead>\n                                            <tr>\n                                                <th style="width: 35px;">#</th>\n                                                <th>Filename</th>\n                                                <th style="width: 50px;">Action</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody></tbody>\n                                    </table>\n                                </div>\n                            </div>\n                            <div class="col-sm-12"><hr></div>\n                            <div class="col-sm-12"><button id="submit" type="button" class="btn btn-primary">Update</button></div>\n                        </div>`},statusUpdate:function(e){var t="";return!0===clientCustom.roundtrip&&(t='<span status="onSite" class="col-sm-12 label label-blue label-transparent font-12 cursor-pointer active pb-2 pt-2 mt-1 d-block">ON-SITE</span>\n                                    <span status="returning" class="col-sm-12 label label-pink label-transparent font-12 cursor-pointer active pb-2 pt-2 mt-1 d-block">RETURNING</span>'),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="small-modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog modal-sm">\n                                    <div class="modal-content">\n                                        <div class="modal-header">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">Update Status</h4>\n                                            <small class="text-muted">Shipment Number: <b>${e}</b></small>\n                                            <small id="incomplete-data" class="text-danger d-block"></small>\n                                        </div>\n                                        <div class="modal-body row">\n                                            <div class="col-sm-12 mb-3">\n                                                <span status="plan" class="col-sm-12 label label-info label-transparent font-12 inactive cursor-pointer pb-2 pt-2 d-block">PLAN</span>\n                                                <span status="assigned" class="col-sm-12 label label-brown label-transparent font-12 inactive cursor-pointer pb-2 pt-2 mt-1 d-block">ASSIGNED</span>\n                                                <span status="queueingAtOrigin" class="col-sm-12 label label-warning label-transparent font-12 cursor-pointer active pb-2 pt-2 mt-1 d-block">QUEUEING (ORIGIN)</span>\n                                                <span status="processingAtOrigin" class="col-sm-12 label label-lime label-transparent font-12 cursor-pointer active pb-2 pt-2 mt-1 d-block">PROCESSING (ORIGIN)</span>\n                                                <span status="idlingAtOrigin" class="col-sm-12 label label-purple label-transparent font-12 cursor-pointer active pb-2 pt-2 mt-1 d-block">IDLING (ORIGIN)</span>\n                                                <span status="in_transit" class="col-sm-12 label label-orange label-transparent font-12 cursor-pointer active pb-2 pt-2 mt-1 d-block">IN TRANSIT</span>\n                                                ${t}\n                                                <span status="complete" class="col-sm-12 label label-success label-transparent font-12 inactive cursor-pointer pb-2 pt-2 mt-1 d-block">COMPLETE</span>\n                                                <span status="incomplete" class="col-sm-12 label label-danger label-transparent font-12 inactive cursor-pointer pb-2 pt-2 mt-1 d-block">INCOMPLETE</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`},import:function(){return'<div class="page-box row">\n                            <div class="col-md-12">\n                                <span class="text-muted">Click <a id="download-template-btn" href="javascript:void(0);"class="font-normal">here</a> to download the excel template.</span>\n                                <small class="text-info d-block font-italic">Excel Template Updated On: <u>04/21/2021</u></small>\n                            </div>\n                            <div class="col-md-12"><hr></div>\n                            <div class="col-md-6">\n                                <input type="file" class="dropify">\n                                <button id="import-btn" class="btn btn-primary mt-3">Import</button>\n                            </div>\n                            <div class="col-md-6">\n                                <div>\n                                    <h5>Report Import:<small class="float-right"><a id="reportDL" href="#" style="display:none;" target="_blank" download="WRU Dispatch Report.txt">Download report</a></small></h5>\n                                    <div>Successful imports: <b class="text-success" success_count>0</b> rows</div>\n                                    <div>Warnings:</div>\n                                    <ul warning_list></ul>\n                                    <div>Unsuccessful imports: <b class="text-danger" error_count>0</b> rows</div>\n                                    <div>Errors:</div>\n                                    <ul error_list></ul>\n                                </div>\n                            </div>\n                        </div>'},fullView:function(e){LIST.dispatch=LIST.dispatch||[];var t=LIST.dispatch.findIndex(t=>t._id==e),a=LIST.dispatch[t];function i(){if(console.log("view obj",a),a){var e=new Dispatch(a);$("body").append(e.fullView()),$(".history-details").css("max-height",$(".main-details").outerHeight()+"px")}}t>-1?i():GET.AJAX({url:`/api/dispatch/${CLIENT.id}/${USER.username}/${e}`,method:"GET",headers:{Authorization:SESSION_TOKEN}},function(e){a=e[0],i()})}},user:{create:function(e,t,a,i){var n=t||a?"readonly":"",s=t||a||{};return`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog modal-md" style="width:700px;">\n                                    <div class="modal-content">\n                                        <div class="modal-header pb-2">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">${e}</h4>\n                                            ${i?`<small class="text-muted">${i}</small>`:""}\n                                        </div>\n                                        <div class="modal-body row pt-2">\n                                            <div class="col-sm-5 p-0" style="border-right: 1px solid #eee;">\n                                                <div id="modal-error"></div>\n                                                <div class="col-sm-12">\n                                                    <small><span class="text-danger">*</span>Name:</small>\n                                                    <input id="name" type="text" class="form-control" value="${s.name||s.fullName||""}" placeholder="Name" autocomplete="off" required>\n                                                </div>\n                                                <div class="col-sm-12">\n                                                    <small><span class="text-danger">*</span>Username:</small>\n                                                    <input id="username" type="text" class="form-control" value="${s._id||s.username||""}" placeholder="Username" autocomplete="off" ${n} required>\n                                                </div>\n                                                <div class="col-sm-12">\n                                                    <small><span class="text-danger">*</span>Email:</small>\n                                                    <input id="email" type="email" class="form-control" value="${s.email||""}" placeholder="Email" autocomplete="off" required>\n                                                </div>\n                                                <div class="col-sm-12">\n                                                    <small>Phone Number:</small>\n                                                    <input id="phoneNumber" type="text" class="form-control" value="${s.phoneNumber||""}" autocomplete="off">\n                                                </div>\n                                                <div class="col-sm-12">\n                                                    <small>Role:</small>\n                                                    <select id="role" class="form-control" required></select>\n                                                </div>\n                                                <div class="col-sm-12">\n                                                    <small>Auto-logout on Window/Tab Closure:</small>\n                                                    <select id="exemptAutoLogout" class="form-control">\n                                                        <option value="false">No</option>\n                                                        <option value="true">Yes</option>\n                                                    </select>\n                                                </div>\n                                                <div class="col-sm-12"> \n                                                    <button id="submit" type="button" class="btn btn-primary col-sm-12 mt-4">Submit</button>\n                                                </div>\n                                            </div>\n                                            <div clas="col-sm-7">\n                                                <div id="priv-title" class="col-sm-7 font-normal mb-2 pb-2" style="border-bottom: 1px solid #eee;">Privileges of User</div>\n                                                <div class="col-sm-7" style="max-height: 270px;overflow: auto;">\n                                                    <table id="tbl-permission" class="table">\n                                                        <thead>\n                                                            <tr>\n                                                                <th style="width: 60%;">Page</th>\n                                                                <th>Read</th>\n                                                                <th>Create</th>\n                                                                <th>Update</th>\n                                                                <th>Delete</th>\n                                                            </tr>\n                                                        </thead>\n                                                        <tbody></tbody>\n                                                    </table>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`}},changelogs:{guide:function(){var e={chore:"Changes to the build process or auxiliary tools and libraries such as documentation generation.",feature:"A new feature.",fix:"A bug fix.",improved:"Significant improvements on UI/UX but neither fixes a bug or adds a feature.",other:"Changes in the system that does not fall under the other changelog types.",refactor:"A code change that neither fixes a bug, adds a feature, or provides significant changes/improvements.",release:"A new version release.",style:"Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)."},t={"[PAGE_NAME]":{desc:"Refers to the page/s where changes have been made.",color:"#334fe5"},"(SITE_VERSION)":{desc:"The version of the website. Either a Mobile version or Web version.",color:"#adadad"}},a="";return Object.keys(e).forEach(t=>{var i=e[t];a+=` <tr>\n                                    <td style="font-family: courier;">${t.capitalize()}</td>\n                                    <td>${i}</td>\n                                </tr>`}),a+=' <tr>\n                                <td style="font-family: courier;">&nbsp;</td>\n                                <td>&nbsp;</td>\n                            </tr>',Object.keys(t).forEach(e=>{var i=t[e];a+=` <tr>\n                                    <td style="font-family: courier;color: ${i.color};">${e}</td>\n                                    <td>${i.desc}</td>\n                                </tr>`}),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                            <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                <div role="document" class="modal-dialog modal-sm" style="width:500px;">\n                                    <div class="modal-content">\n                                        <div class="modal-header pb-2">\n                                            <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                            <h4 class="modal-title" id="myModalLabel2">Changelog Guide</h4>\n                                        </div>\n                                        <div class="modal-body row pt-2 pl-4 pr-4">\n                                            <table class="table">\n                                                <thead>\n                                                    <tr>\n                                                        <th style="width: 22%;">Title</th>\n                                                        <th>Description</th>\n                                                    </tr>\n                                                </thead>\n                                                <tbody>${a}</tbody>\n                                            </table>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`}},notice:{emptyProfile:function(){var e="";return CLIENT.allowDownloadFromOtherDB&&(e=`<li>Download Profile From WRU Dispatch - ${CLIENT.allowDownloadFromOtherDB}</li>`),`<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                                <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                    <div role="document" class="modal-dialog modal-sm">\n                                        <div class="modal-content">\n                                            <div class="modal-header pb-2">\n                                                <button type="button" class="close" id="close" aria-hidden="true">×</button>\n                                                <h5 class="modal-title" id="myModalLabel2">Set up your profile</h5>\n                                            </div>\n                                            <div class="modal-body row pt-2">\n                                                <div class="col-sm-12" style="text-align: justify;">\n                                                    Your <b class="text-primary">name</b> and/or <b class="text-primary">email</b> is empty. You can set up your profile by clicking the 'Go to Profile' button below.\n                                                    <br><br>\n                                                    You will be given the following options in setting up your profile:\n                                                    <ul style="padding-left: 20px;">\n                                                        <li>Download Profile From WRU Main</li>${e}\n                                                        <li>Manually edit your profile details</li>\n                                                    </ul>\n                                                    <div id="empty_profile" type="button" class="btn btn-primary col-sm-12 mt-3" style="width:100%;">Go to Profile</div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>`},browserNotSupported:function(){return'<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                        <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                            <div role="document" class="modal-dialog modal-sm">\n                                <div class="modal-content">\n                                    <div class="modal-header p-0" style="background: #00a548">                                         \n                                        <img src="https://www.pngkit.com/png/full/150-1507719_png-file-frown.png" style="width: 100px;padding: 25px;margin: auto;display: block;filter: invert();image-rendering: -webkit-optimize-contrast;">\n                                    </div>\n                                    <div class="modal-body row pt-2">\n                                        <div class="col-sm-12" style="text-align: center;">\n                                            <h5>Browser version is not supported</h5>\n                                            We\'re very sorry but the version of this browser is not supported. We recommend updating your browser, or try using other browsers such as Google Chrome, Firefox, or Microsoft Edge.\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>'},sessionTimeout:function(){return'<div id="overlay" class="swal2-container swal2-fade swal2-shown" style="overflow-y: auto;">\n                                <div id="modal" class="modal" role="dialog" aria-labelledby="myLargeModalLabel">\n                                    <div role="document" class="modal-dialog modal-sm">\n                                        <div class="modal-content">\n                                            <div class="modal-header pb-2">\n                                                <h5 class="modal-title" id="myModalLabel2">You have been idle</h5>\n                                            </div>\n                                            <div class="modal-body row pt-2">\n                                                <div class="col-sm-12">This page is being timed out due to inactivity for over 30 minutes. Please refresh the page.</div>\n                                                <div class="col-sm-12"> \n                                                    <button type="button" class="btn btn-primary col-sm-12 mt-2" onClick="window.location.reload();">Refresh</button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>'}}}},mobileOptions=new function(){return{notifications:{filter:function(){return'<div style="height: 30px;border-bottom: 1px solid #eee;box-shadow: 1px 1px 8px -6px black;position: fixed;width: 100%;z-index: 9;background: white;top: 40px;" class="dt-buttons pl-3">\n                            <button id="refresh-toggle" tabindex="0" aria-controls="tbl-notifications" type="button" data-toggle="tooltip" data-original-title="Refresh Table" style="float: left;color: green;border: none;background: none;font-size: 16px;padding: 0px 10px 0px 0px !important;font-weight: bold;" class="dt-button m-0">\n                                <span><i title="Refresh Table" class="la la-refresh"></i></span>\n                            </button>\n                            <button id="filter-toggle" class="dt-button" tabindex="0" aria-controls="tbl-notifications" type="button" data-toggle="tooltip" data-original-title="Filter" style="float: left;color: green;border: none;border-top-width: medium;border-right-width: medium;border-bottom-width: medium;border-left-width: medium;background: none;font-size: 16px;padding: 0px 10px 0px 8px !important;font-weight: bold;">\n                                <span><i class="la la-filter" title="Filter"></i></span>\n                            </button>\n                        </div>'}}}};"m"==s&&("development"!=ENVIRONMENT&&LOGGER.disableLogger(),WEBSOCKET.connect().then(()=>{SESSION_FROM_DB(function(){PAGE.MAIN.FUNCTION.init()},function(){LOGOUT()})}));
}